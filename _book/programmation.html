<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapitre 3 Programmation | R avancé</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapitre 3 Programmation | R avancé" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapitre 3 Programmation | R avancé" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Sébastien Déjean et Thibault Laurent" />


<meta name="date" content="2021-10-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="manipulation-de-données-avec-r.html"/>
<link rel="next" href="calcul-parallèle.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.3/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>
<script src="libs/d3-4.5.0/d3.min.js"></script>
<script src="libs/chordNetwork-binding-0.4/chordNetwork.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R avancé</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#principe-du-document"><i class="fa fa-check"></i><b>1.1</b> Principe du document</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#pré-requis"><i class="fa fa-check"></i><b>1.2</b> Pré-requis</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html"><i class="fa fa-check"></i><b>2</b> Manipulation de données avec <strong>R</strong></a>
<ul>
<li class="chapter" data-level="2.1" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#les-chaînes-de-caractères"><i class="fa fa-check"></i><b>2.1</b> Les chaînes de caractères</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#fonctions-de-base"><i class="fa fa-check"></i><b>2.1.1</b> Fonctions de base</a></li>
<li class="chapter" data-level="2.1.2" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#les-expressions-régulières"><i class="fa fa-check"></i><b>2.1.2</b> Les expressions régulières</a></li>
<li class="chapter" data-level="2.1.3" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#application-aux-tweets"><i class="fa fa-check"></i><b>2.1.3</b> Application aux tweets</a></li>
<li class="chapter" data-level="2.1.4" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#nuage-de-mots"><i class="fa fa-check"></i><b>2.1.4</b> Nuage de mots</a></li>
<li class="chapter" data-level="2.1.5" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#ordonnancement"><i class="fa fa-check"></i><b>2.1.5</b> Ordonnancement</a></li>
<li class="chapter" data-level="2.1.6" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#package-stringr"><i class="fa fa-check"></i><b>2.1.6</b> Package <strong>stringr</strong></a></li>
<li class="chapter" data-level="2.1.7" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#package-glue"><i class="fa fa-check"></i><b>2.1.7</b> Package <strong>glue</strong></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#les-facteurs"><i class="fa fa-check"></i><b>2.2</b> Les facteurs</a></li>
<li class="chapter" data-level="2.3" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#les-dates"><i class="fa fa-check"></i><b>2.3</b> Les dates</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#dates-et-unités-de-temps"><i class="fa fa-check"></i><b>2.3.1</b> Dates et unités de temps</a></li>
<li class="chapter" data-level="2.3.2" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#séries-temporelles"><i class="fa fa-check"></i><b>2.3.2</b> Séries temporelles</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#opérations-ensemblistes"><i class="fa fa-check"></i><b>2.4</b> Opérations ensemblistes</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#lunion"><i class="fa fa-check"></i><b>2.4.1</b> L’union</a></li>
<li class="chapter" data-level="2.4.2" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#lintersection"><i class="fa fa-check"></i><b>2.4.2</b> L’intersection</a></li>
<li class="chapter" data-level="2.4.3" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#la-différence-a-b-différent-de-b-a"><i class="fa fa-check"></i><b>2.4.3</b> La différence (<span class="math inline">\(A-B\)</span>, différent de <span class="math inline">\(B-A\)</span>)</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#manipulation-de-bases-de-données"><i class="fa fa-check"></i><b>2.5</b> Manipulation de bases de données</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#jointure-et-agrégation"><i class="fa fa-check"></i><b>2.5.1</b> Jointure et agrégation</a></li>
<li class="chapter" data-level="2.5.2" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#package-dplyr"><i class="fa fa-check"></i><b>2.5.2</b> Package <strong>dplyr</strong></a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#tidy-data"><i class="fa fa-check"></i><b>2.6</b> Tidy data</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#la-fonction-pivot_longer-transformer-des-colonnes-en-lignes"><i class="fa fa-check"></i><b>2.6.1</b> La fonction <em>pivot_longer()</em> : transformer des colonnes en lignes</a></li>
<li class="chapter" data-level="2.6.2" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#la-fonction-pivot_wider-transformer-des-lignes-en-colonnes"><i class="fa fa-check"></i><b>2.6.2</b> La fonction <em>pivot_wider()</em> : transformer des lignes en colonnes</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#gestion-de-données-volumineuses"><i class="fa fa-check"></i><b>2.7</b> Gestion de données volumineuses</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#optimiser-la-fonction-read.table"><i class="fa fa-check"></i><b>2.7.1</b> Optimiser la fonction <em>read.table()</em></a></li>
<li class="chapter" data-level="2.7.2" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#le-package-readr"><i class="fa fa-check"></i><b>2.7.2</b> Le package <strong>readr</strong></a></li>
<li class="chapter" data-level="2.7.3" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#autres-packages"><i class="fa fa-check"></i><b>2.7.3</b> Autres packages</a></li>
<li class="chapter" data-level="2.7.4" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#algorithme-de-type-mapreducce"><i class="fa fa-check"></i><b>2.7.4</b> Algorithme de type Map/Reducce</a></li>
<li class="chapter" data-level="2.7.5" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#interaction-avec-des-systèmes-de-gestion-de-bases-de-données"><i class="fa fa-check"></i><b>2.7.5</b> Interaction avec des systèmes de gestion de bases de données</a></li>
<li class="chapter" data-level="2.7.6" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#utiliser-la-syntaxe-sql"><i class="fa fa-check"></i><b>2.7.6</b> Utiliser la syntaxe SQL</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#visualiser-et-traiter-les-données-manquantes"><i class="fa fa-check"></i><b>2.8</b> Visualiser et traiter les données manquantes</a></li>
<li class="chapter" data-level="2.9" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#répertoires-et-fichiers"><i class="fa fa-check"></i><b>2.9</b> Répertoires et fichiers</a></li>
<li class="chapter" data-level="2.10" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#autour-de-lespace-de-travail"><i class="fa fa-check"></i><b>2.10</b> Autour de l’espace de travail</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="programmation.html"><a href="programmation.html"><i class="fa fa-check"></i><b>3</b> Programmation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="programmation.html"><a href="programmation.html#quelques-règles-de-style"><i class="fa fa-check"></i><b>3.1</b> Quelques règles de style</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="programmation.html"><a href="programmation.html#le-nom-des-fichiers-de-codes"><i class="fa fa-check"></i><b>3.1.1</b> Le nom des fichiers de codes</a></li>
<li class="chapter" data-level="3.1.2" data-path="programmation.html"><a href="programmation.html#le-nom-des-objets"><i class="fa fa-check"></i><b>3.1.2</b> Le nom des objets</a></li>
<li class="chapter" data-level="3.1.3" data-path="programmation.html"><a href="programmation.html#espace-entre-les-opérateurs"><i class="fa fa-check"></i><b>3.1.3</b> Espace entre les opérateurs</a></li>
<li class="chapter" data-level="3.1.4" data-path="programmation.html"><a href="programmation.html#les-conditions"><i class="fa fa-check"></i><b>3.1.4</b> Les conditions</a></li>
<li class="chapter" data-level="3.1.5" data-path="programmation.html"><a href="programmation.html#la-taille-dune-ligne"><i class="fa fa-check"></i><b>3.1.5</b> La taille d’une ligne</a></li>
<li class="chapter" data-level="3.1.6" data-path="programmation.html"><a href="programmation.html#affectation"><i class="fa fa-check"></i><b>3.1.6</b> Affectation</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="programmation.html"><a href="programmation.html#fixer-la-taille-des-vecteurs-si-on-la-connaît-à-lavance"><i class="fa fa-check"></i><b>3.2</b> Fixer la taille des vecteurs (si on la connaît à l’avance)</a></li>
<li class="chapter" data-level="3.3" data-path="programmation.html"><a href="programmation.html#temps-de-calcul-et-mémoire"><i class="fa fa-check"></i><b>3.3</b> Temps de calcul et mémoire</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="programmation.html"><a href="programmation.html#pour-mesurer-les-temps-de-calcul-efficacement"><i class="fa fa-check"></i><b>3.3.1</b> Pour mesurer les temps de calcul efficacement</a></li>
<li class="chapter" data-level="3.3.2" data-path="programmation.html"><a href="programmation.html#pour-comprendre-la-gestion-de-la-mémoire"><i class="fa fa-check"></i><b>3.3.2</b> Pour comprendre la gestion de la mémoire</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="programmation.html"><a href="programmation.html#fonction-vectorisée"><i class="fa fa-check"></i><b>3.4</b> Fonction vectorisée</a></li>
<li class="chapter" data-level="3.5" data-path="programmation.html"><a href="programmation.html#ecrire-un-code-en-c"><i class="fa fa-check"></i><b>3.5</b> Ecrire un code en C++</a></li>
<li class="chapter" data-level="3.6" data-path="programmation.html"><a href="programmation.html#insérer-du-code-python-dans-un-document-markdown"><i class="fa fa-check"></i><b>3.6</b> Insérer du code Python dans un document Markdown</a></li>
<li class="chapter" data-level="3.7" data-path="programmation.html"><a href="programmation.html#eviter-si-possible-les-boucles-apply-lapply-replicate-colsums-etc."><i class="fa fa-check"></i><b>3.7</b> Eviter si possible les boucles (<em>apply()</em>, <em>lapply()</em>, <em>replicate()</em>, <em>colSums()</em>, etc.)</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="programmation.html"><a href="programmation.html#apply-pour-les-matrixarray"><i class="fa fa-check"></i><b>3.7.1</b> <em>apply()</em> pour les <strong>matrix/array</strong></a></li>
<li class="chapter" data-level="3.7.2" data-path="programmation.html"><a href="programmation.html#les-fonctions-colsums-rowsums-colmeans-rowmeans"><i class="fa fa-check"></i><b>3.7.2</b> Les fonctions <em>colSums()</em>, <em>rowSums()</em>, <em>colMeans()</em>, <em>rowMeans()</em></a></li>
<li class="chapter" data-level="3.7.3" data-path="programmation.html"><a href="programmation.html#la-fonction-lapply"><i class="fa fa-check"></i><b>3.7.3</b> La fonction <em>lapply()</em></a></li>
<li class="chapter" data-level="3.7.4" data-path="programmation.html"><a href="programmation.html#la-fonction-sapply"><i class="fa fa-check"></i><b>3.7.4</b> La fonction <em>sapply()</em></a></li>
<li class="chapter" data-level="3.7.5" data-path="programmation.html"><a href="programmation.html#la-fonction-replicate"><i class="fa fa-check"></i><b>3.7.5</b> La fonction <em>replicate()</em></a></li>
<li class="chapter" data-level="3.7.6" data-path="programmation.html"><a href="programmation.html#la-fonction-mapply"><i class="fa fa-check"></i><b>3.7.6</b> La fonction <em>mapply()</em></a></li>
<li class="chapter" data-level="3.7.7" data-path="programmation.html"><a href="programmation.html#la-fonction-tapply"><i class="fa fa-check"></i><b>3.7.7</b> La fonction <em>tapply()</em></a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="programmation.html"><a href="programmation.html#améliorer-ses-fonctions"><i class="fa fa-check"></i><b>3.8</b> Améliorer ses fonctions</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="programmation.html"><a href="programmation.html#créer-des-sous-fonctions"><i class="fa fa-check"></i><b>3.8.1</b> Créer des sous-fonctions</a></li>
<li class="chapter" data-level="3.8.2" data-path="programmation.html"><a href="programmation.html#structure-de-contrôle"><i class="fa fa-check"></i><b>3.8.2</b> Structure de contrôle</a></li>
<li class="chapter" data-level="3.8.3" data-path="programmation.html"><a href="programmation.html#fonction-stopifnot"><i class="fa fa-check"></i><b>3.8.3</b> Fonction <em>stopifnot()</em></a></li>
<li class="chapter" data-level="3.8.4" data-path="programmation.html"><a href="programmation.html#les-arguments-dans-une-fonction"><i class="fa fa-check"></i><b>3.8.4</b> Les arguments dans une fonction</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="programmation.html"><a href="programmation.html#a-quoi-servent-les-fonctions-substitutequote-et-eval"><i class="fa fa-check"></i><b>3.9</b> A quoi servent les fonctions <em>substitute()/quote()</em> et <em>eval()</em> ?</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="programmation.html"><a href="programmation.html#les-fonctions-quote-et-substitute"><i class="fa fa-check"></i><b>3.9.1</b> Les fonctions <em>quote()</em> et <em>substitute()</em></a></li>
<li class="chapter" data-level="3.9.2" data-path="programmation.html"><a href="programmation.html#la-fonction-eval"><i class="fa fa-check"></i><b>3.9.2</b> La fonction <em>eval()</em></a></li>
<li class="chapter" data-level="3.9.3" data-path="programmation.html"><a href="programmation.html#débugger-une-fonction"><i class="fa fa-check"></i><b>3.9.3</b> Débugger une fonction</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="programmation.html"><a href="programmation.html#programmation-orientée-s3s4"><i class="fa fa-check"></i><b>3.10</b> Programmation orientée : S3/S4</a>
<ul>
<li class="chapter" data-level="3.10.1" data-path="programmation.html"><a href="programmation.html#la-norme-s3"><i class="fa fa-check"></i><b>3.10.1</b> La norme S3</a></li>
<li class="chapter" data-level="3.10.2" data-path="programmation.html"><a href="programmation.html#la-norme-s4"><i class="fa fa-check"></i><b>3.10.2</b> La norme S4</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="programmation.html"><a href="programmation.html#visualiser-le-code-source-dune-fonction"><i class="fa fa-check"></i><b>3.11</b> Visualiser le code source d’une fonction</a>
<ul>
<li class="chapter" data-level="3.11.1" data-path="programmation.html"><a href="programmation.html#la-fonction-est-dans-lenvironnement-courant"><i class="fa fa-check"></i><b>3.11.1</b> La fonction est dans l’environnement courant</a></li>
<li class="chapter" data-level="3.11.2" data-path="programmation.html"><a href="programmation.html#la-fonction-est-une-méthode-générique-de-type-s3"><i class="fa fa-check"></i><b>3.11.2</b> La fonction est une méthode générique de type S3</a></li>
<li class="chapter" data-level="3.11.3" data-path="programmation.html"><a href="programmation.html#la-fonction-fait-appel-à-du-code-c"><i class="fa fa-check"></i><b>3.11.3</b> La fonction fait appel à du code <strong>C</strong></a></li>
<li class="chapter" data-level="3.11.4" data-path="programmation.html"><a href="programmation.html#la-fonction-est-une-méthode-générique-de-type-s4"><i class="fa fa-check"></i><b>3.11.4</b> La fonction est une méthode générique de type S4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html"><i class="fa fa-check"></i><b>4</b> Calcul parallèle</a>
<ul>
<li class="chapter" data-level="4.1" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#principe-du-calcul-parallèle"><i class="fa fa-check"></i><b>4.1</b> Principe du calcul parallèle</a></li>
<li class="chapter" data-level="4.2" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#notion-de-programme-maître"><i class="fa fa-check"></i><b>4.2</b> Notion de programme maître</a></li>
<li class="chapter" data-level="4.3" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#fonction-set.seed"><i class="fa fa-check"></i><b>4.3</b> Fonction <em>set.seed()</em></a></li>
<li class="chapter" data-level="4.4" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#syntaxe-pour-lancer-un-calcul-parallèle"><i class="fa fa-check"></i><b>4.4</b> Syntaxe pour lancer un calcul parallèle</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#syntaxe-dans-le-cas-non-parallèle"><i class="fa fa-check"></i><b>4.4.1</b> Syntaxe dans le cas non parallèle</a></li>
<li class="chapter" data-level="4.4.2" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#syntaxe-dans-le-cas-parallèle"><i class="fa fa-check"></i><b>4.4.2</b> Syntaxe dans le cas parallèle</a></li>
<li class="chapter" data-level="4.4.3" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#recommandations"><i class="fa fa-check"></i><b>4.4.3</b> Recommandations</a></li>
<li class="chapter" data-level="4.4.4" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#récupérer-les-résultats"><i class="fa fa-check"></i><b>4.4.4</b> Récupérer les résultats</a></li>
<li class="chapter" data-level="4.4.5" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#utiliser-des-packages-objets-jeux-de-données-sur-les-différents-coeurs"><i class="fa fa-check"></i><b>4.4.5</b> Utiliser des packages, objets, jeux de données sur les différents coeurs</a></li>
<li class="chapter" data-level="4.4.6" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#fonctions-lapply-sapply-apply-mapply"><i class="fa fa-check"></i><b>4.4.6</b> Fonctions <em>lapply()</em>, <em>sapply()</em>, <em>apply()</em>, <em>mapply()</em></a></li>
<li class="chapter" data-level="4.4.7" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#autres-packages-de-calcul-parallèle"><i class="fa fa-check"></i><b>4.4.7</b> Autres packages de calcul parallèle</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#equilibrer-la-répartition-des-tâches"><i class="fa fa-check"></i><b>4.5</b> Equilibrer la répartition des tâches</a></li>
<li class="chapter" data-level="4.6" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#améliorer-la-répartition-des-tâches"><i class="fa fa-check"></i><b>4.6</b> Améliorer la répartition des tâches</a></li>
<li class="chapter" data-level="4.7" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#fonction-vectorisée-vs-calcul-vs-code-c"><i class="fa fa-check"></i><b>4.7</b> Fonction vectorisée VS calcul // VS code <strong>C++</strong></a></li>
<li class="chapter" data-level="4.8" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#reproductibilité-des-résultats-choix-de-la-graine-aléatoire"><i class="fa fa-check"></i><b>4.8</b> Reproductibilité des résultats : choix de la graine aléatoire</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html"><i class="fa fa-check"></i><b>5</b> Visualisation de données</a>
<ul>
<li class="chapter" data-level="5.1" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#fonctions-graphiques-de-base-vs-ggplot2"><i class="fa fa-check"></i><b>5.1</b> Fonctions graphiques de base VS <strong>ggplot2</strong></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#graphiques-standards"><i class="fa fa-check"></i><b>5.1.1</b> Graphiques standards</a></li>
<li class="chapter" data-level="5.1.2" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#graphiques-conditionnels"><i class="fa fa-check"></i><b>5.1.2</b> Graphiques conditionnels</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#présentation-de-graphiques-originaux"><i class="fa fa-check"></i><b>5.2</b> Présentation de graphiques originaux</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#mélange-boîte-à-moustachediagramme-de-dispersion"><i class="fa fa-check"></i><b>5.2.1</b> Mélange boîte à moustache/diagramme de dispersion</a></li>
<li class="chapter" data-level="5.2.2" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#violin-plot"><i class="fa fa-check"></i><b>5.2.2</b> Violin plot</a></li>
<li class="chapter" data-level="5.2.3" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#ridgeline-plots"><i class="fa fa-check"></i><b>5.2.3</b> Ridgeline plots</a></li>
<li class="chapter" data-level="5.2.4" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#barres-derreurs"><i class="fa fa-check"></i><b>5.2.4</b> Barres d’erreurs</a></li>
<li class="chapter" data-level="5.2.5" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#cleveland-dot-chart"><i class="fa fa-check"></i><b>5.2.5</b> Cleveland dot chart</a></li>
<li class="chapter" data-level="5.2.6" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#area-chart"><i class="fa fa-check"></i><b>5.2.6</b> Area chart</a></li>
<li class="chapter" data-level="5.2.7" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#correlation-plot"><i class="fa fa-check"></i><b>5.2.7</b> Correlation plot</a></li>
<li class="chapter" data-level="5.2.8" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#représenter-les-effets-des-variables-explicatives"><i class="fa fa-check"></i><b>5.2.8</b> Représenter les effets des variables explicatives</a></li>
<li class="chapter" data-level="5.2.9" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#mosaic-plot"><i class="fa fa-check"></i><b>5.2.9</b> Mosaic plot</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#présenter-des-tableaux-de-résultats"><i class="fa fa-check"></i><b>5.3</b> Présenter des tableaux de résultats</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#la-fonction-kable"><i class="fa fa-check"></i><b>5.3.1</b> La fonction <span class="math inline">\(kable()\)</span></a></li>
<li class="chapter" data-level="5.3.2" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#la-fonction-stargazer"><i class="fa fa-check"></i><b>5.3.2</b> La fonction <span class="math inline">\(stargazer()\)</span></a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#graphiques-interactifs"><i class="fa fa-check"></i><b>5.4</b> Graphiques interactifs</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#via-plotly"><i class="fa fa-check"></i><b>5.4.1</b> Via <strong>plotly</strong></a></li>
<li class="chapter" data-level="5.4.2" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#via-d3"><i class="fa fa-check"></i><b>5.4.2</b> Via <strong>D3</strong></a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#mini-introduction-à-shiny"><i class="fa fa-check"></i><b>5.5</b> Mini-introduction à <strong>shiny</strong></a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#un-premier-exemple"><i class="fa fa-check"></i><b>5.5.1</b> Un premier exemple</a></li>
<li class="chapter" data-level="5.5.2" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#quelques-fonctionnalités-de-shiny"><i class="fa fa-check"></i><b>5.5.2</b> Quelques fonctionnalités de <strong>shiny</strong></a></li>
<li class="chapter" data-level="5.5.3" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#publier-ses-applications"><i class="fa fa-check"></i><b>5.5.3</b> Publier ses applications</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="hello-bookdown.html"><a href="hello-bookdown.html"><i class="fa fa-check"></i><b>6</b> Hello bookdown</a>
<ul>
<li class="chapter" data-level="6.1" data-path="hello-bookdown.html"><a href="hello-bookdown.html#a-section"><i class="fa fa-check"></i><b>6.1</b> A section</a>
<ul>
<li class="chapter" data-level="" data-path="hello-bookdown.html"><a href="hello-bookdown.html#an-unnumbered-section"><i class="fa fa-check"></i>An unnumbered section</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="cross.html"><a href="cross.html"><i class="fa fa-check"></i><b>7</b> Cross-references</a>
<ul>
<li class="chapter" data-level="7.1" data-path="cross.html"><a href="cross.html#chapters-and-sub-chapters"><i class="fa fa-check"></i><b>7.1</b> Chapters and sub-chapters</a></li>
<li class="chapter" data-level="7.2" data-path="cross.html"><a href="cross.html#captioned-figures-and-tables"><i class="fa fa-check"></i><b>7.2</b> Captioned figures and tables</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="parts.html"><a href="parts.html"><i class="fa fa-check"></i><b>8</b> Parts</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="9" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html"><i class="fa fa-check"></i><b>9</b> Footnotes and citations</a>
<ul>
<li class="chapter" data-level="9.1" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html#footnotes"><i class="fa fa-check"></i><b>9.1</b> Footnotes</a></li>
<li class="chapter" data-level="9.2" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html#citations"><i class="fa fa-check"></i><b>9.2</b> Citations</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="blocks.html"><a href="blocks.html"><i class="fa fa-check"></i><b>10</b> Blocks</a>
<ul>
<li class="chapter" data-level="10.1" data-path="blocks.html"><a href="blocks.html#equations"><i class="fa fa-check"></i><b>10.1</b> Equations</a></li>
<li class="chapter" data-level="10.2" data-path="blocks.html"><a href="blocks.html#theorems-and-proofs"><i class="fa fa-check"></i><b>10.2</b> Theorems and proofs</a></li>
<li class="chapter" data-level="10.3" data-path="blocks.html"><a href="blocks.html#callout-blocks"><i class="fa fa-check"></i><b>10.3</b> Callout blocks</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="sharing-your-book.html"><a href="sharing-your-book.html"><i class="fa fa-check"></i><b>11</b> Sharing your book</a>
<ul>
<li class="chapter" data-level="11.1" data-path="sharing-your-book.html"><a href="sharing-your-book.html#publishing"><i class="fa fa-check"></i><b>11.1</b> Publishing</a></li>
<li class="chapter" data-level="11.2" data-path="sharing-your-book.html"><a href="sharing-your-book.html#pages"><i class="fa fa-check"></i><b>11.2</b> 404 pages</a></li>
<li class="chapter" data-level="11.3" data-path="sharing-your-book.html"><a href="sharing-your-book.html#metadata-for-sharing"><i class="fa fa-check"></i><b>11.3</b> Metadata for sharing</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R avancé</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="programmation" class="section level1" number="3">
<h1><span class="header-section-number">Chapitre 3</span> Programmation</h1>
<p>Nous allons voir dans ce chapitre des éléments de programmation qui permettent de gagner en clarté et simplicité dans le code et parfois en temps de calcul.</p>
<p>Ce document a été généré directement depuis <strong>RStudio</strong> en utilisant l’outil Markdown. La version <em>.pdf</em> se trouve <a href="chapitre_2_avance.pdf">ici</a>.</p>
<p><strong>Packages à installer</strong></p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="programmation.html#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>((<span class="fu">c</span>(<span class="st">&quot;ggplot2&quot;</span>, <span class="co"># Graphiques ggplot2</span></span>
<span id="cb370-2"><a href="programmation.html#cb370-2" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;kableExtra&quot;</span>, <span class="co"># Insérer des tables dans Markdown</span></span>
<span id="cb370-3"><a href="programmation.html#cb370-3" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;Matrix&quot;</span>, <span class="co"># Matrice creuse</span></span>
<span id="cb370-4"><a href="programmation.html#cb370-4" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;microbenchmark&quot;</span>, <span class="co"># Temps de calcul</span></span>
<span id="cb370-5"><a href="programmation.html#cb370-5" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;pryr&quot;</span>, <span class="co"># Mieux comprendre R</span></span>
<span id="cb370-6"><a href="programmation.html#cb370-6" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;Rcpp&quot;</span>, <span class="co"># Faire appel à du code C++</span></span>
<span id="cb370-7"><a href="programmation.html#cb370-7" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;reticulate&quot;</span> <span class="co"># Interface vers Python</span></span>
<span id="cb370-8"><a href="programmation.html#cb370-8" aria-hidden="true" tabindex="-1"></a>                    )))</span></code></pre></div>
<p>On montre un exemple pour utiliser du code <strong>Python</strong>. Pour cela, on aura besoin de la bibliothèque <strong>pandas</strong>:</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="programmation.html#cb371-1" aria-hidden="true" tabindex="-1"></a>reticulate<span class="sc">::</span><span class="fu">py_install</span>(<span class="st">&quot;pandas&quot;</span>)</span></code></pre></div>
<div id="quelques-règles-de-style" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Quelques règles de style</h2>
<p><strong>R</strong> n’a pas de <a href="https://www.python.org/dev/peps/pep-0008/">PEP 8</a> comme c’est le cas pour Python. En revanche, pour des raisons évidentes de clarté et de lisibilité pour soi-même et pour les éventuels collègues qui vont lire notre code, il est important d’essayer de respecter si possible quelques règles d’écritures de codes. On s’est inspiré ici de ces deux documents :</p>
<ul>
<li><p><a href="http://adv-r.had.co.nz/Style.html">“Style guide””</a> de Hadley Wickham dans le livre “<strong>R</strong> advanced”</p></li>
<li><p><a href="https://google.github.io/styleguide/Rguide.xml">“Google’s <strong>R</strong> style guide”</a></p></li>
</ul>
<div id="le-nom-des-fichiers-de-codes" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Le nom des fichiers de codes</h3>
<p>Appeler vos fichiers de code avec l’extension <em>.R</em> et donner des noms clairs à vos fichiers de codes, en utilisant éventuellement le symbole underscore ou le trait d’union entre les différents mots. Par exemple :</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="programmation.html#cb372-1" aria-hidden="true" tabindex="-1"></a>traitement<span class="sc">-</span>base.R</span>
<span id="cb372-2"><a href="programmation.html#cb372-2" aria-hidden="true" tabindex="-1"></a>fonctions<span class="sc">-</span>utiles.R</span>
<span id="cb372-3"><a href="programmation.html#cb372-3" aria-hidden="true" tabindex="-1"></a>exploration.R</span>
<span id="cb372-4"><a href="programmation.html#cb372-4" aria-hidden="true" tabindex="-1"></a>prediction.R</span></code></pre></div>
</div>
<div id="le-nom-des-objets" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Le nom des objets</h3>
<p>Eviter d’appeler vos objets avec des noms de fonctions existants ou de mots clés. Le nombre de caratères devrait être restreint même si le nom doit avoir un sens pour le lecteur. On peut utiliser le symbole underscore ou le point pour séparer des mots entre eux :</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="programmation.html#cb373-1" aria-hidden="true" tabindex="-1"></a>arbre_reg</span>
<span id="cb373-2"><a href="programmation.html#cb373-2" aria-hidden="true" tabindex="-1"></a>rf_reg</span>
<span id="cb373-3"><a href="programmation.html#cb373-3" aria-hidden="true" tabindex="-1"></a>glm_reg</span></code></pre></div>
</div>
<div id="espace-entre-les-opérateurs" class="section level3" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> Espace entre les opérateurs</h3>
<p>Aérer au maximum les opérations (affectation, calcul, utilisation de fonctions, etc.) par des espaces :</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="programmation.html#cb374-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="cn">NA</span>, <span class="dv">4</span>, <span class="dv">3</span>) </span>
<span id="cb374-2"><a href="programmation.html#cb374-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Exception faite pour les opérateurs <strong>:</strong>, <strong>::</strong> et <strong>:::</strong> où il ne faut pas d’espace :</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="programmation.html#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb375-2"><a href="programmation.html#cb375-2" aria-hidden="true" tabindex="-1"></a>stats<span class="sc">::</span>lm</span></code></pre></div>
</div>
<div id="les-conditions" class="section level3" number="3.1.4">
<h3><span class="header-section-number">3.1.4</span> Les conditions</h3>
<p>Quand on utilise les conditions <strong>if/else</strong>, <strong>for</strong>, <strong>while</strong> :</p>
<ul>
<li><p>laisser un espace après le mot clé,</p></li>
<li><p>l’accolade ouvrante se trouve à la fin de la ligne contenant le mot clé, l’accolande fermante se trouve sur une nouvelle ligne,</p></li>
<li><p>mettre deux espaces en début de ligne (indentation) à partir de la seconde ligne jusqu’à la fin de la condition,</p></li>
<li><p>si des conditions sont imbriquées, la nouvelle condition devrait se trouver sur la même ligne que l’accolade fermante de la première condition.</p></li>
</ul>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="programmation.html#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (y <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> debug) {</span>
<span id="cb376-2"><a href="programmation.html#cb376-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&quot;Y is negative&quot;</span>)</span>
<span id="cb376-3"><a href="programmation.html#cb376-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="programmation.html#cb377-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb377-2"><a href="programmation.html#cb377-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log</span>(x)</span>
<span id="cb377-3"><a href="programmation.html#cb377-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb377-4"><a href="programmation.html#cb377-4" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">^</span> x</span>
<span id="cb377-5"><a href="programmation.html#cb377-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="la-taille-dune-ligne" class="section level3" number="3.1.5">
<h3><span class="header-section-number">3.1.5</span> La taille d’une ligne</h3>
<p>Essayer de limiter 80 caractères à une ligne de code.</p>
</div>
<div id="affectation" class="section level3" number="3.1.6">
<h3><span class="header-section-number">3.1.6</span> Affectation</h3>
<p>Pour affecter une valeur à un objet essayer d’utiliser l’opérateur <strong>&lt;-</strong> plutôt que <strong>=</strong>.</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="programmation.html#cb378-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">5</span></span></code></pre></div>
<p><strong>Remarque :</strong> sur <strong>RStudio</strong> quelques-une des règles ci-dessus sont implémentées par défaut, notamment les indentations après les boucles ou les fonctions.</p>
<p><strong>Exercice 2.1</strong></p>
<p>Mettre le code suivant en utilisant les règles de style présentées ci-dessus:</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="programmation.html#cb379-1" aria-hidden="true" tabindex="-1"></a>my_mean<span class="ot">=</span><span class="cf">function</span>(x)</span>
<span id="cb379-2"><a href="programmation.html#cb379-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb379-3"><a href="programmation.html#cb379-3" aria-hidden="true" tabindex="-1"></a><span class="co"># verification</span></span>
<span id="cb379-4"><a href="programmation.html#cb379-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.numeric</span>(x))</span>
<span id="cb379-5"><a href="programmation.html#cb379-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">&quot;x must be a numeric vector&quot;</span>)</span>
<span id="cb379-6"><a href="programmation.html#cb379-6" aria-hidden="true" tabindex="-1"></a><span class="co"># initialization</span></span>
<span id="cb379-7"><a href="programmation.html#cb379-7" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span> <span class="fu">length</span>(x) </span>
<span id="cb379-8"><a href="programmation.html#cb379-8" aria-hidden="true" tabindex="-1"></a>res <span class="ot">=</span><span class="dv">0</span></span>
<span id="cb379-9"><a href="programmation.html#cb379-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) </span>
<span id="cb379-10"><a href="programmation.html#cb379-10" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb379-11"><a href="programmation.html#cb379-11" aria-hidden="true" tabindex="-1"></a>  res<span class="ot">=</span> res<span class="sc">+</span>x[k]</span>
<span id="cb379-12"><a href="programmation.html#cb379-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb379-13"><a href="programmation.html#cb379-13" aria-hidden="true" tabindex="-1"></a><span class="co"># return res</span></span>
<span id="cb379-14"><a href="programmation.html#cb379-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(res<span class="sc">/</span> n)</span>
<span id="cb379-15"><a href="programmation.html#cb379-15" aria-hidden="true" tabindex="-1"></a>}  </span></code></pre></div>
</div>
</div>
<div id="fixer-la-taille-des-vecteurs-si-on-la-connaît-à-lavance" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Fixer la taille des vecteurs (si on la connaît à l’avance)</h2>
<p>On a le problème suivant : on souhaite obtenir un vecteur de taille <span class="math inline">\(n\)</span> contenant des valeurs simulées issues d’une loi gaussienne centrée et réduite, mais on ne souhaite garder que les valeurs supérieures à un paramètre <strong>a</strong> (égal à 0 par défaut). Dans la fonction <em>trunc_rnorm.1()</em> ci-dessous, nous ne précisons pas la taille du vecteur <strong>x</strong> qui sera retourné. A chaque fois qu’une valeur répond au critère, on la concatène au vecteur <strong>x</strong> en utilisant la commande <em>c()</em>. Le défaut de cette méthode est que <strong>R</strong> est sans arrêt en train d’allouer un nouvel espace mémoire pour le vecteur <strong>x</strong> qu’on modifie à chaque fois puisqu’on change sa taille.</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="programmation.html#cb380-1" aria-hidden="true" tabindex="-1"></a>trunc_rnorm<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(n, <span class="at">a =</span> <span class="dv">0</span>) {</span>
<span id="cb380-2"><a href="programmation.html#cb380-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">0</span>)</span>
<span id="cb380-3"><a href="programmation.html#cb380-3" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb380-4"><a href="programmation.html#cb380-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (i <span class="sc">&lt;=</span> n) {</span>
<span id="cb380-5"><a href="programmation.html#cb380-5" aria-hidden="true" tabindex="-1"></a>    r <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>)</span>
<span id="cb380-6"><a href="programmation.html#cb380-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (r <span class="sc">&gt;</span> a) {</span>
<span id="cb380-7"><a href="programmation.html#cb380-7" aria-hidden="true" tabindex="-1"></a>      x <span class="ot">&lt;-</span> <span class="fu">c</span>(x, r)</span>
<span id="cb380-8"><a href="programmation.html#cb380-8" aria-hidden="true" tabindex="-1"></a>      i <span class="ot">=</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb380-9"><a href="programmation.html#cb380-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb380-10"><a href="programmation.html#cb380-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb380-11"><a href="programmation.html#cb380-11" aria-hidden="true" tabindex="-1"></a> x</span>
<span id="cb380-12"><a href="programmation.html#cb380-12" aria-hidden="true" tabindex="-1"></a>}  </span></code></pre></div>
<p>C’est pourquoi lorsqu’on connaît à l’avance la taille du vecteur qu’on souhaite créer, on créé le vecteur avec la bonne taille et l’espace mémoire alloué à ce vecteur est fixée dès le début. C’est la seule différence avec la fonction <em>trunc_rnorm.2()</em> ci-dessous où on a précisé la taille de <strong>x</strong> dès le départ. On affecte ensuite à chaque élément de <strong>x</strong> la valeur qu’on souhaite garder.</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="programmation.html#cb381-1" aria-hidden="true" tabindex="-1"></a>trunc_rnorm<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(n, <span class="at">a =</span> <span class="dv">0</span>) {</span>
<span id="cb381-2"><a href="programmation.html#cb381-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb381-3"><a href="programmation.html#cb381-3" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb381-4"><a href="programmation.html#cb381-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (i <span class="sc">&lt;=</span> n) {</span>
<span id="cb381-5"><a href="programmation.html#cb381-5" aria-hidden="true" tabindex="-1"></a>    r <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>)</span>
<span id="cb381-6"><a href="programmation.html#cb381-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (r <span class="sc">&gt;</span> a) {</span>
<span id="cb381-7"><a href="programmation.html#cb381-7" aria-hidden="true" tabindex="-1"></a>      x[i] <span class="ot">&lt;-</span> r</span>
<span id="cb381-8"><a href="programmation.html#cb381-8" aria-hidden="true" tabindex="-1"></a>      i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span>}</span>
<span id="cb381-9"><a href="programmation.html#cb381-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb381-10"><a href="programmation.html#cb381-10" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb381-11"><a href="programmation.html#cb381-11" aria-hidden="true" tabindex="-1"></a>}  </span></code></pre></div>
<p>On constate que les différences de temps de calcul sont assez importantes :</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="programmation.html#cb382-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(<span class="fu">trunc_rnorm.1</span>(<span class="dv">10000</span>))</span></code></pre></div>
<pre><code>## utilisateur     système      écoulé 
##       0.513       0.012       0.525</code></pre>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="programmation.html#cb384-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(<span class="fu">trunc_rnorm.2</span>(<span class="dv">10000</span>))</span></code></pre></div>
<pre><code>## utilisateur     système      écoulé 
##       0.052       0.000       0.052</code></pre>
</div>
<div id="temps-de-calcul-et-mémoire" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Temps de calcul et mémoire</h2>
<div id="pour-mesurer-les-temps-de-calcul-efficacement" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Pour mesurer les temps de calcul efficacement</h3>
<p>Si vous répétez les instructions précédentes successivement, vous constaterez que les temps de calculs sont à chaque fois différents. Ceci s’explique par le fait que les machines sur lesquelles on travaille exécutent plusieurs tâches à la fois, qui ne sont pas toujours les mêmes à l’instant <span class="math inline">\(t\)</span>. Aussi, une façon de rendre robuste ces temps de calcul est de répéter un certain nombre de fois ces mêmes commandes et de présenter ensuite les résultats statistiques sur ces temps de calcul.</p>
<p>Pour cela, on peut bien évidemment utiliser une boucle <strong>for</strong> ainsi et faire ensuite des statistiques de base</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="programmation.html#cb386-1" aria-hidden="true" tabindex="-1"></a>my_time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time_1 =</span> <span class="fu">numeric</span>(<span class="dv">10</span>),</span>
<span id="cb386-2"><a href="programmation.html#cb386-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">time_2 =</span> <span class="fu">numeric</span>(<span class="dv">10</span>))</span>
<span id="cb386-3"><a href="programmation.html#cb386-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (b <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb386-4"><a href="programmation.html#cb386-4" aria-hidden="true" tabindex="-1"></a> my_time<span class="sc">$</span>time_1[b] <span class="ot">&lt;-</span> <span class="fu">system.time</span>(<span class="fu">trunc_rnorm.1</span>(<span class="dv">10000</span>))[<span class="dv">3</span>]</span>
<span id="cb386-5"><a href="programmation.html#cb386-5" aria-hidden="true" tabindex="-1"></a> my_time<span class="sc">$</span>time_2[b] <span class="ot">&lt;-</span> <span class="fu">system.time</span>(<span class="fu">trunc_rnorm.2</span>(<span class="dv">10000</span>))[<span class="dv">3</span>]</span>
<span id="cb386-6"><a href="programmation.html#cb386-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb386-7"><a href="programmation.html#cb386-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(my_time)</span></code></pre></div>
<pre><code>##      time_1           time_2       
##  Min.   :0.4750   Min.   :0.04100  
##  1st Qu.:0.4835   1st Qu.:0.04225  
##  Median :0.4880   Median :0.04300  
##  Mean   :0.4930   Mean   :0.04400  
##  3rd Qu.:0.4920   3rd Qu.:0.04550  
##  Max.   :0.5430   Max.   :0.04900</code></pre>
<p>Sinon, on utilise la fonction <em>microbenchmark()</em> du package <strong>microbenchmark</strong> (Mersmann et al., 2019). En général, on regarde la moyenne.</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="programmation.html#cb388-1" aria-hidden="true" tabindex="-1"></a>mbm <span class="ot">&lt;-</span> microbenchmark<span class="sc">::</span><span class="fu">microbenchmark</span>(</span>
<span id="cb388-2"><a href="programmation.html#cb388-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">trunc_rnorm.1</span>(<span class="at">n =</span> <span class="dv">10000</span>),</span>
<span id="cb388-3"><a href="programmation.html#cb388-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">trunc_rnorm.2</span>(<span class="at">n =</span> <span class="dv">10000</span>),</span>
<span id="cb388-4"><a href="programmation.html#cb388-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">times =</span> 10L)</span>
<span id="cb388-5"><a href="programmation.html#cb388-5" aria-hidden="true" tabindex="-1"></a>mbm</span></code></pre></div>
<pre><code>## Unit: milliseconds
##                      expr       min        lq      mean    median       uq
##  trunc_rnorm.1(n = 10000) 387.63234 450.58393 444.56901 452.97367 455.4502
##  trunc_rnorm.2(n = 10000)  40.06732  41.49308  61.54328  61.22532  81.8476
##        max neval
##  469.68414    10
##   83.61398    10</code></pre>
<p>Par ailleurs, il est possible de représenter graphiquement ces résultats avec la fonction <em>autoplot()</em> du package <strong>ggplot2</strong>.</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="programmation.html#cb390-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">autoplot</span>(mbm)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-191-1.png" width="672" /></p>
</div>
<div id="pour-comprendre-la-gestion-de-la-mémoire" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Pour comprendre la gestion de la mémoire</h3>
<p>Lorsqu’on crée un vecteur sous <strong>R</strong>, celui-ci est stocké sur un espace mémoire que l’on peut identifier avec la fonction <em>address()</em> du package <strong>pryr</strong> (Wickham, 2019).</p>
<p>Par exemple :</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="programmation.html#cb391-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;pryr&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Attachement du package : &#39;pryr&#39;</code></pre>
<pre><code>## L&#39;objet suivant est masqué depuis &#39;package:data.table&#39;:
## 
##     address</code></pre>
<pre><code>## Les objets suivants sont masqués depuis &#39;package:purrr&#39;:
## 
##     compose, partial</code></pre>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="programmation.html#cb395-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">10</span>)</span>
<span id="cb395-2"><a href="programmation.html#cb395-2" aria-hidden="true" tabindex="-1"></a><span class="fu">address</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;0x5617589ffcb8&quot;</code></pre>
<p>Lorsqu’on attribue de nouvelles valeurs à ce vecteur, l’adresse ne change pas :</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="programmation.html#cb397-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb397-2"><a href="programmation.html#cb397-2" aria-hidden="true" tabindex="-1"></a>  x[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>) <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb397-3"><a href="programmation.html#cb397-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">address</span>(x))</span>
<span id="cb397-4"><a href="programmation.html#cb397-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;0x561758b6fac8&quot;
## [1] &quot;0x561758b6fac8&quot;
## [1] &quot;0x561758b6fac8&quot;
## [1] &quot;0x561758b6fac8&quot;
## [1] &quot;0x561758b6fac8&quot;
## [1] &quot;0x561758b6fac8&quot;
## [1] &quot;0x561758b6fac8&quot;
## [1] &quot;0x561758b6fac8&quot;
## [1] &quot;0x561758b6fac8&quot;
## [1] &quot;0x561758b6fac8&quot;</code></pre>
<p>En revanche, si on change la taille de ce vecteur, <strong>R</strong> va systématiquement réserver un nouvel espace mémoire, ce qui est une opération coûteuse en temps calcul, d’où des temps de calcul plus long. Par exemple :</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="programmation.html#cb399-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb399-2"><a href="programmation.html#cb399-2" aria-hidden="true" tabindex="-1"></a>  x[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>) <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb399-3"><a href="programmation.html#cb399-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">address</span>(x))</span>
<span id="cb399-4"><a href="programmation.html#cb399-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;0x561759c9f538&quot;
## [1] &quot;0x561759c9f488&quot;
## [1] &quot;0x561759c9f3d8&quot;
## [1] &quot;0x561759c9f328&quot;
## [1] &quot;0x561759c9f278&quot;
## [1] &quot;0x561759c9f1c8&quot;
## [1] &quot;0x56175942c3a0&quot;
## [1] &quot;0x561762fb6030&quot;
## [1] &quot;0x56174f8294f0&quot;
## [1] &quot;0x5617601c28b0&quot;</code></pre>
<p><strong>Exercice 2.2</strong></p>
<p>Comparer les temps de calcul des trois expressions suivantes. Représenter graphiquement la variation des temps de calcul.</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="programmation.html#cb401-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="sc">^</span> <span class="dv">6</span></span>
<span id="cb401-2"><a href="programmation.html#cb401-2" aria-hidden="true" tabindex="-1"></a><span class="co"># expression 1</span></span>
<span id="cb401-3"><a href="programmation.html#cb401-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb401-4"><a href="programmation.html#cb401-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) </span>
<span id="cb401-5"><a href="programmation.html#cb401-5" aria-hidden="true" tabindex="-1"></a>  x[k] <span class="ot">&lt;-</span> (<span class="dv">5</span> <span class="sc">==</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">1</span>))</span>
<span id="cb401-6"><a href="programmation.html#cb401-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(x)</span>
<span id="cb401-7"><a href="programmation.html#cb401-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expression 2</span></span>
<span id="cb401-8"><a href="programmation.html#cb401-8" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb401-9"><a href="programmation.html#cb401-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) </span>
<span id="cb401-10"><a href="programmation.html#cb401-10" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">c</span>(x, (<span class="dv">5</span> <span class="sc">==</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">1</span>)))</span>
<span id="cb401-11"><a href="programmation.html#cb401-11" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(x)</span>
<span id="cb401-12"><a href="programmation.html#cb401-12" aria-hidden="true" tabindex="-1"></a><span class="co"># expression 3</span></span>
<span id="cb401-13"><a href="programmation.html#cb401-13" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb401-14"><a href="programmation.html#cb401-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n)</span>
<span id="cb401-15"><a href="programmation.html#cb401-15" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x <span class="sc">+</span> (<span class="dv">5</span> <span class="sc">==</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">1</span>))</span>
<span id="cb401-16"><a href="programmation.html#cb401-16" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(x)</span></code></pre></div>
</div>
</div>
<div id="fonction-vectorisée" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Fonction vectorisée</h2>
<p><strong>R</strong> est un langage interprété et de ce fait, l’exécution de boucles est coûteuse en temps calcul, contrairement à des langages compilés. Pour palier ce problème, les concepteurs du langage <strong>R</strong> ont créé de nombreuses fonctions vectorisées, c’est-à-dire qui peuvent s’appliquer à des vecteurs et qui font en général appel à des fonctions codées en <strong>C</strong> ou <strong>Fortran</strong> pour gagner en rapidité. Pour comprendre ce concept, on va comparer les deux méthodes suivantes dont le but est de calculer la somme des éléments d’un vecteur simulée selon une loi <span class="math inline">\(\mathcal{N}(0,1)\)</span>.</p>
<ul>
<li>Méthode 1 : on utilise des boucles depuis <strong>R</strong></li>
</ul>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="programmation.html#cb402-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1000000</span>)</span>
<span id="cb402-2"><a href="programmation.html#cb402-2" aria-hidden="true" tabindex="-1"></a>my_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb402-3"><a href="programmation.html#cb402-3" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb402-4"><a href="programmation.html#cb402-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">seq_along</span>(vec)) {</span>
<span id="cb402-5"><a href="programmation.html#cb402-5" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> res <span class="sc">+</span> vec[k] </span>
<span id="cb402-6"><a href="programmation.html#cb402-6" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb402-7"><a href="programmation.html#cb402-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb402-8"><a href="programmation.html#cb402-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>Méthode 2 : on utilise la fonction <em>sum()</em> sur un vecteur. Cette dernière va bien entendu effectuer une boucle, mais elle sera effectuée en langage compilé, donc plus rapidement.</li>
</ul>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="programmation.html#cb403-1" aria-hidden="true" tabindex="-1"></a>microbenchmark<span class="sc">::</span><span class="fu">microbenchmark</span>(</span>
<span id="cb403-2"><a href="programmation.html#cb403-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">my_sum</span>(vec), </span>
<span id="cb403-3"><a href="programmation.html#cb403-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">sum</span>(vec), </span>
<span id="cb403-4"><a href="programmation.html#cb403-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">times =</span> 10L)</span></code></pre></div>
<pre><code>## Unit: microseconds
##         expr      min        lq      mean    median        uq       max neval
##  my_sum(vec) 70359.05 70805.562 72186.157 71397.803 72500.110 77398.049    10
##     sum(vec)   976.48   986.132  1024.114  1003.488  1067.377  1107.622    10</code></pre>
<p><strong>Remarque :</strong> il existe de nombreuses fonctions de base qui sont vectorisées et qui permettent de gagner en temps de calcul et on les utilise souvent sans s’en rendre compte. Par exemple, les fonctions <em>log()</em>, <em>cos()</em>, <em>exp()</em>, etc. Dès lors qu’on est amener à faire des boucles, cela peut valoir le coup de se poser la question : est-ce qu’il n’existe pas de fonctions prédéfinies et vectorisées qui feraient déjà ce qu’on souhaite faire, en un temps plus rapide.</p>
<p><strong>Exercise 2.3</strong></p>
<p>Ecrire la fonction <em>my_sd()</em> qui calcule l’écart-type d’un vecteur <strong>numeric</strong>. La fonction ne pourra pas faire appel ni à la fonction <em>sum()</em> ni <em>mean()</em> et ne pourra avoir qu’une seule boucle. Comparer les temps de calcul avec <em>sd()</em>.</p>
</div>
<div id="ecrire-un-code-en-c" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Ecrire un code en C++</h2>
<p>Lorsqu’on a identifié certaines parties d’un code qui sont coûteuses en temps calcul, il peut être intéressant de coder ces parties sous formes de fonctions écrites en <strong>C++</strong> et d’appeler ensuite ces fonctions depuis <strong>R</strong>.</p>
<p>Par exemple, on va convertir la fonction <em>my_sum()</em> écrite en <strong>R</strong> en code <strong>C++</strong>. On présente ci-dessous le code inclus dans le fichier <a href="R/sumcplusplus.cpp">sumcplusplus.cpp</a>.</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb405-1"><a href="programmation.html#cb405-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span><span class="pp"> </span><span class="co">// pour utiliser des fonctions de base</span></span>
<span id="cb405-2"><a href="programmation.html#cb405-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp<span class="op">;</span></span>
<span id="cb405-3"><a href="programmation.html#cb405-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-4"><a href="programmation.html#cb405-4" aria-hidden="true" tabindex="-1"></a><span class="co">// La commande suivante permet d&#39;appeler ensuite les fonctions </span></span>
<span id="cb405-5"><a href="programmation.html#cb405-5" aria-hidden="true" tabindex="-1"></a><span class="co">// crées depuis R</span></span>
<span id="cb405-6"><a href="programmation.html#cb405-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-7"><a href="programmation.html#cb405-7" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::export]] </span></span>
<span id="cb405-8"><a href="programmation.html#cb405-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-9"><a href="programmation.html#cb405-9" aria-hidden="true" tabindex="-1"></a><span class="co">// début de la function</span></span>
<span id="cb405-10"><a href="programmation.html#cb405-10" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> sum_rcpp<span class="op">(</span>NumericVector x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb405-11"><a href="programmation.html#cb405-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> res <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb405-12"><a href="programmation.html#cb405-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> n <span class="op">=</span> x<span class="op">.</span>size<span class="op">();</span></span>
<span id="cb405-13"><a href="programmation.html#cb405-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb405-14"><a href="programmation.html#cb405-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb405-15"><a href="programmation.html#cb405-15" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> res <span class="op">+</span> x<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb405-16"><a href="programmation.html#cb405-16" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb405-17"><a href="programmation.html#cb405-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb405-18"><a href="programmation.html#cb405-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> res<span class="op">;</span></span>
<span id="cb405-19"><a href="programmation.html#cb405-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>L’algorithme utilisé dans la fonction <em>sum_rcpp()</em> présente la même syntaxe que la fonction <em>my_sum()</em> écrite en <strong>R</strong>. Par contre, il faut utiliser les particularités du langage <strong>C++</strong>. Parmi ces particularités :</p>
<ul>
<li><p>il faut définir le type de l’objet qui sera retourné par la fonction,</p></li>
<li><p>de manière générale, il faut définir le type de tous les objets créés et/ou utilisés. En effet, on a du définir le type de tous les paramètres d’entrée. Même dans la boucle <strong>for</strong>, on a définir le type de <strong>i</strong> qui sert d’incrément,</p></li>
<li><p>les lignes de code se terminent par le point virgule,</p></li>
<li><p>l’opérateur d’affectation est le symbole <strong>=</strong>,</p></li>
<li><p>la boucle <strong>for</strong> s’utilise différemment que du code <strong>R</strong>,</p></li>
<li><p>pour connaître la taille d’un vecteur, on a utilisé la méthode <em>.size()</em> qui retourne un entier,</p></li>
<li><p>l’indexation du vecteur commence à 0 et on utiliser les parenthèses pour accéder à un élément du vecteur.</p></li>
</ul>
<p>Une fois la fonction écrite, il faut la charger sous <strong>R</strong>. Pour cela, on utilise la fonction <em>sourceCpp()</em> du package <strong>Rcpp</strong> (Eddelbuettel et al., 2019) qui est le package <strong>R</strong> le plus utilisé par d’autres packages.</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="programmation.html#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;Rcpp&quot;</span>)</span>
<span id="cb406-2"><a href="programmation.html#cb406-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sourceCpp</span>(<span class="st">&quot;R/sumcplusplus.cpp&quot;</span>)</span></code></pre></div>
<p>On peut ensuite appeler directement la fonction créée :</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="programmation.html#cb407-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum_rcpp</span>(vec)</span></code></pre></div>
<pre><code>## [1] 270.4123</code></pre>
<p>Depuis <strong>R</strong> Markdown, il est possible d’insérer du code écrit <strong>C++</strong> directement à l’intérieur d’un chunk. Pour cela, il suffit de cliquer depuis <strong>RStudio</strong> sur l’onglet “Insert,” puis “Rcpp” et cela aura pour effet d’insérer une balise de code qui sera compilée au moment de son évaluation (autrement dit, <em>sourceCpp()</em> est automatiquement exécutée).</p>
<p>Si on compare les temps de calcul avec <em>my_func()</em> et la fonction <em>sum()</em>, on constate que <em>sum_rcpp()</em> est presque 20 fois plus rapides que <em>my_sum()</em> et 4 fois plus lentes que <em>sum()</em>.</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="programmation.html#cb409-1" aria-hidden="true" tabindex="-1"></a> microbenchmark<span class="sc">::</span><span class="fu">microbenchmark</span>(</span>
<span id="cb409-2"><a href="programmation.html#cb409-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">my_sum</span>(vec),</span>
<span id="cb409-3"><a href="programmation.html#cb409-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">sum</span>(vec), </span>
<span id="cb409-4"><a href="programmation.html#cb409-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">sum_rcpp</span>(vec),</span>
<span id="cb409-5"><a href="programmation.html#cb409-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">times =</span> 10L)</span></code></pre></div>
<pre><code>## Unit: microseconds
##           expr       min        lq      mean     median        uq       max
##    my_sum(vec) 69689.651 69825.396 70915.932 70436.3255 71291.139 74511.302
##       sum(vec)   975.490   978.049  1165.809   997.3865  1067.974  2483.762
##  sum_rcpp(vec)  3890.062  3922.382  4156.705  4001.0020  4032.852  5802.086
##  neval
##     10
##     10
##     10</code></pre>
<p>Pour en savoir plus sur l’utilisation de code <strong>C++</strong> depuis <strong>R</strong>, on recommande le document suivant : <a href="http://adv-r.had.co.nz/Rcpp.html" class="uri">http://adv-r.had.co.nz/Rcpp.html</a></p>
<p><strong>Exercise 2.4</strong></p>
<p>Ecrire la fonction <em>my_sd_cpp()</em> en <strong>C++</strong> qui calcule l’écart-type d’un vecteur <strong>numeric</strong>. Comparer les temps de calcul avec <em>sd()</em>.</p>
<p><strong>Remarque :</strong> en <strong>C++</strong>, on utilise <em>pow(a, b)</em> pour calculer <span class="math inline">\(a^b\)</span></p>
</div>
<div id="insérer-du-code-python-dans-un-document-markdown" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> Insérer du code Python dans un document Markdown</h2>
<p>Il est possible d’exécuter du code <strong>Python</strong> dans un document <strong>R</strong> Markdown et d’importer ensuite les objets créés sous <strong>R</strong> pour les utiliser.</p>
<p>Pour cela, il suffit de cliquer depuis <strong>RStudio</strong> sur l’onglet Insert, puis Python et cela aura pour effet d’insérer une balise de code Python</p>
<pre><code>```{python}
```</code></pre>
<p>Par exemple, on va executer les lignes de commande <strong>Python</strong> suivantes dans lesquelles on a créé l’objet <strong>flights</strong> :</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb412-1"><a href="programmation.html#cb412-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas</span>
<span id="cb412-2"><a href="programmation.html#cb412-2" aria-hidden="true" tabindex="-1"></a>flights <span class="op">=</span> pandas.read_csv(<span class="st">&quot;http://www.thibault.laurent.free.fr/cours/R_avance/flights.csv&quot;</span>)</span>
<span id="cb412-3"><a href="programmation.html#cb412-3" aria-hidden="true" tabindex="-1"></a>flights <span class="op">=</span> flights[flights[<span class="st">&#39;Dest&#39;</span>] <span class="op">==</span> <span class="st">&quot;TPA&quot;</span>]</span>
<span id="cb412-4"><a href="programmation.html#cb412-4" aria-hidden="true" tabindex="-1"></a>flights <span class="op">=</span> flights[[<span class="st">&#39;UniqueCarrier&#39;</span>, <span class="st">&#39;DepDelay&#39;</span>, <span class="st">&#39;ArrDelay&#39;</span>]]</span>
<span id="cb412-5"><a href="programmation.html#cb412-5" aria-hidden="true" tabindex="-1"></a>flights <span class="op">=</span> flights.dropna()</span></code></pre></div>
<p>Pour rappatrier l’objet <strong>Python</strong> dans <strong>R</strong>, il suffit ensuite d’utiliser la commande <strong>py$</strong> du package <strong>reticulate</strong> (Ushey et al., 2019) suivi de l’objet à rappatrier :</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="programmation.html#cb413-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;reticulate&quot;</span>)</span>
<span id="cb413-2"><a href="programmation.html#cb413-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb413-3"><a href="programmation.html#cb413-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(py<span class="sc">$</span>flights, <span class="fu">aes</span>(UniqueCarrier, ArrDelay)) <span class="sc">+</span> </span>
<span id="cb413-4"><a href="programmation.html#cb413-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb413-5"><a href="programmation.html#cb413-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>()</span></code></pre></div>
</div>
<div id="eviter-si-possible-les-boucles-apply-lapply-replicate-colsums-etc." class="section level2" number="3.7">
<h2><span class="header-section-number">3.7</span> Eviter si possible les boucles (<em>apply()</em>, <em>lapply()</em>, <em>replicate()</em>, <em>colSums()</em>, etc.)</h2>
<p>On va parler ici des fonctions <em>apply()</em>, <em>lapply</em>, <em>sapply()</em>, <em>mapply()</em>, <em>tapply()</em>. Les différences en temps de calcul ne sont pas significatives par rapport à l’utilisation de boucles, dans la mesure où implicitement, ces fonctions font le même travail que les boucles. L’idée de ces fonctions est de réduire le nombre de lignes de code qu’on utiliserait en faisant des boucles à la place.</p>
<p>On va voir qu’on utilise une de ces fonctions plutôt qu’une autre selon le type de l’objet considéré en entrée et selon le type d’objets que l’on souhaite en sortie. On verra également la fonction <em>replicate()</em> qui utilise les propriétés de la fonction <em>sapply()</em>, mais pour un usage un peu différent.</p>
<p>On présentera également les fonctions <em>colSums()</em>, <em>rowSums()</em>, <em>colMeans()</em>, <em>rowMeans()</em> qui sont plus performantes qu’utiliser la fonction <em>apply()</em> car elles sont vectorisées.</p>
<div id="apply-pour-les-matrixarray" class="section level3" number="3.7.1">
<h3><span class="header-section-number">3.7.1</span> <em>apply()</em> pour les <strong>matrix/array</strong></h3>
<p>Une <strong>matrix</strong> est une forme particulière d’un <strong>array</strong>. Une <strong>matrix</strong> posssède deux dimensions (espace des lignes et espace des colonnes), un <strong>array</strong> peut avoir autant de dimensions que souhaitées. Les <span class="math inline">\(D\)</span>-dimensions sont données sous forme d’un vecteur de taille <span class="math inline">\(D\)</span>, chaque élément <span class="math inline">\(i\)</span> donnant la taille de la dimension <span class="math inline">\(i\)</span>. En général, on utilise peu les <strong>array</strong> à plus de 3 dimensions. Une caractéristique d’un <strong>array</strong> est que tous ses éléments sont du même type : <strong>numeric</strong>, <strong>integer</strong>, <strong>logical</strong>, <strong>character</strong> (rarement <strong>complex</strong>).</p>
<p>Commençons par créer un <strong>array</strong> à trois dimensions de taille <span class="math inline">\(3 \times 2 \times 2\)</span>. Pour simplifier la compréhension d’un <strong>array</strong>, on va donner des noms à chaque composante de chaque dimension. La 1ère dimension correspondra aux nom des individus, la 2ème celle des variables, la 3ème celle des années :</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="programmation.html#cb414-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">90</span>, <span class="dv">110</span>, <span class="dv">25</span>, <span class="dv">24</span>, <span class="dv">28</span>, <span class="dv">175</span>, <span class="dv">180</span>, <span class="dv">190</span>, <span class="dv">68</span>, <span class="dv">74</span>, <span class="dv">85</span>), </span>
<span id="cb414-2"><a href="programmation.html#cb414-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb414-3"><a href="programmation.html#cb414-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(tab)[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Luc&quot;</span>, <span class="st">&quot;Pierre&quot;</span>, <span class="st">&quot;Pedro&quot;</span>)</span>
<span id="cb414-4"><a href="programmation.html#cb414-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(tab)[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;taille&quot;</span>, <span class="st">&quot;poids&quot;</span>)</span>
<span id="cb414-5"><a href="programmation.html#cb414-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(tab)[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;2000&quot;</span>, <span class="st">&quot;2010&quot;</span>)</span>
<span id="cb414-6"><a href="programmation.html#cb414-6" aria-hidden="true" tabindex="-1"></a>tab</span></code></pre></div>
<pre><code>## , , 2000
## 
##        taille poids
## Luc       100    25
## Pierre     90    24
## Pedro     110    28
## 
## , , 2010
## 
##        taille poids
## Luc       175    68
## Pierre    180    74
## Pedro     190    85</code></pre>
<p>La fonction <em>apply()</em> permet de faire des calculs :</p>
<ul>
<li>sur une seule dimension. On précise alors le numéro de la dimension dans le deuxième argument et le troisième argument correspond à la fonction qu’on souhaite appliquer sur chaque élément appartenant à cette dimension. Dans ce cas, le résultat est un vecteur de longueur la taille de la dimension choisie. Par exemple, si on souhaite faire la moyenne des éléments en considérant la 2ème dimension.</li>
</ul>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="programmation.html#cb416-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(tab, <span class="dv">2</span>, mean)</span></code></pre></div>
<pre><code>##    taille     poids 
## 140.83333  50.66667</code></pre>
<p><strong>Remarque :</strong> en réalité, selon la fonction qu’on applique à <em>apply()</em>, le résultat n’est pas forcément un vecteur. Essayer par exemple de remplacer la fonction <em>mean()</em> par <em>range()</em> dans l’exemple ci-dessus.</p>
<p><strong>Equivalent avec les boucles :</strong> si on avait utilisé les boucles plutôt que la fonction <em>apply()</em>, on aurait utilisé le code suivant :</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="programmation.html#cb418-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">dim</span>(tab)[<span class="dv">2</span>])</span>
<span id="cb418-2"><a href="programmation.html#cb418-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">seq_along</span>(res))</span>
<span id="cb418-3"><a href="programmation.html#cb418-3" aria-hidden="true" tabindex="-1"></a>  res[k] <span class="ot">&lt;-</span> <span class="fu">mean</span>(tab[, k, ])</span>
<span id="cb418-4"><a href="programmation.html#cb418-4" aria-hidden="true" tabindex="-1"></a>res</span></code></pre></div>
<pre><code>## [1] 140.83333  50.66667</code></pre>
<ul>
<li>sur deux dimensions :</li>
</ul>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="programmation.html#cb420-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(tab, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>), mean)</span></code></pre></div>
<pre><code>##             2000      2010
## taille 100.00000 181.66667
## poids   25.66667  75.66667</code></pre>
<p><strong>Equivalent avec les boucles :</strong> si on avait utilisé les boucles pour faire ce calcul, on aurait fait :</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="programmation.html#cb422-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">dim</span>(tab)[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)])</span>
<span id="cb422-2"><a href="programmation.html#cb422-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(tab)[<span class="dv">2</span>])</span>
<span id="cb422-3"><a href="programmation.html#cb422-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(tab)[<span class="dv">3</span>])</span>
<span id="cb422-4"><a href="programmation.html#cb422-4" aria-hidden="true" tabindex="-1"></a>    res[i, j] <span class="ot">&lt;-</span> <span class="fu">mean</span>(tab[, i, j])</span>
<span id="cb422-5"><a href="programmation.html#cb422-5" aria-hidden="true" tabindex="-1"></a>res</span></code></pre></div>
<pre><code>##           [,1]      [,2]
## [1,] 100.00000 181.66667
## [2,]  25.66667  75.66667</code></pre>
</div>
<div id="les-fonctions-colsums-rowsums-colmeans-rowmeans" class="section level3" number="3.7.2">
<h3><span class="header-section-number">3.7.2</span> Les fonctions <em>colSums()</em>, <em>rowSums()</em>, <em>colMeans()</em>, <em>rowMeans()</em></h3>
<p>Ces fonctions sont équivalentes à la fonction <em>apply()</em> en utilisant <strong>FUN=sum</strong> ou <strong>FUN=mean</strong> et en appliquant les bonnes dimensions (1 pour lignes, 2 pour colonnes), mais sont plus rapides car elles ont été codées en langage compilé.</p>
<p>Pour comparer les temps de calcul :</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="programmation.html#cb424-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">runif</span>(<span class="fl">10e6</span>), <span class="at">nc =</span> <span class="dv">5</span>)</span>
<span id="cb424-2"><a href="programmation.html#cb424-2" aria-hidden="true" tabindex="-1"></a> microbenchmark<span class="sc">::</span><span class="fu">microbenchmark</span>(</span>
<span id="cb424-3"><a href="programmation.html#cb424-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">apply</span>(x, <span class="dv">2</span>, mean),</span>
<span id="cb424-4"><a href="programmation.html#cb424-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">colMeans</span>(x),</span>
<span id="cb424-5"><a href="programmation.html#cb424-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">times =</span> 10L)</span></code></pre></div>
<pre><code>## Unit: milliseconds
##               expr       min        lq      mean    median        uq       max
##  apply(x, 2, mean) 182.67173 199.21078 235.71830 199.42661 200.10109 576.76999
##        colMeans(x)  11.26868  11.31742  11.44444  11.42105  11.55452  11.70631
##  neval
##     10
##     10</code></pre>
</div>
<div id="la-fonction-lapply" class="section level3" number="3.7.3">
<h3><span class="header-section-number">3.7.3</span> La fonction <em>lapply()</em></h3>
<p>Même si la fonction <em>lapply()</em> s’applique aussi bien sur les vecteurs que les <strong>list</strong>, on présentera ici son utilisation pour les <strong>list/data.frame</strong>. L’intérêt de l’appliquer sur des vecteurs sera présenté avec la fonction <em>replicate()</em>.</p>
<p>On rappelle ici qu’une <strong>list</strong> est caractérisée par un certain nombre d’éléments pouvant être de types différents. On accède aux éléments d’une liste par le symbole <strong>$</strong> suivi du nom de l’élément de la liste et s’il n’y a pas de nom, on y accède avec les doubles crochets avec l’indice de l’élément auquel on souhaite accèder. Un <strong>data.frame</strong> est une forme particulière d’une <strong>list</strong> dans la mesure où les éléments peuvent être vus comme étant les variables (on y accède avec le symbole <strong>$</strong>).</p>
<p>La fonction <em>lapply()</em> consiste à appliquer la même opération sur chaque élément de la <strong>list</strong>. Cette opération pouvant être donnée par une fonction de base de <strong>R</strong> ou bien pouvant être une fonction programmée.</p>
<p>On considère le jeu de données <strong>mtcars</strong> accessible par défaut sous <strong>R</strong> et contenant un certaine nombre de variables sur des moteurs de voitures de différentes marques. Pour connaître les caractéristiques moyennes, on applique la fonction <em>mean()</em> à chaque élément de <strong>mtcars</strong>, autrement dit à chaque variable. Le résultat est retourné sous forme de <strong>list</strong> de même longeur que la <strong>list</strong> de départ.</p>
<p>Ici, on a utilisé la fonction <em>unlist()</em> sur le résultat retourné afin de présenter le résultat sous forme d’un vecteur, plus lisible à lire :</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="programmation.html#cb426-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(<span class="fu">lapply</span>(mtcars, mean))</span></code></pre></div>
<pre><code>##        mpg        cyl       disp         hp       drat         wt       qsec 
##  20.090625   6.187500 230.721875 146.687500   3.596563   3.217250  17.848750 
##         vs         am       gear       carb 
##   0.437500   0.406250   3.687500   2.812500</code></pre>
<p>Cette fonction nous permet ainsi d’éviter de faire la boucle suivante :</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="programmation.html#cb428-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(mtcars))</span>
<span id="cb428-2"><a href="programmation.html#cb428-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">seq_along</span>(res))</span>
<span id="cb428-3"><a href="programmation.html#cb428-3" aria-hidden="true" tabindex="-1"></a>  res[k] <span class="ot">&lt;-</span> <span class="fu">mean</span>(mtcars[[k]])</span>
<span id="cb428-4"><a href="programmation.html#cb428-4" aria-hidden="true" tabindex="-1"></a>res</span></code></pre></div>
<pre><code>##  [1]  20.090625   6.187500 230.721875 146.687500   3.596563   3.217250
##  [7]  17.848750   0.437500   0.406250   3.687500   2.812500</code></pre>
</div>
<div id="la-fonction-sapply" class="section level3" number="3.7.4">
<h3><span class="header-section-number">3.7.4</span> La fonction <em>sapply()</em></h3>
<p>On a vu que la fonction <em>lapply()</em> retournait une <strong>list</strong>. Or, si on sait par avance que le résultat retourné pour chaque élément de la liste sera identique pour chaque élément, la fonction <em>sapply()</em> va concaténer les résultats de chaque élément sous forme d’un vecteur ou d’un tableau. Si on reprend l’exemple précédent :</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="programmation.html#cb430-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(mtcars, mean)</span></code></pre></div>
<pre><code>##        mpg        cyl       disp         hp       drat         wt       qsec 
##  20.090625   6.187500 230.721875 146.687500   3.596563   3.217250  17.848750 
##         vs         am       gear       carb 
##   0.437500   0.406250   3.687500   2.812500</code></pre>
<p>On présente ici un autre exemple où on va créer notre propre fonction qui consiste à retourner, le minimum, le maximum, la moyenne, l’écart-type et la moyenne de chaque élément. On code la fonction suivante où l’argument <strong>x</strong> sera interpété comme représentant un élément de la <strong>list</strong>.</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="programmation.html#cb432-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x) </span>
<span id="cb432-2"><a href="programmation.html#cb432-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">min =</span> <span class="fu">min</span>(x), <span class="at">max =</span> <span class="fu">max</span>(x), <span class="at">mean =</span> <span class="fu">mean</span>(x), <span class="at">med =</span> <span class="fu">median</span>(x), <span class="at">sd =</span> <span class="fu">sd</span>(x))</span></code></pre></div>
<p>On applique ensuite la fonction <em>f()</em> à chaque élément de la <strong>list</strong> avec la fonction <em>sapply()</em>. On transpose le résultat car c’est en général ainsi que sont présentées les statistiques descriptives des variables :</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="programmation.html#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(<span class="fu">sapply</span>(mtcars, f))</span></code></pre></div>
<pre><code>##         min     max       mean     med          sd
## mpg  10.400  33.900  20.090625  19.200   6.0269481
## cyl   4.000   8.000   6.187500   6.000   1.7859216
## disp 71.100 472.000 230.721875 196.300 123.9386938
## hp   52.000 335.000 146.687500 123.000  68.5628685
## drat  2.760   4.930   3.596563   3.695   0.5346787
## wt    1.513   5.424   3.217250   3.325   0.9784574
## qsec 14.500  22.900  17.848750  17.710   1.7869432
## vs    0.000   1.000   0.437500   0.000   0.5040161
## am    0.000   1.000   0.406250   0.000   0.4989909
## gear  3.000   5.000   3.687500   4.000   0.7378041
## carb  1.000   8.000   2.812500   2.000   1.6152000</code></pre>
<p>Par ailleurs, pour insérer une table dans un document Markdown, on peut utiliser la fonction <em>kbl()</em> du package <strong>kableExtra</strong> dont on verra d’autres exemples dans le chapitre sur la visualisation de données.</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="programmation.html#cb435-1" aria-hidden="true" tabindex="-1"></a>kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="fu">t</span>(<span class="fu">round</span>(<span class="fu">sapply</span>(mtcars, f), <span class="dv">3</span>))) </span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
min
</th>
<th style="text-align:right;">
max
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
med
</th>
<th style="text-align:right;">
sd
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
mpg
</td>
<td style="text-align:right;">
10.400
</td>
<td style="text-align:right;">
33.900
</td>
<td style="text-align:right;">
20.091
</td>
<td style="text-align:right;">
19.200
</td>
<td style="text-align:right;">
6.027
</td>
</tr>
<tr>
<td style="text-align:left;">
cyl
</td>
<td style="text-align:right;">
4.000
</td>
<td style="text-align:right;">
8.000
</td>
<td style="text-align:right;">
6.188
</td>
<td style="text-align:right;">
6.000
</td>
<td style="text-align:right;">
1.786
</td>
</tr>
<tr>
<td style="text-align:left;">
disp
</td>
<td style="text-align:right;">
71.100
</td>
<td style="text-align:right;">
472.000
</td>
<td style="text-align:right;">
230.722
</td>
<td style="text-align:right;">
196.300
</td>
<td style="text-align:right;">
123.939
</td>
</tr>
<tr>
<td style="text-align:left;">
hp
</td>
<td style="text-align:right;">
52.000
</td>
<td style="text-align:right;">
335.000
</td>
<td style="text-align:right;">
146.688
</td>
<td style="text-align:right;">
123.000
</td>
<td style="text-align:right;">
68.563
</td>
</tr>
<tr>
<td style="text-align:left;">
drat
</td>
<td style="text-align:right;">
2.760
</td>
<td style="text-align:right;">
4.930
</td>
<td style="text-align:right;">
3.597
</td>
<td style="text-align:right;">
3.695
</td>
<td style="text-align:right;">
0.535
</td>
</tr>
<tr>
<td style="text-align:left;">
wt
</td>
<td style="text-align:right;">
1.513
</td>
<td style="text-align:right;">
5.424
</td>
<td style="text-align:right;">
3.217
</td>
<td style="text-align:right;">
3.325
</td>
<td style="text-align:right;">
0.978
</td>
</tr>
<tr>
<td style="text-align:left;">
qsec
</td>
<td style="text-align:right;">
14.500
</td>
<td style="text-align:right;">
22.900
</td>
<td style="text-align:right;">
17.849
</td>
<td style="text-align:right;">
17.710
</td>
<td style="text-align:right;">
1.787
</td>
</tr>
<tr>
<td style="text-align:left;">
vs
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.438
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.504
</td>
</tr>
<tr>
<td style="text-align:left;">
am
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.406
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.499
</td>
</tr>
<tr>
<td style="text-align:left;">
gear
</td>
<td style="text-align:right;">
3.000
</td>
<td style="text-align:right;">
5.000
</td>
<td style="text-align:right;">
3.688
</td>
<td style="text-align:right;">
4.000
</td>
<td style="text-align:right;">
0.738
</td>
</tr>
<tr>
<td style="text-align:left;">
carb
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
8.000
</td>
<td style="text-align:right;">
2.812
</td>
<td style="text-align:right;">
2.000
</td>
<td style="text-align:right;">
1.615
</td>
</tr>
</tbody>
</table>
<p><strong>Remarque :</strong> si on on souhaite appliquer la fonction <em>f()</em> pour les éléments qui sont de type <strong>numeric</strong> et la fonction <em>table()</em> pour les éléments de type <strong>factor</strong>, alors la fonction <em>sapply()</em> retournera le même résultat que la fonction <em>lapply()</em>, à savoir une <strong>list</strong>, car les résultats retournés pour chaque élément ne seront pas les mêmes :</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="programmation.html#cb436-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(iris, <span class="cf">function</span>(x){</span>
<span id="cb436-2"><a href="programmation.html#cb436-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.numeric</span>(x)) </span>
<span id="cb436-3"><a href="programmation.html#cb436-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">f</span>(x)</span>
<span id="cb436-4"><a href="programmation.html#cb436-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb436-5"><a href="programmation.html#cb436-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">table</span>(x)</span>
<span id="cb436-6"><a href="programmation.html#cb436-6" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## $Sepal.Length
##       min       max      mean       med        sd 
## 4.3000000 7.9000000 5.8433333 5.8000000 0.8280661 
## 
## $Sepal.Width
##       min       max      mean       med        sd 
## 2.0000000 4.4000000 3.0573333 3.0000000 0.4358663 
## 
## $Petal.Length
##      min      max     mean      med       sd 
## 1.000000 6.900000 3.758000 4.350000 1.765298 
## 
## $Petal.Width
##       min       max      mean       med        sd 
## 0.1000000 2.5000000 1.1993333 1.3000000 0.7622377 
## 
## $Species
## x
##     setosa versicolor  virginica 
##         50         50         50</code></pre>
</div>
<div id="la-fonction-replicate" class="section level3" number="3.7.5">
<h3><span class="header-section-number">3.7.5</span> La fonction <em>replicate()</em></h3>
<p>On va partir de l’exemple suivant : on souhaitre simuler 5 échantillons de taille 10 distribués selon une loi uniforme <span class="math inline">\(U_{[0,1]}\)</span>.</p>
<ul>
<li>La première solution serait de faire une boucle :</li>
</ul>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="programmation.html#cb438-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dv">5</span>)</span>
<span id="cb438-2"><a href="programmation.html#cb438-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb438-3"><a href="programmation.html#cb438-3" aria-hidden="true" tabindex="-1"></a>  res[[k]] <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">10</span>)</span></code></pre></div>
<ul>
<li>La deuxième solution consiste à appliquer la fonction <em>lapply()</em> sur un vecteur quelconque de taille 5 (ici, le plus simple est de faire <em>1:5</em>, mais on aurait pu prendre n’importe quel vecteur de taille 5) et de lui appliquer une fonction qui retourne un vecteur simulé selon une <span class="math inline">\(U_{[0,1]}\)</span>. Un vecteur est donc considéré ici comme une liste où chaque élément du vecteur serait un élement d’une liste.</li>
</ul>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="programmation.html#cb439-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="cf">function</span>(x) <span class="fu">runif</span>(<span class="dv">10</span>))</span></code></pre></div>
<p><strong>Remarque :</strong> dans le deuxième argument, la fonction qu’on va appliquer sur chaque élément d’une vecteur prend comme argument d’entrée <strong>x</strong> (un élément du vecteur), mais on ne l’utilise pas à l’intérieur de la fonction, car on n’en a pas besoin pour faire ce qu’on souhaite faire.</p>
<ul>
<li>La troisième solution consiste à utiliser la fonction <em>replicate()</em>, qui comme la fonction <em>sapply()</em> va retourner le résultat sous une forme plus simplifiée qu’une <strong>list</strong> :</li>
</ul>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="programmation.html#cb440-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">5</span>, <span class="fu">runif</span>(<span class="dv">10</span>))</span></code></pre></div>
<p><strong>Remarque :</strong> la fonction <em>replicate()</em> fait précisément appel à la fonction <em>sapply()</em>. Pour cela, elle créé un vecteur de 0L de taille le premier argument de <em>replicate()</em>.</p>
</div>
<div id="la-fonction-mapply" class="section level3" number="3.7.6">
<h3><span class="header-section-number">3.7.6</span> La fonction <em>mapply()</em></h3>
<p>Pour illustrer cette fonction, on considère 5 échantillons de taille 10 issus d’une loi <span class="math inline">\(U_{[0,1]}\)</span>. Pour calculer la moyenne par échantilon, on peut utiliser la fonction <em>lapply()</em> :</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="programmation.html#cb441-1" aria-hidden="true" tabindex="-1"></a>xs <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">5</span>, <span class="fu">runif</span>(<span class="dv">10</span>), <span class="at">simplify =</span> <span class="cn">FALSE</span>)</span>
<span id="cb441-2"><a href="programmation.html#cb441-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(xs, mean)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 0.4200745
## 
## [[2]]
## [1] 0.4105398
## 
## [[3]]
## [1] 0.363235
## 
## [[4]]
## [1] 0.5592183
## 
## [[5]]
## [1] 0.4279419</code></pre>
<p>A présent, supposons qu’on souhaite pondérer les moyennes par un vecteur de poids qui est différent selon chaque échantillon. On créé ici les poids associés à chaque échantillon sous forme d’une liste :</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="programmation.html#cb443-1" aria-hidden="true" tabindex="-1"></a>ws <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">5</span>, <span class="fu">rpois</span>(<span class="dv">10</span>, <span class="dv">5</span>) <span class="sc">+</span> <span class="dv">1</span>, <span class="at">simplify =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Une façon de faire avec des boucles serait la suivante :</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="programmation.html#cb444-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(xs))</span>
<span id="cb444-2"><a href="programmation.html#cb444-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">seq_along</span>(res))</span>
<span id="cb444-3"><a href="programmation.html#cb444-3" aria-hidden="true" tabindex="-1"></a>  res[k] <span class="ot">&lt;-</span> <span class="fu">sum</span>(xs[[k]] <span class="sc">*</span> ws[[k]]) <span class="sc">/</span> <span class="fu">sum</span>(ws[[k]])</span>
<span id="cb444-4"><a href="programmation.html#cb444-4" aria-hidden="true" tabindex="-1"></a>res</span></code></pre></div>
<pre><code>## [1] 0.3918269 0.4219046 0.3278862 0.5367989 0.4524113</code></pre>
<p>Le problème de la fonction <em>lapply()</em> est qu’on ne peut pas appliquer une fonction sur deux <strong>list</strong> simultanément. C’est ce que fait la fonction <em>mapply()</em> qui prend comme 1er argument d’entrée une fonction à appliquer sur les éléments d’autant de <strong>list</strong> que l’on souhaite. La fonction qu’on applique contient donc deux arguments d’entrée <strong>x</strong> et <strong>y</strong> qui correspondent aux éléments de chacune des deux listes :</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="programmation.html#cb446-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mapply</span>(<span class="cf">function</span>(x, y) <span class="fu">sum</span>(x <span class="sc">*</span> y) <span class="sc">/</span> <span class="fu">mean</span>(y), xs, ws)</span></code></pre></div>
<pre><code>## [1] 3.918269 4.219046 3.278862 5.367989 4.524113</code></pre>
</div>
<div id="la-fonction-tapply" class="section level3" number="3.7.7">
<h3><span class="header-section-number">3.7.7</span> La fonction <em>tapply()</em></h3>
<p>On considère les deux vecteurs suivants :</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="programmation.html#cb448-1" aria-hidden="true" tabindex="-1"></a>(taille <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rnorm</span>(<span class="dv">5</span>, <span class="dv">165</span>, <span class="dv">10</span>), <span class="fu">rnorm</span>(<span class="dv">5</span>, <span class="dv">175</span>, <span class="dv">10</span>)))</span></code></pre></div>
<pre><code>##  [1] 141.7006 181.0656 164.2458 177.7004 174.7507 165.0026 180.6391 179.8185
##  [9] 170.9057 177.5540</code></pre>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="programmation.html#cb450-1" aria-hidden="true" tabindex="-1"></a>(sexe <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>), <span class="at">each =</span> <span class="dv">5</span>))</span></code></pre></div>
<pre><code>##  [1] &quot;M&quot; &quot;M&quot; &quot;M&quot; &quot;M&quot; &quot;M&quot; &quot;F&quot; &quot;F&quot; &quot;F&quot; &quot;F&quot; &quot;F&quot;</code></pre>
<p>On souhaite calculer la moyenne dans chaque sous-groupe <em>“M”</em> et <em>“F”</em>. Une façon de faire est de créer une <strong>list</strong> contenant deux éléments, le premier correspondant au vecteur de <strong>taille</strong> du sous-groupe <em>“M”</em> et le second correspondant au vecteur de <strong>taille</strong> du sous-groupe <em>“F”</em>. C’est ce que fait la fonction <em>split()</em> ci-dessous :</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="programmation.html#cb452-1" aria-hidden="true" tabindex="-1"></a>(res.split <span class="ot">&lt;-</span> <span class="fu">split</span>(taille, sexe))</span></code></pre></div>
<pre><code>## $F
## [1] 165.0026 180.6391 179.8185 170.9057 177.5540
## 
## $M
## [1] 141.7006 181.0656 164.2458 177.7004 174.7507</code></pre>
<p>Ensuite, il suffit d’appliquer la fonction <em>sapply()</em> à cette <strong>list</strong> :</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="programmation.html#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(res.split, mean)</span></code></pre></div>
<pre><code>##        F        M 
## 174.7840 167.8926</code></pre>
<p>La fonction <em>tapply()</em> permet de faire ce calcul en une seule ligne :</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="programmation.html#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(taille, sexe, mean)</span></code></pre></div>
<pre><code>##        F        M 
## 174.7840 167.8926</code></pre>
<p><strong>Remarque :</strong> la fonction <em>tapply()</em> ne s’appliquant que sur des vecteurs, la fonction <em>by()</em> permet de généraliser la fonction <em>tapply()</em> aux <strong>data.frame</strong>.</p>
<p><strong>Exercise 2.5</strong></p>
<ul>
<li><p>Créer deux fonctions <em>mean_rnorm.1()</em> et <em>mean_rnorm.2()</em> qui prennent en entrée les paramètres <strong>n</strong> et <strong>p</strong>. Ces fonctions permettent de simuler <strong>n</strong> échantillons de taille <strong>p</strong> de lois normales centrées réduites et retournent pour chaque échantillon la moyenne. <em>mean_rnorm.1()</em> utilisera des boucles, <em>mean_rnorm.2()</em> la fonction <em>replicate()</em>.</p></li>
<li><p>Comparer les temps de calcul de ces 2 fonctions.</p></li>
</ul>
</div>
</div>
<div id="améliorer-ses-fonctions" class="section level2" number="3.8">
<h2><span class="header-section-number">3.8</span> Améliorer ses fonctions</h2>
<div id="créer-des-sous-fonctions" class="section level3" number="3.8.1">
<h3><span class="header-section-number">3.8.1</span> Créer des sous-fonctions</h3>
<p>Il ne faut pas hésiter à créer des petites fonctions qui peuvent être</p>
<ul>
<li><p>locales si elles ne sont utilisées qu’à l’intérieur d’une seule fonction principale</p></li>
<li><p>globales si elles ont à vocation d’être uilisées dans plusieurs fonctions.</p></li>
</ul>
<p>Supposons par exemple qu’on souhaite calculer une densité non paramétrique de la densité en utilisant un des noyaux suivants :</p>
<ul>
<li><p>noyau <em>biweight</em> <span class="math inline">\(K(x) = \frac{15}{16}(1-(\frac{x}{h})^2)^21_{(\frac{x}{h})^2\leq 1}\)</span></p></li>
<li><p>noyau <em>triweight</em> <span class="math inline">\(K(x) = \frac{35}{32}(1-(\frac{x}{h})^2)^31_{(\frac{x}{h})^2\leq 1}\)</span></p></li>
<li><p>noyau gaussien <span class="math inline">\(K(x) = \frac{1}{\sqrt{2\pi}}\exp(-0.5(\frac{x}{h})^2))\)</span></p></li>
</ul>
<p>où <strong>h</strong> est le paramètre de lissage. Dans un premier temps, pn peut alors programmer une fonction par noyau :</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="programmation.html#cb458-1" aria-hidden="true" tabindex="-1"></a>biweight <span class="ot">&lt;-</span> <span class="cf">function</span>(x, h) {</span>
<span id="cb458-2"><a href="programmation.html#cb458-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="dv">15</span> <span class="sc">/</span> <span class="dv">16</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> (x <span class="sc">/</span> h) <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">ifelse</span>((x <span class="sc">/</span> h) <span class="sc">^</span> <span class="dv">2</span> <span class="sc">&lt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb458-3"><a href="programmation.html#cb458-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb458-4"><a href="programmation.html#cb458-4" aria-hidden="true" tabindex="-1"></a>triweight <span class="ot">&lt;-</span> <span class="cf">function</span>(x, h) {</span>
<span id="cb458-5"><a href="programmation.html#cb458-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="dv">35</span> <span class="sc">/</span> <span class="dv">32</span><span class="sc">*</span>(<span class="dv">1</span> <span class="sc">-</span> (x <span class="sc">/</span> h) <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">^</span> <span class="dv">3</span> <span class="sc">*</span> <span class="fu">ifelse</span>((x <span class="sc">/</span> h) <span class="sc">^</span> <span class="dv">2</span> <span class="sc">&lt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb458-6"><a href="programmation.html#cb458-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb458-7"><a href="programmation.html#cb458-7" aria-hidden="true" tabindex="-1"></a>gaussian <span class="ot">&lt;-</span> <span class="cf">function</span>(x, h) {</span>
<span id="cb458-8"><a href="programmation.html#cb458-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">*</span> pi) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> (x <span class="sc">/</span> h) <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb458-9"><a href="programmation.html#cb458-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="structure-de-contrôle" class="section level3" number="3.8.2">
<h3><span class="header-section-number">3.8.2</span> Structure de contrôle</h3>
<p>Les structures de contrôle classiques (<strong>for</strong>, <strong>while</strong>, <strong>repeat</strong>, <strong>if/else</strong>) sont bien entendu disponibles dans <strong>R</strong> (voir les document <a href="http://math.univ-toulouse.fr/~sdejean">“Pour se donner un peu d’<strong>R</strong>”</a> et <a href="http://www.thibault.laurent.free.fr/pedago.html">“Introduction à <strong>R</strong>”</a>. Nous nous intéressons ici à la notion d’aiguillage (fonction <em>switch()</em>) moins couramment utilisée bien que très pratique.</p>
<p>Celle-ci permet d’éviter d’emboîter des <strong>if/else</strong> lorsqu’on a plusieurs options possibles. Supposons par exemple qu’on souhaite calculer une densité non paramétrique de la densité en utilisant un des noyaux suivants :</p>
<ul>
<li><p>noyau <em>biweight</em> <span class="math inline">\(K(x) = \frac{15}{16}(1-(\frac{x}{h})^2)^21_{(\frac{x}{h})^2\leq 1}\)</span></p></li>
<li><p>noyau <em>triweight</em> <span class="math inline">\(K(x) = \frac{35}{32}(1-(\frac{x}{h})^2)^31_{(\frac{x}{h})^2\leq 1}\)</span></p></li>
<li><p>noyau gaussien <span class="math inline">\(K(x) = \frac{1}{\sqrt{2\pi}}\exp(-0.5(\frac{x}{h})^2))\)</span></p></li>
</ul>
<p>où <strong>h</strong> est le paramètre de lissage. On peut alors programmer sous <strong>R</strong> la fonction <em>f_noyau()</em> suivante, prenant en entrée les arguments <strong>x</strong>, <strong>h</strong> et <strong>type</strong> où <strong>type</strong> est un caractère prenant les valeurs <strong>“bi”</strong>, <strong>“tri”</strong> et <strong>“gauss”</strong>.</p>
<div id="solution-avec-ifelse" class="section level4" number="3.8.2.1">
<h4><span class="header-section-number">3.8.2.1</span> Solution avec <strong>if/else</strong></h4>
<p>La façon traditionnelle pour gérer différents cas de figure est d’utiliser les conditions <strong>if/else</strong> :</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="programmation.html#cb459-1" aria-hidden="true" tabindex="-1"></a>f_noyau <span class="ot">&lt;-</span> <span class="cf">function</span>(x, h, <span class="at">type =</span> <span class="st">&quot;bi&quot;</span>) {</span>
<span id="cb459-2"><a href="programmation.html#cb459-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">&quot;bi&quot;</span>) {</span>
<span id="cb459-3"><a href="programmation.html#cb459-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">biweight</span>(x, h)</span>
<span id="cb459-4"><a href="programmation.html#cb459-4" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb459-5"><a href="programmation.html#cb459-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">&quot;tri&quot;</span>) {</span>
<span id="cb459-6"><a href="programmation.html#cb459-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">triweight</span>(x, h)</span>
<span id="cb459-7"><a href="programmation.html#cb459-7" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb459-8"><a href="programmation.html#cb459-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gaussian</span>(x, h)</span>
<span id="cb459-9"><a href="programmation.html#cb459-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb459-10"><a href="programmation.html#cb459-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb459-11"><a href="programmation.html#cb459-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Un inconvénient est qu’en emboîtant des conditions <strong>if/else</strong>, on peut alors vite se perdre dans la lecture du code.</p>
</div>
<div id="solution-avec-switch" class="section level4" number="3.8.2.2">
<h4><span class="header-section-number">3.8.2.2</span> Solution avec <strong>switch()</strong></h4>
<p>La fonction <em>switch()</em> s’applique sur l’argument <strong>type</strong> et on donne ensuite pour chaque valeur possible de <strong>type</strong> le type de calcul à effectuer. On ajoute ici un cas qui correspondrait à toutes autres valeurs de <strong>type</strong>.</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="programmation.html#cb460-1" aria-hidden="true" tabindex="-1"></a>f_noyau<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x, h, <span class="at">type =</span> <span class="st">&quot;bi&quot;</span>) {</span>
<span id="cb460-2"><a href="programmation.html#cb460-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">switch</span>(type, <span class="at">bi =</span> <span class="fu">biweight</span>(x, h),</span>
<span id="cb460-3"><a href="programmation.html#cb460-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">tri =</span> <span class="fu">triweight</span>(x, h),</span>
<span id="cb460-4"><a href="programmation.html#cb460-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">gauss =</span> <span class="fu">gaussian</span>(x, h),</span>
<span id="cb460-5"><a href="programmation.html#cb460-5" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;Préciser une autre valeur de type&quot;</span>)</span>
<span id="cb460-6"><a href="programmation.html#cb460-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Application :</strong></p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="programmation.html#cb461-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.01</span>)</span>
<span id="cb461-2"><a href="programmation.html#cb461-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, <span class="fu">f_noyau.2</span>(x, <span class="fl">0.3</span>, <span class="at">type =</span> <span class="st">&quot;bi&quot;</span>), <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.2</span>))</span>
<span id="cb461-3"><a href="programmation.html#cb461-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">f_noyau.2</span>(x, <span class="fl">0.3</span>, <span class="at">type =</span> <span class="st">&quot;tri&quot;</span>), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb461-4"><a href="programmation.html#cb461-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">f_noyau.2</span>(x, <span class="fl">0.3</span>, <span class="at">type =</span> <span class="st">&quot;gauss&quot;</span>), <span class="at">lty =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-231-1.png" width="672" /></p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="programmation.html#cb462-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f_noyau.2</span>(x, <span class="fl">0.3</span>, <span class="at">type =</span> <span class="st">&quot;unif&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Préciser une autre valeur de type&quot;</code></pre>
</div>
</div>
<div id="fonction-stopifnot" class="section level3" number="3.8.3">
<h3><span class="header-section-number">3.8.3</span> Fonction <em>stopifnot()</em></h3>
<p>On connaît la fonction <em>stop()</em> qui s’insère en général à l’intérieur des conditions <strong>if/else</strong>.</p>
<p>La fonction <em>stopifnot()</em> permet de tester simultanément plusieurs conditions et évite donc d’avoir recours aux <strong>if/else</strong>. Elle est particulièrement utile à l’intérieur d’une fonction pour, par exemple, vérifier la conformité des valeurs passées en paramètres. Un exemple d’uitlisation :</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="programmation.html#cb464-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="dv">1</span> <span class="sc">&lt;</span> <span class="dv">2</span>, <span class="fu">length</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">==</span> <span class="dv">2</span>, pi <span class="sc">&lt;</span> <span class="dv">2</span>, <span class="fu">cos</span>(pi) <span class="sc">&gt;</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Error: pi &lt; 2 n&#39;est pas TRUE</code></pre>
<p>Si plusieurs conditions ne sont pas respectées, c’est la première non respectée qui est renvoyée comme source de l’erreur.</p>
<p><strong>Exercise 2.6</strong></p>
<p>Modifier la fonction <em>f_noyau.2()</em> définie précédemment pour vérifier que :</p>
<ul>
<li><p>le paramètre <strong>x</strong> est <strong>numeric</strong></p></li>
<li><p><strong>h</strong> est de taille 1 et de type <strong>numeric</strong></p></li>
<li><p><strong>type</strong> est une chaîne de caractères (on supprimera la possibilité de passer un entier pour choisir le type).</p></li>
</ul>
</div>
<div id="les-arguments-dans-une-fonction" class="section level3" number="3.8.4">
<h3><span class="header-section-number">3.8.4</span> Les arguments dans une fonction</h3>
<div id="supprimer-les-paramètres-inutiles" class="section level4" number="3.8.4.1">
<h4><span class="header-section-number">3.8.4.1</span> Supprimer les paramètres inutiles</h4>
<p>Dans l’exemple ci-dessous, les paramètres <strong>d</strong> et <strong>e</strong> ne sont pas utilisés dans la fonction et pourtant ils ont un coût de stockage et un coût en temps de calcul car ils sont évalués par défaut dans la fonction.</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="programmation.html#cb466-1" aria-hidden="true" tabindex="-1"></a>f_1 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">a =</span> <span class="dv">5</span>, <span class="at">b =</span> <span class="dv">4</span>, <span class="at">d =</span> <span class="dv">3</span>, <span class="at">e =</span> <span class="dv">1</span>)</span>
<span id="cb466-2"><a href="programmation.html#cb466-2" aria-hidden="true" tabindex="-1"></a>  (a <span class="sc">+</span> b)<span class="sc">^</span><span class="dv">2</span></span></code></pre></div>
<p>On compare les temps de calcul avec la même fonction mais qui n’utilise pas les paramètres inutilisés :</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="programmation.html#cb467-1" aria-hidden="true" tabindex="-1"></a>f_2 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">a =</span> <span class="dv">5</span>, <span class="at">b =</span> <span class="dv">4</span>)</span>
<span id="cb467-2"><a href="programmation.html#cb467-2" aria-hidden="true" tabindex="-1"></a>  (a <span class="sc">+</span> b)<span class="sc">^</span><span class="dv">2</span></span></code></pre></div>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="programmation.html#cb468-1" aria-hidden="true" tabindex="-1"></a>microbenchmark<span class="sc">::</span><span class="fu">microbenchmark</span>(</span>
<span id="cb468-2"><a href="programmation.html#cb468-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f_1</span>(),</span>
<span id="cb468-3"><a href="programmation.html#cb468-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f_2</span>()</span>
<span id="cb468-4"><a href="programmation.html#cb468-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Unit: nanoseconds
##   expr min    lq     mean median    uq     max neval
##  f_1() 488 517.5 25910.17  561.0 747.5 2521986   100
##  f_2() 370 413.0 32083.49  443.5 582.0 3156845   100</code></pre>
<p>Contrairement à d’autres langages, <strong>R</strong> ne signale pas les paramètres qui ne sont pas utiles, qu’il s’agisse de paramètres utilisés en argument d’entrée ou de paramètres créés à l’intérieur de la fonction. C’est donc à celui qui programme d’être vigilent à ne pas créer des paramètres inutiles.</p>
</div>
<div id="utiliser-des-fonctions-comme-argument-dentrée" class="section level4" number="3.8.4.2">
<h4><span class="header-section-number">3.8.4.2</span> Utiliser des fonctions comme argument d’entrée</h4>
<p>On a vu dans la section précédente que la fonction <em>lapply()</em> avait dans ses argument d’entrée une fonction. On peut si on le souhaite créer nos propres fonctions qui ont comme argument d’entrée une fonction. Dans l’exemple suivant, on applique une fonction choisie par l’utilisateur sur un échantillon simulée selon une loi uniforme :</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="programmation.html#cb470-1" aria-hidden="true" tabindex="-1"></a>randomise <span class="ot">&lt;-</span> <span class="cf">function</span>(f) <span class="fu">f</span>(<span class="fu">runif</span>(<span class="fl">1e3</span>))</span></code></pre></div>
<p>Pour l’utiliser, on remplace l’argument <strong>f</strong> par le nom de la fonction qui nous intéresse :</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="programmation.html#cb471-1" aria-hidden="true" tabindex="-1"></a><span class="fu">randomise</span>(mean)</span></code></pre></div>
<pre><code>## [1] 0.4924948</code></pre>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="programmation.html#cb473-1" aria-hidden="true" tabindex="-1"></a><span class="fu">randomise</span>(mean)</span></code></pre></div>
<pre><code>## [1] 0.5048686</code></pre>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="programmation.html#cb475-1" aria-hidden="true" tabindex="-1"></a><span class="fu">randomise</span>(sum)</span></code></pre></div>
<pre><code>## [1] 496.2882</code></pre>
</div>
<div id="utiliser-des-fonctions-comme-argument-de-sortie" class="section level4" number="3.8.4.3">
<h4><span class="header-section-number">3.8.4.3</span> Utiliser des fonctions comme argument de sortie</h4>
<p>Il est également possible de faire retourner une fonction par une fonction. C’est ce que fait la fonction <em>f_power()</em> ci-dessous :</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="programmation.html#cb477-1" aria-hidden="true" tabindex="-1"></a>f_power <span class="ot">&lt;-</span> <span class="cf">function</span>(exponent)</span>
<span id="cb477-2"><a href="programmation.html#cb477-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) x<span class="sc">^</span>exponent </span></code></pre></div>
<p>Pour utiliser cette fonction :</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="programmation.html#cb478-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f_power</span>(<span class="dv">2</span>)(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1]  1  4  9 16 25</code></pre>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="programmation.html#cb480-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f_power</span>(<span class="dv">3</span>)(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1]   1   8  27  64 125</code></pre>
<p>On peut également créer les fonctions <em>f_square()</em> et <em>f_cube()</em> à partir de la fonction <em>f_power()</em> :</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="programmation.html#cb482-1" aria-hidden="true" tabindex="-1"></a>f_square <span class="ot">&lt;-</span> <span class="fu">f_power</span>(<span class="dv">2</span>)</span>
<span id="cb482-2"><a href="programmation.html#cb482-2" aria-hidden="true" tabindex="-1"></a>f_cube <span class="ot">&lt;-</span> <span class="fu">f_power</span>(<span class="dv">3</span>)</span>
<span id="cb482-3"><a href="programmation.html#cb482-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(f_square)</span></code></pre></div>
<pre><code>## [1] &quot;function&quot;</code></pre>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="programmation.html#cb484-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(f_cube)</span></code></pre></div>
<pre><code>## [1] &quot;function&quot;</code></pre>
<p>Et pour obtenir le calcul souhaité :</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="programmation.html#cb486-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f_square</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1]  1  4  9 16 25</code></pre>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="programmation.html#cb488-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f_cube</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1]   1   8  27  64 125</code></pre>
</div>
<div id="utiliser-les-comme-argument-dentrée" class="section level4" number="3.8.4.4">
<h4><span class="header-section-number">3.8.4.4</span> Utiliser les … comme argument d’entrée</h4>
<p>Lorsqu’un utilisateur définit une fonction, il peut permettre à sa fonction d’utiliser toutes les options d’une autre fonction sans les lister une à une. Prenons l’exemple de la fonction <em>plot_reg()</em> définie ci-dessous.</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="programmation.html#cb490-1" aria-hidden="true" tabindex="-1"></a>plot_reg <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, <span class="at">np =</span> <span class="cn">TRUE</span>, ...) {</span>
<span id="cb490-2"><a href="programmation.html#cb490-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(y <span class="sc">~</span> x, ...)</span>
<span id="cb490-3"><a href="programmation.html#cb490-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x), <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb490-4"><a href="programmation.html#cb490-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (np) {</span>
<span id="cb490-5"><a href="programmation.html#cb490-5" aria-hidden="true" tabindex="-1"></a>    np.reg <span class="ot">&lt;-</span> <span class="fu">loess</span>(y <span class="sc">~</span> x)</span>
<span id="cb490-6"><a href="programmation.html#cb490-6" aria-hidden="true" tabindex="-1"></a>    x.seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(x), <span class="fu">max</span>(x), <span class="at">length.out =</span> <span class="dv">25</span>)</span>
<span id="cb490-7"><a href="programmation.html#cb490-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(x.seq, <span class="fu">predict</span>(np.reg, x.seq), <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb490-8"><a href="programmation.html#cb490-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb490-9"><a href="programmation.html#cb490-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>L’utilisation de la syntaxe <strong>…</strong> permet de préciser que la fonction <em>plot_reg()</em> pourra, si besoin, faire appel à n’importe quelle option de la fonction <em>plot()</em>.</p>
<p>Pour illustrer la chose, exécuter les instructions suivantes.</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="programmation.html#cb491-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>) </span>
<span id="cb491-2"><a href="programmation.html#cb491-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> x<span class="sc">*</span><span class="fu">runif</span>(<span class="dv">100</span>)</span></code></pre></div>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="programmation.html#cb492-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_reg</span>(x, y, <span class="at">np =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-245-1.png" width="672" /></p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="programmation.html#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_reg</span>(x, y, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">&quot;pink&quot;</span>,</span>
<span id="cb493-2"><a href="programmation.html#cb493-2" aria-hidden="true" tabindex="-1"></a> <span class="at">xlab =</span> <span class="st">&quot;variable explicative&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;variable à expliquer&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-245-2.png" width="672" /></p>
<p><strong>Exercice 2.7</strong></p>
<p><strong>Q1</strong> Que fait la fonction <em>plot_reg()</em> ?</p>
<p><strong>Q2</strong> Ecrire une fonction <em>hist_extrm()</em> qui prend en argument d’entrée un entier <strong>n</strong>, un entier <strong>B</strong> et <strong>…</strong> qui correspondra aux options utilisées dans la fonction <em>hist()</em>. Cette fonction devra mettre en oeuvre l’algorithme ci-dessous :</p>
<p>Répèter <strong>B</strong> fois l’opération suivante :</p>
<ul>
<li>simulation d’un vecteur <strong>x</strong> de taille <em>n</em> selon une <span class="math inline">\(N(0,1)\)</span>,</li>
</ul>
<p><strong>Résultat</strong>
On comptabilise sur les <strong>B</strong> boucles le pourcentages de boucles où il existe au moins un élément de <strong>x</strong> supérieur en valeur absolue à 1.96. On stockera les valeurs concernées et on représentera l’histogramme des valeurs extrêmes.</p>
</div>
</div>
</div>
<div id="a-quoi-servent-les-fonctions-substitutequote-et-eval" class="section level2" number="3.9">
<h2><span class="header-section-number">3.9</span> A quoi servent les fonctions <em>substitute()/quote()</em> et <em>eval()</em> ?</h2>
<p>On considère l’exemple ci-dessous :</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="programmation.html#cb494-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb494-2"><a href="programmation.html#cb494-2" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(a, <span class="st">&quot;a&quot;</span>) </span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p><strong>a</strong> et <strong>“a”</strong> sont bien entendu deux entités différentes. <strong>a</strong> est un objet qui pointe sur la valeur 5 alors que <strong>“a”</strong> est une chaîne de caractère.</p>
<p>Losqu’on charge une librairie, on a la possibilité d’utiliser les deux commandes suivantes :</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="programmation.html#cb496-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;tidyverse&quot;</span>)</span>
<span id="cb496-2"><a href="programmation.html#cb496-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(tidyverse)</span></code></pre></div>
<p>Dans le deuxième cas, <strong>tidyverse</strong> (sans guillemet) n’est a priori pas un objet (à moins qu’au cours d’une session on ait créé un objet avec ce nom). C’est donc qu’il a été interprété comme étant quelque chose de différent d’un objet.</p>
<div id="les-fonctions-quote-et-substitute" class="section level3" number="3.9.1">
<h3><span class="header-section-number">3.9.1</span> Les fonctions <em>quote()</em> et <em>substitute()</em></h3>
<p>Les fonctions <em>quote()</em> et <em>substitute()</em> permettent de capturer une instruction sans l’évaluer. Pour généraliser, on va appeler cette capture une expression. La différence entre <em>eval()</em> et <em>substitute()</em> est décrite dans le chapitre <a href="http://adv-r.had.co.nz/Computing-on-the-language.html">Non-standard evaluation</a> de l’ouvrage d’Hadley Wickham, mais pour résumer <em>quote()</em> ne fait que retourner l’expression qu’on lui donne en entrée alors que <em>substitute</em> est un peu plus complexe.</p>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="programmation.html#cb497-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quote</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>## 1:10</code></pre>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="programmation.html#cb499-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quote</span>(<span class="fu">f</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span></code></pre></div>
<pre><code>## f(1:10)</code></pre>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="programmation.html#cb501-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quote</span>(<span class="fu">f</span>(x))</span></code></pre></div>
<pre><code>## f(x)</code></pre>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="programmation.html#cb503-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quote</span>(<span class="fu">f</span>(x <span class="sc">+</span> y<span class="sc">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## f(x + y^2)</code></pre>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="programmation.html#cb505-1" aria-hidden="true" tabindex="-1"></a><span class="fu">substitute</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>## 1:10</code></pre>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="programmation.html#cb507-1" aria-hidden="true" tabindex="-1"></a><span class="fu">substitute</span>(<span class="fu">f</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span></code></pre></div>
<pre><code>## f(1:10)</code></pre>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="programmation.html#cb509-1" aria-hidden="true" tabindex="-1"></a><span class="fu">substitute</span>(<span class="fu">f</span>(x))</span></code></pre></div>
<pre><code>## f(x)</code></pre>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="programmation.html#cb511-1" aria-hidden="true" tabindex="-1"></a><span class="fu">substitute</span>(<span class="fu">f</span>(x <span class="sc">+</span> y<span class="sc">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## f(x + y^2)</code></pre>
<p>Une fois qu’on a fait cette capture de code, le but est d’évaluer cette expression dans un environnement spécifique et au moment où on le souhaitera avec la fonction <em>eval()</em>.</p>
</div>
<div id="la-fonction-eval" class="section level3" number="3.9.2">
<h3><span class="header-section-number">3.9.2</span> La fonction <em>eval()</em></h3>
<p>Cette fonction permet d’évaluer une expression. Par défaut, elle est évaluée dans l’environnement courant de <strong>R</strong>. Autrement dit, si on considère l’expression suivante :</p>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="programmation.html#cb513-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">quote</span>(<span class="fu">f.eval</span>(x.eval))</span></code></pre></div>
<p>Si on veut évaluer cette expression, il faut que la fonction <em>f.eval()</em> et l’objet <strong>x.eval</strong> existent tous les deux dans l’environnement où on souhaite exécuter cette expression. Par défaut, <em>eval()</em> ira chercher dans l’environnement courant. Ici, on obtient le message d’erreur suivant car la fonction <em>f.eval()</em> et l’objet <strong>x.eval</strong> n’ont pas été définies au préalables :</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="programmation.html#cb514-1" aria-hidden="true" tabindex="-1"></a><span class="fu">eval</span>(a)</span></code></pre></div>
<pre><code>## Error in f.eval(x.eval): impossible de trouver la fonction &quot;f.eval&quot;</code></pre>
<p>On considère un autre exemple avec l’expression suivante :</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="programmation.html#cb516-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">quote</span>(Species <span class="sc">==</span> <span class="st">&quot;setosa&quot;</span>)</span></code></pre></div>
<p>La commande suivante donnera un message d’erreur :</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="programmation.html#cb517-1" aria-hidden="true" tabindex="-1"></a><span class="fu">eval</span>(a)</span></code></pre></div>
<pre><code>## Error in eval(a): objet &#39;Species&#39; introuvable</code></pre>
<p>En revanche, on peut préciser qu’on va trouver le nom <strong>Species</strong> dans l’environnement du <strong>data.frame</strong> nommé <strong>iris</strong> :</p>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb519-1"><a href="programmation.html#cb519-1" aria-hidden="true" tabindex="-1"></a><span class="fu">eval</span>(a, <span class="at">envir =</span> iris)</span></code></pre></div>
<pre><code>##   [1]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
##  [13]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
##  [25]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
##  [37]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
##  [49]  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [61] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [73] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [85] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [97] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [109] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [121] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [133] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [145] FALSE FALSE FALSE FALSE FALSE FALSE</code></pre>
<div id="et-en-pratique" class="section level4" number="3.9.2.1">
<h4><span class="header-section-number">3.9.2.1</span> Et en pratique ?</h4>
<p>Elles sont utilisées dans beaucoup de fonction sans qu’on s’en apperçoive nécessairement. On va voir quelques fonctions qui utilisent ces expressions :</p>
<ul>
<li>dans la fonction <em>subset()</em>, le deuxième argument est considérée comme une expression :</li>
</ul>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="programmation.html#cb521-1" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(iris, Species <span class="sc">==</span> <span class="st">&quot;setosa&quot;</span> <span class="sc">&amp;</span> Sepal.Length <span class="sc">&gt;</span> <span class="fl">5.5</span>)</span></code></pre></div>
<pre><code>##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 15          5.8         4.0          1.2         0.2  setosa
## 16          5.7         4.4          1.5         0.4  setosa
## 19          5.7         3.8          1.7         0.3  setosa</code></pre>
<p>Ainsi, l’expression <em>Species == “setosa” &amp; Sepal.Length &gt; 5.5</em> sera évaluée dans le jeu de données <strong>iris</strong> ce qui permet d’éviter de faire :</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="programmation.html#cb523-1" aria-hidden="true" tabindex="-1"></a>iris[iris<span class="sc">$</span>Species <span class="sc">==</span> <span class="st">&quot;setosa&quot;</span> <span class="sc">&amp;</span> iris<span class="sc">$</span>Sepal.Length <span class="sc">&gt;</span> <span class="fl">5.5</span>, ]</span></code></pre></div>
<pre><code>##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 15          5.8         4.0          1.2         0.2  setosa
## 16          5.7         4.4          1.5         0.4  setosa
## 19          5.7         3.8          1.7         0.3  setosa</code></pre>
<ul>
<li><p>les différentes fonctions <em>filter()</em>, <em>arrange()</em>, etc. du package <strong>dplyr</strong> présentées dans le chapitre précédent utilisent le même genre de syntaxe que celui de la fonction <em>subset()</em>.</p></li>
<li><p>la fonction <em>plot.defaut()</em> qui représente un nuage de points :</p></li>
</ul>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="programmation.html#cb525-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="fu">rnorm</span>(<span class="dv">10</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-257-1.png" width="672" /></p>
<p>Les arguments par défaut pour représenter la légende en abscisse et en ordonnées (<strong>xlab</strong> et <strong>ylab</strong>) correspondent aux expressions des paramètres <strong>x</strong> et <strong>y</strong> données en entrée.</p>
</div>
</div>
<div id="débugger-une-fonction" class="section level3" number="3.9.3">
<h3><span class="header-section-number">3.9.3</span> Débugger une fonction</h3>
<div id="analyser-le-message-derreur" class="section level4" number="3.9.3.1">
<h4><span class="header-section-number">3.9.3.1</span> Analyser le message d’erreur</h4>
<p>Lorsqu’un message d’erreur (ou d’avertissement) apparaît en rouge dans la console, la première chose à faire est d’essayer de le comprendre. La plupart du temps, le message est suffisament implicite pour qu’on puisse trouver d’où provient le problème.</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb526-1"><a href="programmation.html#cb526-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>))</span></code></pre></div>
<pre><code>## Error in sum(c(&quot;a&quot;, &quot;b&quot;)): &#39;type&#39; (character) de l&#39;argument incorrect</code></pre>
<p>Dans cet exemple, le message d’erreur n’intervient pas dans le coeur de la fonction, mais dans l’appel des arguments. Lorsque l’erreur est dûe à l’exécution d’une commande à l’intérieur d’une fonction, il est parfois plus difficile d’identifier d’où vient le problème.</p>
</div>
<div id="la-fonction-traceback" class="section level4" number="3.9.3.2">
<h4><span class="header-section-number">3.9.3.2</span> La fonction <em>traceback()</em></h4>
<p>Le principe de la fonction <em>traceback()</em> est le suivant : si un message d’erreur est apparu à cause de l’appel d’une commande, l’historique qui a conduit à l’appel de cette commande sera affiché.</p>
<p>Ici, on créé une fonction <em>ex_bug()</em> à partir des fonctions <em>mean_rnorm.1()</em> et <em>mean_rnorm.2()</em> créées précédemment, dans laquelle on a glissé une erreur.</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="programmation.html#cb528-1" aria-hidden="true" tabindex="-1"></a>ex_bug <span class="ot">&lt;-</span> <span class="cf">function</span>(n, p) {</span>
<span id="cb528-2"><a href="programmation.html#cb528-2" aria-hidden="true" tabindex="-1"></a>  n2 <span class="ot">&lt;-</span> <span class="fu">as.character</span>(n)</span>
<span id="cb528-3"><a href="programmation.html#cb528-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">mean_rnorm.1</span>(n2, p) <span class="sc">&gt;</span> <span class="fu">mean_rnorm.2</span>(n, p)))</span>
<span id="cb528-4"><a href="programmation.html#cb528-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>On obtient le message d’erreur suivant :</p>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb529-1"><a href="programmation.html#cb529-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ex_bug</span>(<span class="dv">5</span>, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## Error in mean_rnorm.1(n2, p): impossible de trouver la fonction &quot;mean_rnorm.1&quot;</code></pre>
<p>On appelle la fonction <em>traceback()</em> dans la foulée du message d’erreur :</p>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb531-1"><a href="programmation.html#cb531-1" aria-hidden="true" tabindex="-1"></a><span class="fu">traceback</span>()</span></code></pre></div>
<div class="sourceCode" id="cb532"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb532-1"><a href="programmation.html#cb532-1" aria-hidden="true" tabindex="-1"></a><span class="ex">4:</span> matrix<span class="er">(</span><span class="ex">0,</span> n, 1<span class="kw">)</span> <span class="ex">at</span> <span class="co">#2</span></span>
<span id="cb532-2"><a href="programmation.html#cb532-2" aria-hidden="true" tabindex="-1"></a><span class="ex">3:</span> mean_rnorm.1<span class="er">(</span><span class="ex">n2,</span> p<span class="kw">)</span> <span class="ex">at</span> <span class="co">#3</span></span>
<span id="cb532-3"><a href="programmation.html#cb532-3" aria-hidden="true" tabindex="-1"></a><span class="ex">2:</span> which<span class="er">(</span><span class="ex">mean_rnorm.1</span><span class="er">(</span><span class="ex">n2,</span> p<span class="kw">)</span> <span class="op">&gt;</span> mean_rnorm.2<span class="kw">(</span><span class="ex">n,</span> p<span class="kw">))</span> <span class="ex">at</span> <span class="co">#3</span></span>
<span id="cb532-4"><a href="programmation.html#cb532-4" aria-hidden="true" tabindex="-1"></a><span class="ex">1:</span> ex_bug<span class="er">(</span><span class="ex">5,</span> 10<span class="kw">)</span></span></code></pre></div>
<p>Comment interpéter le résultat de la fonction <em>traceback()</em>. Le message d’erreur est intervenu au moment d’appeler la commande de la ligne 4. Cette commande a été appelée à la suite de l’appel de la commande de la ligne 3. La commande de la ligne 3 a été appelée suite à la commande de la ligne 2. La ligne 1 correspond bien entend à l’appel de la fonction de départ <em>ex_bug()</em>.</p>
</div>
<div id="la-fonction-debugonce" class="section level4" number="3.9.3.3">
<h4><span class="header-section-number">3.9.3.3</span> La fonction <em>debugonce()</em></h4>
<p>La fonction <em>debugonce()</em> a pour objectif de rentrer dans le coeur de la fonction considérée et d’exécuter les lignes de code l’une après l’autre. Après chaque exécution, il est possible d’utiliser la fonction <em>ls()</em>, <em>print()</em>, etc. pour connaître le résultat des étapes intermédiaires. On n’est pas obligé d’utiliser cette fonction uniquement après l’affichage d’un message d’erreur. Parfois, on n’a pas de message d’erreur, mais le résultat retourné n’est pas celui attendu et il peut s’agir d’un problème de programmation. Dans ce cas là, l’idée est d’exécuter son code ligne après ligne et de vérifier les étapes intermédiaires.</p>
<p>On considère la fonction suivante :</p>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="programmation.html#cb533-1" aria-hidden="true" tabindex="-1"></a>ex_bug<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb533-2"><a href="programmation.html#cb533-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb533-3"><a href="programmation.html#cb533-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb533-4"><a href="programmation.html#cb533-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">log</span>(x)</span>
<span id="cb533-5"><a href="programmation.html#cb533-5" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb533-6"><a href="programmation.html#cb533-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Pour utiliser la fonction <em>debugonce()</em> :</p>
<div class="sourceCode" id="cb534"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb534-1"><a href="programmation.html#cb534-1" aria-hidden="true" tabindex="-1"></a><span class="ex">debugonce</span><span class="er">(</span><span class="ex">ex_bug.2</span><span class="kw">)</span></span>
<span id="cb534-2"><a href="programmation.html#cb534-2" aria-hidden="true" tabindex="-1"></a><span class="ex">ex_bug.2</span><span class="er">(</span><span class="ex">-5</span><span class="kw">)</span></span></code></pre></div>
<p>En exécutant pas à pas la fonction <em>ex_bug.2(-5)</em>, on peut demander à chaque étape la valeur que prend la variable <strong>x</strong> en cours d’exécution ; il faut pour cela saisir la variable <strong>x</strong> devant le prompt du débugger (<em>Browse[2]&gt;</em>).</p>
</div>
<div id="négliger-un-message-derreur" class="section level4" number="3.9.3.4">
<h4><span class="header-section-number">3.9.3.4</span> Négliger un message d’erreur</h4>
<p>Une erreur entraîne l’interruption automatique du processus en cours d’execution. Parfois, on peut avoir une erreur, mais on ne souhaite pas que cela interrompe le processus.</p>
<div id="la-fonction-try" class="section level5" number="3.9.3.4.1">
<h5><span class="header-section-number">3.9.3.4.1</span> La fonction <em>try()</em></h5>
<p>Si on connaît l’instruction qui peut entraîner une erreur, il est possible de lui appliquer la fonction <em>try()</em> :</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="programmation.html#cb535-1" aria-hidden="true" tabindex="-1"></a>f_error<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb535-2"><a href="programmation.html#cb535-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">try</span>(x <span class="ot">&lt;-</span> <span class="fu">log</span>(x))</span>
<span id="cb535-3"><a href="programmation.html#cb535-3" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb535-4"><a href="programmation.html#cb535-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Ci-dessous, on constate que le message d’erreur est affiché, mais cela n’a pas interrompu la fonction.</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="programmation.html#cb536-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f_error.1</span>(<span class="st">&quot;10&quot;</span>)</span></code></pre></div>
<pre><code>## Error in log(x) : argument non numérique pour une fonction mathématique</code></pre>
<pre><code>## [1] &quot;10&quot;</code></pre>
<p><strong>Bibliographie :</strong> pour plus de d’informations sur le débuggage, on renvoie le lecteur au chapitre <a href="http://adv-r.had.co.nz/Exceptions-Debugging.html">“Debugging, condition handling, and defensive programming”</a> du livre “Advanced <strong>R</strong>” d’Hadley Wickham.</p>
</div>
</div>
</div>
</div>
<div id="programmation-orientée-s3s4" class="section level2" number="3.10">
<h2><span class="header-section-number">3.10</span> Programmation orientée : S3/S4</h2>
<div id="la-norme-s3" class="section level3" number="3.10.1">
<h3><span class="header-section-number">3.10.1</span> La norme S3</h3>
<p>Nous nous sommes inspirés du document suivant pour décrire la programmation orientée qui utilise la norme S3 : <a href="http://www.duclert.org/r-divers/classes-S3-R.php" class="uri">http://www.duclert.org/r-divers/classes-S3-R.php</a>. Pour expliquer son principe, nous allons prende un exemple concret.</p>
<p>On voudrait calculer l’aire de différentes figures géométriques :</p>
<ul>
<li>un carré, dont il nous faut connaître la longueur d’un côté, par exemple :</li>
</ul>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="programmation.html#cb539-1" aria-hidden="true" tabindex="-1"></a>squ <span class="ot">&lt;-</span> <span class="dv">3</span></span></code></pre></div>
<ul>
<li>un rectangle, défini par sa longueur et sa largeur, par exemple :</li>
</ul>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="programmation.html#cb540-1" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>)</span></code></pre></div>
<ul>
<li>un cercle, caractérisé par son rayon, par exemple :</li>
</ul>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="programmation.html#cb541-1" aria-hidden="true" tabindex="-1"></a>cir <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">10</span>)</span></code></pre></div>
<p>Pour ce faire, on souhaiterait utiliser une fonction qui s’appelle <em>getArea()</em> et qui puisse reconaître quand on l’applique à un carré, un rectangle ou un cercle afin d’utiliser la bonne formule. Ceci consiste à définir une méthode générique <strong>getArea</strong> qui renvoie à la bonne implémentation en fonction de la classe de l’argument d’entrée. C’est ce qu’on appelle le polymorphisme.</p>
<div id="définition-dune-nouvelle-classe" class="section level4" number="3.10.1.1">
<h4><span class="header-section-number">3.10.1.1</span> Définition d’une nouvelle classe</h4>
<p>Pour pouvoir être identifié comme étant un objet particulier, les trois objets ci-dessus doivent être définis comme appartenant à une certaine classe, que l’utilisateur, dans la norme S3, peut lui-même créer. On définit ainsi ci-dessous les trois types de classe <strong>carre</strong>, <strong>rectangle</strong> et <strong>cercle</strong> en utilisant la fonction <em>class()</em> :</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="programmation.html#cb542-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(cir) <span class="ot">&lt;-</span> <span class="st">&quot;cercle&quot;</span></span>
<span id="cb542-2"><a href="programmation.html#cb542-2" aria-hidden="true" tabindex="-1"></a>cir</span></code></pre></div>
<pre><code>## [1] 3.162278
## attr(,&quot;class&quot;)
## [1] &quot;cercle&quot;</code></pre>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="programmation.html#cb544-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(rec) <span class="ot">&lt;-</span> <span class="st">&quot;rectangle&quot;</span></span>
<span id="cb544-2"><a href="programmation.html#cb544-2" aria-hidden="true" tabindex="-1"></a>rec</span></code></pre></div>
<pre><code>## [1] 5 6
## attr(,&quot;class&quot;)
## [1] &quot;rectangle&quot;</code></pre>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb546-1"><a href="programmation.html#cb546-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(squ) <span class="ot">&lt;-</span> <span class="st">&quot;carre&quot;</span> </span>
<span id="cb546-2"><a href="programmation.html#cb546-2" aria-hidden="true" tabindex="-1"></a>squ</span></code></pre></div>
<pre><code>## [1] 3
## attr(,&quot;class&quot;)
## [1] &quot;carre&quot;</code></pre>
<p><strong>Remarque :</strong> à ce stade, nous n’avons créé aucune fonction qui puisse s’appliquer spécifiquement à ces objets. Cependant, comme ils ont été construits à la base comme des vecteurs, on peut toujours appliquer toutes les fonctions qui s’appliquent à des vecteurs de <strong>numeric</strong>.</p>
<p>Par ailleurs, pour calculer l’aire de ces objets, on pourrait écrire la fonction suivante qui traite le cas de chaque classe:</p>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="programmation.html#cb548-1" aria-hidden="true" tabindex="-1"></a>area <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb548-2"><a href="programmation.html#cb548-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">switch</span>(<span class="fu">class</span>(x), </span>
<span id="cb548-3"><a href="programmation.html#cb548-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">carre =</span> x <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb548-4"><a href="programmation.html#cb548-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">rectangle =</span> x[<span class="dv">1</span>] <span class="sc">*</span> x[<span class="dv">2</span>],</span>
<span id="cb548-5"><a href="programmation.html#cb548-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">cercle =</span> pi <span class="sc">*</span> x <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb548-6"><a href="programmation.html#cb548-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;class should be among carre/rec/cercle&quot;</span>)</span>
<span id="cb548-7"><a href="programmation.html#cb548-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Cependant, si on considère une nouvelle classe d’objet (un triangle par exemple), on devra reprogrammer la fonction <em>area()</em>.</p>
<p>C’est pourquoi on définit une méthode générique afin de de pouvoir greffer autant de nouvelles classes d’objet sur celle-ci (par exemple, <strong>plot</strong> est une méthode sur laquelle on peut appliquer différents types d’objets).</p>
</div>
<div id="définition-dune-méthode-générique" class="section level4" number="3.10.1.2">
<h4><span class="header-section-number">3.10.1.2</span> Définition d’une méthode générique</h4>
<p>On va créer la fonction <em>getArea()</em> qui va s’appliquer à ces classes d’objet en 3 étapes : <strong>getArea</strong> sera définie comme étant une méthode générique.</p>
<ul>
<li>La première étape consiste à définir la fonction <em>getArea()</em> comme étant une méthode générique. Autrement dit, on signale à <strong>R</strong> que cette fonction sera ensuite implémentée sous différentes versions :</li>
</ul>
<div class="sourceCode" id="cb549"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb549-1"><a href="programmation.html#cb549-1" aria-hidden="true" tabindex="-1"></a>getArea <span class="ot">&lt;-</span> <span class="cf">function</span>(obj)</span>
<span id="cb549-2"><a href="programmation.html#cb549-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">UseMethod</span>(<span class="st">&quot;getArea&quot;</span>, obj)</span></code></pre></div>
<ul>
<li>La deuxième étape consiste à créer une fonction par défaut qui sera appliquée dans le cas où on appliquerait à la fonction <em>getArea()</em> une classe d’objet autre que <strong>carre</strong>, <strong>rectangle</strong> ou <strong>cercle</strong>.</li>
</ul>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="programmation.html#cb550-1" aria-hidden="true" tabindex="-1"></a>getArea.default <span class="ot">&lt;-</span> <span class="cf">function</span>(obj) {</span>
<span id="cb550-2"><a href="programmation.html#cb550-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">&quot;Méthode getArea non définie pour ce type d&#39;objet&quot;</span>)</span>
<span id="cb550-3"><a href="programmation.html#cb550-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>Enfin, on va créer les 3 “sous” fonctions de <em>getArea()</em> en ajoutant simplement à <strong>getArea</strong> le suffixe <strong>.cercle</strong>, <strong>.rectangle</strong> et <strong>.carre</strong> :</li>
</ul>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb551-1"><a href="programmation.html#cb551-1" aria-hidden="true" tabindex="-1"></a>getArea.cercle <span class="ot">&lt;-</span> <span class="cf">function</span>(obj) {</span>
<span id="cb551-2"><a href="programmation.html#cb551-2" aria-hidden="true" tabindex="-1"></a>  pi <span class="sc">*</span> obj[<span class="dv">1</span>] <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb551-3"><a href="programmation.html#cb551-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb551-4"><a href="programmation.html#cb551-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb551-5"><a href="programmation.html#cb551-5" aria-hidden="true" tabindex="-1"></a>getArea.rectangle <span class="ot">&lt;-</span> <span class="cf">function</span>(obj) {</span>
<span id="cb551-6"><a href="programmation.html#cb551-6" aria-hidden="true" tabindex="-1"></a>  obj[<span class="dv">1</span>] <span class="sc">*</span> obj[<span class="dv">2</span>]</span>
<span id="cb551-7"><a href="programmation.html#cb551-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb551-8"><a href="programmation.html#cb551-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb551-9"><a href="programmation.html#cb551-9" aria-hidden="true" tabindex="-1"></a>getArea.carre <span class="ot">&lt;-</span> <span class="cf">function</span>(obj) {</span>
<span id="cb551-10"><a href="programmation.html#cb551-10" aria-hidden="true" tabindex="-1"></a>  obj[<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb551-11"><a href="programmation.html#cb551-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Voici un exemple d’application d’utilisation de la méthode <strong>getArea</strong> qu’on vient de créer :</p>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb552-1"><a href="programmation.html#cb552-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getArea</span>(cir)</span></code></pre></div>
<pre><code>## [1] 31.41593</code></pre>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="programmation.html#cb554-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getArea</span>(rec)</span></code></pre></div>
<pre><code>## [1] 30</code></pre>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="programmation.html#cb556-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getArea</span>(squ)</span></code></pre></div>
<pre><code>## [1] 9</code></pre>
<p>Si on applique la méthode <strong>getArea</strong> à une classe d’objet non défini :</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="programmation.html#cb558-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb558-2"><a href="programmation.html#cb558-2" aria-hidden="true" tabindex="-1"></a><span class="fu">getArea</span>(a)</span></code></pre></div>
<pre><code>## Error in getArea.default(a): Méthode getArea non définie pour ce type d&#39;objet</code></pre>
<p><strong>Exercice 2.8</strong></p>
<p>Ajouter à la méthode <strong>getArea</strong>, la classe triangle</p>
</div>
<div id="exemple-de-méthodes-génériques" class="section level4" number="3.10.1.3">
<h4><span class="header-section-number">3.10.1.3</span> Exemple de méthodes génériques</h4>
<p>Il existe de nombreuses méthodes sous <strong>R</strong> qui sont déclarées comme génériques dans la norme S3. Par exemple, lorsqu’on utilise la fonction <em>plot()</em> ci-dessous, on l’applique dans le premier cas sur deux vecteurs <strong>numeric</strong> et dans le deuxième cas, on l’applique sur le résultat de la fonction <em>lm()</em> :</p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb560-1"><a href="programmation.html#cb560-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">rnorm</span>(<span class="dv">10</span>), <span class="fu">runif</span>(<span class="dv">10</span>))</span>
<span id="cb560-2"><a href="programmation.html#cb560-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> Sepal.Width, <span class="at">data =</span> iris))</span></code></pre></div>
<p>De même, pour savoir si un objet appartient à la norme S3, ce qui sous-entend que des méthodes génériques pourront s’appliquer sur cet objet, on peut utiliser la fonction <em>otype()</em> du package <strong>pryr</strong> :</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="programmation.html#cb561-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;pryr&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="programmation.html#cb562-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">y =</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span>
<span id="cb562-2"><a href="programmation.html#cb562-2" aria-hidden="true" tabindex="-1"></a>pryr<span class="sc">::</span><span class="fu">otype</span>(df)    </span></code></pre></div>
<pre><code>## [1] &quot;S3&quot;</code></pre>
<p>On constate qu’un <strong>data.frame</strong> appartient à la norme S3, ce qui sous entend qu’un nombre de méthodes génériques pourront s’appliquer dessus. La plupart du temps, ces objets qui appartiennent à la norme S3 sont créés à partir de <strong>list</strong>. Pour savoir comment ils sont constitués, on peut donc simplement utiliser la fonction <em>str()</em>.</p>
<div id="pour-connaître-les-objets-qui-sappliquent-sur-une-méthode-générique" class="section level5" number="3.10.1.3.1">
<h5><span class="header-section-number">3.10.1.3.1</span> Pour connaître les objets qui s’appliquent sur une méthode générique</h5>
<p>On utilise la fonction <em>methods()</em> appliquée au nom de la méthode. Par exemple :</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="programmation.html#cb564-1" aria-hidden="true" tabindex="-1"></a><span class="fu">methods</span>(<span class="st">&quot;plot&quot;</span>)</span></code></pre></div>
<pre><code>##  [1] plot,ANY,ANY-method                       
##  [2] plot,color,ANY-method                     
##  [3] plot,psi_func,ANY-method                  
##  [4] plot,Spatial,missing-method               
##  [5] plot,SpatialGrid,missing-method           
##  [6] plot,SpatialGridDataFrame,missing-method  
##  [7] plot,SpatialLines,missing-method          
##  [8] plot,SpatialMultiPoints,missing-method    
##  [9] plot,SpatialPixels,missing-method         
## [10] plot,SpatialPixelsDataFrame,missing-method
## [11] plot,SpatialPoints,missing-method         
## [12] plot,SpatialPolygons,missing-method       
## [13] plot.acf*                                 
## [14] plot.aggr*                                
## [15] plot.amelia*                              
## [16] plot.bclust*                              
## [17] plot.boot*                                
## [18] plot.classIntervals*                      
## [19] plot.correspondence*                      
## [20] plot.data.frame*                          
## [21] plot.decomposed.ts*                       
## [22] plot.default                              
## [23] plot.dendrogram*                          
## [24] plot.density*                             
## [25] plot.ecdf                                 
## [26] plot.factor*                              
## [27] plot.formula*                             
## [28] plot.function                             
## [29] plot.ggplot*                              
## [30] plot.goodfit*                             
## [31] plot.gtable*                              
## [32] plot.hcl_palettes*                        
## [33] plot.hclust*                              
## [34] plot.histogram*                           
## [35] plot.HoltWinters*                         
## [36] plot.ica*                                 
## [37] plot.isoreg*                              
## [38] plot.lda*                                 
## [39] plot.lm*                                  
## [40] plot.lmrob*                               
## [41] plot.loadings*                            
## [42] plot.loddsratio*                          
## [43] plot.loglm*                               
## [44] plot.lowess*                              
## [45] plot.lts*                                 
## [46] plot.margin*                              
## [47] plot.mca*                                 
## [48] plot.mcd*                                 
## [49] plot.medpolish*                           
## [50] plot.mlm*                                 
## [51] plot.mvr*                                 
## [52] plot.mvrVal*                              
## [53] plot.numpy.ndarray*                       
## [54] plot.paretoTail*                          
## [55] plot.ppr*                                 
## [56] plot.prcomp*                              
## [57] plot.princomp*                            
## [58] plot.profile*                             
## [59] plot.profile.nls*                         
## [60] plot.R6*                                  
## [61] plot.randomForest*                        
## [62] plot.raster*                              
## [63] plot.ridgelm*                             
## [64] plot.scores*                              
## [65] plot.shingle*                             
## [66] plot.SOM*                                 
## [67] plot.somgrid*                             
## [68] plot.spec*                                
## [69] plot.stepfun                              
## [70] plot.stft*                                
## [71] plot.stl*                                 
## [72] plot.structable*                          
## [73] plot.svm*                                 
## [74] plot.table*                               
## [75] plot.trans*                               
## [76] plot.trellis*                             
## [77] plot.ts                                   
## [78] plot.tskernel*                            
## [79] plot.TukeyHSD*                            
## [80] plot.tune*                                
## [81] plot.venn                                 
## [82] plot.zoo                                  
## see &#39;?methods&#39; for accessing help and source code</code></pre>
</div>
<div id="pour-connaître-les-méthodes-qui-sappliquent-sur-une-classe-dobjet" class="section level5" number="3.10.1.3.2">
<h5><span class="header-section-number">3.10.1.3.2</span> Pour connaître les méthodes qui s’appliquent sur une classe d’objet</h5>
<p>On utilise la fonction <em>methods()</em> en précisant l’argument <strong>class =</strong>. Par exemple :</p>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb566-1"><a href="programmation.html#cb566-1" aria-hidden="true" tabindex="-1"></a><span class="fu">methods</span>(<span class="at">class =</span> <span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<pre><code>##  [1] add1           alias          anova          case.names     coerce        
##  [6] confint        cooks.distance deviance       dfbeta         dfbetas       
## [11] drop1          dummy.coef     effects        extractAIC     family        
## [16] formula        fortify        hatvalues      influence      initialize    
## [21] kappa          labels         logLik         model.frame    model.matrix  
## [26] nobs           plot           predict        print          proj          
## [31] qr             residuals      rstandard      rstudent       show          
## [36] simulate       slotsFromS3    summary        variable.names vcov          
## see &#39;?methods&#39; for accessing help and source code</code></pre>
<p><strong>Pour en savoir plus :</strong> le lecteur pourra consulter la dernière partie du lien suivant qui donne un exemple de création de méthode générique plus complet, avec la possibilité de définir les commandes <strong>+</strong>, <strong>[]</strong>, etc. sur de nouvelles classes d’objet : <a href="http://www.duclert.org/r-divers/classes-S3-R.php" class="uri">http://www.duclert.org/r-divers/classes-S3-R.php</a>.</p>
</div>
</div>
</div>
<div id="la-norme-s4" class="section level3" number="3.10.2">
<h3><span class="header-section-number">3.10.2</span> La norme S4</h3>
<p>Ici, on présentera uniquement les grandes lignes de la norme S4. Cette section est inspirée du chapitre <a href="http://adv-r.had.co.nz/OO-essentials.html">OO field guide</a> du livre d’Hadley Wickham.</p>
<p>La norme S4 s’inspire de la norme S3 auxquelles s’ajoutent certaines caractéristiques telles que :</p>
<ul>
<li>les classes sont définies en ajoutant un certain nombre de règles et de précisions les concernant. Pour mieux comprendre, dans l’exemple ci-dessous, on peut définir l’objet <strong>a</strong> comme appartenant à la classe <strong>lm</strong> dans la norme S3, alors qu’il n’en possède pas les caractéristiques :</li>
</ul>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb568-1"><a href="programmation.html#cb568-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb568-2"><a href="programmation.html#cb568-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(a) <span class="ot">&lt;-</span> <span class="st">&quot;lm&quot;</span></span></code></pre></div>
<ul>
<li>on utilisera un opérateur spécial <strong>@</strong> pour extraire des éléments d’un objet ayant la norme S4.</li>
</ul>
<p>Pour savoir si un objet appartient à la norme S4, on peut utiliser la fonction <em>isS4()</em>. La plupart du temps, la norme S4 n’a pas été utilisée pour définir des objets et fonctions qui appartiennant à l’environnement de base. Ils sont donc plutôt présents dans des nouveaux packages qu’on va charger.</p>
<p>Les principales fonctions utilisées pour travailler sur la norme S4 sont :</p>
<ul>
<li>la fonction <em>setClass()</em> qui permet de définir une nouvelle classe. Le 1er argument est le nom de la classe, le second est le résultat de la fonction <em>representation()</em> qui définit le nom et le type des éléments que la classe contient et le troisième argument est le résultat de la fonction <em>prototype()</em> qui donne des valeurs par défaut. Par exemple :</li>
</ul>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb569-1"><a href="programmation.html#cb569-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setClass</span>(<span class="st">&quot;Personne&quot;</span>, <span class="fu">representation</span>(<span class="at">nom =</span> <span class="st">&quot;character&quot;</span>, <span class="at">age =</span> <span class="st">&quot;numeric&quot;</span>),</span>
<span id="cb569-2"><a href="programmation.html#cb569-2" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">prototype</span>(<span class="at">nom =</span> <span class="cn">NA_character_</span>, <span class="at">age =</span> <span class="cn">NA_real_</span>))</span></code></pre></div>
<ul>
<li>la fonction <em>new()</em> permet de créer un nouvel objet.</li>
</ul>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb570-1"><a href="programmation.html#cb570-1" aria-hidden="true" tabindex="-1"></a>hadley <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">&quot;Personne&quot;</span>, <span class="at">nom =</span> <span class="st">&quot;Hadley&quot;</span>, <span class="at">age =</span> <span class="dv">31</span>)</span></code></pre></div>
<p><strong>Remarque :</strong> on accède aux éléments d’un objet de norme S4 avec la commande spéciale <strong>@</strong> :</p>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="programmation.html#cb571-1" aria-hidden="true" tabindex="-1"></a>hadley<span class="sc">@</span>age</span></code></pre></div>
<pre><code>## [1] 31</code></pre>
<p>Les autres fonctions utiles dont vous trouverez des exemples d’utilisation dans <a href="http://adv-r.had.co.nz/S4.html" class="uri">http://adv-r.had.co.nz/S4.html</a> sont :</p>
<ul>
<li><p>la fonction <em>setMethods()</em> permettant de définir des nouvelles méthodes.</p></li>
<li><p>les fonctions <em>as()</em> et <em>setAs()</em> pour passer d’une classe d’objet à une autre (quand cela est possible).</p></li>
<li><p>les fonctions <em>setValidity()</em> et <em>validObject()</em> pour vérifier la validité.</p></li>
<li><p>les fonctions <em>showClass()</em>, <em>showMethods()</em> et <em>getMethod()</em> pour accéder aux propriétés des objets et méthodes créées.</p></li>
</ul>
<p><strong>Bilbiographie :</strong> la présentation de F. Leisch à useR! 2004 (<a href="http://www.ci.tuwien.ac.at/Conferences/useR-2004/Keynotes/Leisch.pdf" class="uri">http://www.ci.tuwien.ac.at/Conferences/useR-2004/Keynotes/Leisch.pdf</a>) ainsi que le manuel de C. Genolini (<a href="https://cran.r-project.org/doc/contrib/Genolini-PetitManuelDeS4.pdf" class="uri">https://cran.r-project.org/doc/contrib/Genolini-PetitManuelDeS4.pdf</a>).</p>
</div>
</div>
<div id="visualiser-le-code-source-dune-fonction" class="section level2" number="3.11">
<h2><span class="header-section-number">3.11</span> Visualiser le code source d’une fonction</h2>
<p>Nous nous sommes inspirés du document suivant pour écrire cette section : <a href="https://informatique-mia.inra.fr/r4ciam/sites/default/files/download/tutoriels/T-methods-fev16.pdf">“Visualiser le code d’une fonction”</a>.</p>
<div id="la-fonction-est-dans-lenvironnement-courant" class="section level3" number="3.11.1">
<h3><span class="header-section-number">3.11.1</span> La fonction est dans l’environnement courant</h3>
<p>Vous tapez le nom de la fonction dans la console et le code apparaît :</p>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb573-1"><a href="programmation.html#cb573-1" aria-hidden="true" tabindex="-1"></a>sapply</span></code></pre></div>
<pre><code>## function (X, FUN, ..., simplify = TRUE, USE.NAMES = TRUE) 
## {
##     FUN &lt;- match.fun(FUN)
##     answer &lt;- lapply(X = X, FUN = FUN, ...)
##     if (USE.NAMES &amp;&amp; is.character(X) &amp;&amp; is.null(names(answer))) 
##         names(answer) &lt;- X
##     if (!isFALSE(simplify)) 
##         simplify2array(answer, higher = (simplify == &quot;array&quot;))
##     else answer
## }
## &lt;bytecode: 0x56174911a3e8&gt;
## &lt;environment: namespace:base&gt;</code></pre>
</div>
<div id="la-fonction-est-une-méthode-générique-de-type-s3" class="section level3" number="3.11.2">
<h3><span class="header-section-number">3.11.2</span> La fonction est une méthode générique de type S3</h3>
<p>Vous tapez le nom d’une fonction <em>lambda()</em> et vous obtenez une ligne <strong>UseMethod(“lambda”)</strong>. Ceci signifie que <strong>lambda</strong> est une méthode générique pour des objets issus de la classe S3. Il existe donc plusieurs fonctions associées à la fonction <em>lambda()</em>. Pour connaître quelles sont les différentes fonctions associées à la fonction <em>lambda()</em>, on utilise la fonction <em>methods()</em>. Par exemple, pour la fonction <em>summary()</em>, si on tape le nom de la fonction dans la console, on obtient :</p>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb575-1"><a href="programmation.html#cb575-1" aria-hidden="true" tabindex="-1"></a>summary</span></code></pre></div>
<pre><code>## function (object, ...) 
## UseMethod(&quot;summary&quot;)
## &lt;bytecode: 0x56174cc20718&gt;
## &lt;environment: namespace:base&gt;</code></pre>
<p>Pour obtenir les différentes fonctions associées à <em>summary()</em>, on utilise donc la fonction <em>methods()</em>.</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="programmation.html#cb577-1" aria-hidden="true" tabindex="-1"></a><span class="fu">methods</span>(<span class="st">&quot;summary&quot;</span>)</span></code></pre></div>
<pre><code>##  [1] summary,ANY-method                   summary,DBIObject-method            
##  [3] summary,diagonalMatrix-method        summary,GridTopology-method         
##  [5] summary,sparseMatrix-method          summary,Spatial-method              
##  [7] summary.aggr*                        summary.amelia*                     
##  [9] summary.Anova.mlm*                   summary.aov                         
## [11] summary.aovlist*                     summary.aspell*                     
## [13] summary.assocstats*                  summary.bcnPowerTransform*          
## [15] summary.bcnPowerTransformlmer*       summary.boot*                       
## [17] summary.check_packages_in_dir*       summary.connection                  
## [19] summary.data.frame                   summary.Date                        
## [21] summary.default                      summary.Duration*                   
## [23] summary.ecdf*                        summary.factor                      
## [25] summary.ggplot*                      summary.glm                         
## [27] summary.glmrob*                      summary.goodfit*                    
## [29] summary.haven_labelled*              summary.hcl_palettes*               
## [31] summary.infl*                        summary.Interval*                   
## [33] summary.Kappa*                       summary.lca*                        
## [35] summary.lm                           summary.lmrob*                      
## [37] summary.lodds*                       summary.loddsratio*                 
## [39] summary.loess*                       summary.loglm*                      
## [41] summary.lts*                         summary.manova                      
## [43] summary.matrix                       summary.mcd*                        
## [45] summary.mi*                          summary.microbenchmark*             
## [47] summary.mlm*                         summary.multinom*                   
## [49] summary.mvr*                         summary.negbin*                     
## [51] summary.nlrob*                       summary.nls*                        
## [53] summary.nnet*                        summary.packageStatus*              
## [55] summary.pandas.core.frame.DataFrame* summary.pandas.core.series.Series*  
## [57] summary.Period*                      summary.polr*                       
## [59] summary.POSIXct                      summary.POSIXlt                     
## [61] summary.powerTransform*              summary.ppr*                        
## [63] summary.pr_DB*                       summary.prcomp*                     
## [65] summary.princomp*                    summary.proc_time                   
## [67] summary.proxy_registry*              summary.python.builtin.object*      
## [69] summary.rlang_error*                 summary.rlang_trace*                
## [71] summary.rlm*                         summary.shingle*                    
## [73] summary.srcfile                      summary.srcref                      
## [75] summary.stepfun                      summary.stl*                        
## [77] summary.svm*                         summary.table                       
## [79] summary.trellis*                     summary.tukeysmooth*                
## [81] summary.tune*                        summary.vctrs_sclr*                 
## [83] summary.vctrs_vctr*                  summary.warnings                    
## [85] summary.yearmon*                     summary.yearqtr*                    
## [87] summary.zoo*                        
## see &#39;?methods&#39; for accessing help and source code</code></pre>
<p>Pour lire le code des fonctions affichées ci-dessus, il y a deux options :</p>
<ul>
<li>si il n’y pas d’étoile à côté de la fonction, vous pouvez obtenir directement le code de la fonction en tapant son nom complet :</li>
</ul>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="programmation.html#cb579-1" aria-hidden="true" tabindex="-1"></a>summary.proc_time</span></code></pre></div>
<pre><code>## function (object, ...) 
## {
##     if (!is.na(object[4L])) 
##         object[1L] &lt;- object[1L] + object[4L]
##     if (!is.na(object[5L])) 
##         object[2L] &lt;- object[2L] + object[5L]
##     object &lt;- object[1L:3L]
##     names(object) &lt;- c(gettext(&quot;user&quot;), gettext(&quot;system&quot;), gettext(&quot;elapsed&quot;))
##     object
## }
## &lt;bytecode: 0x56174cc20b40&gt;
## &lt;environment: namespace:base&gt;</code></pre>
<ul>
<li>s’il y a une étoile, c’est que la fonction se trouve dans un package et qu’on doit indiquer le nom du package suivi de <strong>:::</strong> :</li>
</ul>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb581-1"><a href="programmation.html#cb581-1" aria-hidden="true" tabindex="-1"></a>stats<span class="sc">:::</span>summary.ecdf</span></code></pre></div>
<p>Si on ne connaît pas le nom du package, on peut alors utiliser la fonction <em>getAnywhere()</em> qui va chercher dans toutes les librairies chargées :</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="programmation.html#cb582-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getAnywhere</span>(summary.ecdf)</span></code></pre></div>
<pre><code>## A single object matching &#39;summary.ecdf&#39; was found
## It was found in the following places
##   registered S3 method for summary from namespace stats
##   namespace:stats
## with value
## 
## function (object, ...) 
## {
##     n &lt;- length(eval(expression(x), envir = environment(object)))
##     header &lt;- paste(&quot;Empirical CDF:\t &quot;, n, &quot;unique values with summary\n&quot;)
##     structure(summary(knots(object), ...), header = header, class = &quot;summary.ecdf&quot;)
## }
## &lt;bytecode: 0x56176282fe08&gt;
## &lt;environment: namespace:stats&gt;</code></pre>
</div>
<div id="la-fonction-fait-appel-à-du-code-c" class="section level3" number="3.11.3">
<h3><span class="header-section-number">3.11.3</span> La fonction fait appel à du code <strong>C</strong></h3>
<p>Si on affiche le code la fonction <em>sum()</em>, on constate que le calcul n’est pas directement fait dans le corps de la fonction. C’est ce que nous avons vu précédemment, à savoir qu’il existe un grand nombre de fonctions qui font appel à du code compilé pour gagner en performances. Lorsqu’on voit dans une fonction les instructions <strong>.Primitive()</strong> ou <strong>.Internal()</strong>, cela signifie que <strong>R</strong> va en réalité exécuter des fonctions qui ont été compilées en <strong>C</strong>. La différence entre <strong>.Primitive()</strong> ou <strong>.Internal()</strong> vient du fait que dans le deuxième cas, on peut appeler des fonctions qui sont codées en langage <strong>R</strong>.</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="programmation.html#cb584-1" aria-hidden="true" tabindex="-1"></a>sum</span></code></pre></div>
<pre><code>## function (..., na.rm = FALSE)  .Primitive(&quot;sum&quot;)</code></pre>
<p>On peut donc faire appel à du code <strong>C</strong> de plusieurs façons. On verra ici les deux principales façons de le faire.</p>
<div id="primitive-ou-.internal" class="section level4" number="3.11.3.1">
<h4><span class="header-section-number">3.11.3.1</span> <strong>.Primitive()</strong> ou <strong>.Internal()</strong></h4>
<p>Il est difficile d’accéder directement au code source de la fonction exécutée par <strong>.Primitive()</strong> ou <strong>.Internal()</strong>. Il s’agit des fonctions qui font en général partie du package <strong>base</strong>. On peut utiliser la fonction <em>show_c_source()</em> du package <strong>pryr</strong> qui va effectuer une recherche sur <a href="https://github.com">github</a> où a été déposé le source de l’ensemble des fichiers de codes pré-compilés utilisés dans <strong>R</strong> :</p>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb586-1"><a href="programmation.html#cb586-1" aria-hidden="true" tabindex="-1"></a>pryr<span class="sc">::</span><span class="fu">show_c_source</span>(<span class="fu">.Internal</span>(<span class="fu">mean</span>(x)))</span></code></pre></div>
</div>
<div id="call" class="section level4" number="3.11.3.2">
<h4><span class="header-section-number">3.11.3.2</span> <strong>.Call()</strong></h4>
<p>Dans d’autres situtations, une fonction fait appel à du code <strong>C</strong> via la fonction <em>.Call()</em>. Par exemple :</p>
<div class="sourceCode" id="cb587"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb587-1"><a href="programmation.html#cb587-1" aria-hidden="true" tabindex="-1"></a>qnorm</span></code></pre></div>
<pre><code>## function (p, mean = 0, sd = 1, lower.tail = TRUE, log.p = FALSE) 
## .Call(C_qnorm, p, mean, sd, lower.tail, log.p)
## &lt;bytecode: 0x5617669ed170&gt;
## &lt;environment: namespace:stats&gt;</code></pre>
<p>A priori, le code source est disponible dans les répertoires nommés <strong>src</strong> : soit dans <strong>R</strong>, soit dans les packages installés (dans les deux cas, les codes sources doivent donc être accessibles depuis les répertoires). Sinon, on peut faire une reherche en ligne en tapant dans le moteur de recherche les instructions suivantes :</p>
<div class="sourceCode" id="cb589"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb589-1"><a href="programmation.html#cb589-1" aria-hidden="true" tabindex="-1"></a><span class="ex">site:https://svn.r-project.org/R/trunk/src</span> qnorm</span></code></pre></div>
<p><strong>Biliographie : </strong> pour en savoir plus sur le langage compilé, on pourra lire le chapitre <a href="http://adv-r.had.co.nz/C-interface.html#c-find-source">R’s C interface</a> du livre d’Hadley Wickham, “Advanced <strong>R</strong>.”</p>
</div>
</div>
<div id="la-fonction-est-une-méthode-générique-de-type-s4" class="section level3" number="3.11.4">
<h3><span class="header-section-number">3.11.4</span> La fonction est une méthode générique de type S4</h3>
<p>C’est le cas des fonctions programmées dans le package <strong>Matrix</strong>.</p>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb590-1"><a href="programmation.html#cb590-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;Matrix&quot;</span>)</span></code></pre></div>
<p>Si on utiliser la fonction <em>methods()</em> sur la méthode <strong>dim</strong>, pour identifier les méthodes génériques qui s’appliquent à des objets S4, on constate que le nom de la fonction est suivi d’une virgule, suivi alors de la classe de l’objet sur laquelle s’applique la méthode. Dans le cas de <em>dim()</em>, elle peut s’appliquer sur les classes d’objet <strong>MatrixFactorization</strong> ou <strong>Matrix</strong>.</p>
<div class="sourceCode" id="cb591"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb591-1"><a href="programmation.html#cb591-1" aria-hidden="true" tabindex="-1"></a><span class="fu">methods</span>(<span class="st">&quot;dim&quot;</span>)</span></code></pre></div>
<pre><code>##  [1] dim,Matrix-method                dim,MatrixFactorization-method  
##  [3] dim.cell_limits*                 dim.data.frame                  
##  [5] dim.data.table*                  dim.dist*                       
##  [7] dim.gtable*                      dim.layout*                     
##  [9] dim.lodds*                       dim.loddsratio*                 
## [11] dim.pandas.core.frame.DataFrame* dim.pandas.core.series.Series*  
## [13] dim.permutation*                 dim.resample*                   
## [15] dim.scipy.sparse.base.spmatrix*  dim.SpatialGridDataFrame*       
## [17] dim.SpatialLinesDataFrame*       dim.SpatialMultiPointsDataFrame*
## [19] dim.SpatialPixelsDataFrame*      dim.SpatialPointsDataFrame*     
## [21] dim.SpatialPolygonsDataFrame*    dim.structable*                 
## [23] dim.tbl_lazy*                    dim.trellis*                    
## see &#39;?methods&#39; for accessing help and source code</code></pre>
<p>Pour obtenir le code source de la fonction <em>dim()</em> qui s’applique à la classe d’objet <strong>MatrixFactorization</strong>, on utilise la fonction <em>getMethod()</em> ainsi :</p>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb593-1"><a href="programmation.html#cb593-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getMethod</span>(<span class="st">&quot;dim&quot;</span>, <span class="st">&quot;MatrixFactorization&quot;</span>)</span></code></pre></div>
<pre><code>## Method Definition:
## 
## function (x) 
## x@Dim
## &lt;bytecode: 0x56176001cd90&gt;
## &lt;environment: namespace:Matrix&gt;
## 
## Signatures:
##         x                    
## target  &quot;MatrixFactorization&quot;
## defined &quot;MatrixFactorization&quot;</code></pre>
<p>Pour connaître les méthodes S4 qui s’appliquent sur une classe d’objets particuliers, on utilise la fonction <em>showMethods()</em> :</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb595-1"><a href="programmation.html#cb595-1" aria-hidden="true" tabindex="-1"></a><span class="fu">showMethods</span>(<span class="at">class =</span> <span class="st">&quot;MatrixFactorization&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Function &quot;%m-%&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;%m+%&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;%within%&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;addAttrToGeom&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;as_date&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;as_datetime&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;as.difftime&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;as.duration&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;as.interval&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;as.period&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;asJSON&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;bbox&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;chgDefaults&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;complete&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;coordinates&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;coordinates&lt;-&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;coordnames&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;coordnames&lt;-&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;date&lt;-&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;day&lt;-&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbAppendTable&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbBegin&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbBind&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbCallProc&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbCanConnect&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbClearResult&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbColumnInfo&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbCommit&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbConnect&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbCreateTable&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbDataType&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbDisconnect&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbDriver&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbExecute&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbExistsTable&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbFetch&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbGetConnectArgs&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbGetException&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbGetInfo&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbGetQuery&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbGetRowCount&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbGetRowsAffected&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbGetStatement&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbHasCompleted&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbiDataType&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbIsReadOnly&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbIsValid&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbListConnections&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbListFields&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbListObjects&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbListResults&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbListTables&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbQuoteIdentifier&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbQuoteLiteral&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbQuoteString&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbReadTable&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbRemoveTable&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbRollback&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbSendQuery&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbSendStatement&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbSetDataMappings&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbUnloadDriver&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbUnquoteIdentifier&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbWithTransaction&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;dbWriteTable&quot;:
##  &lt;not an S4 generic function&gt;
## Function: dim (package base)
## x=&quot;MatrixFactorization&quot;
## 
## 
## Function &quot;dimensions&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;disaggregate&quot;:
##  &lt;not an S4 generic function&gt;
## Function: expand (package Matrix)
## x=&quot;MatrixFactorization&quot;
## 
## 
## Function &quot;fetch&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;format_ISO8601&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;fullgrid&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;fullgrid&lt;-&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;functions&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;geometry&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;geometry&lt;-&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;gridded&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;gridded&lt;-&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;hour&lt;-&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;is.projected&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;isSQLKeyword&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;make.db.names&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;merge&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;minute&lt;-&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;month&lt;-&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;over&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;polygons&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;polygons&lt;-&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;proj4string&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;proj4string&lt;-&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;qday&lt;-&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;rebuild_CRS&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;recenter&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;reclass_timespan&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;second&lt;-&quot;:
##  &lt;not an S4 generic function&gt;
## Function: show (package methods)
## object=&quot;MatrixFactorization&quot;
## 
## Function: solve (package base)
## a=&quot;MatrixFactorization&quot;, b=&quot;ANY&quot;
## a=&quot;MatrixFactorization&quot;, b=&quot;missing&quot;
## a=&quot;MatrixFactorization&quot;, b=&quot;numeric&quot;
## 
## 
## Function &quot;spChFIDs&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;spChFIDs&lt;-&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;split&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;sppanel&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;spplot&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;spsample&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;spTransform&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;sqlAppendTable&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;sqlCreateTable&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;sqlData&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;sqlInterpolate&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;SQLKeywords&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;sqlParseVariables&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;surfaceArea&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;time_length&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;wkt&quot;:
##  &lt;not an S4 generic function&gt;
## 
## Function &quot;year&lt;-&quot;:
##  &lt;not an S4 generic function&gt;</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="manipulation-de-données-avec-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="calcul-parallèle.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/02-programming.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

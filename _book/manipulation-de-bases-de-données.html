<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapitre 7 Manipulation de bases de données | Manipulation de données avec R</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapitre 7 Manipulation de bases de données | Manipulation de données avec R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapitre 7 Manipulation de bases de données | Manipulation de données avec R" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Sébastien Déjean et Thibault Laurent" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="opérations-ensemblistes.html"/>
<link rel="next" href="tidy-data.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R avancé</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#usage"><i class="fa fa-check"></i><b>1.1</b> Usage</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#render-book"><i class="fa fa-check"></i><b>1.2</b> Render book</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#preview-book"><i class="fa fa-check"></i><b>1.3</b> Preview book</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#principe-du-document"><i class="fa fa-check"></i><b>2.1</b> Principe du document</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#pré-requis"><i class="fa fa-check"></i><b>2.2</b> Pré-requis</a></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#packages-à-installer"><i class="fa fa-check"></i><b>2.3</b> Packages à installer</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="les-chaînes-de-caractères.html"><a href="les-chaînes-de-caractères.html"><i class="fa fa-check"></i><b>3</b> Les chaînes de caractères</a>
<ul>
<li class="chapter" data-level="3.1" data-path="les-chaînes-de-caractères.html"><a href="les-chaînes-de-caractères.html#fonctions-de-base"><i class="fa fa-check"></i><b>3.1</b> Fonctions de base</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="les-chaînes-de-caractères.html"><a href="les-chaînes-de-caractères.html#nchar"><i class="fa fa-check"></i><b>3.1.1</b> <em>nchar()</em></a></li>
<li class="chapter" data-level="3.1.2" data-path="les-chaînes-de-caractères.html"><a href="les-chaînes-de-caractères.html#substr"><i class="fa fa-check"></i><b>3.1.2</b> <em>substr()</em></a></li>
<li class="chapter" data-level="3.1.3" data-path="les-chaînes-de-caractères.html"><a href="les-chaînes-de-caractères.html#strsplit"><i class="fa fa-check"></i><b>3.1.3</b> <em>strsplit()</em></a></li>
<li class="chapter" data-level="3.1.4" data-path="les-chaînes-de-caractères.html"><a href="les-chaînes-de-caractères.html#toupper-tolower"><i class="fa fa-check"></i><b>3.1.4</b> <em>toupper()</em>, <em>tolower()</em></a></li>
<li class="chapter" data-level="3.1.5" data-path="les-chaînes-de-caractères.html"><a href="les-chaînes-de-caractères.html#grep"><i class="fa fa-check"></i><b>3.1.5</b> <em>grep()</em></a></li>
<li class="chapter" data-level="3.1.6" data-path="les-chaînes-de-caractères.html"><a href="les-chaînes-de-caractères.html#agrep"><i class="fa fa-check"></i><b>3.1.6</b> <em>agrep()</em></a></li>
<li class="chapter" data-level="3.1.7" data-path="les-chaînes-de-caractères.html"><a href="les-chaînes-de-caractères.html#regexpr"><i class="fa fa-check"></i><b>3.1.7</b> <em>regexpr()</em></a></li>
<li class="chapter" data-level="3.1.8" data-path="les-chaînes-de-caractères.html"><a href="les-chaînes-de-caractères.html#abbreviate"><i class="fa fa-check"></i><b>3.1.8</b> <em>abbreviate()</em></a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="les-chaînes-de-caractères.html"><a href="les-chaînes-de-caractères.html#les-expressions-régulières"><i class="fa fa-check"></i><b>3.2</b> Les expressions régulières</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="les-chaînes-de-caractères.html"><a href="les-chaînes-de-caractères.html#définition"><i class="fa fa-check"></i><b>3.2.1</b> Définition</a></li>
<li class="chapter" data-level="3.2.2" data-path="les-chaînes-de-caractères.html"><a href="les-chaînes-de-caractères.html#les-autres-expressions-régulières"><i class="fa fa-check"></i><b>3.2.2</b> Les autres expressions régulières</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="les-chaînes-de-caractères.html"><a href="les-chaînes-de-caractères.html#application-aux-tweets"><i class="fa fa-check"></i><b>3.3</b> Application aux tweets</a></li>
<li class="chapter" data-level="3.4" data-path="les-chaînes-de-caractères.html"><a href="les-chaînes-de-caractères.html#nuage-de-mots"><i class="fa fa-check"></i><b>3.4</b> Nuage de mots</a></li>
<li class="chapter" data-level="3.5" data-path="les-chaînes-de-caractères.html"><a href="les-chaînes-de-caractères.html#ordonnancement"><i class="fa fa-check"></i><b>3.5</b> Ordonnancement</a></li>
<li class="chapter" data-level="3.6" data-path="les-chaînes-de-caractères.html"><a href="les-chaînes-de-caractères.html#package-stringr"><i class="fa fa-check"></i><b>3.6</b> Package <strong>stringr</strong></a></li>
<li class="chapter" data-level="3.7" data-path="les-chaînes-de-caractères.html"><a href="les-chaînes-de-caractères.html#package-glue"><i class="fa fa-check"></i><b>3.7</b> Package <strong>glue</strong></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="les-facteurs.html"><a href="les-facteurs.html"><i class="fa fa-check"></i><b>4</b> Les facteurs</a></li>
<li class="chapter" data-level="5" data-path="les-dates.html"><a href="les-dates.html"><i class="fa fa-check"></i><b>5</b> Les dates</a>
<ul>
<li class="chapter" data-level="5.1" data-path="les-dates.html"><a href="les-dates.html#dates-et-unités-de-temps"><i class="fa fa-check"></i><b>5.1</b> Dates et unités de temps</a></li>
<li class="chapter" data-level="5.2" data-path="les-dates.html"><a href="les-dates.html#séries-temporelles"><i class="fa fa-check"></i><b>5.2</b> Séries temporelles</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="opérations-ensemblistes.html"><a href="opérations-ensemblistes.html"><i class="fa fa-check"></i><b>6</b> Opérations ensemblistes</a>
<ul>
<li class="chapter" data-level="6.1" data-path="opérations-ensemblistes.html"><a href="opérations-ensemblistes.html#lunion"><i class="fa fa-check"></i><b>6.1</b> L’union</a></li>
<li class="chapter" data-level="6.2" data-path="opérations-ensemblistes.html"><a href="opérations-ensemblistes.html#lintersection"><i class="fa fa-check"></i><b>6.2</b> L’intersection</a></li>
<li class="chapter" data-level="6.3" data-path="opérations-ensemblistes.html"><a href="opérations-ensemblistes.html#la-différence-a-b-différent-de-b-a"><i class="fa fa-check"></i><b>6.3</b> La différence (<span class="math inline">\(A-B\)</span>, différent de <span class="math inline">\(B-A\)</span>)</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="manipulation-de-bases-de-données.html"><a href="manipulation-de-bases-de-données.html"><i class="fa fa-check"></i><b>7</b> Manipulation de bases de données</a>
<ul>
<li class="chapter" data-level="7.1" data-path="manipulation-de-bases-de-données.html"><a href="manipulation-de-bases-de-données.html#jointure-et-agrégation"><i class="fa fa-check"></i><b>7.1</b> Jointure et agrégation</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="manipulation-de-bases-de-données.html"><a href="manipulation-de-bases-de-données.html#jointure-sans-utiliser-la-fonction-merge"><i class="fa fa-check"></i><b>7.1.1</b> Jointure sans utiliser la fonction <em>merge()</em></a></li>
<li class="chapter" data-level="7.1.2" data-path="manipulation-de-bases-de-données.html"><a href="manipulation-de-bases-de-données.html#jointure-en-utilisant-la-fonction-merge"><i class="fa fa-check"></i><b>7.1.2</b> Jointure en utilisant la fonction <em>merge()</em></a></li>
<li class="chapter" data-level="7.1.3" data-path="manipulation-de-bases-de-données.html"><a href="manipulation-de-bases-de-données.html#aggrégation"><i class="fa fa-check"></i><b>7.1.3</b> Aggrégation</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="manipulation-de-bases-de-données.html"><a href="manipulation-de-bases-de-données.html#package-dplyr"><i class="fa fa-check"></i><b>7.2</b> Package <strong>dplyr</strong></a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="manipulation-de-bases-de-données.html"><a href="manipulation-de-bases-de-données.html#sélection-de-lignes-avec-la-fonction-filter"><i class="fa fa-check"></i><b>7.2.1</b> Sélection de lignes avec la fonction <em>filter()</em></a></li>
<li class="chapter" data-level="7.2.2" data-path="manipulation-de-bases-de-données.html"><a href="manipulation-de-bases-de-données.html#trier-le-jeu-de-données-avec-la-fonction-arrange"><i class="fa fa-check"></i><b>7.2.2</b> Trier le jeu de données avec la fonction <em>arrange()</em></a></li>
<li class="chapter" data-level="7.2.3" data-path="manipulation-de-bases-de-données.html"><a href="manipulation-de-bases-de-données.html#sélectionner-certaines-variables-avec-la-fonction-select"><i class="fa fa-check"></i><b>7.2.3</b> Sélectionner certaines variables avec la fonction <em>select()</em></a></li>
<li class="chapter" data-level="7.2.4" data-path="manipulation-de-bases-de-données.html"><a href="manipulation-de-bases-de-données.html#changer-le-nom-de-variables-avec-la-fonction-rename"><i class="fa fa-check"></i><b>7.2.4</b> Changer le nom de variables avec la fonction <em>rename()</em></a></li>
<li class="chapter" data-level="7.2.5" data-path="manipulation-de-bases-de-données.html"><a href="manipulation-de-bases-de-données.html#ajouter-une-nouvelle-colonne-avec-la-fonction-mutate"><i class="fa fa-check"></i><b>7.2.5</b> Ajouter une nouvelle colonne avec la fonction <em>mutate()</em></a></li>
<li class="chapter" data-level="7.2.6" data-path="manipulation-de-bases-de-données.html"><a href="manipulation-de-bases-de-données.html#faire-des-calculs-statistiques-avec-la-fonction-summarise"><i class="fa fa-check"></i><b>7.2.6</b> Faire des calculs statistiques avec la fonction <em>summarise()</em></a></li>
<li class="chapter" data-level="7.2.7" data-path="manipulation-de-bases-de-données.html"><a href="manipulation-de-bases-de-données.html#faire-des-calculs-statistiques-en-utilisant-une-nouvelle-syntaxe"><i class="fa fa-check"></i><b>7.2.7</b> Faire des calculs statistiques en utilisant une nouvelle syntaxe</a></li>
<li class="chapter" data-level="7.2.8" data-path="manipulation-de-bases-de-données.html"><a href="manipulation-de-bases-de-données.html#tirer-un-échantillon-dune-population"><i class="fa fa-check"></i><b>7.2.8</b> Tirer un échantillon d’une population</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="tidy-data.html"><a href="tidy-data.html"><i class="fa fa-check"></i><b>8</b> Tidy data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="tidy-data.html"><a href="tidy-data.html#la-fonction-pivot_longer-transformer-des-colonnes-en-lignes"><i class="fa fa-check"></i><b>8.1</b> La fonction <em>pivot_longer()</em> : transformer des colonnes en lignes</a></li>
<li class="chapter" data-level="8.2" data-path="tidy-data.html"><a href="tidy-data.html#la-fonction-pivot_wider-transformer-des-lignes-en-colonnes"><i class="fa fa-check"></i><b>8.2</b> La fonction <em>pivot_wider()</em> : transformer des lignes en colonnes</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="tidy-data.html"><a href="tidy-data.html#la-fonction-separate"><i class="fa fa-check"></i><b>8.2.1</b> La fonction <em>separate()</em></a></li>
<li class="chapter" data-level="8.2.2" data-path="tidy-data.html"><a href="tidy-data.html#la-fonction-unite"><i class="fa fa-check"></i><b>8.2.2</b> La fonction <em>unite()</em></a></li>
<li class="chapter" data-level="8.2.3" data-path="tidy-data.html"><a href="tidy-data.html#la-fonction-extract"><i class="fa fa-check"></i><b>8.2.3</b> La fonction <em>extract()</em></a></li>
<li class="chapter" data-level="8.2.4" data-path="tidy-data.html"><a href="tidy-data.html#la-fonction-complete"><i class="fa fa-check"></i><b>8.2.4</b> La fonction <em>complete()</em></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="gestion-de-données-volumineuses.html"><a href="gestion-de-données-volumineuses.html"><i class="fa fa-check"></i><b>9</b> Gestion de données volumineuses</a>
<ul>
<li class="chapter" data-level="9.1" data-path="gestion-de-données-volumineuses.html"><a href="gestion-de-données-volumineuses.html#optimiser-la-fonction-read.table"><i class="fa fa-check"></i><b>9.1</b> Optimiser la fonction <em>read.table()</em></a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="gestion-de-données-volumineuses.html"><a href="gestion-de-données-volumineuses.html#astuce-1"><i class="fa fa-check"></i><b>9.1.1</b> Astuce 1</a></li>
<li class="chapter" data-level="9.1.2" data-path="gestion-de-données-volumineuses.html"><a href="gestion-de-données-volumineuses.html#astuce-2"><i class="fa fa-check"></i><b>9.1.2</b> Astuce 2</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="gestion-de-données-volumineuses.html"><a href="gestion-de-données-volumineuses.html#le-package-readr"><i class="fa fa-check"></i><b>9.2</b> Le package <strong>readr</strong></a></li>
<li class="chapter" data-level="9.3" data-path="gestion-de-données-volumineuses.html"><a href="gestion-de-données-volumineuses.html#autres-packages"><i class="fa fa-check"></i><b>9.3</b> Autres packages</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="gestion-de-données-volumineuses.html"><a href="gestion-de-données-volumineuses.html#package-data.table"><i class="fa fa-check"></i><b>9.3.1</b> Package <strong>data.table</strong></a></li>
<li class="chapter" data-level="9.3.2" data-path="gestion-de-données-volumineuses.html"><a href="gestion-de-données-volumineuses.html#package-ff"><i class="fa fa-check"></i><b>9.3.2</b> Package <strong>ff</strong></a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="gestion-de-données-volumineuses.html"><a href="gestion-de-données-volumineuses.html#algorithme-de-type-mapreducce"><i class="fa fa-check"></i><b>9.4</b> Algorithme de type Map/Reducce</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="gestion-de-données-volumineuses.html"><a href="gestion-de-données-volumineuses.html#package-matrix"><i class="fa fa-check"></i><b>9.4.1</b> Package <strong>Matrix</strong></a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="gestion-de-données-volumineuses.html"><a href="gestion-de-données-volumineuses.html#interaction-avec-des-systèmes-de-gestion-de-bases-de-données"><i class="fa fa-check"></i><b>9.5</b> Interaction avec des systèmes de gestion de bases de données</a></li>
<li class="chapter" data-level="9.6" data-path="gestion-de-données-volumineuses.html"><a href="gestion-de-données-volumineuses.html#utiliser-la-syntaxe-sql"><i class="fa fa-check"></i><b>9.6</b> utiliser la syntaxe SQL</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="visualiser-et-traiter-les-données-manquantes.html"><a href="visualiser-et-traiter-les-données-manquantes.html"><i class="fa fa-check"></i><b>10</b> Visualiser et traiter les données manquantes</a></li>
<li class="chapter" data-level="11" data-path="répertoires-et-fichiers.html"><a href="répertoires-et-fichiers.html"><i class="fa fa-check"></i><b>11</b> Répertoires et fichiers</a></li>
<li class="chapter" data-level="12" data-path="autour-de-lespace-de-travail.html"><a href="autour-de-lespace-de-travail.html"><i class="fa fa-check"></i><b>12</b> Autour de l’espace de travail</a></li>
<li class="chapter" data-level="13" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html"><i class="fa fa-check"></i><b>13</b> Footnotes and citations</a>
<ul>
<li class="chapter" data-level="13.1" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html#footnotes"><i class="fa fa-check"></i><b>13.1</b> Footnotes</a></li>
<li class="chapter" data-level="13.2" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html#citations"><i class="fa fa-check"></i><b>13.2</b> Citations</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="hello-bookdown.html"><a href="hello-bookdown.html"><i class="fa fa-check"></i><b>14</b> Hello bookdown</a>
<ul>
<li class="chapter" data-level="14.1" data-path="hello-bookdown.html"><a href="hello-bookdown.html#a-section"><i class="fa fa-check"></i><b>14.1</b> A section</a>
<ul>
<li class="chapter" data-level="" data-path="hello-bookdown.html"><a href="hello-bookdown.html#an-unnumbered-section"><i class="fa fa-check"></i>An unnumbered section</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="cross.html"><a href="cross.html"><i class="fa fa-check"></i><b>15</b> Cross-references</a>
<ul>
<li class="chapter" data-level="15.1" data-path="cross.html"><a href="cross.html#chapters-and-sub-chapters"><i class="fa fa-check"></i><b>15.1</b> Chapters and sub-chapters</a></li>
<li class="chapter" data-level="15.2" data-path="cross.html"><a href="cross.html#captioned-figures-and-tables"><i class="fa fa-check"></i><b>15.2</b> Captioned figures and tables</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="parts.html"><a href="parts.html"><i class="fa fa-check"></i><b>16</b> Parts</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="17" data-path="blocks.html"><a href="blocks.html"><i class="fa fa-check"></i><b>17</b> Blocks</a>
<ul>
<li class="chapter" data-level="17.1" data-path="blocks.html"><a href="blocks.html#equations"><i class="fa fa-check"></i><b>17.1</b> Equations</a></li>
<li class="chapter" data-level="17.2" data-path="blocks.html"><a href="blocks.html#theorems-and-proofs"><i class="fa fa-check"></i><b>17.2</b> Theorems and proofs</a></li>
<li class="chapter" data-level="17.3" data-path="blocks.html"><a href="blocks.html#callout-blocks"><i class="fa fa-check"></i><b>17.3</b> Callout blocks</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="sharing-your-book.html"><a href="sharing-your-book.html"><i class="fa fa-check"></i><b>18</b> Sharing your book</a>
<ul>
<li class="chapter" data-level="18.1" data-path="sharing-your-book.html"><a href="sharing-your-book.html#publishing"><i class="fa fa-check"></i><b>18.1</b> Publishing</a></li>
<li class="chapter" data-level="18.2" data-path="sharing-your-book.html"><a href="sharing-your-book.html#pages"><i class="fa fa-check"></i><b>18.2</b> 404 pages</a></li>
<li class="chapter" data-level="18.3" data-path="sharing-your-book.html"><a href="sharing-your-book.html#metadata-for-sharing"><i class="fa fa-check"></i><b>18.3</b> Metadata for sharing</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Manipulation de données avec <strong>R</strong></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="manipulation-de-bases-de-données" class="section level1" number="7">
<h1><span class="header-section-number">Chapitre 7</span> Manipulation de bases de données</h1>
<div id="jointure-et-agrégation" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Jointure et agrégation</h2>
<p>On considère une table <strong>patient</strong> qui contient des informations sur les patients et une table <strong>visite</strong> qui contient des informations sur les visites. La clé de référence est le nom du patient dont la variable ne porte pas le même nom dans les deux tables.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="manipulation-de-bases-de-données.html#cb191-1" aria-hidden="true" tabindex="-1"></a>patient <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb191-2"><a href="manipulation-de-bases-de-données.html#cb191-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">nom.famille =</span> <span class="fu">c</span>(<span class="st">&quot;René&quot;</span>, <span class="st">&quot;Jean&quot;</span>, <span class="st">&quot;Ginette&quot;</span>, <span class="st">&quot;Joseph&quot;</span>),</span>
<span id="cb191-3"><a href="manipulation-de-bases-de-données.html#cb191-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">ddn =</span> <span class="fu">c</span>(<span class="st">&quot;02/02/1925&quot;</span>, <span class="st">&quot;03/03/1952&quot;</span>, <span class="st">&quot;01/10/1992&quot;</span>, <span class="st">&quot;02/02/1920&quot;</span>),</span>
<span id="cb191-4"><a href="manipulation-de-bases-de-données.html#cb191-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">sexe =</span> <span class="fu">c</span>(<span class="st">&quot;m&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;m&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="manipulation-de-bases-de-données.html#cb192-1" aria-hidden="true" tabindex="-1"></a>visite <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb192-2"><a href="manipulation-de-bases-de-données.html#cb192-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">nom =</span> <span class="fu">c</span>(<span class="st">&quot;René&quot;</span>, <span class="st">&quot;Jean&quot;</span>, <span class="st">&quot;René&quot;</span>, <span class="st">&quot;Simone&quot;</span>, <span class="st">&quot;Ginette&quot;</span>),</span>
<span id="cb192-3"><a href="manipulation-de-bases-de-données.html#cb192-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">ddv =</span> <span class="fu">c</span>(<span class="st">&quot;01/01/2020&quot;</span>, <span class="st">&quot;10/12/2020&quot;</span>, <span class="st">&quot;05/01/2020&quot;</span>, <span class="st">&quot;04/12/2020&quot;</span>, <span class="st">&quot;05/10/2020&quot;</span>))</span></code></pre></div>
<p><strong>Problématique :</strong> on souhaite avoir une table contenant l’âge du patient au moment de sa visite. Pour cela, on voit bien qu’il faut connaître la date de naissance du patient au moment de sa visite. L’idée est donc d’ajouter une colonne “ddn” à la table visite pour pouvoir ensuite calculer l’âge en faisant la différence entre la date de visite et la date naissance.</p>
<div id="jointure-sans-utiliser-la-fonction-merge" class="section level3" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> Jointure sans utiliser la fonction <em>merge()</em></h3>
<p>Dans un premier temps, nous allons essayer de répondre au problème sans utiliser la fonction <em>merge()</em>. Pour cela, nous allons utiliser la fonction <em>match()</em> vue précédemment. Elle va nous permettre de savoir où se trouvent dans la table <strong>patient</strong>, les patients qui ont eu des visites. Une fois les indices connus, on a plus qu’à sélectionner les dates de naissance des patients.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="manipulation-de-bases-de-données.html#cb193-1" aria-hidden="true" tabindex="-1"></a>visite<span class="sc">$</span>ddn <span class="ot">&lt;-</span> patient<span class="sc">$</span>ddn[<span class="fu">match</span>(visite<span class="sc">$</span>nom, patient<span class="sc">$</span>nom.famille)]</span></code></pre></div>
<p>Ensuite, on calcule l’âge du patient :</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="manipulation-de-bases-de-données.html#cb194-1" aria-hidden="true" tabindex="-1"></a>visite<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(<span class="fu">as.Date</span>(visite<span class="sc">$</span>ddv, <span class="at">format =</span> <span class="st">&quot;%d/%m/%Y&quot;</span>) <span class="sc">-</span> </span>
<span id="cb194-2"><a href="manipulation-de-bases-de-données.html#cb194-2" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">as.Date</span>(visite<span class="sc">$</span>ddn, <span class="at">format =</span> <span class="st">&quot;%d/%m/%Y&quot;</span>))<span class="sc">/</span><span class="dv">365</span>,</span>
<span id="cb194-3"><a href="manipulation-de-bases-de-données.html#cb194-3" aria-hidden="true" tabindex="-1"></a>                    <span class="dv">0</span>)</span></code></pre></div>
<p>Enfin, on efface la date de naissance qui ne nous intéresse pas ici :</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="manipulation-de-bases-de-données.html#cb195-1" aria-hidden="true" tabindex="-1"></a>visite<span class="sc">$</span>ddn <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb195-2"><a href="manipulation-de-bases-de-données.html#cb195-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(visite)</span></code></pre></div>
<pre><code>##       nom        ddv age
## 1    René 01/01/2020  95
## 2    Jean 10/12/2020  69
## 3    René 05/01/2020  95
## 4  Simone 04/12/2020  NA
## 5 Ginette 05/10/2020  28</code></pre>
<p>Pour la suite, on remet à jour la table <strong>visite</strong> :</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="manipulation-de-bases-de-données.html#cb197-1" aria-hidden="true" tabindex="-1"></a>visite<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
</div>
<div id="jointure-en-utilisant-la-fonction-merge" class="section level3" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> Jointure en utilisant la fonction <em>merge()</em></h3>
<p>A présent, nous allons utiliser la fonction <em>merge()</em> qui permet de réaliser la jointure entre deux tables. Il est essentiel de préciser la clé de référence des deux tables avec l’option <strong>by=</strong> si les deux tables ont un nom de clé identique ou alors <strong>by.x=</strong> et <strong>by.y=</strong> si la clé de référence porte un nom différent selon la table.</p>
<p>Dans la première commande, le merge se fait sur les variables qui sont présentes dans les deux tables. Autrement dit, l’individu “Simone” n’est pas présente dans la nouvelle table compte tenu qu’elle n’est pas identifiée parmi les patients.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="manipulation-de-bases-de-données.html#cb198-1" aria-hidden="true" tabindex="-1"></a>visite<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb198-2"><a href="manipulation-de-bases-de-données.html#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(visite, patient, <span class="at">by.x =</span> <span class="st">&quot;nom&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;nom.famille&quot;</span>)</span></code></pre></div>
<pre><code>##       nom        ddv        ddn sexe
## 1 Ginette 05/10/2020 01/10/1992    f
## 2    Jean 10/12/2020 03/03/1952    m
## 3    René 01/01/2020 02/02/1925    m
## 4    René 05/01/2020 02/02/1925    m</code></pre>
<p>Si on souhaite garder toute l’information contenue dans le fichier visite, on ajoute l’option <strong>all.x=TRUE</strong>. Autrement dit, on affiche ici toutes les visites, y compris celles des personnes qui ne sont bas dans la table <strong>patient</strong>. On remarquera que Simone apparaît en queue de table :</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="manipulation-de-bases-de-données.html#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(visite, patient, <span class="at">by.x =</span> <span class="st">&quot;nom&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;nom.famille&quot;</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##       nom        ddv        ddn sexe
## 1 Ginette 05/10/2020 01/10/1992    f
## 2    Jean 10/12/2020 03/03/1952    m
## 3    René 01/01/2020 02/02/1925    m
## 4    René 05/01/2020 02/02/1925    m
## 5  Simone 04/12/2020       &lt;NA&gt; &lt;NA&gt;</code></pre>
<p>Enfin, si on souhaite conserver l’information dans les deux tables, on utilise <strong>all.x=TRUE</strong> et <strong>all.y=TRUE</strong> :</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="manipulation-de-bases-de-données.html#cb202-1" aria-hidden="true" tabindex="-1"></a>(visite.patient <span class="ot">&lt;-</span> <span class="fu">merge</span>(visite, patient, <span class="at">by.x =</span> <span class="st">&quot;nom&quot;</span>,</span>
<span id="cb202-2"><a href="manipulation-de-bases-de-données.html#cb202-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">by.y =</span> <span class="st">&quot;nom.famille&quot;</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>, <span class="at">all.y =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>##       nom        ddv        ddn sexe
## 1 Ginette 05/10/2020 01/10/1992    f
## 2    Jean 10/12/2020 03/03/1952    m
## 3  Joseph       &lt;NA&gt; 02/02/1920    m
## 4    René 01/01/2020 02/02/1925    m
## 5    René 05/01/2020 02/02/1925    m
## 6  Simone 04/12/2020       &lt;NA&gt; &lt;NA&gt;</code></pre>
<p>Pour calculer l’âge du patient au moment de la visite, on utilise la commande vue précédemment :</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="manipulation-de-bases-de-données.html#cb204-1" aria-hidden="true" tabindex="-1"></a>visite.patient<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(<span class="fu">as.Date</span>(visite.patient<span class="sc">$</span>ddv, </span>
<span id="cb204-2"><a href="manipulation-de-bases-de-données.html#cb204-2" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">format =</span> <span class="st">&quot;%d/%m/%Y&quot;</span>) <span class="sc">-</span> </span>
<span id="cb204-3"><a href="manipulation-de-bases-de-données.html#cb204-3" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">as.Date</span>(visite.patient<span class="sc">$</span>ddn, </span>
<span id="cb204-4"><a href="manipulation-de-bases-de-données.html#cb204-4" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">format =</span> <span class="st">&quot;%d/%m/%Y&quot;</span>))<span class="sc">/</span><span class="dv">365</span>, </span>
<span id="cb204-5"><a href="manipulation-de-bases-de-données.html#cb204-5" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">0</span>)</span></code></pre></div>
<p>Maintenant, on souhaite connaître l’âge des patients lors de leurs visites en fonction du sexe. On va donc faire une aggrégation.</p>
</div>
<div id="aggrégation" class="section level3" number="7.1.3">
<h3><span class="header-section-number">7.1.3</span> Aggrégation</h3>
<p>Pour faire l’agrégation, on utilise la fonction <em>tapply()</em> pour aggréger une variable ou <em>aggregate()</em> pour plusieurs variables. Le principe de ces finctions est le suivant :</p>
<ul>
<li><ol style="list-style-type: decimal">
<li>utiliser <em>split()</em> sur l’échantillon total pour découper en sous-échantillons selon la variable utilisée pour faire l’aggrégation:</li>
</ol></li>
</ul>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="manipulation-de-bases-de-données.html#cb205-1" aria-hidden="true" tabindex="-1"></a>my_split <span class="ot">&lt;-</span> <span class="fu">split</span>(<span class="at">x =</span> visite.patient<span class="sc">$</span>age, <span class="at">f =</span> visite.patient<span class="sc">$</span>sexe)</span></code></pre></div>
<ul>
<li><ol start="2" style="list-style-type: decimal">
<li>utiliser <em>lapply()</em> ou <em>sapply()</em> pour calculer des statistiques sur chaque sous-échantillon</li>
</ol></li>
</ul>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="manipulation-de-bases-de-données.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(my_split, <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> T)</span></code></pre></div>
<pre><code>##        f        m 
## 28.00000 86.33333</code></pre>
<p>En utilisant la fonction <em>tapply()</em>, les deux étapes précédentes sont réalisées à la suite :</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="manipulation-de-bases-de-données.html#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(<span class="at">X =</span> visite.patient<span class="sc">$</span>age, <span class="at">INDEX =</span> <span class="fu">list</span>(<span class="at">sexe =</span> visite.patient<span class="sc">$</span>sexe),</span>
<span id="cb208-2"><a href="manipulation-de-bases-de-données.html#cb208-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> T)</span></code></pre></div>
<pre><code>## sexe
##        f        m 
## 28.00000 86.33333</code></pre>
<p>Si on utilise la fonction <em>aggregate()</em>, la variable qui permet d’aggréger doit être mise sous forme d’une liste dans l’option <strong>by=</strong>. L’option <strong>FUN=</strong> renseigne s’il s’agit de faire une somme, une moyenne, etc. Dans notre cas :</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="manipulation-de-bases-de-données.html#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(visite.patient<span class="sc">$</span>age, <span class="at">by =</span> <span class="fu">list</span>(<span class="at">S =</span> visite.patient<span class="sc">$</span>sexe),</span>
<span id="cb210-2"><a href="manipulation-de-bases-de-données.html#cb210-2" aria-hidden="true" tabindex="-1"></a> <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) </span></code></pre></div>
<pre><code>##   S        x
## 1 f 28.00000
## 2 m 86.33333</code></pre>
<p><strong>Exercice 1.8.</strong></p>
<p><strong>Q1</strong> à partir du jeu de données <strong>iris</strong> (disponible par défaut dans l’environnement courant), construire l’objet <strong>iris1</strong> qui contient en fonction des espèces (variable <strong>Species</strong>), la taille moyenne de la variable <strong>Petal.Length</strong>.</p>
<p><strong>Q2</strong> Construire l’objet <strong>iris2</strong> qui contient en fonction des espèces,
la taille totale de la variable <strong>Petal.Width</strong>.</p>
<p><strong>Q3</strong> Faire le merge des jeux de données <strong>iris1</strong> et <strong>iris2</strong>.</p>
</div>
</div>
<div id="package-dplyr" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Package <strong>dplyr</strong></h2>
<p>Ce document est inspiré d’une présentation de Sophie Lamarre aux rencontres des Ingénieurs statisticiens de Toulouse, disponible
sur ce <a href="http://www.thibault.laurent.free.fr/presentation%20inge_stat/presentation%2006-10-15/dplyr_Inge_stats_SL_02102015.pdf">lien</a>. On recommande aussi la lecture de la vignette du package, disponible sur le site du CRAN :
<a href="https://cran.r-project.org/web/packages/dplyr/vignettes/dplyr.html" class="uri">https://cran.r-project.org/web/packages/dplyr/vignettes/dplyr.html</a></p>
<p>Ce package est de plus en plus utilisé dans la manipulation de jeu de données, notamment parmi les “Data Scientists.” Son principe est de simplifier la syntaxe des fonctions de base de <strong>R</strong> et d’utiliser du code <strong>C++</strong> derrière certaines de ses fonctions dans le but d’améliorer sensiblement les temps de calcul. Il fait partie du projet <a href="https://www.tidyverse.org/">Tidyverse</a> qui contient un ensemble de packages, développés en grande partie par <strong>RStudio</strong>. Avec la commande suivante, vous chargez un ensemble de packages dont certains très populaires (<strong>ggplot2</strong>, <strong>dplyr</strong>, etc.)</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="manipulation-de-bases-de-données.html#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;tidyverse&quot;</span>)</span></code></pre></div>
<pre><code>## Le chargement a nécessité le package : tidyverse</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.3     ✓ purrr   0.3.4
## ✓ tibble  3.1.2     ✓ dplyr   1.0.6
## ✓ tidyr   1.1.3     ✓ forcats 0.5.1
## ✓ readr   1.4.0</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::collapse() masks glue::collapse()
## x dplyr::filter()   masks stats::filter()
## x dplyr::lag()      masks stats::lag()</code></pre>
<p>Description du jeu de données utilisées : il s’agit du jeu de données <strong>diamonds</strong> du package <strong>ggplot2</strong>. On observe sur un peu plus de 50000 diamants, un certain nombre de variables dont : le prix de vente, le poids, la qualité, la couleur, etc.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="manipulation-de-bases-de-données.html#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(diamonds)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 10
##   carat cut       color clarity depth table price     x     y     z
##   &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  0.23 Ideal     E     SI2      61.5    55   326  3.95  3.98  2.43
## 2  0.21 Premium   E     SI1      59.8    61   326  3.89  3.84  2.31
## 3  0.23 Good      E     VS1      56.9    65   327  4.05  4.07  2.31
## 4  0.29 Premium   I     VS2      62.4    58   334  4.2   4.23  2.63
## 5  0.31 Good      J     SI2      63.3    58   335  4.34  4.35  2.75
## 6  0.24 Very Good J     VVS2     62.8    57   336  3.94  3.96  2.48</code></pre>
<p>Voici le résumé statistique des variables :</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="manipulation-de-bases-de-données.html#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(diamonds)</span></code></pre></div>
<pre><code>##      carat               cut        color        clarity          depth      
##  Min.   :0.2000   Fair     : 1610   D: 6775   SI1    :13065   Min.   :43.00  
##  1st Qu.:0.4000   Good     : 4906   E: 9797   VS2    :12258   1st Qu.:61.00  
##  Median :0.7000   Very Good:12082   F: 9542   SI2    : 9194   Median :61.80  
##  Mean   :0.7979   Premium  :13791   G:11292   VS1    : 8171   Mean   :61.75  
##  3rd Qu.:1.0400   Ideal    :21551   H: 8304   VVS2   : 5066   3rd Qu.:62.50  
##  Max.   :5.0100                     I: 5422   VVS1   : 3655   Max.   :79.00  
##                                     J: 2808   (Other): 2531                  
##      table           price             x                y         
##  Min.   :43.00   Min.   :  326   Min.   : 0.000   Min.   : 0.000  
##  1st Qu.:56.00   1st Qu.:  950   1st Qu.: 4.710   1st Qu.: 4.720  
##  Median :57.00   Median : 2401   Median : 5.700   Median : 5.710  
##  Mean   :57.46   Mean   : 3933   Mean   : 5.731   Mean   : 5.735  
##  3rd Qu.:59.00   3rd Qu.: 5324   3rd Qu.: 6.540   3rd Qu.: 6.540  
##  Max.   :95.00   Max.   :18823   Max.   :10.740   Max.   :58.900  
##                                                                   
##        z         
##  Min.   : 0.000  
##  1st Qu.: 2.910  
##  Median : 3.530  
##  Mean   : 3.539  
##  3rd Qu.: 4.040  
##  Max.   :31.800  
## </code></pre>
<p><strong>Remarque :</strong> le jeu de données <strong>diamonds</strong> est dans un format de données nouveau : <strong>tibble</strong>. Il s’agit encore une fois d’une nouveauté proposée par <strong>RStudio</strong>. L’objet de classe <strong>data.frame</strong> peut présenter certaines contraintes pour ses utilisateurs. Par exemple, lorsque’on souhaite afficher un <strong>data.frame</strong> dans la console, <strong>R</strong> affiche autant de lignes qu’il le peut. D’autre part, avec un <strong>data.frame</strong>, certains noms de variables ne sont pas autorisés. Par exemple, dans un <strong>data.frame</strong> un nom de variable ne peut pas commencer par un chiffre ce qui n’est pas le cas avec le <strong>tibble</strong> :</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="manipulation-de-bases-de-données.html#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="st">`</span><span class="at">1a</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb221-2"><a href="manipulation-de-bases-de-données.html#cb221-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="st">`</span><span class="at">1a</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div>
<p>C’est pourquoi des développeurs ont pensé à créer un nouveau type d’objets, le <strong>tibble</strong> qui ne présenterait pas ce genre de contraintes. Ce n’est pas une grande révolution, mais ce package faisant partie du projet <strong>tidyverse</strong>, c’est essentiellement ce type de données qui est utilisé dans cet univers. Les fonctions que nous allons présenter dans cette section s’appliquent aussi bien sur des <strong>data.frame</strong> que sur des <strong>tibble</strong>, ce dernier type d’objet ayant hérité des propriétés des <strong>data.frame</strong>. Pour en savoir plus sur les <strong>tibbles</strong>, vous pouvez consulter ce cours en ligne : <a href="http://r4ds.had.co.nz/tibbles.html" class="uri">http://r4ds.had.co.nz/tibbles.html</a>.</p>
<div id="sélection-de-lignes-avec-la-fonction-filter" class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Sélection de lignes avec la fonction <em>filter()</em></h3>
<p>La fonction “phare” du package <strong>dplyr</strong> est la fonction <em>filter()</em> qui permet de sélectionner un sous-échantillon du jeu de données à partir de critères qu’on lui donne. Par exemple, pour sélectionner uniquement les diamants d’une valeur supérieure à 15000 dollars et ayant une couleur <strong>E</strong> ou <strong>F</strong>, on écrit :</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="manipulation-de-bases-de-données.html#cb222-1" aria-hidden="true" tabindex="-1"></a>filtrage1 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(diamonds, price <span class="sc">&gt;</span> <span class="dv">15000</span> <span class="sc">&amp;</span> (color <span class="sc">==</span> <span class="st">&quot;E&quot;</span> <span class="sc">|</span> color <span class="sc">==</span> <span class="st">&quot;F&quot;</span>))</span></code></pre></div>
<p>Ou de façon équivalente (les virgules remplaçant la condition <strong>et</strong>) :</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="manipulation-de-bases-de-données.html#cb223-1" aria-hidden="true" tabindex="-1"></a>filtrage1 <span class="ot">&lt;-</span> <span class="fu">filter</span>(diamonds, price <span class="sc">&gt;</span> <span class="dv">15000</span>, (color <span class="sc">==</span> <span class="st">&quot;E&quot;</span> <span class="sc">|</span> color <span class="sc">==</span> <span class="st">&quot;F&quot;</span>))</span>
<span id="cb223-2"><a href="manipulation-de-bases-de-données.html#cb223-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(filtrage1, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 10
##   carat cut       color clarity depth table price     x     y     z
##   &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  1.54 Premium   E     VS2      62.3    58 15002  7.31  7.39  4.58
## 2  1.19 Ideal     F     VVS1     61.5    55 15005  6.82  6.84  4.2 
## 3  2.05 Very Good F     SI2      61.9    56 15017  8.13  8.18  5.05</code></pre>
<p>Une nouveauté est également l’utilisation de l’opérteur %&gt;% dit ‘pipe’ en anglais. Il se trouve après un <strong>data.frame</strong> et indique qu’on va utiliser une fonction dont le premier argument est un objet de type <strong>data.frame</strong>. Dans ce cas, ce n’est plus la peine d’indiquer le premier argument de la fonction <em>filter()</em>. Nous verrons par la suite son intérêt lorsqu’on souhaite appliquer successivement des commandes.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="manipulation-de-bases-de-données.html#cb225-1" aria-hidden="true" tabindex="-1"></a>filtrage1 <span class="ot">&lt;-</span> diamonds <span class="sc">%&gt;%</span> </span>
<span id="cb225-2"><a href="manipulation-de-bases-de-données.html#cb225-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(price <span class="sc">&gt;</span> <span class="dv">15000</span>, (color <span class="sc">==</span> <span class="st">&quot;E&quot;</span> <span class="sc">|</span> color <span class="sc">==</span> <span class="st">&quot;F&quot;</span>))</span>
<span id="cb225-3"><a href="manipulation-de-bases-de-données.html#cb225-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(filtrage1, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 10
##   carat cut       color clarity depth table price     x     y     z
##   &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  1.54 Premium   E     VS2      62.3    58 15002  7.31  7.39  4.58
## 2  1.19 Ideal     F     VVS1     61.5    55 15005  6.82  6.84  4.2 
## 3  2.05 Very Good F     SI2      61.9    56 15017  8.13  8.18  5.05</code></pre>
<p><strong>Remarque:</strong> sans utiliser le package <strong>dplyr</strong>, on aurait du faire quelque chose comme ça :</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="manipulation-de-bases-de-données.html#cb227-1" aria-hidden="true" tabindex="-1"></a>filtrage1 <span class="ot">&lt;-</span> <span class="fu">with</span>(diamonds, diamonds[price <span class="sc">&gt;</span> <span class="dv">15000</span> <span class="sc">&amp;</span> </span>
<span id="cb227-2"><a href="manipulation-de-bases-de-données.html#cb227-2" aria-hidden="true" tabindex="-1"></a>                                       (color <span class="sc">==</span> <span class="st">&quot;E&quot;</span> <span class="sc">|</span> color <span class="sc">==</span> <span class="st">&quot;F&quot;</span>), ])</span></code></pre></div>
<p>On aurait également pu utiliser la fonction de base <em>subset()</em>dont le package <strong>dplyr</strong> s’est fortement inspiré.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="manipulation-de-bases-de-données.html#cb228-1" aria-hidden="true" tabindex="-1"></a>filtrage1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(diamonds, price <span class="sc">&gt;</span> <span class="dv">15000</span> <span class="sc">&amp;</span> (color <span class="sc">==</span> <span class="st">&quot;E&quot;</span> <span class="sc">|</span> color <span class="sc">==</span> <span class="st">&quot;F&quot;</span>))</span></code></pre></div>
</div>
<div id="trier-le-jeu-de-données-avec-la-fonction-arrange" class="section level3" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Trier le jeu de données avec la fonction <em>arrange()</em></h3>
<p>On souhaite trier le jeu de données en fonction de la coupe, de la couleur et du prix (en valeur décroissante). Pour cela, on fait :</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="manipulation-de-bases-de-données.html#cb229-1" aria-hidden="true" tabindex="-1"></a>tri1 <span class="ot">&lt;-</span> <span class="fu">arrange</span>(diamonds, cut, color, <span class="fu">desc</span>(price))</span>
<span id="cb229-2"><a href="manipulation-de-bases-de-données.html#cb229-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tri1,<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 10
##   carat cut   color clarity depth table price     x     y     z
##   &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  2.02 Fair  D     SI1      65      55 16386  7.94  7.84  5.13
## 2  2.01 Fair  D     SI2      66.9    57 16086  7.87  7.76  5.23
## 3  3.4  Fair  D     I1       66.8    52 15964  9.42  9.34  6.27</code></pre>
<p>Sans le package <strong>dplyr</strong>, on aurait fait :</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="manipulation-de-bases-de-données.html#cb231-1" aria-hidden="true" tabindex="-1"></a>tri1 <span class="ot">&lt;-</span> <span class="fu">with</span>(diamonds, diamonds[<span class="fu">order</span>(cut, color, <span class="sc">-</span>price),])</span></code></pre></div>
</div>
<div id="sélectionner-certaines-variables-avec-la-fonction-select" class="section level3" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> Sélectionner certaines variables avec la fonction <em>select()</em></h3>
<p>On ne souhaite garder que les variables <strong>carat</strong>, <strong>price</strong>, <strong>color</strong>, <strong>z</strong> et les variables dont le label contient le caractères <strong>i</strong> :</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="manipulation-de-bases-de-données.html#cb232-1" aria-hidden="true" tabindex="-1"></a>selection1 <span class="ot">&lt;-</span> <span class="fu">select</span>(diamonds, carat, price, color, z, </span>
<span id="cb232-2"><a href="manipulation-de-bases-de-données.html#cb232-2" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;i&quot;</span>))</span>
<span id="cb232-3"><a href="manipulation-de-bases-de-données.html#cb232-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(selection1,<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   carat price color     z clarity
##   &lt;dbl&gt; &lt;int&gt; &lt;ord&gt; &lt;dbl&gt; &lt;ord&gt;  
## 1  0.23   326 E      2.43 SI2    
## 2  0.21   326 E      2.31 SI1    
## 3  0.23   327 E      2.31 VS1</code></pre>
<p>Sans le package <strong>dplyr</strong>, on aurait fait :</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="manipulation-de-bases-de-données.html#cb234-1" aria-hidden="true" tabindex="-1"></a>selection1 <span class="ot">&lt;-</span> diamonds[, <span class="fu">unique</span>(<span class="fu">c</span>(<span class="st">&quot;carat&quot;</span>, <span class="st">&quot;price&quot;</span>, <span class="st">&quot;color&quot;</span>, <span class="st">&quot;z&quot;</span>, </span>
<span id="cb234-2"><a href="manipulation-de-bases-de-données.html#cb234-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">names</span>(diamonds)[<span class="fu">grep</span>(<span class="st">&quot;i&quot;</span>, <span class="fu">names</span>(diamonds))]))]</span></code></pre></div>
<p><strong>Remarque :</strong> dans la deuxième syntaxe, pour que la variable <strong>price</strong> n’apparaisse qu’une seule fois dans le jeu de données, on a du utiliser la fonction <em>unique()</em>.</p>
</div>
<div id="changer-le-nom-de-variables-avec-la-fonction-rename" class="section level3" number="7.2.4">
<h3><span class="header-section-number">7.2.4</span> Changer le nom de variables avec la fonction <em>rename()</em></h3>
<p>On souhaite changer le nom de la variable <strong>z</strong> par le label <strong>width</strong> et <strong>color</strong> par <strong>code_color</strong> :</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="manipulation-de-bases-de-données.html#cb235-1" aria-hidden="true" tabindex="-1"></a>renom1 <span class="ot">&lt;-</span> <span class="fu">rename</span>(diamonds, <span class="at">width =</span> z, <span class="at">code_color =</span> color)</span>
<span id="cb235-2"><a href="manipulation-de-bases-de-données.html#cb235-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(renom1, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 10
##   carat cut     code_color clarity depth table price     x     y width
##   &lt;dbl&gt; &lt;ord&gt;   &lt;ord&gt;      &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  0.23 Ideal   E          SI2      61.5    55   326  3.95  3.98  2.43
## 2  0.21 Premium E          SI1      59.8    61   326  3.89  3.84  2.31
## 3  0.23 Good    E          VS1      56.9    65   327  4.05  4.07  2.31</code></pre>
<p>Sans le package <strong>dplyr</strong>, on aurait fait :</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="manipulation-de-bases-de-données.html#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(diamonds)[<span class="fu">c</span>(<span class="fu">match</span>(<span class="st">&quot;z&quot;</span>, <span class="fu">names</span>(diamonds)), </span>
<span id="cb237-2"><a href="manipulation-de-bases-de-données.html#cb237-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">match</span>(<span class="st">&quot;color&quot;</span>, <span class="fu">names</span>(diamonds)))] <span class="ot">&lt;-</span> </span>
<span id="cb237-3"><a href="manipulation-de-bases-de-données.html#cb237-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;width&quot;</span>, <span class="st">&quot;code_color&quot;</span>)</span></code></pre></div>
</div>
<div id="ajouter-une-nouvelle-colonne-avec-la-fonction-mutate" class="section level3" number="7.2.5">
<h3><span class="header-section-number">7.2.5</span> Ajouter une nouvelle colonne avec la fonction <em>mutate()</em></h3>
<p>On calcule le prix au kilo pour chaque diamant et on convertit en euros :</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="manipulation-de-bases-de-données.html#cb238-1" aria-hidden="true" tabindex="-1"></a>calcul1 <span class="ot">&lt;-</span> <span class="fu">mutate</span>(diamonds, <span class="at">prix.kilo =</span> price <span class="sc">/</span> carat, </span>
<span id="cb238-2"><a href="manipulation-de-bases-de-données.html#cb238-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">prix.kilo.euro =</span> prix.kilo <span class="sc">*</span> <span class="fl">0.9035</span>)</span>
<span id="cb238-3"><a href="manipulation-de-bases-de-données.html#cb238-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(calcul1, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 12
##   carat cut     code_color clarity depth table price     x     y width prix.kilo
##   &lt;dbl&gt; &lt;ord&gt;   &lt;ord&gt;      &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1  0.23 Ideal   E          SI2      61.5    55   326  3.95  3.98  2.43     1417.
## 2  0.21 Premium E          SI1      59.8    61   326  3.89  3.84  2.31     1552.
## 3  0.23 Good    E          VS1      56.9    65   327  4.05  4.07  2.31     1422.
## # … with 1 more variable: prix.kilo.euro &lt;dbl&gt;</code></pre>
<p>Sans le package <strong>dplyr</strong>, on aurait fait :</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="manipulation-de-bases-de-données.html#cb240-1" aria-hidden="true" tabindex="-1"></a>diamonds<span class="sc">$</span>prix.kilo <span class="ot">&lt;-</span> diamonds<span class="sc">$</span>price<span class="sc">/</span>diamonds<span class="sc">$</span>carat</span>
<span id="cb240-2"><a href="manipulation-de-bases-de-données.html#cb240-2" aria-hidden="true" tabindex="-1"></a>diamonds<span class="sc">$</span>prix.kilo.euro <span class="ot">&lt;-</span> diamonds<span class="sc">$</span>prix.kilo <span class="sc">*</span> <span class="fl">0.9035</span></span></code></pre></div>
</div>
<div id="faire-des-calculs-statistiques-avec-la-fonction-summarise" class="section level3" number="7.2.6">
<h3><span class="header-section-number">7.2.6</span> Faire des calculs statistiques avec la fonction <em>summarise()</em></h3>
<p>On calcule le prix moyen en fonction de la couleur et de la coupe du diamant :</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="manipulation-de-bases-de-données.html#cb241-1" aria-hidden="true" tabindex="-1"></a>calcul2 <span class="ot">&lt;-</span> <span class="fu">summarise</span>(<span class="fu">group_by</span>(diamonds, cut, code_color), <span class="at">prix.moy =</span> <span class="fu">mean</span>(price))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;cut&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="manipulation-de-bases-de-données.html#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(calcul2, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
## # Groups:   cut [1]
##   cut   code_color prix.moy
##   &lt;ord&gt; &lt;ord&gt;         &lt;dbl&gt;
## 1 Fair  D             4291.
## 2 Fair  E             3682.
## 3 Fair  F             3827.</code></pre>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="manipulation-de-bases-de-données.html#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(calcul2)</span></code></pre></div>
<pre><code>## [1] &quot;grouped_df&quot; &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<p>Sans le package <strong>dplyr</strong>, on aurait fait :</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="manipulation-de-bases-de-données.html#cb247-1" aria-hidden="true" tabindex="-1"></a>calcul2 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(<span class="fu">data.frame</span>(<span class="at">price =</span> diamonds[, <span class="st">&quot;price&quot;</span>]), </span>
<span id="cb247-2"><a href="manipulation-de-bases-de-données.html#cb247-2" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">list</span>(<span class="at">color =</span> diamonds<span class="sc">$</span>code_color, </span>
<span id="cb247-3"><a href="manipulation-de-bases-de-données.html#cb247-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">cut =</span> diamonds<span class="sc">$</span>cut), mean)</span></code></pre></div>
</div>
<div id="faire-des-calculs-statistiques-en-utilisant-une-nouvelle-syntaxe" class="section level3" number="7.2.7">
<h3><span class="header-section-number">7.2.7</span> Faire des calculs statistiques en utilisant une nouvelle syntaxe</h3>
<p>On souhaite calculer le prix maximum d’un diamant en fonction de la couleur et de la coupe. On ne veut garder que les prix supérieurs à 5000 dollars. Pour cela, on peut utiliser la syntaxe suivante, dite ``pipelining’’, qui provient du package <strong>magrittr</strong> (et importé par défaut via la package <strong>dplyr</strong>) :</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="manipulation-de-bases-de-données.html#cb248-1" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">%&gt;%</span> </span>
<span id="cb248-2"><a href="manipulation-de-bases-de-données.html#cb248-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(code_color, cut) <span class="sc">%&gt;%</span> </span>
<span id="cb248-3"><a href="manipulation-de-bases-de-données.html#cb248-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prix_groupe =</span> <span class="fu">mean</span>(price)) <span class="sc">%&gt;%</span> </span>
<span id="cb248-4"><a href="manipulation-de-bases-de-données.html#cb248-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(prix_groupe <span class="sc">&gt;</span> <span class="dv">5000</span>)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;code_color&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 7 x 3
## # Groups:   code_color [3]
##   code_color cut       prix_groupe
##   &lt;ord&gt;      &lt;ord&gt;           &lt;dbl&gt;
## 1 H          Fair            5136.
## 2 H          Premium         5217.
## 3 I          Good            5079.
## 4 I          Very Good       5256.
## 5 I          Premium         5946.
## 6 J          Very Good       5104.
## 7 J          Premium         6295.</code></pre>
<p>L’idée de cette syntaxe est de pouvoir comprendre rapidement les différentes opérations qui sont effectuées les unes à la suite des autres. Dans l’exemple précédent :</p>
<ul>
<li>on prend le jeu de données <strong>diamonds</strong>, le fait d’ajouter un ``pipe’’ à la suite implique qu’on va appliquer une première opération dessus,</li>
<li><em>group_by</em> : on regroupe des observations en fonction des variables <strong>color</strong> et <strong>cut</strong>,</li>
<li><em>summarise</em> : on calcule le prix moyen sur les groupes précédemment créés,</li>
<li><em>filter</em> : on ne garde que les observations supérieures à 5000 dollars.</li>
</ul>
<p><strong>Remarque :</strong> depuis la version <strong>4.1.0</strong>, <strong>R</strong> a lancé une version native de l’opérateur `<code>pipe''. Il s'agit de la commande suivante</code>|&gt;`. Voici un exemple d’utilisation :</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="manipulation-de-bases-de-données.html#cb251-1" aria-hidden="true" tabindex="-1"></a>my_vec <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb251-2"><a href="manipulation-de-bases-de-données.html#cb251-2" aria-hidden="true" tabindex="-1"></a>my_vec <span class="sc">|&gt;</span></span>
<span id="cb251-3"><a href="manipulation-de-bases-de-données.html#cb251-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>()</span></code></pre></div>
<pre><code>## [1] -0.4518699</code></pre>
<p>Dans la plupart des cas, il peut remplacer le pipe de <strong>magrittr</strong>.</p>
</div>
<div id="tirer-un-échantillon-dune-population" class="section level3" number="7.2.8">
<h3><span class="header-section-number">7.2.8</span> Tirer un échantillon d’une population</h3>
<p>On souhaite tirer de façon aléatoire 100 observations :</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="manipulation-de-bases-de-données.html#cb253-1" aria-hidden="true" tabindex="-1"></a>tirage1 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(diamonds, <span class="dv">100</span>)</span></code></pre></div>
<p>On souhaite tirer de façon aléatoire <span class="math inline">\(5\%\)</span> de l’échantillon :</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="manipulation-de-bases-de-données.html#cb254-1" aria-hidden="true" tabindex="-1"></a>tirage1 <span class="ot">&lt;-</span> <span class="fu">sample_frac</span>(diamonds, <span class="fl">0.05</span>)</span></code></pre></div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="opérations-ensemblistes.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tidy-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/01-data-management.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapitre 2 Manipulation de données avec R | R avancé</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapitre 2 Manipulation de données avec R | R avancé" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapitre 2 Manipulation de données avec R | R avancé" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Sébastien Déjean et Thibault Laurent" />


<meta name="date" content="2021-10-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="programmation.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.3/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>
<script src="libs/d3-4.5.0/d3.min.js"></script>
<script src="libs/chordNetwork-binding-0.4/chordNetwork.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R avancé</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#principe-du-document"><i class="fa fa-check"></i><b>1.1</b> Principe du document</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#pré-requis"><i class="fa fa-check"></i><b>1.2</b> Pré-requis</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html"><i class="fa fa-check"></i><b>2</b> Manipulation de données avec <strong>R</strong></a>
<ul>
<li class="chapter" data-level="2.1" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#les-chaînes-de-caractères"><i class="fa fa-check"></i><b>2.1</b> Les chaînes de caractères</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#fonctions-de-base"><i class="fa fa-check"></i><b>2.1.1</b> Fonctions de base</a></li>
<li class="chapter" data-level="2.1.2" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#les-expressions-régulières"><i class="fa fa-check"></i><b>2.1.2</b> Les expressions régulières</a></li>
<li class="chapter" data-level="2.1.3" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#application-aux-tweets"><i class="fa fa-check"></i><b>2.1.3</b> Application aux tweets</a></li>
<li class="chapter" data-level="2.1.4" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#nuage-de-mots"><i class="fa fa-check"></i><b>2.1.4</b> Nuage de mots</a></li>
<li class="chapter" data-level="2.1.5" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#ordonnancement"><i class="fa fa-check"></i><b>2.1.5</b> Ordonnancement</a></li>
<li class="chapter" data-level="2.1.6" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#package-stringr"><i class="fa fa-check"></i><b>2.1.6</b> Package <strong>stringr</strong></a></li>
<li class="chapter" data-level="2.1.7" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#package-glue"><i class="fa fa-check"></i><b>2.1.7</b> Package <strong>glue</strong></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#les-facteurs"><i class="fa fa-check"></i><b>2.2</b> Les facteurs</a></li>
<li class="chapter" data-level="2.3" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#les-dates"><i class="fa fa-check"></i><b>2.3</b> Les dates</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#dates-et-unités-de-temps"><i class="fa fa-check"></i><b>2.3.1</b> Dates et unités de temps</a></li>
<li class="chapter" data-level="2.3.2" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#séries-temporelles"><i class="fa fa-check"></i><b>2.3.2</b> Séries temporelles</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#opérations-ensemblistes"><i class="fa fa-check"></i><b>2.4</b> Opérations ensemblistes</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#lunion"><i class="fa fa-check"></i><b>2.4.1</b> L’union</a></li>
<li class="chapter" data-level="2.4.2" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#lintersection"><i class="fa fa-check"></i><b>2.4.2</b> L’intersection</a></li>
<li class="chapter" data-level="2.4.3" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#la-différence-a-b-différent-de-b-a"><i class="fa fa-check"></i><b>2.4.3</b> La différence (<span class="math inline">\(A-B\)</span>, différent de <span class="math inline">\(B-A\)</span>)</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#manipulation-de-bases-de-données"><i class="fa fa-check"></i><b>2.5</b> Manipulation de bases de données</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#jointure-et-agrégation"><i class="fa fa-check"></i><b>2.5.1</b> Jointure et agrégation</a></li>
<li class="chapter" data-level="2.5.2" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#package-dplyr"><i class="fa fa-check"></i><b>2.5.2</b> Package <strong>dplyr</strong></a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#tidy-data"><i class="fa fa-check"></i><b>2.6</b> Tidy data</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#la-fonction-pivot_longer-transformer-des-colonnes-en-lignes"><i class="fa fa-check"></i><b>2.6.1</b> La fonction <em>pivot_longer()</em> : transformer des colonnes en lignes</a></li>
<li class="chapter" data-level="2.6.2" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#la-fonction-pivot_wider-transformer-des-lignes-en-colonnes"><i class="fa fa-check"></i><b>2.6.2</b> La fonction <em>pivot_wider()</em> : transformer des lignes en colonnes</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#gestion-de-données-volumineuses"><i class="fa fa-check"></i><b>2.7</b> Gestion de données volumineuses</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#optimiser-la-fonction-read.table"><i class="fa fa-check"></i><b>2.7.1</b> Optimiser la fonction <em>read.table()</em></a></li>
<li class="chapter" data-level="2.7.2" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#le-package-readr"><i class="fa fa-check"></i><b>2.7.2</b> Le package <strong>readr</strong></a></li>
<li class="chapter" data-level="2.7.3" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#autres-packages"><i class="fa fa-check"></i><b>2.7.3</b> Autres packages</a></li>
<li class="chapter" data-level="2.7.4" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#algorithme-de-type-mapreducce"><i class="fa fa-check"></i><b>2.7.4</b> Algorithme de type Map/Reducce</a></li>
<li class="chapter" data-level="2.7.5" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#interaction-avec-des-systèmes-de-gestion-de-bases-de-données"><i class="fa fa-check"></i><b>2.7.5</b> Interaction avec des systèmes de gestion de bases de données</a></li>
<li class="chapter" data-level="2.7.6" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#utiliser-la-syntaxe-sql"><i class="fa fa-check"></i><b>2.7.6</b> Utiliser la syntaxe SQL</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#visualiser-et-traiter-les-données-manquantes"><i class="fa fa-check"></i><b>2.8</b> Visualiser et traiter les données manquantes</a></li>
<li class="chapter" data-level="2.9" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#répertoires-et-fichiers"><i class="fa fa-check"></i><b>2.9</b> Répertoires et fichiers</a></li>
<li class="chapter" data-level="2.10" data-path="manipulation-de-données-avec-r.html"><a href="manipulation-de-données-avec-r.html#autour-de-lespace-de-travail"><i class="fa fa-check"></i><b>2.10</b> Autour de l’espace de travail</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="programmation.html"><a href="programmation.html"><i class="fa fa-check"></i><b>3</b> Programmation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="programmation.html"><a href="programmation.html#quelques-règles-de-style"><i class="fa fa-check"></i><b>3.1</b> Quelques règles de style</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="programmation.html"><a href="programmation.html#le-nom-des-fichiers-de-codes"><i class="fa fa-check"></i><b>3.1.1</b> Le nom des fichiers de codes</a></li>
<li class="chapter" data-level="3.1.2" data-path="programmation.html"><a href="programmation.html#le-nom-des-objets"><i class="fa fa-check"></i><b>3.1.2</b> Le nom des objets</a></li>
<li class="chapter" data-level="3.1.3" data-path="programmation.html"><a href="programmation.html#espace-entre-les-opérateurs"><i class="fa fa-check"></i><b>3.1.3</b> Espace entre les opérateurs</a></li>
<li class="chapter" data-level="3.1.4" data-path="programmation.html"><a href="programmation.html#les-conditions"><i class="fa fa-check"></i><b>3.1.4</b> Les conditions</a></li>
<li class="chapter" data-level="3.1.5" data-path="programmation.html"><a href="programmation.html#la-taille-dune-ligne"><i class="fa fa-check"></i><b>3.1.5</b> La taille d’une ligne</a></li>
<li class="chapter" data-level="3.1.6" data-path="programmation.html"><a href="programmation.html#affectation"><i class="fa fa-check"></i><b>3.1.6</b> Affectation</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="programmation.html"><a href="programmation.html#fixer-la-taille-des-vecteurs-si-on-la-connaît-à-lavance"><i class="fa fa-check"></i><b>3.2</b> Fixer la taille des vecteurs (si on la connaît à l’avance)</a></li>
<li class="chapter" data-level="3.3" data-path="programmation.html"><a href="programmation.html#temps-de-calcul-et-mémoire"><i class="fa fa-check"></i><b>3.3</b> Temps de calcul et mémoire</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="programmation.html"><a href="programmation.html#pour-mesurer-les-temps-de-calcul-efficacement"><i class="fa fa-check"></i><b>3.3.1</b> Pour mesurer les temps de calcul efficacement</a></li>
<li class="chapter" data-level="3.3.2" data-path="programmation.html"><a href="programmation.html#pour-comprendre-la-gestion-de-la-mémoire"><i class="fa fa-check"></i><b>3.3.2</b> Pour comprendre la gestion de la mémoire</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="programmation.html"><a href="programmation.html#fonction-vectorisée"><i class="fa fa-check"></i><b>3.4</b> Fonction vectorisée</a></li>
<li class="chapter" data-level="3.5" data-path="programmation.html"><a href="programmation.html#ecrire-un-code-en-c"><i class="fa fa-check"></i><b>3.5</b> Ecrire un code en C++</a></li>
<li class="chapter" data-level="3.6" data-path="programmation.html"><a href="programmation.html#insérer-du-code-python-dans-un-document-markdown"><i class="fa fa-check"></i><b>3.6</b> Insérer du code Python dans un document Markdown</a></li>
<li class="chapter" data-level="3.7" data-path="programmation.html"><a href="programmation.html#eviter-si-possible-les-boucles-apply-lapply-replicate-colsums-etc."><i class="fa fa-check"></i><b>3.7</b> Eviter si possible les boucles (<em>apply()</em>, <em>lapply()</em>, <em>replicate()</em>, <em>colSums()</em>, etc.)</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="programmation.html"><a href="programmation.html#apply-pour-les-matrixarray"><i class="fa fa-check"></i><b>3.7.1</b> <em>apply()</em> pour les <strong>matrix/array</strong></a></li>
<li class="chapter" data-level="3.7.2" data-path="programmation.html"><a href="programmation.html#les-fonctions-colsums-rowsums-colmeans-rowmeans"><i class="fa fa-check"></i><b>3.7.2</b> Les fonctions <em>colSums()</em>, <em>rowSums()</em>, <em>colMeans()</em>, <em>rowMeans()</em></a></li>
<li class="chapter" data-level="3.7.3" data-path="programmation.html"><a href="programmation.html#la-fonction-lapply"><i class="fa fa-check"></i><b>3.7.3</b> La fonction <em>lapply()</em></a></li>
<li class="chapter" data-level="3.7.4" data-path="programmation.html"><a href="programmation.html#la-fonction-sapply"><i class="fa fa-check"></i><b>3.7.4</b> La fonction <em>sapply()</em></a></li>
<li class="chapter" data-level="3.7.5" data-path="programmation.html"><a href="programmation.html#la-fonction-replicate"><i class="fa fa-check"></i><b>3.7.5</b> La fonction <em>replicate()</em></a></li>
<li class="chapter" data-level="3.7.6" data-path="programmation.html"><a href="programmation.html#la-fonction-mapply"><i class="fa fa-check"></i><b>3.7.6</b> La fonction <em>mapply()</em></a></li>
<li class="chapter" data-level="3.7.7" data-path="programmation.html"><a href="programmation.html#la-fonction-tapply"><i class="fa fa-check"></i><b>3.7.7</b> La fonction <em>tapply()</em></a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="programmation.html"><a href="programmation.html#améliorer-ses-fonctions"><i class="fa fa-check"></i><b>3.8</b> Améliorer ses fonctions</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="programmation.html"><a href="programmation.html#créer-des-sous-fonctions"><i class="fa fa-check"></i><b>3.8.1</b> Créer des sous-fonctions</a></li>
<li class="chapter" data-level="3.8.2" data-path="programmation.html"><a href="programmation.html#structure-de-contrôle"><i class="fa fa-check"></i><b>3.8.2</b> Structure de contrôle</a></li>
<li class="chapter" data-level="3.8.3" data-path="programmation.html"><a href="programmation.html#fonction-stopifnot"><i class="fa fa-check"></i><b>3.8.3</b> Fonction <em>stopifnot()</em></a></li>
<li class="chapter" data-level="3.8.4" data-path="programmation.html"><a href="programmation.html#les-arguments-dans-une-fonction"><i class="fa fa-check"></i><b>3.8.4</b> Les arguments dans une fonction</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="programmation.html"><a href="programmation.html#a-quoi-servent-les-fonctions-substitutequote-et-eval"><i class="fa fa-check"></i><b>3.9</b> A quoi servent les fonctions <em>substitute()/quote()</em> et <em>eval()</em> ?</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="programmation.html"><a href="programmation.html#les-fonctions-quote-et-substitute"><i class="fa fa-check"></i><b>3.9.1</b> Les fonctions <em>quote()</em> et <em>substitute()</em></a></li>
<li class="chapter" data-level="3.9.2" data-path="programmation.html"><a href="programmation.html#la-fonction-eval"><i class="fa fa-check"></i><b>3.9.2</b> La fonction <em>eval()</em></a></li>
<li class="chapter" data-level="3.9.3" data-path="programmation.html"><a href="programmation.html#débugger-une-fonction"><i class="fa fa-check"></i><b>3.9.3</b> Débugger une fonction</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="programmation.html"><a href="programmation.html#programmation-orientée-s3s4"><i class="fa fa-check"></i><b>3.10</b> Programmation orientée : S3/S4</a>
<ul>
<li class="chapter" data-level="3.10.1" data-path="programmation.html"><a href="programmation.html#la-norme-s3"><i class="fa fa-check"></i><b>3.10.1</b> La norme S3</a></li>
<li class="chapter" data-level="3.10.2" data-path="programmation.html"><a href="programmation.html#la-norme-s4"><i class="fa fa-check"></i><b>3.10.2</b> La norme S4</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="programmation.html"><a href="programmation.html#visualiser-le-code-source-dune-fonction"><i class="fa fa-check"></i><b>3.11</b> Visualiser le code source d’une fonction</a>
<ul>
<li class="chapter" data-level="3.11.1" data-path="programmation.html"><a href="programmation.html#la-fonction-est-dans-lenvironnement-courant"><i class="fa fa-check"></i><b>3.11.1</b> La fonction est dans l’environnement courant</a></li>
<li class="chapter" data-level="3.11.2" data-path="programmation.html"><a href="programmation.html#la-fonction-est-une-méthode-générique-de-type-s3"><i class="fa fa-check"></i><b>3.11.2</b> La fonction est une méthode générique de type S3</a></li>
<li class="chapter" data-level="3.11.3" data-path="programmation.html"><a href="programmation.html#la-fonction-fait-appel-à-du-code-c"><i class="fa fa-check"></i><b>3.11.3</b> La fonction fait appel à du code <strong>C</strong></a></li>
<li class="chapter" data-level="3.11.4" data-path="programmation.html"><a href="programmation.html#la-fonction-est-une-méthode-générique-de-type-s4"><i class="fa fa-check"></i><b>3.11.4</b> La fonction est une méthode générique de type S4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html"><i class="fa fa-check"></i><b>4</b> Calcul parallèle</a>
<ul>
<li class="chapter" data-level="4.1" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#principe-du-calcul-parallèle"><i class="fa fa-check"></i><b>4.1</b> Principe du calcul parallèle</a></li>
<li class="chapter" data-level="4.2" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#notion-de-programme-maître"><i class="fa fa-check"></i><b>4.2</b> Notion de programme maître</a></li>
<li class="chapter" data-level="4.3" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#fonction-set.seed"><i class="fa fa-check"></i><b>4.3</b> Fonction <em>set.seed()</em></a></li>
<li class="chapter" data-level="4.4" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#syntaxe-pour-lancer-un-calcul-parallèle"><i class="fa fa-check"></i><b>4.4</b> Syntaxe pour lancer un calcul parallèle</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#syntaxe-dans-le-cas-non-parallèle"><i class="fa fa-check"></i><b>4.4.1</b> Syntaxe dans le cas non parallèle</a></li>
<li class="chapter" data-level="4.4.2" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#syntaxe-dans-le-cas-parallèle"><i class="fa fa-check"></i><b>4.4.2</b> Syntaxe dans le cas parallèle</a></li>
<li class="chapter" data-level="4.4.3" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#recommandations"><i class="fa fa-check"></i><b>4.4.3</b> Recommandations</a></li>
<li class="chapter" data-level="4.4.4" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#récupérer-les-résultats"><i class="fa fa-check"></i><b>4.4.4</b> Récupérer les résultats</a></li>
<li class="chapter" data-level="4.4.5" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#utiliser-des-packages-objets-jeux-de-données-sur-les-différents-coeurs"><i class="fa fa-check"></i><b>4.4.5</b> Utiliser des packages, objets, jeux de données sur les différents coeurs</a></li>
<li class="chapter" data-level="4.4.6" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#fonctions-lapply-sapply-apply-mapply"><i class="fa fa-check"></i><b>4.4.6</b> Fonctions <em>lapply()</em>, <em>sapply()</em>, <em>apply()</em>, <em>mapply()</em></a></li>
<li class="chapter" data-level="4.4.7" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#autres-packages-de-calcul-parallèle"><i class="fa fa-check"></i><b>4.4.7</b> Autres packages de calcul parallèle</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#equilibrer-la-répartition-des-tâches"><i class="fa fa-check"></i><b>4.5</b> Equilibrer la répartition des tâches</a></li>
<li class="chapter" data-level="4.6" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#améliorer-la-répartition-des-tâches"><i class="fa fa-check"></i><b>4.6</b> Améliorer la répartition des tâches</a></li>
<li class="chapter" data-level="4.7" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#fonction-vectorisée-vs-calcul-vs-code-c"><i class="fa fa-check"></i><b>4.7</b> Fonction vectorisée VS calcul // VS code <strong>C++</strong></a></li>
<li class="chapter" data-level="4.8" data-path="calcul-parallèle.html"><a href="calcul-parallèle.html#reproductibilité-des-résultats-choix-de-la-graine-aléatoire"><i class="fa fa-check"></i><b>4.8</b> Reproductibilité des résultats : choix de la graine aléatoire</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html"><i class="fa fa-check"></i><b>5</b> Visualisation de données</a>
<ul>
<li class="chapter" data-level="5.1" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#fonctions-graphiques-de-base-vs-ggplot2"><i class="fa fa-check"></i><b>5.1</b> Fonctions graphiques de base VS <strong>ggplot2</strong></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#graphiques-standards"><i class="fa fa-check"></i><b>5.1.1</b> Graphiques standards</a></li>
<li class="chapter" data-level="5.1.2" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#graphiques-conditionnels"><i class="fa fa-check"></i><b>5.1.2</b> Graphiques conditionnels</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#présentation-de-graphiques-originaux"><i class="fa fa-check"></i><b>5.2</b> Présentation de graphiques originaux</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#mélange-boîte-à-moustachediagramme-de-dispersion"><i class="fa fa-check"></i><b>5.2.1</b> Mélange boîte à moustache/diagramme de dispersion</a></li>
<li class="chapter" data-level="5.2.2" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#violin-plot"><i class="fa fa-check"></i><b>5.2.2</b> Violin plot</a></li>
<li class="chapter" data-level="5.2.3" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#ridgeline-plots"><i class="fa fa-check"></i><b>5.2.3</b> Ridgeline plots</a></li>
<li class="chapter" data-level="5.2.4" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#barres-derreurs"><i class="fa fa-check"></i><b>5.2.4</b> Barres d’erreurs</a></li>
<li class="chapter" data-level="5.2.5" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#cleveland-dot-chart"><i class="fa fa-check"></i><b>5.2.5</b> Cleveland dot chart</a></li>
<li class="chapter" data-level="5.2.6" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#area-chart"><i class="fa fa-check"></i><b>5.2.6</b> Area chart</a></li>
<li class="chapter" data-level="5.2.7" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#correlation-plot"><i class="fa fa-check"></i><b>5.2.7</b> Correlation plot</a></li>
<li class="chapter" data-level="5.2.8" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#représenter-les-effets-des-variables-explicatives"><i class="fa fa-check"></i><b>5.2.8</b> Représenter les effets des variables explicatives</a></li>
<li class="chapter" data-level="5.2.9" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#mosaic-plot"><i class="fa fa-check"></i><b>5.2.9</b> Mosaic plot</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#présenter-des-tableaux-de-résultats"><i class="fa fa-check"></i><b>5.3</b> Présenter des tableaux de résultats</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#la-fonction-kable"><i class="fa fa-check"></i><b>5.3.1</b> La fonction <span class="math inline">\(kable()\)</span></a></li>
<li class="chapter" data-level="5.3.2" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#la-fonction-stargazer"><i class="fa fa-check"></i><b>5.3.2</b> La fonction <span class="math inline">\(stargazer()\)</span></a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#graphiques-interactifs"><i class="fa fa-check"></i><b>5.4</b> Graphiques interactifs</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#via-plotly"><i class="fa fa-check"></i><b>5.4.1</b> Via <strong>plotly</strong></a></li>
<li class="chapter" data-level="5.4.2" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#via-d3"><i class="fa fa-check"></i><b>5.4.2</b> Via <strong>D3</strong></a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#mini-introduction-à-shiny"><i class="fa fa-check"></i><b>5.5</b> Mini-introduction à <strong>shiny</strong></a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#un-premier-exemple"><i class="fa fa-check"></i><b>5.5.1</b> Un premier exemple</a></li>
<li class="chapter" data-level="5.5.2" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#quelques-fonctionnalités-de-shiny"><i class="fa fa-check"></i><b>5.5.2</b> Quelques fonctionnalités de <strong>shiny</strong></a></li>
<li class="chapter" data-level="5.5.3" data-path="visualisation-de-données.html"><a href="visualisation-de-données.html#publier-ses-applications"><i class="fa fa-check"></i><b>5.5.3</b> Publier ses applications</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="hello-bookdown.html"><a href="hello-bookdown.html"><i class="fa fa-check"></i><b>6</b> Hello bookdown</a>
<ul>
<li class="chapter" data-level="6.1" data-path="hello-bookdown.html"><a href="hello-bookdown.html#a-section"><i class="fa fa-check"></i><b>6.1</b> A section</a>
<ul>
<li class="chapter" data-level="" data-path="hello-bookdown.html"><a href="hello-bookdown.html#an-unnumbered-section"><i class="fa fa-check"></i>An unnumbered section</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="cross.html"><a href="cross.html"><i class="fa fa-check"></i><b>7</b> Cross-references</a>
<ul>
<li class="chapter" data-level="7.1" data-path="cross.html"><a href="cross.html#chapters-and-sub-chapters"><i class="fa fa-check"></i><b>7.1</b> Chapters and sub-chapters</a></li>
<li class="chapter" data-level="7.2" data-path="cross.html"><a href="cross.html#captioned-figures-and-tables"><i class="fa fa-check"></i><b>7.2</b> Captioned figures and tables</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="parts.html"><a href="parts.html"><i class="fa fa-check"></i><b>8</b> Parts</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="9" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html"><i class="fa fa-check"></i><b>9</b> Footnotes and citations</a>
<ul>
<li class="chapter" data-level="9.1" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html#footnotes"><i class="fa fa-check"></i><b>9.1</b> Footnotes</a></li>
<li class="chapter" data-level="9.2" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html#citations"><i class="fa fa-check"></i><b>9.2</b> Citations</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="blocks.html"><a href="blocks.html"><i class="fa fa-check"></i><b>10</b> Blocks</a>
<ul>
<li class="chapter" data-level="10.1" data-path="blocks.html"><a href="blocks.html#equations"><i class="fa fa-check"></i><b>10.1</b> Equations</a></li>
<li class="chapter" data-level="10.2" data-path="blocks.html"><a href="blocks.html#theorems-and-proofs"><i class="fa fa-check"></i><b>10.2</b> Theorems and proofs</a></li>
<li class="chapter" data-level="10.3" data-path="blocks.html"><a href="blocks.html#callout-blocks"><i class="fa fa-check"></i><b>10.3</b> Callout blocks</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="sharing-your-book.html"><a href="sharing-your-book.html"><i class="fa fa-check"></i><b>11</b> Sharing your book</a>
<ul>
<li class="chapter" data-level="11.1" data-path="sharing-your-book.html"><a href="sharing-your-book.html#publishing"><i class="fa fa-check"></i><b>11.1</b> Publishing</a></li>
<li class="chapter" data-level="11.2" data-path="sharing-your-book.html"><a href="sharing-your-book.html#pages"><i class="fa fa-check"></i><b>11.2</b> 404 pages</a></li>
<li class="chapter" data-level="11.3" data-path="sharing-your-book.html"><a href="sharing-your-book.html#metadata-for-sharing"><i class="fa fa-check"></i><b>11.3</b> Metadata for sharing</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R avancé</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="manipulation-de-données-avec-r" class="section level1" number="2">
<h1><span class="header-section-number">Chapitre 2</span> Manipulation de données avec <strong>R</strong></h1>
<p>Packages à installer pour ce chapitre</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="manipulation-de-données-avec-r.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(</span>
<span id="cb2-2"><a href="manipulation-de-données-avec-r.html#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># import data:</span></span>
<span id="cb2-3"><a href="manipulation-de-données-avec-r.html#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;foreign&quot;</span>, <span class="st">&quot;jsonlite&quot;</span>, <span class="st">&quot;readr&quot;</span>, <span class="st">&quot;readxl&quot;</span>, <span class="st">&quot;sas7bdat&quot;</span>, <span class="st">&quot;XML&quot;</span>, </span>
<span id="cb2-4"><a href="manipulation-de-données-avec-r.html#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># big data analysis</span></span>
<span id="cb2-5"><a href="manipulation-de-données-avec-r.html#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;data.table&quot;</span>, <span class="st">&quot;ff&quot;</span>, <span class="st">&quot;ffbase&quot;</span>, </span>
<span id="cb2-6"><a href="manipulation-de-données-avec-r.html#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># matrices creuses</span></span>
<span id="cb2-7"><a href="manipulation-de-données-avec-r.html#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Marix&quot;</span>, </span>
<span id="cb2-8"><a href="manipulation-de-données-avec-r.html#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># character treatment</span></span>
<span id="cb2-9"><a href="manipulation-de-données-avec-r.html#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;classInt&quot;</span>, <span class="st">&quot;glue&quot;</span>, <span class="st">&quot;stringr&quot;</span>, <span class="st">&quot;wordcloud&quot;</span>, </span>
<span id="cb2-10"><a href="manipulation-de-données-avec-r.html#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;gplots&quot;</span>, <span class="co"># plotting data with ggplot2 style</span></span>
<span id="cb2-11"><a href="manipulation-de-données-avec-r.html#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tidyverse&quot;</span>, <span class="st">&quot;DSR&quot;</span>, <span class="co"># Data Scientists toolkits</span></span>
<span id="cb2-12"><a href="manipulation-de-données-avec-r.html#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Amelia&quot;</span>, <span class="st">&quot;DMwR&quot;</span>, <span class="st">&quot;missForest&quot;</span>, <span class="st">&quot;naniar&quot;</span>,  <span class="co"># missing values treatement</span></span>
<span id="cb2-13"><a href="manipulation-de-données-avec-r.html#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;sp&quot;</span>, <span class="st">&quot;sf&quot;</span>, <span class="co"># spatial data object</span></span>
<span id="cb2-14"><a href="manipulation-de-données-avec-r.html#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;zoo&quot;</span>)  <span class="co"># Time series analysis</span></span>
<span id="cb2-15"><a href="manipulation-de-données-avec-r.html#cb2-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div id="les-chaînes-de-caractères" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Les chaînes de caractères</h2>
<div id="fonctions-de-base" class="section level3" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Fonctions de base</h3>
<p>On considère la chaîne de caractère suivante :</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="manipulation-de-données-avec-r.html#cb3-1" aria-hidden="true" tabindex="-1"></a>phrase <span class="ot">&lt;-</span> <span class="st">&quot;Notes obtenues</span><span class="sc">\n</span><span class="st">anglais: 16, Stat:14, Eco=18&quot;</span></span>
<span id="cb3-2"><a href="manipulation-de-données-avec-r.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(phrase)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>Parmi les fonctions qui permettent de manipuler les chaînes de caractères, voici celles qui nous semblent importantes de connaître :</p>
<div id="nchar" class="section level4" number="2.1.1.1">
<h4><span class="header-section-number">2.1.1.1</span> <em>nchar()</em></h4>
<p>Permet de compter le nombre de caractères de chaque élément d’un vecteur :</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="manipulation-de-données-avec-r.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nchar</span>(phrase)</span></code></pre></div>
<pre><code>## [1] 43</code></pre>
</div>
<div id="substr" class="section level4" number="2.1.1.2">
<h4><span class="header-section-number">2.1.1.2</span> <em>substr()</em></h4>
<p>Permet d’extraire un sous-ensemble de caractères :</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="manipulation-de-données-avec-r.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">substr</span>(phrase, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">stop =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Notes&quot;</code></pre>
</div>
<div id="strsplit" class="section level4" number="2.1.1.3">
<h4><span class="header-section-number">2.1.1.3</span> <em>strsplit()</em></h4>
<p>Permet d’éclater une chaîne de caractères dès qu’on trouve une sous-chaîne particulière :</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="manipulation-de-données-avec-r.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">strsplit</span>(phrase, <span class="at">split =</span> <span class="st">&quot; &quot;</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;Notes&quot;              &quot;obtenues\nanglais:&quot; &quot;16,&quot;               
## [4] &quot;Stat:14,&quot;           &quot;Eco=18&quot;</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="manipulation-de-données-avec-r.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">strsplit</span>(phrase, <span class="at">split =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;Notes obtenues&quot;               &quot;anglais: 16, Stat:14, Eco=18&quot;</code></pre>
<p><strong>Remarque 1 :</strong> un espace est considéré comme une chaîne de caractère.</p>
<p><strong>Remarque 2 :</strong> “\n” est un caractère spécial qui correspond à un saut de ligne (pour consulter la liste des caractères spéciaux, voir cette <a href="http://help.stonesoft.com/onlinehelp/StoneGate/SMC/5.3.6/SGAG/SG_RegularExpressions/Special_Character_Sequences.htm">page web</a>). Pour évaluer un caractère spécial dans une chaîne de caractère, on peut utiliser la fonction <em>cat()</em>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="manipulation-de-données-avec-r.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(phrase)</span></code></pre></div>
<pre><code>## Notes obtenues
## anglais: 16, Stat:14, Eco=18</code></pre>
<p><strong>Remarque 3 :</strong> l’objet retourné est de type <strong>list</strong>. Pour convertir une <strong>list</strong> en un vecteur, sur lequel il est plus facile de faire de la manipulation, on utilise la fonction <em>unlist()</em>. Enfin, si on veut éclater une chaîne de caractère en fonction de plusieurs caractères, on utilise le symbole |. Dans l’exemple suivant, l’idée est de séparer tous les mots en présence d’un des caractères spéciaux :</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="manipulation-de-données-avec-r.html#cb15-1" aria-hidden="true" tabindex="-1"></a>(mots <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(phrase, <span class="at">split =</span> <span class="st">&quot;,|</span><span class="sc">\n</span><span class="st">| |:|=&quot;</span>))</span></code></pre></div>
<pre><code>## [[1]]
##  [1] &quot;Notes&quot;    &quot;obtenues&quot; &quot;anglais&quot;  &quot;&quot;         &quot;16&quot;       &quot;&quot;        
##  [7] &quot;Stat&quot;     &quot;14&quot;       &quot;&quot;         &quot;Eco&quot;      &quot;18&quot;</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="manipulation-de-données-avec-r.html#cb17-1" aria-hidden="true" tabindex="-1"></a>(mots <span class="ot">&lt;-</span> <span class="fu">unlist</span>(mots))</span></code></pre></div>
<pre><code>##  [1] &quot;Notes&quot;    &quot;obtenues&quot; &quot;anglais&quot;  &quot;&quot;         &quot;16&quot;       &quot;&quot;        
##  [7] &quot;Stat&quot;     &quot;14&quot;       &quot;&quot;         &quot;Eco&quot;      &quot;18&quot;</code></pre>
<p>Si on utilise le type <strong>NULL</strong> comme critère de recherche, cela a pour effet d’éclater tous les éléments de la chaîne de caractères en des caractères uniques :</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="manipulation-de-données-avec-r.html#cb19-1" aria-hidden="true" tabindex="-1"></a>(lettres <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(phrase, <span class="at">split =</span> <span class="cn">NULL</span>))</span></code></pre></div>
<pre><code>## [[1]]
##  [1] &quot;N&quot;  &quot;o&quot;  &quot;t&quot;  &quot;e&quot;  &quot;s&quot;  &quot; &quot;  &quot;o&quot;  &quot;b&quot;  &quot;t&quot;  &quot;e&quot;  &quot;n&quot;  &quot;u&quot;  &quot;e&quot;  &quot;s&quot;  &quot;\n&quot;
## [16] &quot;a&quot;  &quot;n&quot;  &quot;g&quot;  &quot;l&quot;  &quot;a&quot;  &quot;i&quot;  &quot;s&quot;  &quot;:&quot;  &quot; &quot;  &quot;1&quot;  &quot;6&quot;  &quot;,&quot;  &quot; &quot;  &quot;S&quot;  &quot;t&quot; 
## [31] &quot;a&quot;  &quot;t&quot;  &quot;:&quot;  &quot;1&quot;  &quot;4&quot;  &quot;,&quot;  &quot; &quot;  &quot;E&quot;  &quot;c&quot;  &quot;o&quot;  &quot;=&quot;  &quot;1&quot;  &quot;8&quot;</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="manipulation-de-données-avec-r.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(lettres[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>## [1] 43</code></pre>
<p><strong>Remarque :</strong> dans le contexte d’une étude statistique, on appliquera cette fonction à des vecteurs de caractère. Par exemple :</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="manipulation-de-données-avec-r.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">strsplit</span>(mots, <span class="at">split =</span> <span class="st">&quot;:&quot;</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;Notes&quot;
## 
## [[2]]
## [1] &quot;obtenues&quot;
## 
## [[3]]
## [1] &quot;anglais&quot;
## 
## [[4]]
## character(0)
## 
## [[5]]
## [1] &quot;16&quot;
## 
## [[6]]
## character(0)
## 
## [[7]]
## [1] &quot;Stat&quot;
## 
## [[8]]
## [1] &quot;14&quot;
## 
## [[9]]
## character(0)
## 
## [[10]]
## [1] &quot;Eco&quot;
## 
## [[11]]
## [1] &quot;18&quot;</code></pre>
</div>
<div id="toupper-tolower" class="section level4" number="2.1.1.4">
<h4><span class="header-section-number">2.1.1.4</span> <em>toupper()</em>, <em>tolower()</em></h4>
<p>Pemettent de convertir toutes les lettres en majuscules et minuscules :</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="manipulation-de-données-avec-r.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">toupper</span>(phrase)</span></code></pre></div>
<pre><code>## [1] &quot;NOTES OBTENUES\nANGLAIS: 16, STAT:14, ECO=18&quot;</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="manipulation-de-données-avec-r.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tolower</span>(<span class="st">&quot;AAA&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;aaa&quot;</code></pre>
</div>
<div id="grep" class="section level4" number="2.1.1.5">
<h4><span class="header-section-number">2.1.1.5</span> <em>grep()</em></h4>
<p>Permet de trouver dans un vecteur de caractères quels sont les indices des composantes du vecteur qui contiennent un ensemble de caractères. Par exemple quels sont les mots qui contiennent la lettre “e” :</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="manipulation-de-données-avec-r.html#cb29-1" aria-hidden="true" tabindex="-1"></a>(res <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="at">pattern =</span> <span class="st">&quot;e&quot;</span>, <span class="at">x =</span> mots))</span></code></pre></div>
<pre><code>## [1] 1 2</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="manipulation-de-données-avec-r.html#cb31-1" aria-hidden="true" tabindex="-1"></a>mots[res]</span></code></pre></div>
<pre><code>## [1] &quot;Notes&quot;    &quot;obtenues&quot;</code></pre>
<p>On peut chercher plusieurs lettres à la fois. Ici, on cherche les mots qui contiennent une des lettres “j,” “J” et “t.” Pour cela, on utilise une expression régulière grâce aux crochets (nous verrons dans la section suivante plus en détail le fonctionnement des expressions régulières) :</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="manipulation-de-données-avec-r.html#cb33-1" aria-hidden="true" tabindex="-1"></a>(res <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="at">pattern =</span> <span class="st">&quot;[jSE]&quot;</span>, <span class="at">x =</span> mots))</span></code></pre></div>
<pre><code>## [1]  7 10</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="manipulation-de-données-avec-r.html#cb35-1" aria-hidden="true" tabindex="-1"></a>mots[res]</span></code></pre></div>
<pre><code>## [1] &quot;Stat&quot; &quot;Eco&quot;</code></pre>
<p><strong>Remarque :</strong> un vecteur de taille nulle est retourné si le critère n’est pas satisfait.</p>
</div>
<div id="agrep" class="section level4" number="2.1.1.6">
<h4><span class="header-section-number">2.1.1.6</span> <em>agrep()</em></h4>
<p>Pemet de trouver dans un vecteur de caractères quels sont les indices des composantes du vecteur qui contiennent “approximativement” une sous-chaîne, l’approximation pouvant être réglée avec les options de la fonction. Dans l’exemple suivant, la lettre s minuscule est différente de S majuscule, mais cette différence d’1 caractère sera tolérée.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="manipulation-de-données-avec-r.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">agrep</span>(<span class="st">&quot;stat&quot;</span>, mots)</span></code></pre></div>
<pre><code>## [1] 7</code></pre>
<p><strong>Remarque :</strong> lorsqu’on traite des fichiers de données brutes, ce fichier peut contenir des erreurs de saisie, par exemple “Toulouze” au lieu de “Toulouse” et c’est pourquoi le fait de tolérer un nombre de différences peut s’avérer intéressant.</p>
<ul>
<li><em>sub()</em> pour changer une sous-chaîne de caractères par une autre :</li>
</ul>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="manipulation-de-données-avec-r.html#cb39-1" aria-hidden="true" tabindex="-1"></a>(mots <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="at">pattern =</span> <span class="st">&quot;=&quot;</span>, <span class="at">replacement =</span> <span class="st">&quot;:&quot;</span>, <span class="at">x =</span> phrase))</span></code></pre></div>
<pre><code>## [1] &quot;Notes obtenues\nanglais: 16, Stat:14, Eco:18&quot;</code></pre>
</div>
<div id="regexpr" class="section level4" number="2.1.1.7">
<h4><span class="header-section-number">2.1.1.7</span> <em>regexpr()</em></h4>
<p>Permet de dire à quelle position dans le mot se trouve une sous-chaîne de caractères. Dans l’exemple suivant, on cherche à savoir où se trouve le caractère “:” dans les mots. Si un caractère est présent, alors la fonction retourne les positions de la lettre “:” et si elle n’apparaît pas, la valeur -1 est retournée. Le résultat est encore donné sous forme de <strong>list</strong> car cela permet de traiter chaque mot du vecteur.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="manipulation-de-données-avec-r.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gregexpr</span>(<span class="at">pattern =</span> <span class="st">&quot;:&quot;</span>, <span class="at">text =</span> mots, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><strong>Compléments :</strong> en pratique, on peut vouloir faire des recherches plus complexes (plusieurs caractères, des caractères spéciaux, etc), ce qui nécessite une adaptation dans les critères de recherche. La gestion des chaînes de caractères est synthétisée dans l’aide suivante :</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="manipulation-de-données-avec-r.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(regexp)</span></code></pre></div>
</div>
<div id="abbreviate" class="section level4" number="2.1.1.8">
<h4><span class="header-section-number">2.1.1.8</span> <em>abbreviate()</em></h4>
<p>Pemet de faire des abbréviations de chaînes de caratères trop longue, tout en respectant l’unicité de chaque mot (autement dit, une même abbréviation ne peut pas être donnée à deux mots différents). Par exemple :</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="manipulation-de-données-avec-r.html#cb43-1" aria-hidden="true" tabindex="-1"></a>pays <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Bosnie-Herzégovine&quot;</span>, <span class="st">&quot;Burkina Faso&quot;</span>,  <span class="st">&quot;Côte d&#39;Ivoire&quot;</span>)</span>
<span id="cb43-2"><a href="manipulation-de-données-avec-r.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abbreviate</span>(pays)</span></code></pre></div>
<pre><code>## Warning in abbreviate(pays): abbreviate utilisé avec des caractères non ASCII</code></pre>
<pre><code>## Bosnie-Herzégovine       Burkina Faso      Côte d&#39;Ivoire 
##             &quot;Bs-H&quot;             &quot;BrkF&quot;             &quot;Cd&#39;I&quot;</code></pre>
<p><strong>Exercice 1.1</strong></p>
<p><strong>Q1</strong> Compter le nombre de caractères de chaque élément du vecteur suivant. Que constatez-vous ?</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="manipulation-de-données-avec-r.html#cb46-1" aria-hidden="true" tabindex="-1"></a>x_with_missing <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;oui&quot;</span>, <span class="st">&quot;peut-être&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;non&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;si&quot;</span>)</span></code></pre></div>
<p><strong>Q2</strong> Dans le vecteur suivant, faire l’extraction des deux entiers qui se trouvent entre le symbole <strong>_</strong> et présenter le résultat sous forme de vecteur :</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="manipulation-de-données-avec-r.html#cb47-1" aria-hidden="true" tabindex="-1"></a>code_INSEE <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;toulouse_31_HG&quot;</span>, <span class="st">&quot;lyon_69_Rhone&quot;</span>,</span>
<span id="cb47-2"><a href="manipulation-de-données-avec-r.html#cb47-2" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;marsei_13_PACA&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="les-expressions-régulières" class="section level3" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Les expressions régulières</h3>
<p>Ce paragraphe s’inspire de cette <a href="http://eric.univ-lyon2.fr/~ricco/cours/slides/TM.E%20-%20expressions%20regulieres.pdf">note de cours</a> écrite par Ricco Rakotomalala.</p>
<p>On va s’attarder sur l’utilisation d’expressions régulières qui est très populaire dans certaines disciplines et notamment le text mining qui englobe l’analyse de tweets.</p>
<div id="définition" class="section level4" number="2.1.2.1">
<h4><span class="header-section-number">2.1.2.1</span> Définition</h4>
<p>Une expression régulière est une séquence de caractères qui définit un motif d’intérêt. Par exemple, on considère le motif d’intérêt “b.b.” une séquence de 4 caractères où le 1er et 3ème caractères sont le caractère “b” et le 2ème et 4ème peuvent être n’importe quel autre caractère tel que “bobi,” “buba,” “bib1,” “bpbe,” “byb=,” etc.</p>
<p>On pourrait considérer un second motif d’intérêt “b.b.” une séquence de 4 caractères où le 1er et 3ème caractère sont le caractère “b” et le 2ème et 4ème peuvent être une voyelle uniquement. Dans ce cas, “bybe” serait un candidat, mais pas “bib1.”</p>
<p>Une expression régulière correspond donc à la syntaxe informatique qui sera utilisée pour détecter un motif d’intérêt.</p>
<div id="exemples" class="section level5" number="2.1.2.1.1">
<h5><span class="header-section-number">2.1.2.1.1</span> Exemples</h5>
<p>Par défaut, les fonctions <em>strsplit()</em>, <em>grep()</em>, <em>sub()</em> ou <em>regexpr()</em> permettent d’utiliser une expression régulière comme critère de recherche. Par exemple, pour identifier le 1er motif d’intérêt, l’expression régulière est la suivante “b.b.” où le “.” indique donc que n’importe quel caractère est accepté</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="manipulation-de-données-avec-r.html#cb48-1" aria-hidden="true" tabindex="-1"></a>textes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;bobi&quot;</span>, <span class="st">&quot;bibé&quot;</span>, <span class="st">&quot;tatane&quot;</span>, <span class="st">&quot;bAbA&quot;</span>, <span class="st">&quot;tbtc&quot;</span>,</span>
<span id="cb48-2"><a href="manipulation-de-données-avec-r.html#cb48-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;tut&quot;</span>, <span class="st">&quot;byb=&quot;</span>, <span class="st">&quot;baba&quot;</span>, <span class="st">&quot;bub1&quot;</span>, <span class="st">&quot;t5t3&quot;</span>)</span>
<span id="cb48-3"><a href="manipulation-de-données-avec-r.html#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">grep</span>(<span class="st">&quot;b.b.&quot;</span>, textes))</span></code></pre></div>
<pre><code>## [1] 1 2 4 7 8 9</code></pre>
<p>Pour le second motif d’intérêt, on va utiliser l’expression régulière suivante :</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="manipulation-de-données-avec-r.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">grep</span>(<span class="st">&quot;b[aeiouy]b[aeiouy]&quot;</span>, textes))</span></code></pre></div>
<pre><code>## [1] 1 8</code></pre>
<p>On met entre crochets les caractères qui sont autorisés.</p>
<p>La négation des caractères autorisés est obtenue avec le symbole “^.” Par exemple, dans l’exemple suivant, on autorise tous les caractères sauf les voyelles :</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="manipulation-de-données-avec-r.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">grep</span>(<span class="st">&quot;b[^aeiouy]b[^aeiouy]&quot;</span>, textes))</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p>Pour autoriser une suite de caractères, on utilise le symbole “-.” Par exemple, si on autorise uniquement les lettres minuscules de l’alphabet, on fait:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="manipulation-de-données-avec-r.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">grep</span>(<span class="st">&quot;b[a-z]b[a-z]&quot;</span>, textes))</span></code></pre></div>
<pre><code>## [1] 1 8</code></pre>
<p>Si on autorise toutes les lettres de l’alphabet (minuscules et majuscules ainsi que les caractères spéciaux comme les accents é, à, è, ç, etc.), on utilise la syntaxe “[:alpha:]” entre crochets. Par exemple :</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="manipulation-de-données-avec-r.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">grep</span>(<span class="st">&quot;b[[:alpha:]]b[[:alpha:]]&quot;</span>, textes))</span></code></pre></div>
<pre><code>## [1] 1 2 4 8</code></pre>
<p>Si on utilise toutes les lettres de l’alphabet ainsi que les chiffre numériques, on utilise la syntaxe “[:alnum:]” entre crochets. Par exemple :</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="manipulation-de-données-avec-r.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">grep</span>(<span class="st">&quot;b[[:alnum:]]b[[:alnum:]]&quot;</span>, textes))</span></code></pre></div>
<pre><code>## [1] 1 2 4 8 9</code></pre>
</div>
</div>
<div id="les-autres-expressions-régulières" class="section level4" number="2.1.2.2">
<h4><span class="header-section-number">2.1.2.2</span> Les autres expressions régulières</h4>
<p>Nous avons résumé différentes expressions régulières pouvant être utilisées :</p>
<ul>
<li>[…] : un des caractères indiqués entre les crochets. Par exemple:</li>
</ul>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="manipulation-de-données-avec-r.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">grep</span>(<span class="st">&quot;t[aeiouy]t[aeiouy]&quot;</span>, textes))</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<ul>
<li>[^...] : tous les caractères sauf ceux indiqués après le ^. Par exemple:</li>
</ul>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="manipulation-de-données-avec-r.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">grep</span>(<span class="st">&quot;t[^aeiouy]t[^aeiouy]&quot;</span>, textes))</span></code></pre></div>
<pre><code>## [1]  5 10</code></pre>
<ul>
<li>[x-y] : les caractères compris entre x à y inclus. Par exemple :</li>
</ul>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="manipulation-de-données-avec-r.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">grep</span>(<span class="st">&quot;t[a-z]t[a-z]&quot;</span>, textes))</span></code></pre></div>
<pre><code>## [1] 3 5</code></pre>
<ul>
<li><p>[:alnum:] équivalent à a-zA-Z0-9 avec en plus les caractères spéciaux que l’on retrouve suivant les langues utilisées comme les é, è, ù, ç, à.</p></li>
<li><p>[:alpha:] équivalent à a-zA-Z avec en plus les caractères spéciaux que l’on retrouve suivant les langues utilisées</p></li>
<li><p>[:digit:] équivalent à 0-9. Par exemple :</p></li>
</ul>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="manipulation-de-données-avec-r.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">grep</span>(<span class="st">&quot;t[[:digit:]]t[[:digit:]]&quot;</span>, textes))</span></code></pre></div>
<pre><code>## [1] 10</code></pre>
<ul>
<li><p>[:lower:] équivalent à a-z avec en plus les caractères spéciaux que l’on retrouve suivant les langues utilisées</p></li>
<li><p>[:upper:] équivalent à A-Z avec en plus les caractères spéciaux que l’on retrouve suivant les langues utilisées comme les Â, Û, Ô, etc.</p></li>
<li><p>[:xdigit:] équivalent à 0-9a-fA-F</p></li>
<li><p>[:graph:] tout caractère graphique</p></li>
<li><p>[:print:] tout caractère affichable</p></li>
<li><p>[:punct:] tout caractère de ponctuation</p></li>
<li><p>[:blank:] espace, tabulation</p></li>
<li><p>[:space:] espace, tabulation, nouvelle ligne, retour chariot</p></li>
<li><p>[:cntrl:] tout caractère de contrôle</p></li>
</ul>
<p><strong>Exercice 1.2</strong>:</p>
<p>On considère la chaîne de caractère suivante :</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="manipulation-de-données-avec-r.html#cb68-1" aria-hidden="true" tabindex="-1"></a>ww <span class="ot">&lt;-</span> <span class="st">&quot;we went to warwick 5 times&quot;</span></span></code></pre></div>
<p>Avec la fonction <em>gregexpr()</em>, trouver les expressions régulières qui permettent de donner l’emplacement de :</p>
<ul>
<li>la chaîne de caractères “i”</li>
<li>un chiffre numérique</li>
<li>la chaîne de caractères “we”</li>
<li>une des deux chaînes de caractères “w” ou “e”</li>
<li>un pattern commençant par un espace suivi de la chaîne “w.”</li>
</ul>
</div>
</div>
<div id="application-aux-tweets" class="section level3" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> Application aux tweets</h3>
<p>On considère le vecteur suivant dont les éléments correspondent à des extraits de tweets</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="manipulation-de-données-avec-r.html#cb69-1" aria-hidden="true" tabindex="-1"></a>tweet <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;TopStartupsUSA: RT @FernandoX: 7 C&#39;s of Marketing in the Digital Era.</span><span class="sc">\n</span><span class="st">&quot;</span>, </span>
<span id="cb69-2"><a href="manipulation-de-données-avec-r.html#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;#Analytics #MachineLearning #DataScience #MalWare #IIoT&quot;</span>, </span>
<span id="cb69-3"><a href="manipulation-de-données-avec-r.html#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;YvesMulkers: RT @wil_bielert: RT @neptanum: Standard Model Physics from an Algebra?&quot;</span>, </span>
<span id="cb69-4"><a href="manipulation-de-données-avec-r.html#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;#BigData #Analytics #DataScience #AI #MachineLearning #IoT #IIoT #Python&quot;</span>)</span></code></pre></div>
<p><strong>Exercice 1.3.</strong></p>
<p>Expliquer la fonction de chacune des expressions régulières suivantes</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="manipulation-de-données-avec-r.html#cb70-1" aria-hidden="true" tabindex="-1"></a>correct <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;(RT|via)((?:</span><span class="sc">\\</span><span class="st">b</span><span class="sc">\\</span><span class="st">W*@</span><span class="sc">\\</span><span class="st">w+)+)&quot;</span>, <span class="st">&quot;&quot;</span>, tweet)</span>
<span id="cb70-2"><a href="manipulation-de-données-avec-r.html#cb70-2" aria-hidden="true" tabindex="-1"></a>correct <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;@</span><span class="sc">\\</span><span class="st">w+&quot;</span>, <span class="st">&quot;&quot;</span>, correct)</span>
<span id="cb70-3"><a href="manipulation-de-données-avec-r.html#cb70-3" aria-hidden="true" tabindex="-1"></a>correct <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;[[:punct:]]&quot;</span>, <span class="st">&quot;&quot;</span>, correct)</span>
<span id="cb70-4"><a href="manipulation-de-données-avec-r.html#cb70-4" aria-hidden="true" tabindex="-1"></a>correct <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;[[:digit:]]&quot;</span>, <span class="st">&quot;&quot;</span>, correct)</span>
<span id="cb70-5"><a href="manipulation-de-données-avec-r.html#cb70-5" aria-hidden="true" tabindex="-1"></a>correct <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;http</span><span class="sc">\\</span><span class="st">w+&quot;</span>, <span class="st">&quot;&quot;</span>, correct)</span>
<span id="cb70-6"><a href="manipulation-de-données-avec-r.html#cb70-6" aria-hidden="true" tabindex="-1"></a>correct <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;[</span><span class="sc">\t</span><span class="st"> ]{2,}&quot;</span>, <span class="st">&quot; &quot;</span>, correct)</span>
<span id="cb70-7"><a href="manipulation-de-données-avec-r.html#cb70-7" aria-hidden="true" tabindex="-1"></a>correct <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;^</span><span class="sc">\\</span><span class="st">s+|</span><span class="sc">\\</span><span class="st">s+$&quot;</span>, <span class="st">&quot;&quot;</span>, correct)</span>
<span id="cb70-8"><a href="manipulation-de-données-avec-r.html#cb70-8" aria-hidden="true" tabindex="-1"></a>correct <span class="ot">&lt;-</span> <span class="fu">iconv</span>(correct, <span class="st">&quot;UTF-8&quot;</span>, <span class="st">&quot;ASCII&quot;</span>, <span class="at">sub =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
</div>
<div id="nuage-de-mots" class="section level3" number="2.1.4">
<h3><span class="header-section-number">2.1.4</span> Nuage de mots</h3>
<p>On présente ici la fonction <em>wordcloud()</em> du package <strong>wordcloud</strong> qui permet de représenter un nuage de mots en fonctions du nombre d’occurences des mots trouvés dans un corps de texte.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="manipulation-de-données-avec-r.html#cb71-1" aria-hidden="true" tabindex="-1"></a>word <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(correct, <span class="st">&quot; &quot;</span>))</span>
<span id="cb71-2"><a href="manipulation-de-données-avec-r.html#cb71-2" aria-hidden="true" tabindex="-1"></a>tab_word <span class="ot">&lt;-</span> <span class="fu">table</span>(word)</span>
<span id="cb71-3"><a href="manipulation-de-données-avec-r.html#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;wordcloud&quot;</span>)</span></code></pre></div>
<pre><code>## Le chargement a nécessité le package : wordcloud</code></pre>
<pre><code>## Le chargement a nécessité le package : RColorBrewer</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="manipulation-de-données-avec-r.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wordcloud</span>(<span class="fu">names</span>(tab_word), tab_word)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-35-1.png" width="768" /></p>
</div>
<div id="ordonnancement" class="section level3" number="2.1.5">
<h3><span class="header-section-number">2.1.5</span> Ordonnancement</h3>
<p>Les caractères peuvent s’ordonner comme on le fait avec des chiffres. Par exemple, le caratère “a” est plus petit que “b” qui n’est pas plus grand que “c.” Pour le vérifier :</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="manipulation-de-données-avec-r.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;a&quot;</span> <span class="sc">&lt;</span> <span class="st">&quot;b&quot;</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="manipulation-de-données-avec-r.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;b&quot;</span> <span class="sc">&gt;</span> <span class="st">&quot;c&quot;</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>On s’intéresse ici plus particulièrement aux règles d’ordonnancement utilisées pour la langue française. Selon la langue utilisée par la machine, il existe donc des règles particulières pour ordonnancer les chaînes de caractères, qui diffèrent d’une langue à l’autre. Pour vérifier la langue utilisée par la machine, on peut utiliser la commande</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="manipulation-de-données-avec-r.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setlocale</span>(<span class="at">category =</span> <span class="st">&quot;LC_CTYPE&quot;</span>, <span class="at">locale =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;fr_FR.UTF-8&quot;</code></pre>
<p>Considérons la citation suivante stockée dans l’objet <strong>citation</strong> :</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="manipulation-de-données-avec-r.html#cb81-1" aria-hidden="true" tabindex="-1"></a>citation <span class="ot">&lt;-</span> <span class="st">&quot;Il est important que les étudiants portent un regard neuf </span></span>
<span id="cb81-2"><a href="manipulation-de-données-avec-r.html#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="st">et irrévérencieux  sur leurs études ; il ne doivent pas vénérer le savoir </span></span>
<span id="cb81-3"><a href="manipulation-de-données-avec-r.html#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="st">mais le remettre en question (chapitre : 1 - paragraphe : 2 - ligne : 10 </span></span>
<span id="cb81-4"><a href="manipulation-de-données-avec-r.html#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="st">- page : 185. Jacob Chanowski).&quot;</span></span></code></pre></div>
<p>On peut récupérer chaque “mot” (entités séparées par des espaces”) par la commande :</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="manipulation-de-données-avec-r.html#cb82-1" aria-hidden="true" tabindex="-1"></a>(mots <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(citation, <span class="at">split =</span> <span class="st">&quot; &quot;</span>)))</span></code></pre></div>
<pre><code>##  [1] &quot;Il&quot;             &quot;est&quot;            &quot;important&quot;      &quot;que&quot;           
##  [5] &quot;les&quot;            &quot;étudiants&quot;      &quot;portent&quot;        &quot;un&quot;            
##  [9] &quot;regard&quot;         &quot;neuf&quot;           &quot;\net&quot;           &quot;irrévérencieux&quot;
## [13] &quot;&quot;               &quot;sur&quot;            &quot;leurs&quot;          &quot;études&quot;        
## [17] &quot;;&quot;              &quot;il&quot;             &quot;ne&quot;             &quot;doivent&quot;       
## [21] &quot;pas&quot;            &quot;vénérer&quot;        &quot;le&quot;             &quot;savoir&quot;        
## [25] &quot;\nmais&quot;         &quot;le&quot;             &quot;remettre&quot;       &quot;en&quot;            
## [29] &quot;question&quot;       &quot;(chapitre&quot;      &quot;:&quot;              &quot;1&quot;             
## [33] &quot;-&quot;              &quot;paragraphe&quot;     &quot;:&quot;              &quot;2&quot;             
## [37] &quot;-&quot;              &quot;ligne&quot;          &quot;:&quot;              &quot;10&quot;            
## [41] &quot;\n-&quot;            &quot;page&quot;           &quot;:&quot;              &quot;185.&quot;          
## [45] &quot;Jacob&quot;          &quot;Chanowski).&quot;</code></pre>
<p>Le tri des éléments (uniques) du vecteur <strong>mots</strong> nous montre les règles d’ordonnancement appliquées par <strong>R</strong>.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="manipulation-de-données-avec-r.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">unique</span>(mots))</span></code></pre></div>
<pre><code>##  [1] &quot;&quot;               &quot;\n-&quot;            &quot;\net&quot;           &quot;\nmais&quot;        
##  [5] &quot;-&quot;              &quot;;&quot;              &quot;:&quot;              &quot;(chapitre&quot;     
##  [9] &quot;1&quot;              &quot;10&quot;             &quot;185.&quot;           &quot;2&quot;             
## [13] &quot;Chanowski).&quot;    &quot;doivent&quot;        &quot;en&quot;             &quot;est&quot;           
## [17] &quot;études&quot;         &quot;étudiants&quot;      &quot;il&quot;             &quot;Il&quot;            
## [21] &quot;important&quot;      &quot;irrévérencieux&quot; &quot;Jacob&quot;          &quot;le&quot;            
## [25] &quot;les&quot;            &quot;leurs&quot;          &quot;ligne&quot;          &quot;ne&quot;            
## [29] &quot;neuf&quot;           &quot;page&quot;           &quot;paragraphe&quot;     &quot;pas&quot;           
## [33] &quot;portent&quot;        &quot;que&quot;            &quot;question&quot;       &quot;regard&quot;        
## [37] &quot;remettre&quot;       &quot;savoir&quot;         &quot;sur&quot;            &quot;un&quot;            
## [41] &quot;vénérer&quot;</code></pre>
<ul>
<li><p>les caractères spéciaux <strong>-</strong>, <strong>:</strong>, <strong>;</strong>, <strong>(</strong>, etc. sont prioritaires sur les chiffres et les lettres.</p></li>
<li><p>les chiffres sont prioritaires sur les lettres.</p></li>
<li><p>les mots sont ordonnancés comme dans un dictionnaire français.</p></li>
<li><p>quand il y a des lettres avec des accents, on ordonnance comme s’il n’y avait pas d’accents.</p></li>
<li><p>les lettres majuscules sont insérées dans l’ordre alphabétique et ne sont pas prioritaires par rapport aux lettres minuscules.</p></li>
<li><p>la syntaxe <em>“\n”</em> n’est pas comptabilisée.</p></li>
<li><p>les chiffres ne sont pas regardés comme des chiffres mais comme une chaîne de caractères. Autrement dit “10” doit être vu comme un mot avec 2 caractères consécutifs : “1,” puis “0.” “2” doit être vu comme 1 mot avec un seul caractère. Pour comparer ces 2 mots, on compare les caractères entre eux les uns après les autres. Dans un premier temps, on regarde le 1er caractère de chaque mot : “1” est plus petit que “2.” Aussi, quelque soit le nombre de caractère qu’on va ajouter après “1” ce mot sera plus petit que “2.” Par exemple “15552525” sera plus petit que “2.”</p></li>
</ul>
<p><strong>Exercice 1.4.</strong></p>
<p>A partir du jeu de données <strong>USArrests</strong>, extraire les lignes dont le nom contient la chaîne de caractères “New.” Vous pouvez vous inspirer des instructions suivantes. Dans le premier cas, tous les noms de lignes contenant la lettre <strong>C</strong> sont renvoyés ; dans le second cas, seuls ceux commencant par <strong>C</strong> sont renvoyés. Consulter la fiche d’aide sur les expressions régulières pour en savoir (beaucoup !) plus (<strong>help(regexp)</strong>).</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="manipulation-de-données-avec-r.html#cb86-1" aria-hidden="true" tabindex="-1"></a>USArrests[<span class="fu">grep</span>(<span class="st">&quot;C&quot;</span>, <span class="fu">rownames</span>(USArrests)),]</span></code></pre></div>
<pre><code>##                Murder Assault UrbanPop Rape
## California        9.0     276       91 40.6
## Colorado          7.9     204       78 38.7
## Connecticut       3.3     110       77 11.1
## North Carolina   13.0     337       45 16.1
## South Carolina   14.4     279       48 22.5</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="manipulation-de-données-avec-r.html#cb88-1" aria-hidden="true" tabindex="-1"></a>USArrests[<span class="fu">grep</span>(<span class="st">&quot;^C&quot;</span>, <span class="fu">rownames</span>(USArrests)),]</span></code></pre></div>
<pre><code>##             Murder Assault UrbanPop Rape
## California     9.0     276       91 40.6
## Colorado       7.9     204       78 38.7
## Connecticut    3.3     110       77 11.1</code></pre>
</div>
<div id="package-stringr" class="section level3" number="2.1.6">
<h3><span class="header-section-number">2.1.6</span> Package <strong>stringr</strong></h3>
<p>On a vu ci-dessus les fonctions de base pour manipuler des chaînes de caractères. Toutefois, si on cherche à faire des statistiques un plus poussées sur les chaînes de caractères, on va devoir avoir recours aux fonctions <em>sapply()</em> ou <em>lapply()</em> qui permettent de faire des opérations sur les listes. Par exemple, on cherche à calculer le nombre de fois qu’apparaît la lettre “a” dans le vecteur <strong>mots</strong> précédent. Pour cela, on va appliquer la fonction <em>sapply()</em> (dont nous reparlerons plus tard) sur le résultat donné par la fonction <em>gregexpr()</em>. On rappelle que le résultat de cette fonction est -1 si le caractère n’a pas été trouvé et sinon, il retourne le vecteur des positions. Pour répondre à notre problème, on exécute donc le code suivant :</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="manipulation-de-données-avec-r.html#cb90-1" aria-hidden="true" tabindex="-1"></a>res1 <span class="ot">&lt;-</span> <span class="fu">gregexpr</span>(<span class="at">pattern =</span> <span class="st">&quot;a&quot;</span>, <span class="at">text =</span> mots, <span class="at">ignore.case =</span> T)</span>
<span id="cb90-2"><a href="manipulation-de-données-avec-r.html#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(res1, <span class="cf">function</span>(x) <span class="fu">ifelse</span>(x[<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="fu">length</span>(x), <span class="dv">0</span>)) </span></code></pre></div>
<pre><code>##  [1] 0 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 0 0 0 0 1 0 0 1 1 0 0 0 0 1 0 0 0 3 0 0 0 0
## [39] 0 0 0 1 0 0 1 1</code></pre>
<p>Le package <strong>stringr</strong> a vu le jour dans le but d’effacer certaines lacunes des fonctions de base et également simplifier la syntaxe des fonctions de base. Adopter les fonctions de ces packages revient un peu à oublier la syntaxe des fonctions que nous avons vues. Par exemple, la fonction <em>str_c()</em> est plus ou moins équivalente à la fonction <em>paste()</em>, la fonction <em>str_length()</em> est équivalent à la fonction <em>nchar()</em>. La fonction <em>str_count()</em> retourne le même résultat précédent en 1 seul ligne de commande :</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="manipulation-de-données-avec-r.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;stringr&quot;</span>)</span>
<span id="cb92-2"><a href="manipulation-de-données-avec-r.html#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_count</span>(mots, <span class="st">&quot;a&quot;</span>)</span></code></pre></div>
<pre><code>##  [1] 0 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 0 0 0 0 1 0 0 1 1 0 0 0 0 1 0 0 0 3 0 0 0 0
## [39] 0 0 0 1 0 0 1 1</code></pre>
<p>Parmi les autres fonctions intéressantes de ce package, on notera la fonction <em>str_pad()</em> qui permet de faire en sorte qu’une chaîne de caractère (1er argument de la fonction) possède au minimum un nombre de caractère (2ème argument) et la compléte si nécessaire avec un caractère (3ème argument). Par exemple, si on souhaite que chaque élément du vecteur suivant possède au moins 3 caractères et qu’on souhaite compléter les chaînes manquantes par le caractère “-” en début de chaîne, on procède ainsi :</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="manipulation-de-données-avec-r.html#cb94-1" aria-hidden="true" tabindex="-1"></a>vec_to_change <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;105&quot;</span>, <span class="st">&quot;9999&quot;</span>, <span class="st">&quot;0008&quot;</span>)</span>
<span id="cb94-2"><a href="manipulation-de-données-avec-r.html#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_pad</span>(vec_to_change, <span class="dv">4</span>, <span class="at">pad =</span> <span class="st">&quot;0&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;0001&quot; &quot;0010&quot; &quot;0105&quot; &quot;9999&quot; &quot;0008&quot;</code></pre>
<p>On notera que le package <strong>stringr</strong> a été développé par Hadley Wickam (<strong>RStudio</strong>) qui est l’auteur d’un grand nombre d’autres packages avec cet esprit de rendre les choses plus simples pour l’utilisateur. Nous vous présenterons ces outils au fur et à mesure, mais à notre sens, il est important d’avoir conscience que derrière ces fonctions, se cachent des programmes qui utilisent les fonctions de base de <strong>R</strong>.</p>
<p>On citera également le package <strong>stringi</strong> qui propose un grand nombre de fonctions plus orientées vers l’analyse statistique de chaînes de caractères.</p>
<p><strong>Bibliographie</strong>
On pourra consulter ce document très intéressant et complet sur la gestion des chaînes de caractères avec <strong>R</strong> (la version gratuite est très bien) :
<a href="https://leanpub.com/r4strings" class="uri">https://leanpub.com/r4strings</a></p>
</div>
<div id="package-glue" class="section level3" number="2.1.7">
<h3><span class="header-section-number">2.1.7</span> Package <strong>glue</strong></h3>
<p>Ce package contient la fonction <em>glue()</em> qui permet d’insérer dans du texte des objets qui ont été créés dans l’environnement courant.
En reprenant l’exemple de l’auteur du package (<a href="https://cran.r-project.org/web/packages/glue/readme/README.html" class="uri">https://cran.r-project.org/web/packages/glue/readme/README.html</a>) :</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="manipulation-de-données-avec-r.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;glue&quot;</span>)</span></code></pre></div>
<pre><code>## Le chargement a nécessité le package : glue</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="manipulation-de-données-avec-r.html#cb98-1" aria-hidden="true" tabindex="-1"></a>name <span class="ot">&lt;-</span> <span class="st">&quot;Fred&quot;</span></span>
<span id="cb98-2"><a href="manipulation-de-données-avec-r.html#cb98-2" aria-hidden="true" tabindex="-1"></a>anniversary <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;1991-10-12&quot;</span>)</span>
<span id="cb98-3"><a href="manipulation-de-données-avec-r.html#cb98-3" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">floor</span>((<span class="fu">Sys.Date</span>() <span class="sc">-</span> anniversary)<span class="sc">/</span><span class="dv">365</span>))</span>
<span id="cb98-4"><a href="manipulation-de-données-avec-r.html#cb98-4" aria-hidden="true" tabindex="-1"></a>new_object <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">&#39;My name is {name},&#39;</span>,</span>
<span id="cb98-5"><a href="manipulation-de-données-avec-r.html#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39; my age next year is {age + 1},&#39;</span>,</span>
<span id="cb98-6"><a href="manipulation-de-données-avec-r.html#cb98-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39; my anniversary is {format(anniversary, &quot;%A, %d %B, %Y&quot;)}.&#39;</span>)</span></code></pre></div>
<p><strong>Remarque:</strong> l’objet créé est à la fois un objet de type <strong>glue</strong> et <strong>character</strong> en même temps. La particularité de ce type d’objets est qu’il hérite de toutes les fonctions qui peuvent s’appliquer à ces deux types:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="manipulation-de-données-avec-r.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(new_object)</span></code></pre></div>
<pre><code>## [1] &quot;glue&quot;      &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="manipulation-de-données-avec-r.html#cb101-1" aria-hidden="true" tabindex="-1"></a>new_object</span></code></pre></div>
<pre><code>## My name is Fred, my age next year is 31, my anniversary is samedi, 12 octobre, 1991.</code></pre>
<p>Il est important de noter qu’une fois l’objet <strong>glue</strong> créé, sa valeur est fixée. Autrement dit, même si on modifie les objets qui ont été utilisés pour le créer, cela ne le modifiera (à moins bien sûr de re-exécuter la commande). Exemple :</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="manipulation-de-données-avec-r.html#cb103-1" aria-hidden="true" tabindex="-1"></a>name <span class="ot">&lt;-</span> <span class="st">&quot;Jojo&quot;</span></span>
<span id="cb103-2"><a href="manipulation-de-données-avec-r.html#cb103-2" aria-hidden="true" tabindex="-1"></a>new_object</span></code></pre></div>
<pre><code>## My name is Fred, my age next year is 31, my anniversary is samedi, 12 octobre, 1991.</code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="manipulation-de-données-avec-r.html#cb105-1" aria-hidden="true" tabindex="-1"></a>new_object <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">&#39;My name is {name},&#39;</span>,</span>
<span id="cb105-2"><a href="manipulation-de-données-avec-r.html#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39; my age next year is {age + 1},&#39;</span>,</span>
<span id="cb105-3"><a href="manipulation-de-données-avec-r.html#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39; my anniversary is {format(anniversary, &quot;%A, %d %B, %Y&quot;)}.&#39;</span>)</span>
<span id="cb105-4"><a href="manipulation-de-données-avec-r.html#cb105-4" aria-hidden="true" tabindex="-1"></a>new_object</span></code></pre></div>
<pre><code>## My name is Jojo, my age next year is 31, my anniversary is samedi, 12 octobre, 1991.</code></pre>
</div>
</div>
<div id="les-facteurs" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Les facteurs</h2>
<p>Même s’ils peuvent a priori ressembler à des chaînes de caractères, les <strong>factor</strong> ont un comportement différent. Cette classe d’objet a été créé pour correspondre à une variable qualitative.</p>
<p>On commence par créer un vecteur de chaîne de caractères :</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="manipulation-de-données-avec-r.html#cb107-1" aria-hidden="true" tabindex="-1"></a>genre <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;Ctrl&quot;</span>, <span class="st">&quot;Trait&quot;</span>), <span class="at">size =</span> <span class="dv">10000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Puis, on le transforme en <strong>factor</strong> en utilisant la fonction <em>factor()</em> ou <em>as.factor()</em> :</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="manipulation-de-données-avec-r.html#cb108-1" aria-hidden="true" tabindex="-1"></a>genre_fact <span class="ot">&lt;-</span> <span class="fu">factor</span>(genre)</span></code></pre></div>
<p>Les facteurs ont des modalités pré-définies qui sont retournées avec la fonction <em>levels()</em>. L’affectation d’une valeur différente de ces modalités pré-définies provoque un message d’avertissement et une valeur manquante dans le vecteur :</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="manipulation-de-données-avec-r.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(genre_fact)</span></code></pre></div>
<pre><code>## [1] &quot;Ctrl&quot;  &quot;Trait&quot;</code></pre>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="manipulation-de-données-avec-r.html#cb111-1" aria-hidden="true" tabindex="-1"></a>genre_fact[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Autre&quot;</span></span></code></pre></div>
<pre><code>## Warning in `[&lt;-.factor`(`*tmp*`, 1, value = &quot;Autre&quot;): niveau de facteur
## incorrect, NAs générés</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="manipulation-de-données-avec-r.html#cb113-1" aria-hidden="true" tabindex="-1"></a>genre_fact[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] &lt;NA&gt;
## Levels: Ctrl Trait</code></pre>
<p>ce qui n’est bien entendu pas le cas pour les vecteurs de caractères :</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="manipulation-de-données-avec-r.html#cb115-1" aria-hidden="true" tabindex="-1"></a>genre[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Autre&quot;</span> </span>
<span id="cb115-2"><a href="manipulation-de-données-avec-r.html#cb115-2" aria-hidden="true" tabindex="-1"></a>genre[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] &quot;Autre&quot;</code></pre>
<p>Dans le cas de vecteurs de taille importantes, le stockage d’un <strong>factor</strong> est un peu moins volumineux qu’un objet <strong>character</strong>. Ici, on utilise la fonction <em>object.size()</em> qui indique la taille allouée à un objet en mémoire vive :</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="manipulation-de-données-avec-r.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">object.size</span>(genre)</span></code></pre></div>
<pre><code>## 80216 bytes</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="manipulation-de-données-avec-r.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">object.size</span>(genre_fact)</span></code></pre></div>
<pre><code>## 40560 bytes</code></pre>
<p>L’exemple suivant permet de mieux comprendre qu’un <strong>factor</strong> peut être considéré comme un vecteur de valeurs entières où chaque entier pourrait être remplacé par un <strong>label</strong>. Dans le cas où l’on souhaite associer un <strong>label</strong>, on procède de la façon suivante.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="manipulation-de-données-avec-r.html#cb121-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">size =</span> <span class="dv">20</span>, <span class="at">rep =</span> T)</span>
<span id="cb121-2"><a href="manipulation-de-données-avec-r.html#cb121-2" aria-hidden="true" tabindex="-1"></a>(f_vec <span class="ot">&lt;-</span> <span class="fu">factor</span>(vec, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, </span>
<span id="cb121-3"><a href="manipulation-de-données-avec-r.html#cb121-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Rien&quot;</span>, <span class="st">&quot;Peu&quot;</span>, <span class="st">&quot;Beaucoup&quot;</span>)))</span></code></pre></div>
<pre><code>##  [1] Rien     Rien     Rien     Beaucoup Peu      Peu      Beaucoup Rien    
##  [9] Rien     Beaucoup Beaucoup Beaucoup Beaucoup Rien     Beaucoup &lt;NA&gt;    
## [17] Beaucoup Peu      Rien     Peu     
## Levels: Rien Peu Beaucoup</code></pre>
<p><strong>Remarque :</strong> si on oublie d’associer un <strong>level</strong> à un <strong>label</strong>, cela a pour conséquence de créer une valeur manquante.</p>
<p>La fonction <em>cut()</em> qui permet le recodage d’une variable quantitative en classes, génère un objet de type <strong>factor</strong>. On précise les amplitudes des classes avec l’option <strong>breaks</strong> :</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="manipulation-de-données-avec-r.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb123-2"><a href="manipulation-de-données-avec-r.html#cb123-2" aria-hidden="true" tabindex="-1"></a>mesures <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb123-3"><a href="manipulation-de-données-avec-r.html#cb123-3" aria-hidden="true" tabindex="-1"></a>codage <span class="ot">&lt;-</span> <span class="fu">cut</span>(mesures, <span class="at">breaks =</span> <span class="sc">-</span><span class="dv">4</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb123-4"><a href="manipulation-de-données-avec-r.html#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(codage)</span></code></pre></div>
<pre><code>## codage
## (-4,-3] (-3,-2] (-2,-1]  (-1,0]   (0,1]   (1,2]   (2,3]   (3,4] 
##       0       1      13      34      35      14       3       0</code></pre>
<p>Pour aider à trouver un découpage d’une variable quantitative, la fonction <em>classIntervals()</em> du package <strong>classInt</strong> propose différentes méthodes de discrétisation d’une variable quantitative. Parmi ces méthodes, on compte la méthode basée sur des classes d’amplitudes égales, d’effectifs égaux, ou calculées à partir de l’algorithme des <span class="math inline">\(k\)</span>-means :</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="manipulation-de-données-avec-r.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;classInt&quot;</span>)</span>
<span id="cb125-2"><a href="manipulation-de-données-avec-r.html#cb125-2" aria-hidden="true" tabindex="-1"></a>codage2 <span class="ot">&lt;-</span> <span class="fu">cut</span>(mesures, </span>
<span id="cb125-3"><a href="manipulation-de-données-avec-r.html#cb125-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">classIntervals</span>(mesures, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">style =</span> <span class="st">&quot;kmeans&quot;</span>)<span class="sc">$</span>brks)</span>
<span id="cb125-4"><a href="manipulation-de-données-avec-r.html#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(codage2)</span></code></pre></div>
<pre><code>## codage2
##   (-2.31,-0.874] (-0.874,-0.0726]  (-0.0726,0.614]     (0.614,1.44] 
##               13               31               28               19 
##      (1.44,2.19] 
##                8</code></pre>
<p><strong>Remarque</strong> : les fonctions classiques d’importation des jeux de données codent les variables qualitatives sous forme de <strong>factor</strong>. Cet aspect a été critiqué par certains programmeurs dont Hadley Wickam (nous en verrons les raisons un peu plus tard), qui préconise un codage des variables qualitatives sous forme de <strong>character</strong>. Toutefois, un des avantages de la classe <strong>factor</strong> est que cela permet de représenter les modalités d’une variable qualitative de façon ordonnée, ce qui se révelera très pratique pour représenter des diagramme en barres par exemple..</p>
<p><strong>Exercice 1.5.</strong></p>
<ul>
<li><strong>Q1. Facteur ordonné:</strong>
<ul>
<li>Créer un vecteur de chaîne de caractères <strong>doses</strong> de taille 25, comprenant les valeurs “faible,” “moyenne” ou “forte” (on pourra créer ce vecteur de façon aléatoire).</li>
<li>Convertir cet élément en <strong>f_dose</strong> de type <strong>factor</strong> ordonné (voir si besoin <em>?factor</em>).</li>
<li>Vérifier que les niveaux du facteur sont effectivement ordonnés. Pour cela, il suffit de comparer d’utiliser les opérateurs de comparaison <strong>&lt;</strong> ou <strong>&gt;</strong> sur deux composantes du vecteur.</li>
</ul></li>
<li><strong>Q2. Codage et comptage :</strong> donner un équivalent de l’enchaînement des fonctions <em>cut()</em> et <em>table()</em> utilisées précédemment.</li>
</ul>
</div>
<div id="les-dates" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Les dates</h2>
<div id="dates-et-unités-de-temps" class="section level3" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Dates et unités de temps</h3>
<p>Il existe plusieurs packages pour manipuler des données temporelles ; voir la <a href="http://cran.r-project.org/web/views/TimeSeries.html">Task View Time Series Analysis</a>. Nous nous contentons ici de présenter quelques manipulations élémentaires. Une référence sur le sujet :</p>
<ul>
<li>G. Grothendieck and T. Petzoldt (2004), <strong>R</strong> Help Desk: Date and Time Classes in <strong>R</strong>, <strong>R</strong> News 4(1), 29-32 (<a href="https://www.r-project.org/doc/Rnews/Rnews_2004-1.pdf" class="uri">https://www.r-project.org/doc/Rnews/Rnews_2004-1.pdf</a>).</li>
</ul>
<p>Dans <strong>R</strong>, une façon naturelle de manipuler des dates est d’utiliser la classe d’objet <strong>Date</strong>. Voici l’allure d’un objet de classe <strong>Date</strong> :</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="manipulation-de-données-avec-r.html#cb127-1" aria-hidden="true" tabindex="-1"></a>(format.Date <span class="ot">&lt;-</span> <span class="fu">Sys.Date</span>())</span></code></pre></div>
<pre><code>## [1] &quot;2021-10-15&quot;</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="manipulation-de-données-avec-r.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(format.Date)</span></code></pre></div>
<pre><code>## [1] &quot;Date&quot;</code></pre>
<p>En gros, il s’agit d’une chaîne de caractère de la forme <strong>“YYYY-MM-DD”</strong>, parfois <strong>“YYYY/MM/DD”</strong> ou encore <strong>“MM/DD/YY”</strong>. Pour passer d’une chaîne de caractère à un objet de classe <strong>Date</strong>, il faut donc préciser où sont placés les années, mois et jours dans la chaîne de caractère, préciser si les mois sont des valeurs numériques ou écrit en lettre, etc. Par exemple :</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="manipulation-de-données-avec-r.html#cb131-1" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;01/01/17&quot;</span>, <span class="st">&quot;02/03/17&quot;</span>, <span class="st">&quot;03/05/17&quot;</span>)</span>
<span id="cb131-2"><a href="manipulation-de-données-avec-r.html#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(dates, <span class="st">&quot;%d/%m/%y&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2017-01-01&quot; &quot;2017-03-02&quot; &quot;2017-05-03&quot;</code></pre>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="manipulation-de-données-avec-r.html#cb133-1" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;1 janvier 2017&quot;</span>, <span class="st">&quot;2 mars 2017&quot;</span>, <span class="st">&quot;3 mai 2017&quot;</span>)</span>
<span id="cb133-2"><a href="manipulation-de-données-avec-r.html#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(dates, <span class="st">&quot;%d %B %Y&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2017-01-01&quot; &quot;2017-03-02&quot; &quot;2017-05-03&quot;</code></pre>
<p>Les informations sur la façon dont convertir les chaînes de caractères en objet <strong>Date</strong> sont données dans l’aide suivante :</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="manipulation-de-données-avec-r.html#cb135-1" aria-hidden="true" tabindex="-1"></a>?format.Date</span></code></pre></div>
<p>Une autre classe d’objet utile est la classe <strong>POSIXct/POSIXt</strong>. Le format <strong>POSIXct/POSIXlt</strong> est plus précis que le format <strong>Date</strong> car il mesure à la fois la date et l’heure. Ce format est notamment utilisé dans les séries temporelles d’indices boursiers.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="manipulation-de-données-avec-r.html#cb136-1" aria-hidden="true" tabindex="-1"></a>(format.POSIXlt <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>())</span></code></pre></div>
<pre><code>## [1] &quot;2021-10-15 20:07:36 CEST&quot;</code></pre>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="manipulation-de-données-avec-r.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(format.POSIXlt)</span></code></pre></div>
<pre><code>## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<p>Un certain nombre de fonctions de <strong>R</strong> reconnaissent ce type de format. On en cite ici quelques-unes :</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="manipulation-de-données-avec-r.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">weekdays</span>(format.POSIXlt)</span></code></pre></div>
<pre><code>## [1] &quot;vendredi&quot;</code></pre>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="manipulation-de-données-avec-r.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">months</span>(format.POSIXlt)</span></code></pre></div>
<pre><code>## [1] &quot;octobre&quot;</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="manipulation-de-données-avec-r.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quarters</span>(format.POSIXlt)</span></code></pre></div>
<pre><code>## [1] &quot;Q4&quot;</code></pre>
<p>De même que pour les dates, il est possible de convertir des chaînes de caractères en <strong>POSIXct/POSIXlt</strong> ou de faire l’inverse. Pour cela, il faut respecter la nomenclature des dates (voir l’aide en ligne <em>?strptime</em>). Pour convertir une chaîne de caractères en <strong>POSIXct/POSIXlt</strong> :</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="manipulation-de-données-avec-r.html#cb146-1" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;02/27/92&quot;</span>, <span class="st">&quot;02/27/92&quot;</span>, <span class="st">&quot;01/14/92&quot;</span>, <span class="st">&quot;02/28/92&quot;</span>, <span class="st">&quot;02/01/92&quot;</span>)</span>
<span id="cb146-2"><a href="manipulation-de-données-avec-r.html#cb146-2" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;23:03:20&quot;</span>, <span class="st">&quot;22:29:56&quot;</span>, <span class="st">&quot;01:03:30&quot;</span>, <span class="st">&quot;18:21:03&quot;</span>, <span class="st">&quot;16:56:26&quot;</span>)</span>
<span id="cb146-3"><a href="manipulation-de-données-avec-r.html#cb146-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">paste</span>(dates, times)</span>
<span id="cb146-4"><a href="manipulation-de-données-avec-r.html#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="fu">strptime</span>(x, <span class="st">&quot;%m/%d/%y %H:%M:%S&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1992-02-27 23:03:20 CET&quot; &quot;1992-02-27 22:29:56 CET&quot;
## [3] &quot;1992-01-14 01:03:30 CET&quot; &quot;1992-02-28 18:21:03 CET&quot;
## [5] &quot;1992-02-01 16:56:26 CET&quot;</code></pre>
<p>Pour faire l’inverse (transformer un <strong>POSIXct/POSIXlt</strong> en <strong>character</strong>) :</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="manipulation-de-données-avec-r.html#cb148-1" aria-hidden="true" tabindex="-1"></a>(z <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>())</span></code></pre></div>
<pre><code>## [1] &quot;2021-10-15 20:07:36 CEST&quot;</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="manipulation-de-données-avec-r.html#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span>(z,<span class="st">&quot;%a %d %b %Y %X %Z&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;ven. 15 oct. 2021 20:07:36 CEST&quot;</code></pre>
<p>La fonction <em>system.time()</em> renvoie plusieurs informations concernant le temps de calcul d’une commande :</p>
<ul>
<li><p><em>Utilisateur</em> : il s’agit du temps mis par l’ordinateur pour exécuter directement le code donné par l’utilisateur,</p></li>
<li><p><em>Système</em> : il s’agit du temps utilisé pas directement par le calcul, mais par le système (ex: gestion des entrées/sorties, écriture sur le disque, etc.) lié au code qui doit être exécuté.</p></li>
<li><p><em>écoulé</em> : il s’agit du temps Utilisateur + Système C’est en général ce dernier qui est utilisé pour comparer des temps de calcul.</p></li>
</ul>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="manipulation-de-données-avec-r.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) <span class="fu">var</span>(<span class="fu">runif</span>(<span class="dv">100000</span>)))</span></code></pre></div>
<pre><code>## utilisateur     système      écoulé 
##       0.341       0.031       0.372</code></pre>
<p><strong>Remarque :</strong> il est parfois compliqué de convertir des chaînes de caractères en <strong>Date</strong> ou <strong>POSIXct/POSIXlt</strong>, mais une fois que cela est fait, il est alors possible d’utiliser un nombre conséquent de packages existants, qui permettent en autre la manipulation de séries temporelles.</p>
<p><strong>Exercice 1.6.</strong></p>
<p><strong>Q1</strong> Quel jour (lundi, mardi … ?) sera le 1er janvier de l’année 2022 ?</p>
<p><strong>Q2</strong> Combien de jours nous séparent du 31 décembre de l’année en cours</p>
</div>
<div id="séries-temporelles" class="section level3" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Séries temporelles</h3>
<p>Nous faisons ici un aparte pour évoquer la manipulation de séries temporelles.</p>
<p>On commence par simuler deux séries temporelles issues respectivement d’un processus AR(2) et MA(2). Nous ne rentrerons pas dans le détail de ces modèles mais le lecteur pourra se référer à l’ouvrage d’Yves Aragon “Séries temporelles avec <strong>R</strong>” pour une introduction. On utilise la fonction <em>set.seed()</em> avant chaque simulation, ce qui va nous permettre de générer la même séquence dès lors qu’on utilisera les mêmes entiers comme argument de la fonction (493 et 494 ici).</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="manipulation-de-données-avec-r.html#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">493</span>)</span>
<span id="cb154-2"><a href="manipulation-de-données-avec-r.html#cb154-2" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="at">model =</span> <span class="fu">list</span>(<span class="at">ar =</span> <span class="fu">c</span>(.<span class="dv">9</span>, <span class="sc">-</span>.<span class="dv">2</span>)), <span class="at">n =</span> <span class="dv">100</span>)</span>
<span id="cb154-3"><a href="manipulation-de-données-avec-r.html#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">494</span>)</span>
<span id="cb154-4"><a href="manipulation-de-données-avec-r.html#cb154-4" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="at">model =</span> <span class="fu">list</span>(<span class="at">ma =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">7</span>, .<span class="dv">1</span>)), <span class="at">n =</span> <span class="dv">100</span>)</span></code></pre></div>
<p>Le principe d’une série temporelle est que les observations sont associées à une date et dans certains cas une date et un temps (indices boursiers observés en temps réel). Pour faire simple, on va associer la série à des dates journalières commencant le 1er octobre 2017 et de taille 100. Une façon de faire est d’utiliser la fonction <em>seq.Date()</em> :</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="manipulation-de-données-avec-r.html#cb155-1" aria-hidden="true" tabindex="-1"></a>date_x <span class="ot">&lt;-</span> <span class="fu">seq.Date</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2017-10-01&quot;</span>), <span class="at">by =</span> <span class="st">&quot;day&quot;</span>, <span class="at">len =</span> <span class="dv">100</span>)</span></code></pre></div>
<p>Ensuite, on utilise la fonction <em>zoo()</em> du package qui porte le même nom pour associer les séries aux dates précédemment créées :</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="manipulation-de-données-avec-r.html#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;zoo&quot;</span>)</span>
<span id="cb156-2"><a href="manipulation-de-données-avec-r.html#cb156-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">zoo</span>(<span class="fu">cbind</span>(x1, x2), date_x)</span></code></pre></div>
<p>L’objet précédemment créé peut ensuite être appliqué aux fonctions du package <strong>zoo</strong>. Ainsi, en appliquant la fonction <em>plot()</em> à un tel objet, cela a pour avantage d’afficher en abscisses les dates, d’afficher plusieurs courbes s’il s’agit de séries temporelles multidimensionnelles, etc. On pourra consulter les fonctions du package <strong>zoo</strong> pour plus d’informations (<em>help(package=“zoo”)</em>)</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="manipulation-de-données-avec-r.html#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb157-2"><a href="manipulation-de-données-avec-r.html#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="at">screens =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
<p><strong>Remarque :</strong> l’option <strong>las = 1</strong> dans la fonction <em>par()</em> permet d’afficher la légende de l’axe des ordonnées horizontalement. L’options <strong>screens = 1</strong> permet de représenter les deux séries dans la meme figure.</p>
</div>
</div>
<div id="opérations-ensemblistes" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Opérations ensemblistes</h2>
<p>On définit deux vecteurs <span class="math inline">\(A\)</span> et <span class="math inline">\(B\)</span> d’entiers.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="manipulation-de-données-avec-r.html#cb158-1" aria-hidden="true" tabindex="-1"></a>(A <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="manipulation-de-données-avec-r.html#cb160-1" aria-hidden="true" tabindex="-1"></a>(B <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">12</span>, <span class="dv">15</span>, <span class="dv">18</span>))</span></code></pre></div>
<pre><code>## [1]  3  4  5  6 12 15 18</code></pre>
<p>Les opérations ensemblistes classiques sont :</p>
<div id="lunion" class="section level3" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> L’union</h3>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="manipulation-de-données-avec-r.html#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">union</span>(A, B)</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10 12 15 18</code></pre>
<p>équivalent à la syntaxe suivante écrite avec des fonctions de base:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="manipulation-de-données-avec-r.html#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">c</span>(A, B))</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10 12 15 18</code></pre>
</div>
<div id="lintersection" class="section level3" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> L’intersection</h3>
<ul>
<li>fonction <em>intersect()</em></li>
</ul>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="manipulation-de-données-avec-r.html#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">intersect</span>(A, B)</span></code></pre></div>
<pre><code>## [1] 3 4 5 6</code></pre>
<p>équivalent à la syntaxe suivante écrite avec des fonctions de base:</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="manipulation-de-données-avec-r.html#cb168-1" aria-hidden="true" tabindex="-1"></a>A[A <span class="sc">%in%</span> B]</span></code></pre></div>
<pre><code>## [1] 3 4 5 6</code></pre>
<ul>
<li>fonction <em>match()</em></li>
</ul>
<p>Ici, il nous semble important de parler de la fonction <em>match()</em> qui a été utilisée pour coder la fonction <em>intersect()</em>. Dans le code ci-dessous, elle retourne pour chaque élément de <strong>A</strong> s’il se trouve dans <strong>B</strong> et si oui à quelle position dans <strong>B</strong>. Ci-dessous, le 3ème élement de <strong>A</strong> est bien dans <strong>B</strong> et il se situe à la 1ère position de <strong>B</strong>.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="manipulation-de-données-avec-r.html#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">match</span>(A, B)</span></code></pre></div>
<pre><code>##  [1] NA NA  1  2  3  4 NA NA NA NA</code></pre>
<p>Il est important de rappeler que l’opérateur <strong>%in%</strong> fait appel à la fonction <em>match()</em>. Pour afficher le code de la fonction <strong>%in%</strong>, on peut utiliser la syntaxe suivante:</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="manipulation-de-données-avec-r.html#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%in%</span><span class="st">`</span></span></code></pre></div>
<pre><code>## function (x, table) 
## match(x, table, nomatch = 0L) &gt; 0L
## &lt;bytecode: 0x561746bf3548&gt;
## &lt;environment: namespace:base&gt;</code></pre>
</div>
<div id="la-différence-a-b-différent-de-b-a" class="section level3" number="2.4.3">
<h3><span class="header-section-number">2.4.3</span> La différence (<span class="math inline">\(A-B\)</span>, différent de <span class="math inline">\(B-A\)</span>)</h3>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="manipulation-de-données-avec-r.html#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(A, B)</span></code></pre></div>
<pre><code>## [1]  1  2  7  8  9 10</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="manipulation-de-données-avec-r.html#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(B, A)</span></code></pre></div>
<pre><code>## [1] 12 15 18</code></pre>
<p>Pour savoir si un ou plusieurs éléments sont contenus dans un ensemble :</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="manipulation-de-données-avec-r.html#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.element</span>(<span class="dv">2</span>, A)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="manipulation-de-données-avec-r.html#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.element</span>(<span class="dv">2</span>, B)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="manipulation-de-données-avec-r.html#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.element</span>(A, B)</span></code></pre></div>
<pre><code>##  [1] FALSE FALSE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="manipulation-de-données-avec-r.html#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.element</span>(B, A)</span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE</code></pre>
<p><strong>Attention :</strong> on utilise ces fonctions sur des objets de même classe. Si on fait l’union d’un vecteur d’entiers avec un vecteur de caractères, le vecteur d’entiers sera transformé en caractères. Par exemple :</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="manipulation-de-données-avec-r.html#cb186-1" aria-hidden="true" tabindex="-1"></a>let <span class="ot">&lt;-</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb186-2"><a href="manipulation-de-données-avec-r.html#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="fu">union</span>(A, let)</span></code></pre></div>
<pre><code>##  [1] &quot;1&quot;  &quot;2&quot;  &quot;3&quot;  &quot;4&quot;  &quot;5&quot;  &quot;6&quot;  &quot;7&quot;  &quot;8&quot;  &quot;9&quot;  &quot;10&quot; &quot;a&quot;  &quot;b&quot;  &quot;c&quot;  &quot;d&quot;  &quot;e&quot; 
## [16] &quot;f&quot;  &quot;g&quot;  &quot;h&quot;  &quot;i&quot;  &quot;j&quot;</code></pre>
<p>Il est donc possible de faire des opérations ensemblistes sur les chaînes de caractères.</p>
<p><strong>Exercice 1.7.</strong></p>
<p><strong>Q1 :</strong> donner une notation équivalente à <em>is.element(2, A)</em>.</p>
<p><strong>Q2 :</strong> l’objet <strong>letters</strong> est un vecteur de longueur 26 qui contient les lettres de l’alphabet. Tester l’appartenance des lettres <strong>k</strong> et <strong>m</strong> à l’alphabet ; que renvoie la syntaxe “réciproque” (appartenance de l’alphabet à l’ensemble <em>c(“k,” “m”)</em>) ? Comment obtenir le rang des lettres <strong>k</strong> et <strong>m</strong> dans l’alphabet ?</p>
<p><strong>Q3 :</strong> en plus des 2 vecteurs <strong>A</strong> et <strong>B</strong> définis précédemment, considérons le vecteur <strong>E</strong> (nous évitons la lettre <strong>C</strong> qui existe déjà dans <strong>R</strong>, voir <em>help(C)</em>) suivant :</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="manipulation-de-données-avec-r.html#cb188-1" aria-hidden="true" tabindex="-1"></a>E <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">18</span>, <span class="dv">1</span>, <span class="dv">9</span>, <span class="dv">14</span>, <span class="dv">12</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">19</span>)</span></code></pre></div>
<p>Donner l’enchaînement des commandes qui permettent de retrouver les valeurs disposées sur le diagramme de Venn ci-dessous (obtenu avec la fonction <em>venn()</em> du package <strong>gplots</strong>).</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="manipulation-de-données-avec-r.html#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;gplots&quot;</span>)</span>
<span id="cb189-2"><a href="manipulation-de-données-avec-r.html#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="fu">venn</span>(<span class="fu">list</span>(<span class="at">A =</span> A, <span class="at">B =</span> B, <span class="at">E =</span> E))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-79-1.png" width="672" /></p>
</div>
</div>
<div id="manipulation-de-bases-de-données" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Manipulation de bases de données</h2>
<div id="jointure-et-agrégation" class="section level3" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> Jointure et agrégation</h3>
<p>On considère une table <strong>patient</strong> qui contient des informations sur les patients et une table <strong>visite</strong> qui contient des informations sur les visites. La clé de référence est le nom du patient dont la variable ne porte pas le même nom dans les deux tables.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="manipulation-de-données-avec-r.html#cb190-1" aria-hidden="true" tabindex="-1"></a>patient <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb190-2"><a href="manipulation-de-données-avec-r.html#cb190-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">nom.famille =</span> <span class="fu">c</span>(<span class="st">&quot;René&quot;</span>, <span class="st">&quot;Jean&quot;</span>, <span class="st">&quot;Ginette&quot;</span>, <span class="st">&quot;Joseph&quot;</span>),</span>
<span id="cb190-3"><a href="manipulation-de-données-avec-r.html#cb190-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">ddn =</span> <span class="fu">c</span>(<span class="st">&quot;02/02/1925&quot;</span>, <span class="st">&quot;03/03/1952&quot;</span>, <span class="st">&quot;01/10/1992&quot;</span>, <span class="st">&quot;02/02/1920&quot;</span>),</span>
<span id="cb190-4"><a href="manipulation-de-données-avec-r.html#cb190-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">sexe =</span> <span class="fu">c</span>(<span class="st">&quot;m&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;m&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="manipulation-de-données-avec-r.html#cb191-1" aria-hidden="true" tabindex="-1"></a>visite <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb191-2"><a href="manipulation-de-données-avec-r.html#cb191-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">nom =</span> <span class="fu">c</span>(<span class="st">&quot;René&quot;</span>, <span class="st">&quot;Jean&quot;</span>, <span class="st">&quot;René&quot;</span>, <span class="st">&quot;Simone&quot;</span>, <span class="st">&quot;Ginette&quot;</span>),</span>
<span id="cb191-3"><a href="manipulation-de-données-avec-r.html#cb191-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">ddv =</span> <span class="fu">c</span>(<span class="st">&quot;01/01/2020&quot;</span>, <span class="st">&quot;10/12/2020&quot;</span>, <span class="st">&quot;05/01/2020&quot;</span>, <span class="st">&quot;04/12/2020&quot;</span>, <span class="st">&quot;05/10/2020&quot;</span>))</span></code></pre></div>
<p><strong>Problématique :</strong> on souhaite avoir une table contenant l’âge du patient au moment de sa visite. Pour cela, on voit bien qu’il faut connaître la date de naissance du patient au moment de sa visite. L’idée est donc d’ajouter une colonne “ddn” à la table visite pour pouvoir ensuite calculer l’âge en faisant la différence entre la date de visite et la date naissance.</p>
<div id="jointure-sans-utiliser-la-fonction-merge" class="section level4" number="2.5.1.1">
<h4><span class="header-section-number">2.5.1.1</span> Jointure sans utiliser la fonction <em>merge()</em></h4>
<p>Dans un premier temps, nous allons essayer de répondre au problème sans utiliser la fonction <em>merge()</em>. Pour cela, nous allons utiliser la fonction <em>match()</em> vue précédemment. Elle va nous permettre de savoir où se trouvent dans la table <strong>patient</strong>, les patients qui ont eu des visites. Une fois les indices connus, on a plus qu’à sélectionner les dates de naissance des patients.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="manipulation-de-données-avec-r.html#cb192-1" aria-hidden="true" tabindex="-1"></a>visite<span class="sc">$</span>ddn <span class="ot">&lt;-</span> patient<span class="sc">$</span>ddn[<span class="fu">match</span>(visite<span class="sc">$</span>nom, patient<span class="sc">$</span>nom.famille)]</span></code></pre></div>
<p>Ensuite, on calcule l’âge du patient :</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="manipulation-de-données-avec-r.html#cb193-1" aria-hidden="true" tabindex="-1"></a>visite<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(<span class="fu">as.Date</span>(visite<span class="sc">$</span>ddv, <span class="at">format =</span> <span class="st">&quot;%d/%m/%Y&quot;</span>) <span class="sc">-</span> </span>
<span id="cb193-2"><a href="manipulation-de-données-avec-r.html#cb193-2" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">as.Date</span>(visite<span class="sc">$</span>ddn, <span class="at">format =</span> <span class="st">&quot;%d/%m/%Y&quot;</span>))<span class="sc">/</span><span class="dv">365</span>,</span>
<span id="cb193-3"><a href="manipulation-de-données-avec-r.html#cb193-3" aria-hidden="true" tabindex="-1"></a>                    <span class="dv">0</span>)</span></code></pre></div>
<p>Enfin, on efface la date de naissance qui ne nous intéresse pas ici :</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="manipulation-de-données-avec-r.html#cb194-1" aria-hidden="true" tabindex="-1"></a>visite<span class="sc">$</span>ddn <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb194-2"><a href="manipulation-de-données-avec-r.html#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(visite)</span></code></pre></div>
<pre><code>##       nom        ddv age
## 1    René 01/01/2020  95
## 2    Jean 10/12/2020  69
## 3    René 05/01/2020  95
## 4  Simone 04/12/2020  NA
## 5 Ginette 05/10/2020  28</code></pre>
<p>Pour la suite, on remet à jour la table <strong>visite</strong> :</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="manipulation-de-données-avec-r.html#cb196-1" aria-hidden="true" tabindex="-1"></a>visite<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
</div>
<div id="jointure-en-utilisant-la-fonction-merge" class="section level4" number="2.5.1.2">
<h4><span class="header-section-number">2.5.1.2</span> Jointure en utilisant la fonction <em>merge()</em></h4>
<p>A présent, nous allons utiliser la fonction <em>merge()</em> qui permet de réaliser la jointure entre deux tables. Il est essentiel de préciser la clé de référence des deux tables avec l’option <strong>by=</strong> si les deux tables ont un nom de clé identique ou alors <strong>by.x=</strong> et <strong>by.y=</strong> si la clé de référence porte un nom différent selon la table.</p>
<p>Dans la première commande, le merge se fait sur les variables qui sont présentes dans les deux tables. Autrement dit, l’individu “Simone” n’est pas présente dans la nouvelle table compte tenu qu’elle n’est pas identifiée parmi les patients.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="manipulation-de-données-avec-r.html#cb197-1" aria-hidden="true" tabindex="-1"></a>visite<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb197-2"><a href="manipulation-de-données-avec-r.html#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(visite, patient, <span class="at">by.x =</span> <span class="st">&quot;nom&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;nom.famille&quot;</span>)</span></code></pre></div>
<pre><code>##       nom        ddv        ddn sexe
## 1 Ginette 05/10/2020 01/10/1992    f
## 2    Jean 10/12/2020 03/03/1952    m
## 3    René 01/01/2020 02/02/1925    m
## 4    René 05/01/2020 02/02/1925    m</code></pre>
<p>Si on souhaite garder toute l’information contenue dans le fichier visite, on ajoute l’option <strong>all.x=TRUE</strong>. Autrement dit, on affiche ici toutes les visites, y compris celles des personnes qui ne sont bas dans la table <strong>patient</strong>. On remarquera que Simone apparaît en queue de table :</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="manipulation-de-données-avec-r.html#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(visite, patient, <span class="at">by.x =</span> <span class="st">&quot;nom&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;nom.famille&quot;</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##       nom        ddv        ddn sexe
## 1 Ginette 05/10/2020 01/10/1992    f
## 2    Jean 10/12/2020 03/03/1952    m
## 3    René 01/01/2020 02/02/1925    m
## 4    René 05/01/2020 02/02/1925    m
## 5  Simone 04/12/2020       &lt;NA&gt; &lt;NA&gt;</code></pre>
<p>Enfin, si on souhaite conserver l’information dans les deux tables, on utilise <strong>all.x=TRUE</strong> et <strong>all.y=TRUE</strong> :</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="manipulation-de-données-avec-r.html#cb201-1" aria-hidden="true" tabindex="-1"></a>(visite.patient <span class="ot">&lt;-</span> <span class="fu">merge</span>(visite, patient, <span class="at">by.x =</span> <span class="st">&quot;nom&quot;</span>,</span>
<span id="cb201-2"><a href="manipulation-de-données-avec-r.html#cb201-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">by.y =</span> <span class="st">&quot;nom.famille&quot;</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>, <span class="at">all.y =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>##       nom        ddv        ddn sexe
## 1 Ginette 05/10/2020 01/10/1992    f
## 2    Jean 10/12/2020 03/03/1952    m
## 3  Joseph       &lt;NA&gt; 02/02/1920    m
## 4    René 01/01/2020 02/02/1925    m
## 5    René 05/01/2020 02/02/1925    m
## 6  Simone 04/12/2020       &lt;NA&gt; &lt;NA&gt;</code></pre>
<p>Pour calculer l’âge du patient au moment de la visite, on utilise la commande vue précédemment :</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="manipulation-de-données-avec-r.html#cb203-1" aria-hidden="true" tabindex="-1"></a>visite.patient<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(<span class="fu">as.Date</span>(visite.patient<span class="sc">$</span>ddv, </span>
<span id="cb203-2"><a href="manipulation-de-données-avec-r.html#cb203-2" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">format =</span> <span class="st">&quot;%d/%m/%Y&quot;</span>) <span class="sc">-</span> </span>
<span id="cb203-3"><a href="manipulation-de-données-avec-r.html#cb203-3" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">as.Date</span>(visite.patient<span class="sc">$</span>ddn, </span>
<span id="cb203-4"><a href="manipulation-de-données-avec-r.html#cb203-4" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">format =</span> <span class="st">&quot;%d/%m/%Y&quot;</span>))<span class="sc">/</span><span class="dv">365</span>, </span>
<span id="cb203-5"><a href="manipulation-de-données-avec-r.html#cb203-5" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">0</span>)</span></code></pre></div>
<p>Maintenant, on souhaite connaître l’âge des patients lors de leurs visites en fonction du sexe. On va donc faire une aggrégation.</p>
</div>
<div id="aggrégation" class="section level4" number="2.5.1.3">
<h4><span class="header-section-number">2.5.1.3</span> Aggrégation</h4>
<p>Pour faire l’agrégation, on utilise la fonction <em>tapply()</em> pour aggréger une variable ou <em>aggregate()</em> pour plusieurs variables. Le principe de ces finctions est le suivant :</p>
<ul>
<li><ol style="list-style-type: decimal">
<li>utiliser <em>split()</em> sur l’échantillon total pour découper en sous-échantillons selon la variable utilisée pour faire l’aggrégation:</li>
</ol></li>
</ul>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="manipulation-de-données-avec-r.html#cb204-1" aria-hidden="true" tabindex="-1"></a>my_split <span class="ot">&lt;-</span> <span class="fu">split</span>(<span class="at">x =</span> visite.patient<span class="sc">$</span>age, <span class="at">f =</span> visite.patient<span class="sc">$</span>sexe)</span></code></pre></div>
<ul>
<li><ol start="2" style="list-style-type: decimal">
<li>utiliser <em>lapply()</em> ou <em>sapply()</em> pour calculer des statistiques sur chaque sous-échantillon</li>
</ol></li>
</ul>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="manipulation-de-données-avec-r.html#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(my_split, <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> T)</span></code></pre></div>
<pre><code>##        f        m 
## 28.00000 86.33333</code></pre>
<p>En utilisant la fonction <em>tapply()</em>, les deux étapes précédentes sont réalisées à la suite :</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="manipulation-de-données-avec-r.html#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(<span class="at">X =</span> visite.patient<span class="sc">$</span>age, <span class="at">INDEX =</span> <span class="fu">list</span>(<span class="at">sexe =</span> visite.patient<span class="sc">$</span>sexe),</span>
<span id="cb207-2"><a href="manipulation-de-données-avec-r.html#cb207-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> T)</span></code></pre></div>
<pre><code>## sexe
##        f        m 
## 28.00000 86.33333</code></pre>
<p>Si on utilise la fonction <em>aggregate()</em>, la variable qui permet d’aggréger doit être mise sous forme d’une liste dans l’option <strong>by=</strong>. L’option <strong>FUN=</strong> renseigne s’il s’agit de faire une somme, une moyenne, etc. Dans notre cas :</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="manipulation-de-données-avec-r.html#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(visite.patient<span class="sc">$</span>age, <span class="at">by =</span> <span class="fu">list</span>(<span class="at">S =</span> visite.patient<span class="sc">$</span>sexe),</span>
<span id="cb209-2"><a href="manipulation-de-données-avec-r.html#cb209-2" aria-hidden="true" tabindex="-1"></a> <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) </span></code></pre></div>
<pre><code>##   S        x
## 1 f 28.00000
## 2 m 86.33333</code></pre>
<p><strong>Exercice 1.8.</strong></p>
<p><strong>Q1</strong> à partir du jeu de données <strong>iris</strong> (disponible par défaut dans l’environnement courant), construire l’objet <strong>iris1</strong> qui contient en fonction des espèces (variable <strong>Species</strong>), la taille moyenne de la variable <strong>Petal.Length</strong>.</p>
<p><strong>Q2</strong> Construire l’objet <strong>iris2</strong> qui contient en fonction des espèces,
la taille totale de la variable <strong>Petal.Width</strong>.</p>
<p><strong>Q3</strong> Faire le merge des jeux de données <strong>iris1</strong> et <strong>iris2</strong>.</p>
</div>
</div>
<div id="package-dplyr" class="section level3" number="2.5.2">
<h3><span class="header-section-number">2.5.2</span> Package <strong>dplyr</strong></h3>
<p>Ce document est inspiré d’une présentation de Sophie Lamarre aux rencontres des Ingénieurs statisticiens de Toulouse, disponible
sur ce <a href="http://www.thibault.laurent.free.fr/presentation%20inge_stat/presentation%2006-10-15/dplyr_Inge_stats_SL_02102015.pdf">lien</a>. On recommande aussi la lecture de la vignette du package, disponible sur le site du CRAN :
<a href="https://cran.r-project.org/web/packages/dplyr/vignettes/dplyr.html" class="uri">https://cran.r-project.org/web/packages/dplyr/vignettes/dplyr.html</a></p>
<p>Ce package est de plus en plus utilisé dans la manipulation de jeu de données, notamment parmi les “Data Scientists.” Son principe est de simplifier la syntaxe des fonctions de base de <strong>R</strong> et d’utiliser du code <strong>C++</strong> derrière certaines de ses fonctions dans le but d’améliorer sensiblement les temps de calcul. Il fait partie du projet <a href="https://www.tidyverse.org/">Tidyverse</a> qui contient un ensemble de packages, développés en grande partie par <strong>RStudio</strong>. Avec la commande suivante, vous chargez un ensemble de packages dont certains très populaires (<strong>ggplot2</strong>, <strong>dplyr</strong>, etc.)</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="manipulation-de-données-avec-r.html#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;tidyverse&quot;</span>)</span></code></pre></div>
<pre><code>## Le chargement a nécessité le package : tidyverse</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.3     ✓ purrr   0.3.4
## ✓ tibble  3.1.2     ✓ dplyr   1.0.6
## ✓ tidyr   1.1.3     ✓ forcats 0.5.1
## ✓ readr   1.4.0</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::collapse() masks glue::collapse()
## x dplyr::filter()   masks stats::filter()
## x dplyr::lag()      masks stats::lag()</code></pre>
<p>Description du jeu de données utilisées : il s’agit du jeu de données <strong>diamonds</strong> du package <strong>ggplot2</strong>. On observe sur un peu plus de 50000 diamants, un certain nombre de variables dont : le prix de vente, le poids, la qualité, la couleur, etc.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="manipulation-de-données-avec-r.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(diamonds)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 10
##   carat cut       color clarity depth table price     x     y     z
##   &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  0.23 Ideal     E     SI2      61.5    55   326  3.95  3.98  2.43
## 2  0.21 Premium   E     SI1      59.8    61   326  3.89  3.84  2.31
## 3  0.23 Good      E     VS1      56.9    65   327  4.05  4.07  2.31
## 4  0.29 Premium   I     VS2      62.4    58   334  4.2   4.23  2.63
## 5  0.31 Good      J     SI2      63.3    58   335  4.34  4.35  2.75
## 6  0.24 Very Good J     VVS2     62.8    57   336  3.94  3.96  2.48</code></pre>
<p>Voici le résumé statistique des variables :</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="manipulation-de-données-avec-r.html#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(diamonds)</span></code></pre></div>
<pre><code>##      carat               cut        color        clarity          depth      
##  Min.   :0.2000   Fair     : 1610   D: 6775   SI1    :13065   Min.   :43.00  
##  1st Qu.:0.4000   Good     : 4906   E: 9797   VS2    :12258   1st Qu.:61.00  
##  Median :0.7000   Very Good:12082   F: 9542   SI2    : 9194   Median :61.80  
##  Mean   :0.7979   Premium  :13791   G:11292   VS1    : 8171   Mean   :61.75  
##  3rd Qu.:1.0400   Ideal    :21551   H: 8304   VVS2   : 5066   3rd Qu.:62.50  
##  Max.   :5.0100                     I: 5422   VVS1   : 3655   Max.   :79.00  
##                                     J: 2808   (Other): 2531                  
##      table           price             x                y         
##  Min.   :43.00   Min.   :  326   Min.   : 0.000   Min.   : 0.000  
##  1st Qu.:56.00   1st Qu.:  950   1st Qu.: 4.710   1st Qu.: 4.720  
##  Median :57.00   Median : 2401   Median : 5.700   Median : 5.710  
##  Mean   :57.46   Mean   : 3933   Mean   : 5.731   Mean   : 5.735  
##  3rd Qu.:59.00   3rd Qu.: 5324   3rd Qu.: 6.540   3rd Qu.: 6.540  
##  Max.   :95.00   Max.   :18823   Max.   :10.740   Max.   :58.900  
##                                                                   
##        z         
##  Min.   : 0.000  
##  1st Qu.: 2.910  
##  Median : 3.530  
##  Mean   : 3.539  
##  3rd Qu.: 4.040  
##  Max.   :31.800  
## </code></pre>
<p><strong>Remarque :</strong> le jeu de données <strong>diamonds</strong> est dans un format de données nouveau : <strong>tibble</strong>. Il s’agit encore une fois d’une nouveauté proposée par <strong>RStudio</strong>. L’objet de classe <strong>data.frame</strong> peut présenter certaines contraintes pour ses utilisateurs. Par exemple, lorsque’on souhaite afficher un <strong>data.frame</strong> dans la console, <strong>R</strong> affiche autant de lignes qu’il le peut. D’autre part, avec un <strong>data.frame</strong>, certains noms de variables ne sont pas autorisés. Par exemple, dans un <strong>data.frame</strong> un nom de variable ne peut pas commencer par un chiffre ce qui n’est pas le cas avec le <strong>tibble</strong> :</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="manipulation-de-données-avec-r.html#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="st">`</span><span class="at">1a</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb220-2"><a href="manipulation-de-données-avec-r.html#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="st">`</span><span class="at">1a</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div>
<p>C’est pourquoi des développeurs ont pensé à créer un nouveau type d’objets, le <strong>tibble</strong> qui ne présenterait pas ce genre de contraintes. Ce n’est pas une grande révolution, mais ce package faisant partie du projet <strong>tidyverse</strong>, c’est essentiellement ce type de données qui est utilisé dans cet univers. Les fonctions que nous allons présenter dans cette section s’appliquent aussi bien sur des <strong>data.frame</strong> que sur des <strong>tibble</strong>, ce dernier type d’objet ayant hérité des propriétés des <strong>data.frame</strong>. Pour en savoir plus sur les <strong>tibbles</strong>, vous pouvez consulter ce cours en ligne : <a href="http://r4ds.had.co.nz/tibbles.html" class="uri">http://r4ds.had.co.nz/tibbles.html</a>.</p>
<div id="sélection-de-lignes-avec-la-fonction-filter" class="section level4" number="2.5.2.1">
<h4><span class="header-section-number">2.5.2.1</span> Sélection de lignes avec la fonction <em>filter()</em></h4>
<p>La fonction “phare” du package <strong>dplyr</strong> est la fonction <em>filter()</em> qui permet de sélectionner un sous-échantillon du jeu de données à partir de critères qu’on lui donne. Par exemple, pour sélectionner uniquement les diamants d’une valeur supérieure à 15000 dollars et ayant une couleur <strong>E</strong> ou <strong>F</strong>, on écrit :</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="manipulation-de-données-avec-r.html#cb221-1" aria-hidden="true" tabindex="-1"></a>filtrage1 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(diamonds, price <span class="sc">&gt;</span> <span class="dv">15000</span> <span class="sc">&amp;</span> (color <span class="sc">==</span> <span class="st">&quot;E&quot;</span> <span class="sc">|</span> color <span class="sc">==</span> <span class="st">&quot;F&quot;</span>))</span></code></pre></div>
<p>Ou de façon équivalente (les virgules remplaçant la condition <strong>et</strong>) :</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="manipulation-de-données-avec-r.html#cb222-1" aria-hidden="true" tabindex="-1"></a>filtrage1 <span class="ot">&lt;-</span> <span class="fu">filter</span>(diamonds, price <span class="sc">&gt;</span> <span class="dv">15000</span>, (color <span class="sc">==</span> <span class="st">&quot;E&quot;</span> <span class="sc">|</span> color <span class="sc">==</span> <span class="st">&quot;F&quot;</span>))</span>
<span id="cb222-2"><a href="manipulation-de-données-avec-r.html#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(filtrage1, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 10
##   carat cut       color clarity depth table price     x     y     z
##   &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  1.54 Premium   E     VS2      62.3    58 15002  7.31  7.39  4.58
## 2  1.19 Ideal     F     VVS1     61.5    55 15005  6.82  6.84  4.2 
## 3  2.05 Very Good F     SI2      61.9    56 15017  8.13  8.18  5.05</code></pre>
<p>Une nouveauté est également l’utilisation de l’opérteur %&gt;% dit ‘pipe’ en anglais. Il se trouve après un <strong>data.frame</strong> et indique qu’on va utiliser une fonction dont le premier argument est un objet de type <strong>data.frame</strong>. Dans ce cas, ce n’est plus la peine d’indiquer le premier argument de la fonction <em>filter()</em>. Nous verrons par la suite son intérêt lorsqu’on souhaite appliquer successivement des commandes.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="manipulation-de-données-avec-r.html#cb224-1" aria-hidden="true" tabindex="-1"></a>filtrage1 <span class="ot">&lt;-</span> diamonds <span class="sc">%&gt;%</span> </span>
<span id="cb224-2"><a href="manipulation-de-données-avec-r.html#cb224-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(price <span class="sc">&gt;</span> <span class="dv">15000</span>, (color <span class="sc">==</span> <span class="st">&quot;E&quot;</span> <span class="sc">|</span> color <span class="sc">==</span> <span class="st">&quot;F&quot;</span>))</span>
<span id="cb224-3"><a href="manipulation-de-données-avec-r.html#cb224-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(filtrage1, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 10
##   carat cut       color clarity depth table price     x     y     z
##   &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  1.54 Premium   E     VS2      62.3    58 15002  7.31  7.39  4.58
## 2  1.19 Ideal     F     VVS1     61.5    55 15005  6.82  6.84  4.2 
## 3  2.05 Very Good F     SI2      61.9    56 15017  8.13  8.18  5.05</code></pre>
<p><strong>Remarque:</strong> sans utiliser le package <strong>dplyr</strong>, on aurait du faire quelque chose comme ça :</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="manipulation-de-données-avec-r.html#cb226-1" aria-hidden="true" tabindex="-1"></a>filtrage1 <span class="ot">&lt;-</span> <span class="fu">with</span>(diamonds, diamonds[price <span class="sc">&gt;</span> <span class="dv">15000</span> <span class="sc">&amp;</span> </span>
<span id="cb226-2"><a href="manipulation-de-données-avec-r.html#cb226-2" aria-hidden="true" tabindex="-1"></a>                                       (color <span class="sc">==</span> <span class="st">&quot;E&quot;</span> <span class="sc">|</span> color <span class="sc">==</span> <span class="st">&quot;F&quot;</span>), ])</span></code></pre></div>
<p>On aurait également pu utiliser la fonction de base <em>subset()</em>dont le package <strong>dplyr</strong> s’est fortement inspiré.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="manipulation-de-données-avec-r.html#cb227-1" aria-hidden="true" tabindex="-1"></a>filtrage1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(diamonds, price <span class="sc">&gt;</span> <span class="dv">15000</span> <span class="sc">&amp;</span> (color <span class="sc">==</span> <span class="st">&quot;E&quot;</span> <span class="sc">|</span> color <span class="sc">==</span> <span class="st">&quot;F&quot;</span>))</span></code></pre></div>
</div>
<div id="trier-le-jeu-de-données-avec-la-fonction-arrange" class="section level4" number="2.5.2.2">
<h4><span class="header-section-number">2.5.2.2</span> Trier le jeu de données avec la fonction <em>arrange()</em></h4>
<p>On souhaite trier le jeu de données en fonction de la coupe, de la couleur et du prix (en valeur décroissante). Pour cela, on fait :</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="manipulation-de-données-avec-r.html#cb228-1" aria-hidden="true" tabindex="-1"></a>tri1 <span class="ot">&lt;-</span> <span class="fu">arrange</span>(diamonds, cut, color, <span class="fu">desc</span>(price))</span>
<span id="cb228-2"><a href="manipulation-de-données-avec-r.html#cb228-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tri1,<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 10
##   carat cut   color clarity depth table price     x     y     z
##   &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  2.02 Fair  D     SI1      65      55 16386  7.94  7.84  5.13
## 2  2.01 Fair  D     SI2      66.9    57 16086  7.87  7.76  5.23
## 3  3.4  Fair  D     I1       66.8    52 15964  9.42  9.34  6.27</code></pre>
<p>Sans le package <strong>dplyr</strong>, on aurait fait :</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="manipulation-de-données-avec-r.html#cb230-1" aria-hidden="true" tabindex="-1"></a>tri1 <span class="ot">&lt;-</span> <span class="fu">with</span>(diamonds, diamonds[<span class="fu">order</span>(cut, color, <span class="sc">-</span>price),])</span></code></pre></div>
</div>
<div id="sélectionner-certaines-variables-avec-la-fonction-select" class="section level4" number="2.5.2.3">
<h4><span class="header-section-number">2.5.2.3</span> Sélectionner certaines variables avec la fonction <em>select()</em></h4>
<p>On ne souhaite garder que les variables <strong>carat</strong>, <strong>price</strong>, <strong>color</strong>, <strong>z</strong> et les variables dont le label contient le caractères <strong>i</strong> :</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="manipulation-de-données-avec-r.html#cb231-1" aria-hidden="true" tabindex="-1"></a>selection1 <span class="ot">&lt;-</span> <span class="fu">select</span>(diamonds, carat, price, color, z, </span>
<span id="cb231-2"><a href="manipulation-de-données-avec-r.html#cb231-2" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;i&quot;</span>))</span>
<span id="cb231-3"><a href="manipulation-de-données-avec-r.html#cb231-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(selection1,<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   carat price color     z clarity
##   &lt;dbl&gt; &lt;int&gt; &lt;ord&gt; &lt;dbl&gt; &lt;ord&gt;  
## 1  0.23   326 E      2.43 SI2    
## 2  0.21   326 E      2.31 SI1    
## 3  0.23   327 E      2.31 VS1</code></pre>
<p>Sans le package <strong>dplyr</strong>, on aurait fait :</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="manipulation-de-données-avec-r.html#cb233-1" aria-hidden="true" tabindex="-1"></a>selection1 <span class="ot">&lt;-</span> diamonds[, <span class="fu">unique</span>(<span class="fu">c</span>(<span class="st">&quot;carat&quot;</span>, <span class="st">&quot;price&quot;</span>, <span class="st">&quot;color&quot;</span>, <span class="st">&quot;z&quot;</span>, </span>
<span id="cb233-2"><a href="manipulation-de-données-avec-r.html#cb233-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">names</span>(diamonds)[<span class="fu">grep</span>(<span class="st">&quot;i&quot;</span>, <span class="fu">names</span>(diamonds))]))]</span></code></pre></div>
<p><strong>Remarque :</strong> dans la deuxième syntaxe, pour que la variable <strong>price</strong> n’apparaisse qu’une seule fois dans le jeu de données, on a du utiliser la fonction <em>unique()</em>.</p>
</div>
<div id="changer-le-nom-de-variables-avec-la-fonction-rename" class="section level4" number="2.5.2.4">
<h4><span class="header-section-number">2.5.2.4</span> Changer le nom de variables avec la fonction <em>rename()</em></h4>
<p>On souhaite changer le nom de la variable <strong>z</strong> par le label <strong>width</strong> et <strong>color</strong> par <strong>code_color</strong> :</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="manipulation-de-données-avec-r.html#cb234-1" aria-hidden="true" tabindex="-1"></a>renom1 <span class="ot">&lt;-</span> <span class="fu">rename</span>(diamonds, <span class="at">width =</span> z, <span class="at">code_color =</span> color)</span>
<span id="cb234-2"><a href="manipulation-de-données-avec-r.html#cb234-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(renom1, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 10
##   carat cut     code_color clarity depth table price     x     y width
##   &lt;dbl&gt; &lt;ord&gt;   &lt;ord&gt;      &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  0.23 Ideal   E          SI2      61.5    55   326  3.95  3.98  2.43
## 2  0.21 Premium E          SI1      59.8    61   326  3.89  3.84  2.31
## 3  0.23 Good    E          VS1      56.9    65   327  4.05  4.07  2.31</code></pre>
<p>Sans le package <strong>dplyr</strong>, on aurait fait :</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="manipulation-de-données-avec-r.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(diamonds)[<span class="fu">c</span>(<span class="fu">match</span>(<span class="st">&quot;z&quot;</span>, <span class="fu">names</span>(diamonds)), </span>
<span id="cb236-2"><a href="manipulation-de-données-avec-r.html#cb236-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">match</span>(<span class="st">&quot;color&quot;</span>, <span class="fu">names</span>(diamonds)))] <span class="ot">&lt;-</span> </span>
<span id="cb236-3"><a href="manipulation-de-données-avec-r.html#cb236-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;width&quot;</span>, <span class="st">&quot;code_color&quot;</span>)</span></code></pre></div>
</div>
<div id="ajouter-une-nouvelle-colonne-avec-la-fonction-mutate" class="section level4" number="2.5.2.5">
<h4><span class="header-section-number">2.5.2.5</span> Ajouter une nouvelle colonne avec la fonction <em>mutate()</em></h4>
<p>On calcule le prix au kilo pour chaque diamant et on convertit en euros :</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="manipulation-de-données-avec-r.html#cb237-1" aria-hidden="true" tabindex="-1"></a>calcul1 <span class="ot">&lt;-</span> <span class="fu">mutate</span>(diamonds, <span class="at">prix.kilo =</span> price <span class="sc">/</span> carat, </span>
<span id="cb237-2"><a href="manipulation-de-données-avec-r.html#cb237-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">prix.kilo.euro =</span> prix.kilo <span class="sc">*</span> <span class="fl">0.9035</span>)</span>
<span id="cb237-3"><a href="manipulation-de-données-avec-r.html#cb237-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(calcul1, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 12
##   carat cut     code_color clarity depth table price     x     y width prix.kilo
##   &lt;dbl&gt; &lt;ord&gt;   &lt;ord&gt;      &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1  0.23 Ideal   E          SI2      61.5    55   326  3.95  3.98  2.43     1417.
## 2  0.21 Premium E          SI1      59.8    61   326  3.89  3.84  2.31     1552.
## 3  0.23 Good    E          VS1      56.9    65   327  4.05  4.07  2.31     1422.
## # … with 1 more variable: prix.kilo.euro &lt;dbl&gt;</code></pre>
<p>Sans le package <strong>dplyr</strong>, on aurait fait :</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="manipulation-de-données-avec-r.html#cb239-1" aria-hidden="true" tabindex="-1"></a>diamonds<span class="sc">$</span>prix.kilo <span class="ot">&lt;-</span> diamonds<span class="sc">$</span>price<span class="sc">/</span>diamonds<span class="sc">$</span>carat</span>
<span id="cb239-2"><a href="manipulation-de-données-avec-r.html#cb239-2" aria-hidden="true" tabindex="-1"></a>diamonds<span class="sc">$</span>prix.kilo.euro <span class="ot">&lt;-</span> diamonds<span class="sc">$</span>prix.kilo <span class="sc">*</span> <span class="fl">0.9035</span></span></code></pre></div>
</div>
<div id="faire-des-calculs-statistiques-avec-la-fonction-summarise" class="section level4" number="2.5.2.6">
<h4><span class="header-section-number">2.5.2.6</span> Faire des calculs statistiques avec la fonction <em>summarise()</em></h4>
<p>On calcule le prix moyen en fonction de la couleur et de la coupe du diamant :</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="manipulation-de-données-avec-r.html#cb240-1" aria-hidden="true" tabindex="-1"></a>calcul2 <span class="ot">&lt;-</span> <span class="fu">summarise</span>(<span class="fu">group_by</span>(diamonds, cut, code_color), <span class="at">prix.moy =</span> <span class="fu">mean</span>(price))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;cut&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="manipulation-de-données-avec-r.html#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(calcul2, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
## # Groups:   cut [1]
##   cut   code_color prix.moy
##   &lt;ord&gt; &lt;ord&gt;         &lt;dbl&gt;
## 1 Fair  D             4291.
## 2 Fair  E             3682.
## 3 Fair  F             3827.</code></pre>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="manipulation-de-données-avec-r.html#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(calcul2)</span></code></pre></div>
<pre><code>## [1] &quot;grouped_df&quot; &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<p>Sans le package <strong>dplyr</strong>, on aurait fait :</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="manipulation-de-données-avec-r.html#cb246-1" aria-hidden="true" tabindex="-1"></a>calcul2 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(<span class="fu">data.frame</span>(<span class="at">price =</span> diamonds[, <span class="st">&quot;price&quot;</span>]), </span>
<span id="cb246-2"><a href="manipulation-de-données-avec-r.html#cb246-2" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">list</span>(<span class="at">color =</span> diamonds<span class="sc">$</span>code_color, </span>
<span id="cb246-3"><a href="manipulation-de-données-avec-r.html#cb246-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">cut =</span> diamonds<span class="sc">$</span>cut), mean)</span></code></pre></div>
</div>
<div id="faire-des-calculs-statistiques-en-utilisant-une-nouvelle-syntaxe" class="section level4" number="2.5.2.7">
<h4><span class="header-section-number">2.5.2.7</span> Faire des calculs statistiques en utilisant une nouvelle syntaxe</h4>
<p>On souhaite calculer le prix maximum d’un diamant en fonction de la couleur et de la coupe. On ne veut garder que les prix supérieurs à 5000 dollars. Pour cela, on peut utiliser la syntaxe suivante, dite ``pipelining’’, qui provient du package <strong>magrittr</strong> (et importé par défaut via la package <strong>dplyr</strong>) :</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="manipulation-de-données-avec-r.html#cb247-1" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">%&gt;%</span> </span>
<span id="cb247-2"><a href="manipulation-de-données-avec-r.html#cb247-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(code_color, cut) <span class="sc">%&gt;%</span> </span>
<span id="cb247-3"><a href="manipulation-de-données-avec-r.html#cb247-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prix_groupe =</span> <span class="fu">mean</span>(price)) <span class="sc">%&gt;%</span> </span>
<span id="cb247-4"><a href="manipulation-de-données-avec-r.html#cb247-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(prix_groupe <span class="sc">&gt;</span> <span class="dv">5000</span>)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;code_color&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 7 x 3
## # Groups:   code_color [3]
##   code_color cut       prix_groupe
##   &lt;ord&gt;      &lt;ord&gt;           &lt;dbl&gt;
## 1 H          Fair            5136.
## 2 H          Premium         5217.
## 3 I          Good            5079.
## 4 I          Very Good       5256.
## 5 I          Premium         5946.
## 6 J          Very Good       5104.
## 7 J          Premium         6295.</code></pre>
<p>L’idée de cette syntaxe est de pouvoir comprendre rapidement les différentes opérations qui sont effectuées les unes à la suite des autres. Dans l’exemple précédent :</p>
<ul>
<li>on prend le jeu de données <strong>diamonds</strong>, le fait d’ajouter un ``pipe’’ à la suite implique qu’on va appliquer une première opération dessus,</li>
<li><em>group_by</em> : on regroupe des observations en fonction des variables <strong>color</strong> et <strong>cut</strong>,</li>
<li><em>summarise</em> : on calcule le prix moyen sur les groupes précédemment créés,</li>
<li><em>filter</em> : on ne garde que les observations supérieures à 5000 dollars.</li>
</ul>
<p><strong>Remarque :</strong> depuis la version <strong>4.1.0</strong>, <strong>R</strong> a lancé une version native de l’opérateur `<code>pipe''. Il s'agit de la commande suivante</code>|&gt;`. Voici un exemple d’utilisation :</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="manipulation-de-données-avec-r.html#cb250-1" aria-hidden="true" tabindex="-1"></a>my_vec <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb250-2"><a href="manipulation-de-données-avec-r.html#cb250-2" aria-hidden="true" tabindex="-1"></a>my_vec <span class="sc">|&gt;</span></span>
<span id="cb250-3"><a href="manipulation-de-données-avec-r.html#cb250-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>()</span></code></pre></div>
<pre><code>## [1] -0.4518699</code></pre>
<p>Dans la plupart des cas, il peut remplacer le pipe de <strong>magrittr</strong>.</p>
</div>
<div id="tirer-un-échantillon-dune-population" class="section level4" number="2.5.2.8">
<h4><span class="header-section-number">2.5.2.8</span> Tirer un échantillon d’une population</h4>
<p>On souhaite tirer de façon aléatoire 100 observations :</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="manipulation-de-données-avec-r.html#cb252-1" aria-hidden="true" tabindex="-1"></a>tirage1 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(diamonds, <span class="dv">100</span>)</span></code></pre></div>
<p>On souhaite tirer de façon aléatoire <span class="math inline">\(5\%\)</span> de l’échantillon :</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="manipulation-de-données-avec-r.html#cb253-1" aria-hidden="true" tabindex="-1"></a>tirage1 <span class="ot">&lt;-</span> <span class="fu">sample_frac</span>(diamonds, <span class="fl">0.05</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="tidy-data" class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Tidy data</h2>
<p>Pour illustrer ce paragraphe, on considére les données suivantes : on observe pour 3 pays (Afghanistan, Brazil et Chine) sur 2 années consécutives (1999 et 2000), la taille de la population ainsi que le nombre de cas de tuberculoses observés. On va voir qu’on peut utiliser différentes tables pour présenter ces données et parmi ces différentes possibilités, on aura intérêt à en utiliser une plutôt que les autres. Pour charger ces données, on va installer le package <strong>DSR</strong> accessible depuis <strong>github</strong>. En effet, il est possible de récupérer sur <strong>github</strong> des packages qui sont en cours de développement et qui n’ont pas encore passés le processus de validation pour être un package officiel du CRAN :</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="manipulation-de-données-avec-r.html#cb254-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;garrettgman/DSR&quot;</span>)</span></code></pre></div>
<p>On pourrait traduire <em>tidy data</em> par données rangées en opposition à <em>messy data</em>, données désordonnées. Ce courant de <em>tidy data</em> vient encore de Hadley Wickham (voir article <a href="https://www.jstatsoft.org/article/view/v059i10" class="uri">https://www.jstatsoft.org/article/view/v059i10</a> ou encore <a href="https://r4ds.had.co.nz/tidy-data.html" class="uri">https://r4ds.had.co.nz/tidy-data.html</a>) qui part du principe suivant qui peut paraître évident, mais selon les situations, ce n’est pas toujours le cas :</p>
<ul>
<li><p>Une variable doit être rangée dans une colonne,</p></li>
<li><p>Un individu est rangé dans une ligne,</p></li>
<li><p>On place les valeurs observées dans les bonnes cases.</p></li>
</ul>
<p>On présente ici une façon de présenter les données <em>tidy</em> :</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="manipulation-de-données-avec-r.html#cb255-1" aria-hidden="true" tabindex="-1"></a>DSR<span class="sc">::</span>table1</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   country      year  cases population
##   &lt;fct&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<p>Au contraire, dans les données <em>messy</em>, on trouve en général une de ces situations :</p>
<ul>
<li><p>le nom des colonnes sont des valeurs et pas des noms,</p></li>
<li><p>Plusieurs variables sont stockées dans une même colonne, c’est le cas du jeu de données suivant.</p></li>
</ul>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="manipulation-de-données-avec-r.html#cb257-1" aria-hidden="true" tabindex="-1"></a>DSR<span class="sc">::</span>table3</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country      year rate             
##   &lt;fct&gt;       &lt;int&gt; &lt;chr&gt;            
## 1 Afghanistan  1999 745/19987071     
## 2 Afghanistan  2000 2666/20595360    
## 3 Brazil       1999 37737/172006362  
## 4 Brazil       2000 80488/174504898  
## 5 China        1999 212258/1272915272
## 6 China        2000 213766/1280428583</code></pre>
<ul>
<li>Les variables sont à la fois présentes dans les lignes et les colonnes, c’est le cas du jeu de données suivant où constate que la colonne <strong>key</strong> contient le nom des deux variables <strong>population</strong> et <strong>cases</strong>, qu’il semblerait judiciable de présenter plutôt en colonnes.</li>
</ul>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="manipulation-de-données-avec-r.html#cb259-1" aria-hidden="true" tabindex="-1"></a>DSR<span class="sc">::</span>table2</span></code></pre></div>
<pre><code>## # A tibble: 12 x 4
##    country      year key             value
##    &lt;fct&gt;       &lt;int&gt; &lt;fct&gt;           &lt;int&gt;
##  1 Afghanistan  1999 cases             745
##  2 Afghanistan  1999 population   19987071
##  3 Afghanistan  2000 cases            2666
##  4 Afghanistan  2000 population   20595360
##  5 Brazil       1999 cases           37737
##  6 Brazil       1999 population  172006362
##  7 Brazil       2000 cases           80488
##  8 Brazil       2000 population  174504898
##  9 China        1999 cases          212258
## 10 China        1999 population 1272915272
## 11 China        2000 cases          213766
## 12 China        2000 population 1280428583</code></pre>
<ul>
<li>Les valeurs sont stockées dans plusieurs tables. C’est le cas de ces deux tables (une contenant les informations sur la population, l’autre sur le nombre de cas de tuberculoses) qui auraient pu être regroupées en une seule table</li>
</ul>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="manipulation-de-données-avec-r.html#cb261-1" aria-hidden="true" tabindex="-1"></a>DSR<span class="sc">::</span>table4</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   country     `1999` `2000`
##   &lt;fct&gt;        &lt;int&gt;  &lt;int&gt;
## 1 Afghanistan    745   2666
## 2 Brazil       37737  80488
## 3 China       212258 213766</code></pre>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="manipulation-de-données-avec-r.html#cb263-1" aria-hidden="true" tabindex="-1"></a>DSR<span class="sc">::</span>table5</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   country         `1999`     `2000`
##   &lt;fct&gt;            &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan   19987071   20595360
## 2 Brazil       172006362  174504898
## 3 China       1272915272 1280428583</code></pre>
<p>On va présenter ici les fonctions principales du package <strong>tidyr</strong> (ce package fait partie de la bibliothèque <strong>tidyverse</strong>) qui permettent de passer d’un format <em>messy</em> à un format <em>tidy</em> ou inversement.</p>
<div id="la-fonction-pivot_longer-transformer-des-colonnes-en-lignes" class="section level3" number="2.6.1">
<h3><span class="header-section-number">2.6.1</span> La fonction <em>pivot_longer()</em> : transformer des colonnes en lignes</h3>
<p>Cette fonction permet de représenter en 1 seul colonne (et d’ajouter une colonne correspondant à une variable qualitative où les modalités sont le nom des variables initiales), une variable contenue à l’origine dans plusieurs colonnes.</p>
<p><img src="Figures/pivot_longer.png" width="80%" height="\textheight" /></p>
<p>L’argument <strong>cols</strong> indique les variables à transformer en ligne, l’argument <strong>names_to</strong> correspond au nom donné à la variable contenant les nouvelles modalités (le nom des variables) et l’argument <strong>values_to</strong> correspond au nom de la colonne contenant les valeurs qui ont été transformées de colonnes en lignes.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="manipulation-de-données-avec-r.html#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_longer</span>(DSR<span class="sc">::</span>table4, </span>
<span id="cb265-2"><a href="manipulation-de-données-avec-r.html#cb265-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;1999&quot;</span>, <span class="st">&quot;2000&quot;</span>),</span>
<span id="cb265-3"><a href="manipulation-de-données-avec-r.html#cb265-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">names_to =</span> <span class="st">&quot;years&quot;</span>,</span>
<span id="cb265-4"><a href="manipulation-de-données-avec-r.html#cb265-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">values_to =</span> <span class="st">&quot;cases&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country     years  cases
##   &lt;fct&gt;       &lt;chr&gt;  &lt;int&gt;
## 1 Afghanistan 1999     745
## 2 Afghanistan 2000    2666
## 3 Brazil      1999   37737
## 4 Brazil      2000   80488
## 5 China       1999  212258
## 6 China       2000  213766</code></pre>
<p>Avant <em>pivot_longer()</em>, il était possible d’utiliser la fonction <em>gather()</em>:</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="manipulation-de-données-avec-r.html#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gather</span>(DSR<span class="sc">::</span>table4, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;cases&quot;</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country     year   cases
##   &lt;fct&gt;       &lt;chr&gt;  &lt;int&gt;
## 1 Afghanistan 1999     745
## 2 Brazil      1999   37737
## 3 China       1999  212258
## 4 Afghanistan 2000    2666
## 5 Brazil      2000   80488
## 6 China       2000  213766</code></pre>
<p>Avant toutes ces fonctions, il aurait fallu exécuter ce genre de commandes où l’opération mathématique consiste à transformer une matrice en un vecteur.</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="manipulation-de-données-avec-r.html#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb269-2"><a href="manipulation-de-données-avec-r.html#cb269-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">country =</span> <span class="fu">rep</span>(DSR<span class="sc">::</span>table4<span class="sc">$</span>country, <span class="at">times =</span> <span class="dv">2</span>),</span>
<span id="cb269-3"><a href="manipulation-de-données-avec-r.html#cb269-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;1999&quot;</span>, <span class="st">&quot;2000&quot;</span>), <span class="at">each =</span> <span class="fu">nrow</span>(DSR<span class="sc">::</span>table4)), </span>
<span id="cb269-4"><a href="manipulation-de-données-avec-r.html#cb269-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">cases =</span> <span class="fu">as.vector</span>(<span class="fu">as.matrix</span>(DSR<span class="sc">::</span>table4[ , <span class="fu">c</span>(<span class="st">&quot;1999&quot;</span>, <span class="st">&quot;2000&quot;</span>)]))</span>
<span id="cb269-5"><a href="manipulation-de-données-avec-r.html#cb269-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##       country year  cases
## 1 Afghanistan 1999    745
## 2      Brazil 1999  37737
## 3       China 1999 212258
## 4 Afghanistan 2000   2666
## 5      Brazil 2000  80488
## 6       China 2000 213766</code></pre>
</div>
<div id="la-fonction-pivot_wider-transformer-des-lignes-en-colonnes" class="section level3" number="2.6.2">
<h3><span class="header-section-number">2.6.2</span> La fonction <em>pivot_wider()</em> : transformer des lignes en colonnes</h3>
<p>Cette fonction permet de re-distribuer les valeurs d’une colonne qui contenait l’information de plusieurs variables, en plusieurs colonnes où chaque colonne correspond à une variable.</p>
<p><img src="Figures/pivot_wider.png" width="80%" height="\textheight" /></p>
<p>L’argument <strong>names_from</strong> correspond au nom de la colonne qui contient le nom des variables, et l’argument <strong>values_from</strong> correspond au nom de la colonne qui contient les valeurs à re-distribuer :</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="manipulation-de-données-avec-r.html#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_wider</span>(DSR<span class="sc">::</span>table2, <span class="at">names_from =</span> key, </span>
<span id="cb271-2"><a href="manipulation-de-données-avec-r.html#cb271-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">values_from =</span> value)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   country      year  cases population
##   &lt;fct&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<p>Avant <em>pivot_wider()</em>, il était possible d’utiliser la fonction <em>spread()</em></p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="manipulation-de-données-avec-r.html#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="fu">spread</span>(DSR<span class="sc">::</span>table2, key, value)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   country      year  cases population
##   &lt;fct&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<p>Avant la création de ces fonctions, il aurait fallu utiliser la fonction <em>split()</em> et <em>merge()</em>:</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="manipulation-de-données-avec-r.html#cb275-1" aria-hidden="true" tabindex="-1"></a>sp_DSR <span class="ot">&lt;-</span> <span class="fu">split</span>(DSR<span class="sc">::</span>table2[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>)],  DSR<span class="sc">::</span>table2[, <span class="dv">3</span>]) </span>
<span id="cb275-2"><a href="manipulation-de-données-avec-r.html#cb275-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sp_DSR<span class="sc">$</span>cases)[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">&quot;cases&quot;</span></span>
<span id="cb275-3"><a href="manipulation-de-données-avec-r.html#cb275-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sp_DSR<span class="sc">$</span>population)[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">&quot;population&quot;</span></span>
<span id="cb275-4"><a href="manipulation-de-données-avec-r.html#cb275-4" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(sp_DSR<span class="sc">$</span>cases, sp_DSR<span class="sc">$</span>population,</span>
<span id="cb275-5"><a href="manipulation-de-données-avec-r.html#cb275-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">by.x =</span> <span class="fu">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>),</span>
<span id="cb275-6"><a href="manipulation-de-données-avec-r.html#cb275-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">by.y =</span> <span class="fu">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>),)</span></code></pre></div>
<pre><code>##       country year  cases population
## 1 Afghanistan 1999    745   19987071
## 2 Afghanistan 2000   2666   20595360
## 3      Brazil 1999  37737  172006362
## 4      Brazil 2000  80488  174504898
## 5       China 1999 212258 1272915272
## 6       China 2000 213766 1280428583</code></pre>
<div id="la-fonction-separate" class="section level4" number="2.6.2.1">
<h4><span class="header-section-number">2.6.2.1</span> La fonction <em>separate()</em></h4>
<p>Cette fonction permet de séparer une colonne en deux variables dès qu’elle détecte un caractère de séparation. Par exemple, pour spliter la colonne <strong>rate</strong> de la <strong>table3</strong>.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="manipulation-de-données-avec-r.html#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="fu">separate</span>(table3, rate, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;population&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   country      year cases  population
##   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     
## 1 Afghanistan  1999 745    19987071  
## 2 Afghanistan  2000 2666   20595360  
## 3 Brazil       1999 37737  172006362 
## 4 Brazil       2000 80488  174504898 
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
</div>
<div id="la-fonction-unite" class="section level4" number="2.6.2.2">
<h4><span class="header-section-number">2.6.2.2</span> La fonction <em>unite()</em></h4>
<p>Cette fonction permet de faire l’opération inverse de <em>separate()</em>. Elle permet de concaténer deux variables. Le résultat est proche de celui de la fonction <em>paste()</em>.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="manipulation-de-données-avec-r.html#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unite</span>(DSR<span class="sc">::</span>table1, <span class="at">col =</span> <span class="st">&quot;rate&quot;</span>,</span>
<span id="cb279-2"><a href="manipulation-de-données-avec-r.html#cb279-2" aria-hidden="true" tabindex="-1"></a>      cases, population, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country      year rate             
##   &lt;fct&gt;       &lt;int&gt; &lt;chr&gt;            
## 1 Afghanistan  1999 745/19987071     
## 2 Afghanistan  2000 2666/20595360    
## 3 Brazil       1999 37737/172006362  
## 4 Brazil       2000 80488/174504898  
## 5 China        1999 212258/1272915272
## 6 China        2000 213766/1280428583</code></pre>
</div>
<div id="la-fonction-extract" class="section level4" number="2.6.2.3">
<h4><span class="header-section-number">2.6.2.3</span> La fonction <em>extract()</em></h4>
<p>Cette fonction permet de spliter une colonne en deux en précisant quelle chaîne de caractère est utilisée pour le split. Dans l’exemple ci-dessous, on splitte une chaîne de caractère lorsqu’il y a un espace dans une chaîne de caractère. Pour cela, on utilise l’argument <strong>regex=</strong> qui indique une expression régulière “REGEX.”</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="manipulation-de-données-avec-r.html#cb281-1" aria-hidden="true" tabindex="-1"></a>df_to_split <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb281-2"><a href="manipulation-de-données-avec-r.html#cb281-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">player =</span> <span class="fu">c</span>(<span class="st">&quot;Lionel Messi&quot;</span>, <span class="st">&quot;Christiano Ronaldo&quot;</span>, <span class="st">&quot;Antoine Griezman&quot;</span>),</span>
<span id="cb281-3"><a href="manipulation-de-données-avec-r.html#cb281-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">prix =</span> <span class="fu">c</span>(<span class="dv">170</span>, <span class="dv">100</span>, <span class="dv">120</span>))</span>
<span id="cb281-4"><a href="manipulation-de-données-avec-r.html#cb281-4" aria-hidden="true" tabindex="-1"></a><span class="fu">extract</span>(df_to_split, </span>
<span id="cb281-5"><a href="manipulation-de-données-avec-r.html#cb281-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> player,</span>
<span id="cb281-6"><a href="manipulation-de-données-avec-r.html#cb281-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;prenom&quot;</span>, <span class="st">&quot;nom&quot;</span>),</span>
<span id="cb281-7"><a href="manipulation-de-données-avec-r.html#cb281-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">regex =</span> <span class="st">&quot;^(.).* (.).*$&quot;</span>)</span></code></pre></div>
<pre><code>##   prenom nom prix
## 1      L   M  170
## 2      C   R  100
## 3      A   G  120</code></pre>
<p>Ceci aurait pu se faire en utilisant la fonction <em>strsplit()</em>.</p>
</div>
<div id="la-fonction-complete" class="section level4" number="2.6.2.4">
<h4><span class="header-section-number">2.6.2.4</span> La fonction <em>complete()</em></h4>
<p>Cette fonction permet d’ajouter des lignes dans le cas où une valeur serait manquante. Par exemple, si on considère le jeu de données suivant, on constate que la firme B n’a pas de valeurs de CA pour l’année 2009.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="manipulation-de-données-avec-r.html#cb283-1" aria-hidden="true" tabindex="-1"></a>firms <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb283-2"><a href="manipulation-de-données-avec-r.html#cb283-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">firms =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>),</span>
<span id="cb283-3"><a href="manipulation-de-données-avec-r.html#cb283-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">years =</span> <span class="fu">c</span>(<span class="st">&quot;2008&quot;</span>, <span class="st">&quot;2009&quot;</span>, <span class="st">&quot;2008&quot;</span>),</span>
<span id="cb283-4"><a href="manipulation-de-données-avec-r.html#cb283-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">CA =</span> <span class="fu">c</span>(<span class="dv">20000</span>, <span class="dv">25000</span>, <span class="dv">40000</span>)</span>
<span id="cb283-5"><a href="manipulation-de-données-avec-r.html#cb283-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Pour changer cela, on utilise la fonction <em>complete()</em> de la façon suivante:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="manipulation-de-données-avec-r.html#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="fu">complete</span>(firms, firms, years)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   firms years    CA
##   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;
## 1 A     2008  20000
## 2 A     2009  25000
## 3 B     2008  40000
## 4 B     2009     NA</code></pre>
<p>Pour plus de documentation sur l’univers <strong>tidyr</strong>, on recommande la lecture de <a href="https://juba.github.io/tidyverse/12-tidyr.html#fn19">cette page</a> écrite par Julien Barnier.</p>
<p><strong>Exercice 1.9.</strong></p>
<p><strong>Q1</strong> Découper en 3 variables (<strong>ville</strong>, <strong>num</strong>, <strong>dep</strong>), le vecteur suivant :</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="manipulation-de-données-avec-r.html#cb286-1" aria-hidden="true" tabindex="-1"></a>code_INSEE <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;toulouse_31_HG&quot;</span>, <span class="st">&quot;lyon_69_Rhone&quot;</span>, <span class="st">&quot;marsei_13_PACA&quot;</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="gestion-de-données-volumineuses" class="section level2" number="2.7">
<h2><span class="header-section-number">2.7</span> Gestion de données volumineuses</h2>
<p>Ici, nous allons essentiellement parler de données “moyennement volumineuses,” à savoir des données qui prennent entre 1 et 2 Go de RAM, ce qui correspond très approximativement à des jeux de données contenant quelques millions de lignes et quelques dizaines de variables. Nous parlerons des packages qui permettent de traiter des bases de données plus volumineuses, sans rentrer dans les détails.</p>
<div id="optimiser-la-fonction-read.table" class="section level3" number="2.7.1">
<h3><span class="header-section-number">2.7.1</span> Optimiser la fonction <em>read.table()</em></h3>
<div id="astuce-1" class="section level4" number="2.7.1.1">
<h4><span class="header-section-number">2.7.1.1</span> Astuce 1</h4>
<p>Une première astuce concernant la gestion de données volumineuses consiste à mieux gérer l’importation des données. Regardons ce que cela donne avec un fichier contenant 500000 lignes et 3 colonnes.</p>
<ul>
<li>Commençons par générer des données :</li>
</ul>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="manipulation-de-données-avec-r.html#cb287-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">500000</span> <span class="co"># à modifier selon la mémoire vive de votre machine</span></span>
<span id="cb287-2"><a href="manipulation-de-données-avec-r.html#cb287-2" aria-hidden="true" tabindex="-1"></a>donnees_a_importer <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">chiffre =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb287-3"><a href="manipulation-de-données-avec-r.html#cb287-3" aria-hidden="true" tabindex="-1"></a> <span class="at">lettre =</span> <span class="fu">paste0</span>(<span class="st">&quot;caract&quot;</span>, <span class="dv">1</span><span class="sc">:</span>n), </span>
<span id="cb287-4"><a href="manipulation-de-données-avec-r.html#cb287-4" aria-hidden="true" tabindex="-1"></a> <span class="at">date =</span> <span class="fu">sample</span>(<span class="fu">seq.Date</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2017-10-01&quot;</span>), <span class="at">by =</span> <span class="st">&quot;day&quot;</span>, <span class="at">len =</span> <span class="dv">100</span>), n, </span>
<span id="cb287-5"><a href="manipulation-de-données-avec-r.html#cb287-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">replace =</span> T))</span>
<span id="cb287-6"><a href="manipulation-de-données-avec-r.html#cb287-6" aria-hidden="true" tabindex="-1"></a><span class="fu">object.size</span>(donnees_a_importer)</span></code></pre></div>
<pre><code>## 40001136 bytes</code></pre>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="manipulation-de-données-avec-r.html#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(donnees_a_importer)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    500000 obs. of  3 variables:
##  $ chiffre: int  1 2 3 4 5 6 7 8 9 10 ...
##  $ lettre : chr  &quot;caract1&quot; &quot;caract2&quot; &quot;caract3&quot; &quot;caract4&quot; ...
##  $ date   : Date, format: &quot;2017-12-04&quot; &quot;2017-10-01&quot; ...</code></pre>
<p>Ce jeu de données utilise environ 38Mo de mémoire vive ou RAM (pour un rappel sur les différents types de mémoire, voir ce <a href="https://cours-informatique-gratuit.fr/cours/disque-dur-et-ram/">tutoriel</a> intéressant). Il contient 3 variables : la 1ère au format <strong>integer</strong> (un <strong>integer</strong> occupe moins de mémoires qu’un <strong>double</strong>), la seconde au format <strong>factor</strong>, le troisième au format <strong>Date</strong>.</p>
<ul>
<li>Exportons ces données dans un fichier avec la fonction <em>write.table()</em> :</li>
</ul>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="manipulation-de-données-avec-r.html#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(donnees_a_importer, <span class="st">&quot;fichier.txt&quot;</span>, <span class="at">row.names =</span> F)</span></code></pre></div>
<p>On peut connaître la taille du fichier en mémoire disque :</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="manipulation-de-données-avec-r.html#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="fu">file.info</span>(<span class="st">&quot;fichier.txt&quot;</span>)</span></code></pre></div>
<p>On dispose ainsi d’un fichier appelé <em>fichier.txt</em> dans l’espace de travail, qui pèse environ 16Mo.</p>
<ul>
<li>Importons ces données avec la fonction <em>read.table()</em> en mesurant le temps pris pour accomplir cette action. On remarque que les 2ème et 3ème variables ont été stockées en tant que <strong>factor</strong> (parce que on lui a demandé en utilisant l’option <strong>stringsAsFactors = TRUE</strong>).</li>
</ul>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="manipulation-de-données-avec-r.html#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(import1 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;fichier.txt&quot;</span>, <span class="at">header =</span> T, </span>
<span id="cb293-2"><a href="manipulation-de-données-avec-r.html#cb293-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## utilisateur     système      écoulé 
##       2.716       0.034       2.752</code></pre>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="manipulation-de-données-avec-r.html#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(import1)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    500000 obs. of  3 variables:
##  $ chiffre: int  1 2 3 4 5 6 7 8 9 10 ...
##  $ lettre : Factor w/ 500000 levels &quot;caract1&quot;,&quot;caract10&quot;,..: 1 111112 222223 333334 444445 455557 466668 477779 488890 2 ...
##  $ date   : Factor w/ 100 levels &quot;2017-10-01&quot;,&quot;2017-10-02&quot;,..: 65 1 56 95 64 100 21 62 15 34 ...</code></pre>
<ul>
<li>Exécutons la même opération en précisant que les chaînes de caractères seront stockées sous forme de <strong>character</strong>.</li>
</ul>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="manipulation-de-données-avec-r.html#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(import2 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;fichier.txt&quot;</span>, <span class="at">header =</span> T,</span>
<span id="cb297-2"><a href="manipulation-de-données-avec-r.html#cb297-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<pre><code>## utilisateur     système      écoulé 
##       0.472       0.004       0.479</code></pre>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="manipulation-de-données-avec-r.html#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(import2)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    500000 obs. of  3 variables:
##  $ chiffre: int  1 2 3 4 5 6 7 8 9 10 ...
##  $ lettre : chr  &quot;caract1&quot; &quot;caract2&quot; &quot;caract3&quot; &quot;caract4&quot; ...
##  $ date   : chr  &quot;2017-12-04&quot; &quot;2017-10-01&quot; &quot;2017-11-25&quot; &quot;2018-01-03&quot; ...</code></pre>
<p>Le gain de temps dans le second cas vient du fait qu’on demande à ce que les variables qualitatives ne soient pas codées en <strong>factor</strong>. En effet, pour créer un <strong>factor</strong>, <strong>R</strong> a besoin de parcourir l’ensemble du fichier pour identifier tous les <strong>levels</strong> possibles, pour pouvoir attribuer un numéro à chaque <strong>levels</strong>. Cette procédure n’est évidemment pas optimale et il s’agissait d’une critique majeure concernant les objets <strong>data.frame</strong>, à savoir que les variables qualitatives sont codées par défaut en <strong>factor</strong> jusqu’à 2019. Depuis la version 4.0.0., l’argument *stringsAsFactors** vaut :</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="manipulation-de-données-avec-r.html#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="fu">default.stringsAsFactors</span>()</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>En effet, depuis la conférence useR!2019 qui s’est tenue à Toulouse, les chaînes de caractères sont à présent sauvegardées au format <strong>character</strong>. L’idée avancée était qu’un <strong>factor</strong> ordonne les caractères selon des règles lexicographiques qui ne sont pas les mêmes d’un pays à un autre. Autrement dit, compte tenu que ces règles sont définies par la machine utilisée, on peut obtenir des résultats différents d’une machine à une autre et la reproductibilité d’un même code n’était donc plus assurée. Pour plus de détails , voir <a href="https://developer.r-project.org/Blog/public/2020/02/16/stringsasfactors/index.html">ce message</a>.</p>
</div>
<div id="astuce-2" class="section level4" number="2.7.1.2">
<h4><span class="header-section-number">2.7.1.2</span> Astuce 2</h4>
<p>Pour importer un gros fichier, nous conseillons d’utiliser dans un premier temps la fonction <em>read.table()</em> (ou <em>read.csv()</em>, etc) sur les quelques premières lignes du fichier (entre 20 et 100 lignes selon la taille du fichier), puis d’analyser la structure du jeu de données, plus particulièrement le type de chaque colonne :</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="manipulation-de-données-avec-r.html#cb303-1" aria-hidden="true" tabindex="-1"></a>bigfile_sample <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;fichier.txt&quot;</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>, </span>
<span id="cb303-2"><a href="manipulation-de-données-avec-r.html#cb303-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">header =</span> T, <span class="at">nrows =</span> <span class="dv">20</span>)</span>
<span id="cb303-3"><a href="manipulation-de-données-avec-r.html#cb303-3" aria-hidden="true" tabindex="-1"></a>(bigfile_colclass <span class="ot">&lt;-</span> <span class="fu">sapply</span>(bigfile_sample, class))</span></code></pre></div>
<pre><code>##     chiffre      lettre        date 
##   &quot;integer&quot; &quot;character&quot; &quot;character&quot;</code></pre>
<p>Dans un second temps, on importe la table en précisant le type de chaque colonne (par défaut l’option <strong>stringsAsFactors = FALSE</strong> donc ce n’est pas la peine de l’ajouter), ce qui aura pour effet de diminuer encore légèrement le temps de traitement.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="manipulation-de-données-avec-r.html#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(bigfile_raw <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;fichier.txt&quot;</span>, <span class="at">header =</span> T, </span>
<span id="cb305-2"><a href="manipulation-de-données-avec-r.html#cb305-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">colClasses =</span> bigfile_colclass)) </span></code></pre></div>
<pre><code>## utilisateur     système      écoulé 
##       0.368       0.003       0.372</code></pre>
<p><strong>Remarque 1 :</strong> si le type d’une colonne a été mal spécifié, cela pourra créer un message d’erreur.</p>
<p><strong>Remarque 2 :</strong> si vous êtes sûr que le fichier ne contient pas de lignes de commentaires, vous pouvez encore améliorer le temps de lecture en précisant l’option <strong>comment.char=““</strong>, ce qui permettra d’éviter de faire une recherche systématique de caractères de commentaires.</p>
</div>
</div>
<div id="le-package-readr" class="section level3" number="2.7.2">
<h3><span class="header-section-number">2.7.2</span> Le package <strong>readr</strong></h3>
<p>Nous présentons ici le package <strong>readr</strong>, faisant également partie du projet <strong>tidyverse</strong> et dont l’objectif est encore et toujours de rendre les codes plus simples et calculs plus rapides. Pour cela, les fonctions de ce package utilisent du code <strong>C++</strong> ce qui vous le verrez permet de faire des améliorations considérables en temps de calcul. Parmi les fonctions de ce package, <em>read_csv()</em> ou <em>read_table()</em> dont le but est bien entendu l’importation de fichiers <strong>csv</strong> ou <strong>txt</strong>. Elles ont été programmées de telle sorte qu’il suffit en général de les appeler en précisant uniquement le chemin d’accès du fichier à importer.</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="manipulation-de-données-avec-r.html#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(</span>
<span id="cb307-2"><a href="manipulation-de-données-avec-r.html#cb307-2" aria-hidden="true" tabindex="-1"></a> tibble.don <span class="ot">&lt;-</span> <span class="fu">read_table2</span>(<span class="st">&quot;fichier.txt&quot;</span>)</span>
<span id="cb307-3"><a href="manipulation-de-données-avec-r.html#cb307-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## 
## ── Column specification ────────────────────────────────────────────────────────
## cols(
##   `&quot;chiffre&quot;` = col_double(),
##   `&quot;lettre&quot;` = col_character(),
##   `&quot;date&quot;` = col_date(format = &quot;&quot;)
## )</code></pre>
<pre><code>## utilisateur     système      écoulé 
##       0.349       0.004       0.353</code></pre>
<p>L’objet importé n’est pas un <strong>data.frame</strong> mais un <strong>tibble</strong> que nous avons déjà vu précédemment :</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="manipulation-de-données-avec-r.html#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(tibble.don)</span></code></pre></div>
<pre><code>## [1] &quot;spec_tbl_df&quot; &quot;tbl_df&quot;      &quot;tbl&quot;         &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="manipulation-de-données-avec-r.html#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="fu">object.size</span>(tibble.don)</span></code></pre></div>
<pre><code>## 44004504 bytes</code></pre>
<p>Ce type de format ne s’est pas encore généralisé à toutes les fonctions de <strong>R</strong>. Il se peut donc que vous rencontriez des difficultés pour utiliser certaines fonctions sur ce type d’objets. Pour passer du format <strong>tibble</strong> au <strong>data.frame</strong>, cela se fait très facilement au moyen de la fonction <strong>as.data.frame</strong>.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="manipulation-de-données-avec-r.html#cb314-1" aria-hidden="true" tabindex="-1"></a>don <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(tibble.don)</span></code></pre></div>
<p><strong>Autres formats de données :</strong> dans la même lignée que <strong>readr</strong>, nous citons également le package <strong>readxl</strong> pour la lecture de fichiers <em>xls/xlsx</em>, ainsi que le package <strong>haven</strong> pour la lecture de données issue des logiciels <strong>SPSS</strong>, <strong>Stata</strong> ou <strong>SAS</strong>.</p>
<p><strong>Bibliographie:</strong> pour l’usage du package <strong>readr</strong>, le lecteur pourra consulter ce document <a href="http://readr.tidyverse.org/" class="uri">http://readr.tidyverse.org/</a>.</p>
</div>
<div id="autres-packages" class="section level3" number="2.7.3">
<h3><span class="header-section-number">2.7.3</span> Autres packages</h3>
<p>Voici 3 packages, parmi d’autres, susceptibles d’aider l’utilisateur à manipuler des fichiers de données volumineux.</p>
<div id="package-data.table" class="section level4" number="2.7.3.1">
<h4><span class="header-section-number">2.7.3.1</span> Package <strong>data.table</strong></h4>
<p>Ce package est un package concurent au projet <strong>tidyverse</strong>, l’objectif de ce package étant également de rendre les lignes de codes plus élégantes, les calculs plus rapides, notamment en présence de données volumineuses. Le package <strong>data.table</strong> est plus ancien que le projet <strong>tidyverse</strong>, mais ce dernier bénéficiant du support financier de <strong>RStudio</strong>, il semble à ce jour plus intéressant de choisir l’univers <strong>tidyverse</strong> qui devrait bénéficier de plus de développements par la suite. Nous présentons toutefois ici quelques exemples d’utilisation de <strong>data.table</strong>.</p>
<p>Pour importer un jeu de données :</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="manipulation-de-données-avec-r.html#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;data.table&quot;</span>)</span>
<span id="cb315-2"><a href="manipulation-de-données-avec-r.html#cb315-2" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(</span>
<span id="cb315-3"><a href="manipulation-de-données-avec-r.html#cb315-3" aria-hidden="true" tabindex="-1"></a>objet.data.table <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&quot;fichier.txt&quot;</span>)</span>
<span id="cb315-4"><a href="manipulation-de-données-avec-r.html#cb315-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## utilisateur     système      écoulé 
##       0.386       0.012       0.093</code></pre>
<p>L’objet créé appartient à la classe d’objet <strong>data.table</strong> :</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="manipulation-de-données-avec-r.html#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(objet.data.table)</span></code></pre></div>
<pre><code>## [1] &quot;data.table&quot; &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="manipulation-de-données-avec-r.html#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="fu">object.size</span>(objet.data.table)</span></code></pre></div>
<pre><code>## 40001760 bytes</code></pre>
<p>Pour manipuler ce format de données, il faut se familiariser avec une nouvelle syntaxe propre à ce genre de données. Le lecteur pourra consulter la note suivante s’il souhaite utiliser ce package : <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html" class="uri">https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html</a></p>
</div>
<div id="package-ff" class="section level4" number="2.7.3.2">
<h4><span class="header-section-number">2.7.3.2</span> Package <strong>ff</strong></h4>
<p>Pour des données trop volumineuses par rapport à la mémoire vive disponible de la machine, la package <strong>ff</strong> va faire en sorte de ne charger qu’une partie des données en mémoire vive que lorsqu’il en aura besoin.</p>
<p>Ici, on créé un fichier <em>“big_file.csv”</em> qui va contenir 50,000,000 observations et 3 colonnes. Pour faire cela, on va concaténer 100 fois <strong>Donnees.a.importer</strong> au fichier de sortie <em>big_file.csv</em> en utilisant la fonction <em>write_csv()</em>. L’opération peut prendre quelques minutes et c’est pourquoi pour informer l’utilisateur du temps restant, on propose d’utiliser la fonction <em>progress_estimated()</em>, qui fait avancer une barre au début de chaque nouvelle boucle (ici la boucle est répétée 100 fois).</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="manipulation-de-données-avec-r.html#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(donnees_a_importer, <span class="st">&quot;big_file.csv&quot;</span>)</span>
<span id="cb321-2"><a href="manipulation-de-données-avec-r.html#cb321-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-3"><a href="manipulation-de-données-avec-r.html#cb321-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">progress_estimated</span>(<span class="dv">100</span>)</span>
<span id="cb321-4"><a href="manipulation-de-données-avec-r.html#cb321-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>){</span>
<span id="cb321-5"><a href="manipulation-de-données-avec-r.html#cb321-5" aria-hidden="true" tabindex="-1"></a>  p<span class="sc">$</span><span class="fu">pause</span>(<span class="fl">0.1</span>)<span class="sc">$</span><span class="fu">tick</span>()<span class="sc">$</span><span class="fu">print</span>()</span>
<span id="cb321-6"><a href="manipulation-de-données-avec-r.html#cb321-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(donnees_a_importer, <span class="st">&quot;big_file.csv&quot;</span>, <span class="at">append =</span> T)</span>
<span id="cb321-7"><a href="manipulation-de-données-avec-r.html#cb321-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>La taille du fichier créé, d’environ 1.5Go est encore théoriquement manipulable sur <strong>R</strong> (essayer de le faire via la fonction <em>read.csv()</em>), mais on va supposer ici qu’on ne souhaite pas charger ce jeu de données intégralement en mémoire vive. Pour cela, on va utiliser la fonction <em>read.csv.ffdf()</em> du package <strong>ff</strong>. On spécifie comme options que l’on souhaite lire les données par groupe de 5,000,000 d’observations, excepté la première fois où l’on va lire 500,000 observations</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="manipulation-de-données-avec-r.html#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;ff&quot;</span>)</span>
<span id="cb322-2"><a href="manipulation-de-données-avec-r.html#cb322-2" aria-hidden="true" tabindex="-1"></a>bigDF <span class="ot">&lt;-</span> <span class="fu">read.csv.ffdf</span>(<span class="at">file=</span><span class="st">&quot;big_file.csv&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb322-3"><a href="manipulation-de-données-avec-r.html#cb322-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">first.rows =</span> <span class="dv">500000</span>, <span class="at">next.rows =</span> <span class="dv">5000000</span>)</span></code></pre></div>
<p>L’objet créé ne prend qu’une partie de la mémoire vive.</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="manipulation-de-données-avec-r.html#cb323-1" aria-hidden="true" tabindex="-1"></a>bigDF</span>
<span id="cb323-2"><a href="manipulation-de-données-avec-r.html#cb323-2" aria-hidden="true" tabindex="-1"></a><span class="fu">object.size</span>(bigDF)</span></code></pre></div>
<p>L’idée de ce package est de stocker les variables non pas en mémoire vive, mais quelque part sur le disque dur et d’y accéder en utilisant des pointeurs. On peut effectuer un certain nombre d’opérations sur ces objets. Par exemple, pour calculer la moyenne de la variable <strong>chiffre</strong> :</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="manipulation-de-données-avec-r.html#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;ffbase&quot;</span>)</span>
<span id="cb324-2"><a href="manipulation-de-données-avec-r.html#cb324-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean.ff</span>(bigDF<span class="sc">$</span>chiffre)</span></code></pre></div>
<p><strong>Remarque:</strong> on citera également le package <strong>bigmemory</strong> dont le principe est similaire. Plus récemment, le package <a href="https://cran.r-project.org/web/packages/disk.frame/readme/README.html"><strong>disk.frame</strong></a> semble également promis à un bel avenir.</p>
</div>
</div>
<div id="algorithme-de-type-mapreducce" class="section level3" number="2.7.4">
<h3><span class="header-section-number">2.7.4</span> Algorithme de type Map/Reducce</h3>
<p>On peut utiliser un algorithme de type <em>Map/Reduce</em> pour éviter d’importer un jeu de données trop volumineux sur la RAM. A la base, ce type d’algorithme s’applique sur des données qui sont organisées selon l’approche conceptuelle d’Hadoop, où les fichiers de données sont fractionnés en gros bloc et distribués à travers les noeuds d’un cluster.</p>
<p>Dans cet exemple, nous n’avons qu’un gros fichier de données, l’idée étant d’importer des échantillons de ce jeu de données sur lesquels on va appliquer la première étape <em>Map</em> de l’algorithme.</p>
<p>Par exemple, dans l’exemple ci-après, on a choisi d’importer les 5,000,000 premières observations, puis les 5,000,000 suivantes, etc. jusqu’à ce qu’on est parcouru tout le fichier. Sur chacun de ces échantillons, on va calculer d’une part la somme et d’autre part le maximum d’une variable quantitative.</p>
<p>Une fois réalisée cette étape sur les sous-échantillons, on va assembler les résultats obtenus à l’étape précédente. Pour calculer la moyenne, on va faire la somme sur les sommes obtenues et diviser ensuite par le nombre total d’observations et pour le max, on va calculer le maximum sur les maximum.</p>
<p><strong>Remarque :</strong> on ne peut pas appliquer toutes les méthodes statistiques sur ce type d’algorithme (par exemple calculer un quantile nécessite de travailler sur l’échantillon complet). En revanche, ce type d’algorithme peut fonctionner pour calculer l’estimateur des moindres carrés d’un modèle linéaire. Par ailleurs, le calcul parallèle (que nous verrons dans un autre chapitre) pourra être envisagé sur ce type d’algorithme.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="manipulation-de-données-avec-r.html#cb325-1" aria-hidden="true" tabindex="-1"></a>n_split <span class="ot">&lt;-</span> <span class="dv">11</span></span>
<span id="cb325-2"><a href="manipulation-de-données-avec-r.html#cb325-2" aria-hidden="true" tabindex="-1"></a>ind <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb325-3"><a href="manipulation-de-données-avec-r.html#cb325-3" aria-hidden="true" tabindex="-1"></a>n_max <span class="ot">&lt;-</span> <span class="dv">5000001</span></span>
<span id="cb325-4"><a href="manipulation-de-données-avec-r.html#cb325-4" aria-hidden="true" tabindex="-1"></a>my_max <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_split)</span>
<span id="cb325-5"><a href="manipulation-de-données-avec-r.html#cb325-5" aria-hidden="true" tabindex="-1"></a>my_mean <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_split)</span>
<span id="cb325-6"><a href="manipulation-de-données-avec-r.html#cb325-6" aria-hidden="true" tabindex="-1"></a>my_n <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_split)</span>
<span id="cb325-7"><a href="manipulation-de-données-avec-r.html#cb325-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_split) {</span>
<span id="cb325-8"><a href="manipulation-de-données-avec-r.html#cb325-8" aria-hidden="true" tabindex="-1"></a>  split_don <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;big_file.csv&quot;</span>, <span class="at">skip =</span> ind, <span class="at">n_max =</span> n_max,</span>
<span id="cb325-9"><a href="manipulation-de-données-avec-r.html#cb325-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">&quot;chiffre&quot;</span>, <span class="st">&quot;lettre&quot;</span>, <span class="st">&quot;date&quot;</span>), </span>
<span id="cb325-10"><a href="manipulation-de-données-avec-r.html#cb325-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_types =</span> <span class="st">&quot;ncc&quot;</span>)</span>
<span id="cb325-11"><a href="manipulation-de-données-avec-r.html#cb325-11" aria-hidden="true" tabindex="-1"></a>  my_max[k] <span class="ot">&lt;-</span> <span class="fu">max</span>(split_don<span class="sc">$</span>chiffre)</span>
<span id="cb325-12"><a href="manipulation-de-données-avec-r.html#cb325-12" aria-hidden="true" tabindex="-1"></a>  my_mean[k] <span class="ot">&lt;-</span> <span class="fu">sum</span>(split_don<span class="sc">$</span>chiffre)</span>
<span id="cb325-13"><a href="manipulation-de-données-avec-r.html#cb325-13" aria-hidden="true" tabindex="-1"></a>  my_n[k] <span class="ot">&lt;-</span> <span class="fu">nrow</span>(split_don)</span>
<span id="cb325-14"><a href="manipulation-de-données-avec-r.html#cb325-14" aria-hidden="true" tabindex="-1"></a>  ind <span class="ot">&lt;-</span> ind <span class="sc">+</span> n_max</span>
<span id="cb325-15"><a href="manipulation-de-données-avec-r.html#cb325-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb325-16"><a href="manipulation-de-données-avec-r.html#cb325-16" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(my_mean) <span class="sc">/</span> <span class="fu">sum</span>(my_n)</span>
<span id="cb325-17"><a href="manipulation-de-données-avec-r.html#cb325-17" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(my_max)</span></code></pre></div>
<div id="package-matrix" class="section level4" number="2.7.4.1">
<h4><span class="header-section-number">2.7.4.1</span> Package <strong>Matrix</strong></h4>
<p>Il est possible d’avoir suffisament de mémoires vives pour importer des données, mais pour certaines opérations algébriques et notamment le calcul matriciel, il y a des cas où on a besoin d’avoir plus de mémoires vives que ce dont nous disposons (typiquement une inversion de matrice). Dans ce cas-là, il est important de voir si les données sur lesquelles on travaille sont creuses ou non, c’est-à-dire contenant beaucoup de 0. Si c’est le cas, le package <strong>Matrix</strong> permet d’obtenir de bonnes performances en temps calcul et d’utiliser moins de RAM, grâce aux propriétés des matrices creuses.</p>
<p>Ce package s’utilise très simplement et la plupart des fonctions existantes pour le calcul matriciel (<em>crossprod()</em>, <em>solve()</em>, %&gt;%) s’appliquent directement sur ce type d’objet. Pour plus d’informations sur ce package, consulter la <a href="https://cran.r-project.org/web/packages/Matrix/vignettes/Intro2Matrix.pdf">vignette</a>.</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="manipulation-de-données-avec-r.html#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;Matrix&quot;</span>)</span>
<span id="cb326-2"><a href="manipulation-de-données-avec-r.html#cb326-2" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rbinom</span>(<span class="dv">10000</span>, <span class="dv">1</span>, <span class="fl">0.05</span>), <span class="dv">100</span>, <span class="dv">100</span>)</span>
<span id="cb326-3"><a href="manipulation-de-données-avec-r.html#cb326-3" aria-hidden="true" tabindex="-1"></a><span class="fu">object.size</span>(mat)</span>
<span id="cb326-4"><a href="manipulation-de-données-avec-r.html#cb326-4" aria-hidden="true" tabindex="-1"></a>Mat <span class="ot">&lt;-</span> <span class="fu">as</span>(mat, <span class="st">&quot;Matrix&quot;</span>)</span>
<span id="cb326-5"><a href="manipulation-de-données-avec-r.html#cb326-5" aria-hidden="true" tabindex="-1"></a><span class="fu">object.size</span>(Mat)</span></code></pre></div>
</div>
</div>
<div id="interaction-avec-des-systèmes-de-gestion-de-bases-de-données" class="section level3" number="2.7.5">
<h3><span class="header-section-number">2.7.5</span> Interaction avec des systèmes de gestion de bases de données</h3>
<p>Lorsqu’une entreprise travaille sur de gros volumes de données, cela sous-entend qu’elle dispose de systèmes de gestion de base de données.</p>
<p><strong>R</strong> dispose de plusieurs packages permettant d’intéragir avec des systèmes de gestion de base de données : <strong>RODBC</strong>, <strong>RMySQL</strong>, <strong>RPostgresSQL</strong>, <strong>RSQLite</strong> ainsi qu’avec des bases de données orientées document comme <em>MongoDB</em> et <em>couchDB</em> via les packages <strong>mongolite</strong> et <strong>couchDB</strong>.</p>
<p>Le gros avantage de ces packages est qu’ils permettent de laisser les bases de données trop grandes sur l’espace disque et d’aller récupérer uniquement l’information dont on a besoin en envoyant depuis <strong>R</strong> des requêtes qui seront exécutées sur les systèmes de gestion de base de données.</p>
<p><strong>Bibliographie</strong> pour le traitement de données volumineuses, nous recommendons la lecture de ce document : <a href="https://rpubs.com/msundar/large_data_analysis" class="uri">https://rpubs.com/msundar/large_data_analysis</a></p>
</div>
<div id="utiliser-la-syntaxe-sql" class="section level3" number="2.7.6">
<h3><span class="header-section-number">2.7.6</span> Utiliser la syntaxe SQL</h3>
<p>Pour celles et ceux qui sont familiers avec le langage SQL, le package <strong>sqldf</strong> permet d’utiliser la syntaxe SQL pour faire des requêtes depuis <strong>R</strong>.</p>
<p>Pour plus d’informations, voir : <a href="https://github.com/ggrothendieck/sqldf" class="uri">https://github.com/ggrothendieck/sqldf</a></p>
</div>
</div>
<div id="visualiser-et-traiter-les-données-manquantes" class="section level2" number="2.8">
<h2><span class="header-section-number">2.8</span> Visualiser et traiter les données manquantes</h2>
<p>On présente dans ce paragraphe quelques packages qui permettent de visualiser et traiter les données manquantes. Pour commencer, nous allons générer des valeurs manquantes de façon aléatoire dans le jeu de données <strong>iris</strong> :</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="manipulation-de-données-avec-r.html#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;missForest&quot;</span>)</span>
<span id="cb327-2"><a href="manipulation-de-données-avec-r.html#cb327-2" aria-hidden="true" tabindex="-1"></a>iris.mis <span class="ot">&lt;-</span> <span class="fu">prodNA</span>(iris, <span class="fl">0.05</span>)</span></code></pre></div>
<p>Le package <strong>Amelia</strong> permet de visualiser dans un graphique où sont localisées les données manquantes. Cela permet notamment de voir s’il existe un pattern ou une forme particulière (un bloc par exemple) parmi les valeurs manquantes :</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="manipulation-de-données-avec-r.html#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;Amelia&quot;</span>)</span>
<span id="cb328-2"><a href="manipulation-de-données-avec-r.html#cb328-2" aria-hidden="true" tabindex="-1"></a><span class="fu">missmap</span>(iris.mis, <span class="at">main =</span> <span class="st">&quot;Missing values vs observed&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-156-1.png" width="672" /></p>
<p>On notera également les packages <strong>visdat</strong> et <strong>naniar</strong> qui proposent plusieurs outils pour visualiser les données manquantes. Par exemple, pour savoir si les valeurs manquantes d’une variable sont liées à une autre variable, on peut utiliser l’outils suivant :</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="manipulation-de-données-avec-r.html#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris.mis, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span> </span>
<span id="cb329-2"><a href="manipulation-de-données-avec-r.html#cb329-2" aria-hidden="true" tabindex="-1"></a>  naniar<span class="sc">::</span><span class="fu">geom_miss_point</span>() <span class="sc">+</span> </span>
<span id="cb329-3"><a href="manipulation-de-données-avec-r.html#cb329-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Species)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-157-1.png" width="672" /></p>
<p>Pour traiter les données manquantes, il existe plusieurs façons de procéder :</p>
<ul>
<li>ne rien faire. Dans ce cas, certaines fonctions comme la fonction <em>lm()</em> enlève automatiquement les observations dès lors qu’il existe au moins une valeur manquante parmi les variables à expliquer et explicatives :</li>
</ul>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="manipulation-de-données-avec-r.html#cb330-1" aria-hidden="true" tabindex="-1"></a>res_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sepal.Width <span class="sc">~</span> Sepal.Length <span class="sc">+</span> Petal.Length <span class="sc">+</span> </span>
<span id="cb330-2"><a href="manipulation-de-données-avec-r.html#cb330-2" aria-hidden="true" tabindex="-1"></a>             Petal.Width <span class="sc">+</span> Species, <span class="at">data =</span> iris.mis)</span></code></pre></div>
<ul>
<li>supression des observations contenant au moins une valeur manquante en utilisant la fonction <em>subset()</em> ou <em>filter()</em> (du package <strong>dplyr</strong>)</li>
</ul>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="manipulation-de-données-avec-r.html#cb331-1" aria-hidden="true" tabindex="-1"></a>iris.mis <span class="ot">&lt;-</span> <span class="fu">subset</span>(iris.mis, <span class="sc">!</span><span class="fu">is.na</span>(Species))</span></code></pre></div>
<ul>
<li>imputation par la moyenne ou la médiane lorsqu’il s’agit d’une variable numérique ou alors par le mode lorsqu’il s’agit d’une variable qualitative.</li>
</ul>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="manipulation-de-données-avec-r.html#cb332-1" aria-hidden="true" tabindex="-1"></a>ind_NA_Sepal.Length <span class="ot">&lt;-</span> <span class="fu">is.na</span>(iris.mis<span class="sc">$</span>Sepal.Length)</span>
<span id="cb332-2"><a href="manipulation-de-données-avec-r.html#cb332-2" aria-hidden="true" tabindex="-1"></a>mean_spec <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(Sepal.Length <span class="sc">~</span> Species, </span>
<span id="cb332-3"><a href="manipulation-de-données-avec-r.html#cb332-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> iris.mis, <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> T)</span>
<span id="cb332-4"><a href="manipulation-de-données-avec-r.html#cb332-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">levels</span>(iris.mis<span class="sc">$</span>Species)) {</span>
<span id="cb332-5"><a href="manipulation-de-données-avec-r.html#cb332-5" aria-hidden="true" tabindex="-1"></a> iris.mis[ind_NA_Sepal.Length <span class="sc">&amp;</span> iris.mis<span class="sc">$</span>Species <span class="sc">==</span> k, </span>
<span id="cb332-6"><a href="manipulation-de-données-avec-r.html#cb332-6" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;Sepal.Length&quot;</span>] <span class="ot">&lt;-</span> mean_spec[mean_spec<span class="sc">$</span>Species <span class="sc">==</span> k, <span class="dv">2</span>]</span>
<span id="cb332-7"><a href="manipulation-de-données-avec-r.html#cb332-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>imputation en utilisant des modèles linéaires afin de prédire les valeurs manquantes. Par exemple :</li>
</ul>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="manipulation-de-données-avec-r.html#cb333-1" aria-hidden="true" tabindex="-1"></a>iris.imp_mean <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sapply</span>(iris.mis[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], </span>
<span id="cb333-2"><a href="manipulation-de-données-avec-r.html#cb333-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(x), x, <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T))),</span>
<span id="cb333-3"><a href="manipulation-de-données-avec-r.html#cb333-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Species =</span> iris.mis<span class="sc">$</span>Species)</span>
<span id="cb333-4"><a href="manipulation-de-données-avec-r.html#cb333-4" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict.lm</span>(res_lm, <span class="at">newdata =</span> iris.imp_mean)</span>
<span id="cb333-5"><a href="manipulation-de-données-avec-r.html#cb333-5" aria-hidden="true" tabindex="-1"></a>iris.mis[<span class="fu">is.na</span>(iris.mis<span class="sc">$</span>Sepal.Width), <span class="st">&quot;Sepal.Width&quot;</span>] <span class="ot">&lt;-</span></span>
<span id="cb333-6"><a href="manipulation-de-données-avec-r.html#cb333-6" aria-hidden="true" tabindex="-1"></a>  pred[<span class="fu">is.na</span>(iris.mis<span class="sc">$</span>Sepal.Width)]</span></code></pre></div>
<ul>
<li>imputation en utilisant des modèles de prédiction sophistiqués issus du machine learning. Par exemple, les forêts aléatoires ou les <span class="math inline">\(K\)</span>-plus proches voisins :</li>
</ul>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="manipulation-de-données-avec-r.html#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;missForest&quot;</span>)</span>
<span id="cb334-2"><a href="manipulation-de-données-avec-r.html#cb334-2" aria-hidden="true" tabindex="-1"></a>iris.imp <span class="ot">&lt;-</span> <span class="fu">missForest</span>(iris.mis)</span></code></pre></div>
<pre><code>##   missForest iteration 1 in progress...done!
##   missForest iteration 2 in progress...done!
##   missForest iteration 3 in progress...done!
##   missForest iteration 4 in progress...done!</code></pre>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="manipulation-de-données-avec-r.html#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;VIM&quot;</span>)</span>
<span id="cb336-2"><a href="manipulation-de-données-avec-r.html#cb336-2" aria-hidden="true" tabindex="-1"></a>iris.knn <span class="ot">&lt;-</span> <span class="fu">kNN</span>(iris.mis, <span class="at">k =</span> <span class="dv">2</span>)</span></code></pre></div>
</div>
<div id="répertoires-et-fichiers" class="section level2" number="2.9">
<h2><span class="header-section-number">2.9</span> Répertoires et fichiers</h2>
<p>Il existe plusieurs fonctions de base qui permettent la gestion des répertoires et fichiers. L’utilisation de la plupart de ces fonctions est intéressante lors de l’écriture de scripts “propres” qui stockeront les résultats dans des fichiers bien rangés dans des répertoires bien nommés.</p>
<p>Parmi ces fonctions :</p>
<ul>
<li>la fonction <em>getwd()</em> retourne le chemin du répertoire de travail. Il s’agit du répertoire où seront sauvegardées par défaut les différentes opérations de sauvegarde (graphiques, codes, fichier historique, etc.) :</li>
</ul>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="manipulation-de-données-avec-r.html#cb337-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div>
<pre><code>## [1] &quot;/home/laurent/Documents/R_book/R_book&quot;</code></pre>
<ul>
<li>la fonction <em>dir()</em> retourne les fichiers et répertoires situés dans le chemin spécifié et éventuellement ses sous-répertoires (options <strong>recursive = TRUE</strong>). Par défaut, il s’agit du chemin correspondant à l’environnement de travail actuel (donné par <em>getwd()</em>) :</li>
</ul>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="manipulation-de-données-avec-r.html#cb339-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;_book&quot;                  &quot;_bookdown_files&quot;        &quot;_bookdown.yml&quot;         
##  [4] &quot;_main_files&quot;            &quot;_main.log&quot;              &quot;_main.pdf&quot;             
##  [7] &quot;_main.Rmd&quot;              &quot;_main.tex&quot;              &quot;_output.yml&quot;           
## [10] &quot;01-data-management.Rmd&quot; &quot;02-programming.Rmd&quot;     &quot;03-parallel.Rmd&quot;       
## [13] &quot;04_graphics.Rmd&quot;        &quot;05-intro.Rmd&quot;           &quot;06-cross-refs.Rmd&quot;     
## [16] &quot;07-parts.Rmd&quot;           &quot;07-references.Rmd&quot;      &quot;08-citations.Rmd&quot;      
## [19] &quot;09-blocks.Rmd&quot;          &quot;10-share.Rmd&quot;           &quot;book.bib&quot;              
## [22] &quot;fichier.txt&quot;            &quot;Figures&quot;                &quot;index.Rmd&quot;             
## [25] &quot;packages.bib&quot;           &quot;preamble.tex&quot;           &quot;R&quot;                     
## [28] &quot;R_book.Rproj&quot;           &quot;README.md&quot;              &quot;Sorties&quot;               
## [31] &quot;style.css&quot;</code></pre>
<ul>
<li>la fonction <em>file.info()</em> prend comme argument d’entrée des chemins de fichiers ou répertoires et retourne des informations les concernant (taille, etc.) :</li>
</ul>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="manipulation-de-données-avec-r.html#cb341-1" aria-hidden="true" tabindex="-1"></a><span class="fu">file.info</span>(<span class="fu">dir</span>())</span></code></pre></div>
<ul>
<li>la fonction <em>R.home()</em> retourne l’emplacement de <strong>R</strong> :</li>
</ul>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="manipulation-de-données-avec-r.html#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="fu">R.home</span>()</span></code></pre></div>
<pre><code>## [1] &quot;/usr/lib/R&quot;</code></pre>
<ul>
<li>la fonction <em>file.access()</em> donne des informations sur la permission accordée aux fichiers. Les permissions qui sont testées sont : existence (0), exécution (1), écriture (2) et lecture (4). La fonction retourne la valeur 0 pour oui et -1 pour non. Dans l’exemple qui suit, les fichiers qui sont situés dans le chemin où se situe <strong>R</strong> peuvent être lus et exécutés, mais sont en revanche protégés en écriture :</li>
</ul>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="manipulation-de-données-avec-r.html#cb344-1" aria-hidden="true" tabindex="-1"></a>fic <span class="ot">&lt;-</span> <span class="fu">dir</span>(<span class="fu">file.path</span>(<span class="fu">R.home</span>(), <span class="st">&quot;bin&quot;</span>), <span class="at">full =</span> T)</span>
<span id="cb344-2"><a href="manipulation-de-données-avec-r.html#cb344-2" aria-hidden="true" tabindex="-1"></a><span class="fu">file.access</span>(fic, <span class="dv">0</span>)</span>
<span id="cb344-3"><a href="manipulation-de-données-avec-r.html#cb344-3" aria-hidden="true" tabindex="-1"></a><span class="fu">file.access</span>(fic, <span class="dv">1</span>)</span>
<span id="cb344-4"><a href="manipulation-de-données-avec-r.html#cb344-4" aria-hidden="true" tabindex="-1"></a><span class="fu">file.access</span>(fic, <span class="dv">2</span>)</span>
<span id="cb344-5"><a href="manipulation-de-données-avec-r.html#cb344-5" aria-hidden="true" tabindex="-1"></a><span class="fu">file.access</span>(fic, <span class="dv">4</span>)</span></code></pre></div>
<ul>
<li>la fonction <em>dir.exists()</em> teste l’existence d’un répertoire et la fonction <em>dir.create()</em> créé un répertoire.</li>
</ul>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="manipulation-de-données-avec-r.html#cb345-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;Sorties&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in dir.create(&quot;Sorties&quot;): &#39;Sorties&#39; existe déjà</code></pre>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="manipulation-de-données-avec-r.html#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.exists</span>(<span class="st">&quot;Sorties&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p><strong>Exercice 1.10.</strong></p>
<p>écrire une fonction qui, à partir d’un nombre entier <span class="math inline">\(n\)</span> passé en paramètre, effectue un tirage aléatoire de <span class="math inline">\(n\)</span> valeurs selon une loi normale <span class="math inline">\(\mathcal{N}(0,1)\)</span> puis renvoie les valeurs générées dans un fichier d’un répertoire <em>Num</em> et trace une boxplot de ces données qui sera stockée dans un fichier <em>.jpg</em> du répertoire <em>Graph</em>.</p>
</div>
<div id="autour-de-lespace-de-travail" class="section level2" number="2.10">
<h2><span class="header-section-number">2.10</span> Autour de l’espace de travail</h2>
<p>La fonction <em>search()</em> donne la liste des packages (mais pas seulement) attachés à l’espace de travail. En gros, il s’agit des packages et environnements auxquels il est possible d’accéder dans la session en cours à l’instant <span class="math inline">\(t\)</span>. Cette liste évolue bien entendu au fur et à mesure de la session :</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="manipulation-de-données-avec-r.html#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="fu">search</span>()</span>
<span id="cb349-2"><a href="manipulation-de-données-avec-r.html#cb349-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;foreign&quot;</span>)</span>
<span id="cb349-3"><a href="manipulation-de-données-avec-r.html#cb349-3" aria-hidden="true" tabindex="-1"></a><span class="fu">search</span>()</span></code></pre></div>
<p>L’option <strong>pos</strong> de la fonction <em>ls()</em> permet de lister le contenu d’un package particulier en donnant sa position dans la liste renvoyée par <em>search()</em>. Vous pourrez en choisissant le bon indice, vous rendre compte de l’ensemble des fonctions accessibles depuis le package <strong>base</strong> :</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="manipulation-de-données-avec-r.html#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>(<span class="at">pos =</span> <span class="fu">which</span>(<span class="fu">search</span>() <span class="sc">==</span> <span class="st">&quot;package:base&quot;</span>))</span></code></pre></div>
<p>Certains packages peuvent avoir des fonctions portant le même nom ; d’où le message d’avertissement ci-dessous au moment de charger un nouveau package, indiquant qu’un objet est masqué dans un package situé plus loin dans la liste <em>search()</em>.</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="manipulation-de-données-avec-r.html#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;pls&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Attachement du package : &#39;pls&#39;</code></pre>
<pre><code>## L&#39;objet suivant est masqué depuis &#39;package:stats&#39;:
## 
##     loadings</code></pre>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="manipulation-de-données-avec-r.html#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="fu">search</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;.GlobalEnv&quot;           &quot;package:pls&quot;          &quot;package:VIM&quot;         
##  [4] &quot;package:grid&quot;         &quot;package:colorspace&quot;   &quot;package:Amelia&quot;      
##  [7] &quot;package:Rcpp&quot;         &quot;package:missForest&quot;   &quot;package:itertools&quot;   
## [10] &quot;package:iterators&quot;    &quot;package:foreach&quot;      &quot;package:randomForest&quot;
## [13] &quot;package:data.table&quot;   &quot;package:forcats&quot;      &quot;package:dplyr&quot;       
## [16] &quot;package:purrr&quot;        &quot;package:readr&quot;        &quot;package:tidyr&quot;       
## [19] &quot;package:tibble&quot;       &quot;package:ggplot2&quot;      &quot;package:tidyverse&quot;   
## [22] &quot;package:gplots&quot;       &quot;package:zoo&quot;          &quot;package:classInt&quot;    
## [25] &quot;package:glue&quot;         &quot;package:stringr&quot;      &quot;package:wordcloud&quot;   
## [28] &quot;package:RColorBrewer&quot; &quot;package:stats&quot;        &quot;package:graphics&quot;    
## [31] &quot;package:grDevices&quot;    &quot;package:utils&quot;        &quot;package:datasets&quot;    
## [34] &quot;package:methods&quot;      &quot;Autoloads&quot;            &quot;package:base&quot;</code></pre>
<p>Dans ce cas, si on souhaite obtenir l’aide de la “bonne” fonction, il suffit de précéder le nom de la fonction par le nom du package suivi de <em>::</em>.</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="manipulation-de-données-avec-r.html#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="fu">find</span>(<span class="st">&quot;loadings&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;package:pls&quot;   &quot;package:stats&quot;</code></pre>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="manipulation-de-données-avec-r.html#cb358-1" aria-hidden="true" tabindex="-1"></a>?loadings</span></code></pre></div>
<pre><code>## Help on topic &#39;loadings&#39; was found in the following packages:
## 
##   Package               Library
##   pls                   /home/laurent/R/x86_64-pc-linux-gnu-library/4.1
##   stats                 /usr/lib/R/library
## 
## 
## Utilisation de la première correspondance ...</code></pre>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="manipulation-de-données-avec-r.html#cb360-1" aria-hidden="true" tabindex="-1"></a>?stats<span class="sc">::</span>loadings</span></code></pre></div>
<p><strong>Remarque :</strong> on pourra procéder de la même façon pour être sûr d’exécuter la “bonne” fonction.</p>
<p>On a vu précédement que pour accéder à un élément d’une <strong>list</strong> ou d’un <strong>data.frame</strong>, il est nécessaire d’appeler cet objet suivi de l’opérateur <strong>$</strong>. Il existe au moins deux façons de simplifier cette opération. La première consiste à utiliser la fonction <em>with()</em> :</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="manipulation-de-données-avec-r.html#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(airquality,</span>
<span id="cb361-2"><a href="manipulation-de-données-avec-r.html#cb361-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">summary</span>(Ozone))</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##    1.00   18.00   31.50   42.13   63.25  168.00      37</code></pre>
<p>La seconde consiste à utiliser la fonction <em>attach()</em> qui permet d’attacher tous les éléments d’un objet dans l’environnement de travail comme s’il s’agissait d’un package.</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="manipulation-de-données-avec-r.html#cb363-1" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">e_vec_x =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb363-2"><a href="manipulation-de-données-avec-r.html#cb363-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">e_fic1 =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x), </span>
<span id="cb363-3"><a href="manipulation-de-données-avec-r.html#cb363-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">e_fic2 =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>((x<span class="sc">-</span><span class="fu">e_fic1</span>(x))<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb363-4"><a href="manipulation-de-données-avec-r.html#cb363-4" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(e)</span>
<span id="cb363-5"><a href="manipulation-de-données-avec-r.html#cb363-5" aria-hidden="true" tabindex="-1"></a><span class="fu">search</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;.GlobalEnv&quot;           &quot;e&quot;                    &quot;package:pls&quot;         
##  [4] &quot;package:VIM&quot;          &quot;package:grid&quot;         &quot;package:colorspace&quot;  
##  [7] &quot;package:Amelia&quot;       &quot;package:Rcpp&quot;         &quot;package:missForest&quot;  
## [10] &quot;package:itertools&quot;    &quot;package:iterators&quot;    &quot;package:foreach&quot;     
## [13] &quot;package:randomForest&quot; &quot;package:data.table&quot;   &quot;package:forcats&quot;     
## [16] &quot;package:dplyr&quot;        &quot;package:purrr&quot;        &quot;package:readr&quot;       
## [19] &quot;package:tidyr&quot;        &quot;package:tibble&quot;       &quot;package:ggplot2&quot;     
## [22] &quot;package:tidyverse&quot;    &quot;package:gplots&quot;       &quot;package:zoo&quot;         
## [25] &quot;package:classInt&quot;     &quot;package:glue&quot;         &quot;package:stringr&quot;     
## [28] &quot;package:wordcloud&quot;    &quot;package:RColorBrewer&quot; &quot;package:stats&quot;       
## [31] &quot;package:graphics&quot;     &quot;package:grDevices&quot;    &quot;package:utils&quot;       
## [34] &quot;package:datasets&quot;     &quot;package:methods&quot;      &quot;Autoloads&quot;           
## [37] &quot;package:base&quot;</code></pre>
<p>Ensuite, il est possible d’accéder directement aux éléments de la liste sans avoir à appeler l’objet <strong>e</strong> :</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="manipulation-de-données-avec-r.html#cb365-1" aria-hidden="true" tabindex="-1"></a><span class="fu">e_fic1</span>(e_vec_x)</span></code></pre></div>
<pre><code>## [1] 0.6690173</code></pre>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="manipulation-de-données-avec-r.html#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="fu">e_fic2</span>(e_vec_x)</span></code></pre></div>
<pre><code>## [1] 0.9399229</code></pre>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="manipulation-de-données-avec-r.html#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(e)</span></code></pre></div>
<p><strong>Attention :</strong> il faut être très prudent avec la fonction <em>attach()</em>, car cela peut créer des conflits avec l’environnement global.</p>
<p><strong>Remarque :</strong> il est parfois utile de connaître certains détails de l’environnement de travail notamment pour comprendre <em>pourquoi ça ne marche pas !!!</em> (voir dessin ci-dessous). Les fonctions <em>sessionInfo()</em> et <em>R.Version()</em> peuvent permettre d’identifier certaines incompatibilités entre notre version de <strong>R</strong> et un package particulier que l’on vient d’installer.</p>
<div class="figure">
<img src="Figures/version.png" alt="" />
<p class="caption">ça ne marche pas !!!</p>
</div>
<p><strong>Exercice 1.11.</strong></p>
<p><strong>Q1</strong> Quel est l’inconvénient illustré par les manipulations de <em>e_fic1()</em>, <strong>e_vec_x</strong> et <em>e_fic2()</em> ?</p>
<p><strong>Q2</strong> à quoi sert l’opérateur <strong>::</strong> ?</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="programmation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/01-data-management.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
